<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Mascote</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        theme: {
                            bg: '#0a0a0c',
                            panel: '#0f0f12',
                            border: '#2a2a2e',
                            text: '#e8e4dc',
                            pink: '#ec4899',
                            red: '#dc2626',
                            purple: '#8b5cf6',
                            yellow: '#f59e0b',
                            blue: '#4a9eff',
                            green: '#22c55e',
                            cyan: '#06b6d4',
                            orange: '#ff6b35',
                            teal: '#14b8a6',
                            indigo: '#6366f1',
                            muted: '#606060'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: #e8e4dc; }
        
        /* Animações */
        .anim-entry { animation: fadeInUp 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Animações para efeitos especiais */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes shine { 0% { background-position: -200px; } 100% { background-position: calc(200px + 100%); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        
        .animate-pulse-slow { animation: pulse 2s infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-shine { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); background-size: 200px 100%; animation: shine 3s infinite; }
        
        /* Estilos customizados para cards */
        .creature-card { transition: all 0.3s ease; cursor: pointer; }
        .creature-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .creature-card.selected { border-color: #ec4899; box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.3); }
        
        /* Estilos para habilidades */
        .skill-badge { transition: all 0.2s ease; }
        .skill-badge:hover { transform: scale(1.05); }
        .skill-badge.buff { background: linear-gradient(135deg, #22c55e20, #16a34a20); border-color: #22c55e; }
        .skill-badge.debuff { background: linear-gradient(135deg, #dc262620, #b91c1c20); border-color: #dc2626; }
        .skill-badge.self { background: linear-gradient(135deg, #3b82f620, #1d4ed820); border-color: #3b82f6; }
        
        /* Estilo para passivas */
        .passive-effect { 
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(168, 85, 247, 0.1));
            border-left: 3px solid #8b5cf6;
        }
        
        /* Custom Range Input */
        input[type=range] { appearance: none; -webkit-appearance: none; background: transparent; width: 100%; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%;
            background: #ec4899; cursor: pointer; border: 2px solid #0a0a0c; box-shadow: 0 0 10px rgba(236, 72, 153, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track { 
            width: 100%; height: 6px; cursor: pointer; 
            background: linear-gradient(90deg, #2a2a2e, #3a3a3e); 
            border-radius: 3px; 
        }
        
        /* Estilo para atributos */
        .stat-circle { 
            width: 60px; height: 60px; 
            border: 2px solid; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            position: relative; overflow: hidden;
        }
        .stat-circle::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: conic-gradient(currentColor 0% var(--percentage), transparent var(--percentage) 100%);
            border-radius: 50%;
        }
        .stat-circle span { position: relative; z-index: 2; font-weight: bold; }
        
        /* Modal de customização */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #0f0f12; border: 1px solid #2a2a2e;
            border-radius: 12px; width: 90%; max-width: 600px;
            max-height: 90vh; overflow-y: auto;
        }
        
        /* Estilos para tipos customizados */
        .custom-type-badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 2px 8px; border-radius: 12px; font-size: 11px;
            background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body class="min-h-screen font-sans pb-12">

    <!-- Modal de Customização de Tipo -->
    <div id="custom-type-modal" class="modal-backdrop hidden">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-cinzel text-xl font-bold text-theme-purple">
                    <i data-lucide="plus-circle" class="w-5 h-5 inline mr-2"></i>
                    Criar Novo Tipo de Criatura
                </h3>
                <button onclick="closeCustomTypeModal()" class="text-theme-muted hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Nome do Tipo</label>
                    <input type="text" id="custom-type-name" placeholder="Ex: Elemental, Cósmico, Mutante..."
                           class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-theme-purple outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Cor do Tipo</label>
                    <div class="grid grid-cols-6 gap-2">
                        <button onclick="selectColor('#ec4899')" class="w-10 h-10 rounded-full bg-[#ec4899] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#8b5cf6')" class="w-10 h-10 rounded-full bg-[#8b5cf6] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#4a9eff')" class="w-10 h-10 rounded-full bg-[#4a9eff] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#22c55e')" class="w-10 h-10 rounded-full bg-[#22c55e] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#f59e0b')" class="w-10 h-10 rounded-full bg-[#f59e0b] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#dc2626')" class="w-10 h-10 rounded-full bg-[#dc2626] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#06b6d4')" class="w-10 h-10 rounded-full bg-[#06b6d4] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#ff6b35')" class="w-10 h-10 rounded-full bg-[#ff6b35] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#14b8a6')" class="w-10 h-10 rounded-full bg-[#14b8a6] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#6366f1')" class="w-10 h-10 rounded-full bg-[#6366f1] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#a855f7')" class="w-10 h-10 rounded-full bg-[#a855f7] border-2 border-transparent hover:border-white"></button>
                        <button onclick="selectColor('#84cc16')" class="w-10 h-10 rounded-full bg-[#84cc16] border-2 border-transparent hover:border-white"></button>
                    </div>
                    <div class="mt-3">
                        <input type="color" id="custom-type-color" value="#ec4899" 
                               class="w-full h-10 cursor-pointer bg-transparent border-0">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Ícone</label>
                    <div class="grid grid-cols-8 gap-2 mb-3">
                        <button onclick="selectIcon('dog')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="dog" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('cat')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="cat" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('bird')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="bird" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('fish')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="fish" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('rabbit')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="rabbit" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('snake')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="snake" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('bug')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="bug" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('spider')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="spider" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-8 gap-2">
                        <button onclick="selectIcon('sparkles')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="sparkles" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('flame')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="flame" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('droplet')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="droplet" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('wind')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="wind" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('mountain')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="mountain" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('zap')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="zap" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('brain')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="brain" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                        <button onclick="selectIcon('ghost')" class="p-2 rounded-lg border border-theme-border hover:border-theme-purple bg-theme-bg">
                            <i data-lucide="ghost" class="w-5 h-5 text-white mx-auto"></i>
                        </button>
                    </div>
                    <input type="text" id="custom-type-icon" value="dog" class="hidden">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Passiva Especial</label>
                    <textarea id="custom-type-passiva" placeholder="Descreva a passiva especial deste tipo..."
                              class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-theme-purple outline-none h-32 resize-none"></textarea>
                    <p class="text-xs text-theme-muted mt-2">
                        Exemplos: "+10% de dano elemental", "Imune a efeitos de sono", "Cura 2% da vida máxima por turno"
                    </p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Descrição (Opcional)</label>
                    <textarea id="custom-type-descricao" placeholder="Descreva características comuns deste tipo..."
                              class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-theme-purple outline-none h-24 resize-none"></textarea>
                </div>
                
                <div class="flex gap-3 pt-4 border-t border-theme-border">
                    <button onclick="closeCustomTypeModal()" class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors">
                        Cancelar
                    </button>
                    <button onclick="saveCustomType()" class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-purple to-pink-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                        Criar Tipo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Tipos -->
    <div id="manage-types-modal" class="modal-backdrop hidden">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-cinzel text-xl font-bold text-theme-purple">
                    <i data-lucide="list" class="w-5 h-5 inline mr-2"></i>
                    Gerenciar Tipos de Criatura
                </h3>
                <button onclick="closeManageTypesModal()" class="text-theme-muted hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div id="custom-types-list" class="space-y-3 max-h-[400px] overflow-y-auto mb-6">
                <!-- Tipos customizados serão inseridos aqui -->
            </div>
            
            <div class="flex gap-3 pt-4 border-t border-theme-border">
                <button onclick="closeManageTypesModal()" class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors">
                    Fechar
                </button>
                <button onclick="openCustomTypeModal()" class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-blue to-cyan-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                    <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                    Novo Tipo
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edição de Passiva -->
    <div id="edit-passiva-modal" class="modal-backdrop hidden">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-cinzel text-xl font-bold text-theme-purple">
                    <i data-lucide="edit" class="w-5 h-5 inline mr-2"></i>
                    Editar Passiva
                </h3>
                <button onclick="closeEditPassivaModal()" class="text-theme-muted hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Passiva Especial</label>
                    <textarea id="edit-passiva-text" placeholder="Descreva a passiva especial..."
                              class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-theme-purple outline-none h-32 resize-none"></textarea>
                    <p class="text-xs text-theme-muted mt-2">
                        A passiva é um efeito passivo que está sempre ativo para este tipo de criatura.
                    </p>
                </div>
                
                <div class="flex gap-3 pt-4 border-t border-theme-border">
                    <button onclick="closeEditPassivaModal()" class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors">
                        Cancelar
                    </button>
                    <button onclick="savePassiva()" class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-purple to-pink-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                        Salvar Passiva
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="print-area">
        
        <nav class="w-full bg-[#0f0f12]/95 backdrop-blur-sm border-b border-theme-border sticky top-0 z-50 mb-8" data-html2pdf-ignore="true">
            <div class="max-w-7xl mx-auto px-4 flex items-center gap-4 py-4">
                <a href="index.html" class="text-theme-text hover:text-theme-pink transition-colors">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </a>
                <div class="h-6 w-[1px] bg-theme-border"></div>
                <span class="font-cinzel font-bold text-lg tracking-wide text-theme-pink">Grimório Digital</span>
                <div class="h-6 w-[1px] bg-theme-border"></div>
                <span class="text-sm text-theme-muted">Mascote</span>
            </div>
            <div class="h-[1px] bg-gradient-to-r from-transparent via-theme-pink to-transparent"></div>
        </nav>

        <div class="max-w-6xl mx-auto px-4 space-y-6">

            <!-- Cabeçalho -->
            <header class="flex items-center justify-between mb-6 anim-entry">
                <div class="flex items-center gap-4">
                    <div class="p-3 rounded-lg bg-gradient-to-br from-theme-pink/20 to-purple-600/20 border border-theme-pink/30">
                        <i data-lucide="dog" class="w-8 h-8 text-theme-pink"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-cinzel font-bold text-white">Mascote</h1>
                        <p class="text-gray-400">Seu companheiro fiel na aventura</p>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="flex items-center gap-2 px-4 py-2 bg-theme-panel border border-theme-border rounded-lg">
                        <i data-lucide="star" class="w-4 h-4 text-theme-yellow"></i>
                        <span class="font-mono text-theme-yellow" id="mascote-nivel-display">Nível 1</span>
                    </div>
                </div>
            </header>

            <!-- Seção 1: Seleção de Tipo e Nome -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.1s; border-left: 4px solid #ec4899;">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-pink">
                        <i data-lucide="sparkles" class="w-4 h-4"></i> Identidade do Mascote
                    </h3>
                    <div class="flex items-center gap-2 text-sm text-theme-muted">
                        <i data-lucide="clock" class="w-3 h-3"></i>
                        <span id="last-saved">Não salvo</span>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div class="md:col-span-2">
                        <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2 font-cinzel">
                            <i data-lucide="tag" class="w-3 h-3 inline mr-1"></i>Nome do Mascote
                        </label>
                        <div class="flex items-center border-2 border-theme-border rounded-lg px-4 py-3 focus-within:border-theme-pink transition-colors group">
                            <i data-lucide="dog" class="w-5 h-5 text-theme-muted mr-3 group-focus-within:text-theme-pink transition-colors"></i>
                            <input type="text" id="mascote-nome" placeholder="Ex: Lobo da Lua, Corvo Sombrio..." 
                                   class="w-full bg-transparent text-lg font-cinzel outline-none text-white placeholder-gray-600"
                                   oninput="autoSave()">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2 font-cinzel">
                            <i data-lucide="star" class="w-3 h-3 inline mr-1"></i>Nível
                        </label>
                        <div class="flex items-center border-2 border-theme-border rounded-lg px-4 py-3 focus-within:border-theme-yellow transition-colors">
                            <i data-lucide="trending-up" class="w-5 h-5 text-theme-muted mr-3"></i>
                            <input type="number" id="mascote-nivel" value="1" min="1" max="20" 
                                   class="w-full bg-transparent text-xl font-mono font-bold outline-none text-theme-yellow text-center"
                                   onchange="updateNivelDisplay(); autoSave();">
                        </div>
                    </div>
                </div>

                <!-- Seleção de Tipo de Criatura -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <label class="block text-xs uppercase tracking-widest text-theme-muted font-cinzel">
                            <i data-lucide="git-branch" class="w-3 h-3 inline mr-1"></i>Tipo de Criatura
                        </label>
                        <div class="flex gap-2">
                            <button onclick="openManageTypesModal()" class="text-xs text-theme-blue hover:text-theme-cyan flex items-center gap-1">
                                <i data-lucide="settings" class="w-3 h-3"></i>
                                Gerenciar
                            </button>
                            <button onclick="openCustomTypeModal()" class="text-xs text-theme-green hover:text-green-400 flex items-center gap-1">
                                <i data-lucide="plus" class="w-3 h-3"></i>
                                Criar Novo
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-4" id="tipo-container">
                        <!-- Tipos serão inseridos via JavaScript -->
                    </div>
                    
                    <div class="text-center">
                        <button onclick="openCustomTypeModal()" 
                                class="inline-flex items-center gap-2 px-4 py-2 border-2 border-dashed border-theme-border rounded-lg text-theme-muted hover:text-white hover:border-theme-purple transition-all group">
                            <i data-lucide="plus-circle" class="w-4 h-4 group-hover:text-theme-purple"></i>
                            <span class="text-sm">Criar Tipo Personalizado</span>
                        </button>
                    </div>
                </div>

                <!-- Passiva Especial -->
                <div id="passiva-container" class="mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <label class="block text-xs uppercase tracking-widest text-theme-muted font-cinzel">
                            <i data-lucide="zap" class="w-3 h-3 inline mr-1"></i>Passiva Especial
                        </label>
                        <button onclick="openEditPassivaModal()" class="text-xs text-theme-blue hover:text-theme-cyan flex items-center gap-1">
                            <i data-lucide="edit" class="w-3 h-3"></i>
                            Editar
                        </button>
                    </div>
                    <div id="passiva-content" class="passive-effect p-4 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="p-2 rounded-lg bg-theme-purple/20">
                                <i data-lucide="zap" class="w-5 h-5 text-theme-purple"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold mb-1 text-theme-purple">Passiva do Mascote</h4>
                                <p id="passiva-text" class="text-sm text-white">
                                    Clique em "Editar" para criar uma passiva especial para seu mascote.
                                </p>
                                <p class="text-xs text-theme-muted mt-1">Passiva sempre ativa</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção 2: Status e Atributos -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.2s; border-left: 4px solid #dc2626;">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-red mb-6">
                    <i data-lucide="activity" class="w-4 h-4"></i> Status do Mascote
                </h3>

                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Vida -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i data-lucide="heart" class="w-4 h-4 text-theme-red"></i>
                                <span class="text-sm font-medium text-theme-red">Vida</span>
                            </div>
                            <span class="text-xs text-theme-muted" id="vida-pct">100%</span>
                        </div>
                        <div class="h-2 bg-[#1a1a1e] rounded-full overflow-hidden mb-2">
                            <div id="bar-vida" class="h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-500" style="width: 100%"></div>
                        </div>
                        <div class="flex gap-2 justify-center items-center">
                            <input type="number" id="vida-atual" value="50" min="0" max="999" 
                                   oninput="updateVida(); autoSave();" 
                                   class="w-16 bg-transparent text-center border-b border-theme-border text-white font-mono focus:outline-none focus:border-theme-red">
                            <span class="text-theme-muted">/</span>
                            <input type="number" id="vida-max" value="50" min="1" max="999" 
                                   oninput="updateVida(); autoSave();" 
                                   class="w-16 bg-transparent text-center border-b border-theme-border text-white font-mono focus:outline-none focus:border-theme-red">
                        </div>
                    </div>

                    <!-- Lealdade -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i data-lucide="heart-handshake" class="w-4 h-4 text-theme-pink"></i>
                                <span class="text-sm font-medium text-theme-pink">Lealdade</span>
                            </div>
                            <span class="text-xs text-theme-muted" id="lealdade-value">80%</span>
                        </div>
                        <div class="h-2 bg-[#1a1a1e] rounded-full overflow-hidden mb-3">
                            <div id="bar-lealdade" class="h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-500" style="width: 80%"></div>
                        </div>
                        <input type="range" id="input-lealdade" min="0" max="100" value="80" 
                               oninput="updateLealdade(); autoSave();" class="w-full">
                        <p id="lealdade-texto" class="text-theme-muted text-sm text-center mt-1">Leal</p>
                    </div>

                    <!-- Agilidade -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i data-lucide="wind" class="w-4 h-4 text-theme-green"></i>
                                <span class="text-sm font-medium text-theme-green">Agilidade</span>
                            </div>
                        </div>
                        <div class="stat-circle mx-auto mb-2" style="--percentage: 70%; color: #fefefe;">
                            <span class="text-2xl" id="agilidade-value">70</span>
                        </div>
                        <input type="range" id="input-agilidade" min="1" max="100" value="70" 
                               oninput="updateAgilidade(); autoSave();" class="w-full">
                    </div>

                    <!-- Força -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i data-lucide="sword" class="w-4 h-4 text-theme-orange"></i>
                                <span class="text-sm font-medium text-theme-orange">Força</span>
                            </div>
                        </div>
                        <div class="stat-circle mx-auto mb-2" style="--percentage: 60%; color: #ffffff;">
                            <span class="text-2xl" id="forca-value">60</span>
                        </div>
                        <input type="range" id="input-forca" min="1" max="100" value="60" 
                               oninput="updateForca(); autoSave();" class="w-full">
                    </div>
                </div>

                <!-- Atributos Adicionais -->
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="eye" class="w-4 h-4 text-theme-blue"></i>
                            <span class="text-sm font-medium">Percepção</span>
                        </div>
                        <input type="number" id="input-percepcao" value="65" min="1" max="100" 
                               oninput="updatePercepcao(); autoSave();" 
                               class="w-full bg-transparent text-center text-2xl font-bold font-mono outline-none text-theme-blue">
                    </div>
                    
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="shield" class="w-4 h-4 text-theme-purple"></i>
                            <span class="text-sm font-medium">Defesa</span>
                        </div>
                        <input type="number" id="input-defesa" value="55" min="1" max="100" 
                               oninput="updateDefesa(); autoSave();" 
                               class="w-full bg-transparent text-center text-2xl font-bold font-mono outline-none text-theme-purple">
                    </div>
                    
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="zap" class="w-4 h-4 text-theme-yellow"></i>
                            <span class="text-sm font-medium">Energia</span>
                        </div>
                        <input type="number" id="input-energia" value="75" min="1" max="100" 
                               oninput="updateEnergia(); autoSave();" 
                               class="w-full bg-transparent text-center text-2xl font-bold font-mono outline-none text-theme-yellow">
                    </div>
                </div>
            </section>

            <!-- Seção 3: Habilidades -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.3s; border-left: 4px solid #4a9eff;">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-blue mb-6">
                    <i data-lucide="swords" class="w-4 h-4"></i> Habilidades Especiais
                </h3>
                
                <div class="mb-4">
                    <p class="text-sm text-theme-muted mb-3">
                        <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                        Você pode adicionar até 3 habilidades. Use o botão + para adicionar novas.
                    </p>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="addSkill('buff')" class="skill-badge buff px-4 py-2 rounded-lg border flex items-center gap-2">
                            <i data-lucide="plus" class="w-3 h-3"></i>
                            <span>Buff</span>
                        </button>
                        <button onclick="addSkill('debuff')" class="skill-badge debuff px-4 py-2 rounded-lg border flex items-center gap-2">
                            <i data-lucide="plus" class="w-3 h-3"></i>
                            <span>Debuff</span>
                        </button>
                        <button onclick="addSkill('self')" class="skill-badge self px-4 py-2 rounded-lg border flex items-center gap-2">
                            <i data-lucide="plus" class="w-3 h-3"></i>
                            <span>Auto</span>
                        </button>
                    </div>
                </div>

                <div id="skills-container" class="space-y-4">
                    <!-- Habilidades serão inseridas aqui via JavaScript -->
                </div>
                
                <div class="mt-4 text-xs text-theme-muted">
                    <i data-lucide="lightbulb" class="w-3 h-3 inline mr-1"></i>
                    <strong>Buff:</strong> Beneficia aliados | 
                    <strong>Debuff:</strong> Prejudica inimigos | 
                    <strong>Auto:</strong> Afeta apenas o mascote
                </div>
            </section>

            <!-- Seção 4: Descrições -->
            <div class="grid md:grid-cols-2 gap-6 anim-entry" style="animation-delay: 0.4s;">
                <section class="bg-theme-panel border border-theme-border p-6 rounded-lg relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-theme-purple"></div>
                    <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-purple mb-4">
                        <i data-lucide="palette" class="w-4 h-4"></i> Aparência
                    </h3>
                    <textarea id="mascote-aparencia" placeholder="Descreva a aparência do seu mascote: pelagem, olhos, tamanho, marcas distintivas, ornamentos..."
                              class="w-full bg-transparent border border-theme-border rounded p-4 text-white focus:border-theme-purple outline-none h-[180px] resize-none transition-colors"
                              oninput="autoSave(); updateCharCounters();"></textarea>
                    <div class="flex justify-between text-xs text-theme-muted mt-2">
                        <span>Detalhes visuais</span>
                        <span id="aparencia-chars">0/500</span>
                    </div>
                </section>

                <section class="bg-theme-panel border border-theme-border p-6 rounded-lg relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-theme-yellow"></div>
                    <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-yellow mb-4">
                        <i data-lucide="brain" class="w-4 h-4"></i> Personalidade
                    </h3>
                    <textarea id="mascote-personalidade" placeholder="Como ele se comporta? É brincalhão, protetor, curioso? Quais são suas manias e preferências..."
                              class="w-full bg-transparent border border-theme-border rounded p-4 text-white focus:border-theme-yellow outline-none h-[180px] resize-none transition-colors"
                              oninput="autoSave(); updateCharCounters();"></textarea>
                    <div class="flex justify-between text-xs text-theme-muted mt-2">
                        <span>Traços comportamentais</span>
                        <span id="personalidade-chars">0/500</span>
                    </div>
                </section>
            </div>

            <!-- Seção 5: História e Notas -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.5s; border-left: 4px solid #22c55e;">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-green mb-4">
                    <i data-lucide="book-open" class="w-4 h-4"></i> História & Notas
                </h3>
                <textarea id="mascote-historia" placeholder="Como você encontrou seu mascote? Qual é a história dele? Eventos importantes, conquistas, preferências alimentares..."
                          class="w-full bg-transparent border border-theme-border rounded p-4 text-white focus:border-theme-green outline-none h-[150px] resize-none transition-colors"
                          oninput="autoSave(); updateCharCounters();"></textarea>
                <div class="flex justify-between text-xs text-theme-muted mt-2">
                    <span>História e anotações especiais</span>
                    <span id="historia-chars">0/1000</span>
                </div>
            </section>

        </div>
    </div>

    <!-- Rodapé com Ações -->
    <div class="max-w-6xl mx-auto px-4 mt-8 pb-12 flex flex-col md:flex-row justify-end gap-4 anim-entry" data-html2pdf-ignore="true">
        <button onclick="resetMascote()" class="flex items-center justify-center gap-2 px-6 py-3 border border-theme-border rounded text-theme-text hover:bg-white/5 transition-colors font-cinzel text-sm">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
            Resetar
        </button>
        
        <button onclick="downloadTXT()" class="flex items-center justify-center gap-2 px-6 py-3 bg-theme-panel border border-theme-border rounded text-theme-text hover:bg-white/5 transition-colors font-cinzel text-sm">
            <i data-lucide="file-text" class="w-4 h-4"></i>
            Exportar TXT
        </button>

        <button onclick="saveToIndex()" id="btn-save-index" class="flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-theme-blue to-cyan-600 rounded text-white shadow-lg hover:shadow-blue-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="home" class="w-4 h-4"></i>
            Salvar no Index
        </button>

        <button onclick="saveMascote()" id="btn-save" class="flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-theme-pink to-purple-600 rounded text-white shadow-lg hover:shadow-pink-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="save" class="w-4 h-4"></i>
            Salvar Local
        </button>
    </div>

    <script>
        // Inicializar ícones
        lucide.createIcons();

        // ====================================================================
        // DADOS GLOBAIS
        // ====================================================================
        const TIPOS_PREDEFINIDOS = [
            { id: 'canino', nome: 'Canino', icone: 'dog', cor: '#f59e0b', custom: false },
            { id: 'felino', nome: 'Felino', icone: 'cat', cor: '#8b5cf6', custom: false },
            { id: 'ave', nome: 'Ave', icone: 'bird', cor: '#4a9eff', custom: false },
            { id: 'reptil', nome: 'Réptil', icone: 'snake', cor: '#22c55e', custom: false },
            { id: 'fantastico', nome: 'Fantástico', icone: 'sparkles', cor: '#ec4899', custom: false }
        ];

        let mascoteData = {
            tipoSelecionado: 'canino',
            skills: [],
            lastAutoSave: null,
            customTypes: [],
            currentPassiva: 'Clique em "Editar" para criar uma passiva especial para seu mascote.'
        };

        // ====================================================================
        // FUNÇÕES DE MODAL
        // ====================================================================
        function openCustomTypeModal() {
            document.getElementById('custom-type-modal').classList.remove('hidden');
            document.getElementById('custom-type-name').focus();
        }

        function closeCustomTypeModal() {
            document.getElementById('custom-type-modal').classList.add('hidden');
            // Resetar campos
            document.getElementById('custom-type-name').value = '';
            document.getElementById('custom-type-color').value = '#ec4899';
            document.getElementById('custom-type-icon').value = 'dog';
            document.getElementById('custom-type-passiva').value = '';
            document.getElementById('custom-type-descricao').value = '';
        }

        function openManageTypesModal() {
            document.getElementById('manage-types-modal').classList.remove('hidden');
            loadCustomTypesList();
        }

        function closeManageTypesModal() {
            document.getElementById('manage-types-modal').classList.add('hidden');
        }

        function openEditPassivaModal() {
            document.getElementById('edit-passiva-modal').classList.remove('hidden');
            document.getElementById('edit-passiva-text').value = mascoteData.currentPassiva;
            document.getElementById('edit-passiva-text').focus();
        }

        function closeEditPassivaModal() {
            document.getElementById('edit-passiva-modal').classList.add('hidden');
        }

        function selectColor(color) {
            document.getElementById('custom-type-color').value = color;
        }

        function selectIcon(icon) {
            document.getElementById('custom-type-icon').value = icon;
            // Adicionar feedback visual
            document.querySelectorAll('#custom-type-modal button').forEach(btn => {
                btn.classList.remove('border-theme-purple', 'bg-theme-purple/20');
            });
            event.currentTarget.classList.add('border-theme-purple', 'bg-theme-purple/20');
        }

        // ====================================================================
        // FUNÇÕES DE TIPOS CUSTOMIZADOS
        // ====================================================================
        function saveCustomType() {
            const name = document.getElementById('custom-type-name').value.trim();
            const color = document.getElementById('custom-type-color').value;
            const icon = document.getElementById('custom-type-icon').value;
            const passiva = document.getElementById('custom-type-passiva').value.trim();
            const descricao = document.getElementById('custom-type-descricao').value.trim();
            
            if (!name) {
                alert('Por favor, insira um nome para o tipo.');
                return;
            }
            
            if (!passiva) {
                alert('Por favor, insira uma passiva especial.');
                return;
            }
            
            // Gerar ID único
            const id = 'custom_' + Date.now() + '_' + name.toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            const customType = {
                id: id,
                nome: name,
                icone: icon,
                cor: color,
                passiva: passiva,
                descricao: descricao,
                custom: true
            };
            
            // Salvar no array
            mascoteData.customTypes.push(customType);
            
            // Salvar no localStorage
            localStorage.setItem('mascote_custom_types', JSON.stringify(mascoteData.customTypes));
            
            // Atualizar interface
            renderTipoCriaturas();
            selectTipoCriatura(id);
            
            // Fechar modal
            closeCustomTypeModal();
            
            // Feedback
            alert(`Tipo "${name}" criado com sucesso!`);
        }

        function loadCustomTypes() {
            const saved = localStorage.getItem('mascote_custom_types');
            if (saved) {
                mascoteData.customTypes = JSON.parse(saved);
            }
        }

        function deleteCustomType(typeId) {
            if (confirm('Tem certeza que deseja excluir este tipo? Esta ação não pode ser desfeita.')) {
                mascoteData.customTypes = mascoteData.customTypes.filter(type => type.id !== typeId);
                
                // Se o tipo atual for excluído, selecionar um padrão
                if (mascoteData.tipoSelecionado === typeId) {
                    mascoteData.tipoSelecionado = 'canino';
                }
                
                // Salvar alterações
                localStorage.setItem('mascote_custom_types', JSON.stringify(mascoteData.customTypes));
                
                // Atualizar interface
                renderTipoCriaturas();
                loadCustomTypesList();
            }
        }

        function loadCustomTypesList() {
            const container = document.getElementById('custom-types-list');
            container.innerHTML = '';
            
            if (mascoteData.customTypes.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 border-2 border-dashed border-theme-border rounded-lg">
                        <i data-lucide="folder-open" class="w-12 h-12 mx-auto mb-3 text-theme-muted"></i>
                        <p class="text-theme-muted">Nenhum tipo personalizado criado</p>
                        <p class="text-xs text-theme-muted mt-1">Use "Criar Novo" para adicionar tipos</p>
                    </div>
                `;
                return;
            }
            
            mascoteData.customTypes.forEach(type => {
                const typeElement = document.createElement('div');
                typeElement.className = 'bg-theme-bg border border-theme-border rounded-lg p-4';
                typeElement.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background: ${type.cor}20; border: 2px solid ${type.cor}">
                                <i data-lucide="${type.icone}" style="color: ${type.cor}" class="w-4 h-4"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold" style="color: ${type.cor}">${type.nome}</h4>
                                <span class="custom-type-badge">Personalizado</span>
                            </div>
                        </div>
                        <button onclick="deleteCustomType('${type.id}')" class="text-theme-muted hover:text-red-500 p-1">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="text-sm text-white mb-2">${type.passiva}</p>
                    ${type.descricao ? `<p class="text-xs text-theme-muted">${type.descricao}</p>` : ''}
                `;
                container.appendChild(typeElement);
            });
            
            lucide.createIcons();
        }

        // ====================================================================
        // FUNÇÕES DE INICIALIZAÇÃO
        // ====================================================================
        function renderTipoCriaturas() {
            const container = document.getElementById('tipo-container');
            container.innerHTML = '';
            
            // Adicionar tipos predefinidos
            TIPOS_PREDEFINIDOS.forEach(tipo => {
                addTipoCard(tipo);
            });
            
            // Adicionar tipos customizados
            mascoteData.customTypes.forEach(tipo => {
                addTipoCard(tipo);
            });
            
            // Selecionar tipo atual
            selectTipoCriatura(mascoteData.tipoSelecionado);
        }

        function addTipoCard(tipo) {
            const container = document.getElementById('tipo-container');
            const card = document.createElement('div');
            card.className = 'creature-card bg-[#0a0a0c] border border-theme-border p-4 rounded-lg text-center cursor-pointer transition-all';
            card.dataset.id = tipo.id;
            
            let badge = '';
            if (tipo.custom) {
                badge = '<span class="custom-type-badge absolute -top-1 -right-1">C</span>';
            }
            
            card.innerHTML = `
                <div class="relative">
                    <div class="w-12 h-12 mx-auto mb-2 rounded-full flex items-center justify-center border-2" style="border-color: ${tipo.cor}80; background: ${tipo.cor}20">
                        <i data-lucide="${tipo.icone}" style="color: ${tipo.cor}" class="w-6 h-6"></i>
                    </div>
                    ${badge}
                </div>
                <h4 class="font-medium text-sm mb-1" style="color: ${tipo.cor}">${tipo.nome}</h4>
                <p class="text-xs text-theme-muted">${tipo.custom ? 'Personalizado' : 'Tipo padrão'}</p>
            `;
            
            card.addEventListener('click', () => selectTipoCriatura(tipo.id));
            container.appendChild(card);
        }

        function selectTipoCriatura(tipoId) {
            mascoteData.tipoSelecionado = tipoId;
            
            // Remover seleção anterior
            document.querySelectorAll('.creature-card').forEach(card => {
                card.classList.remove('selected');
                card.style.borderColor = '';
            });
            
            // Adicionar seleção atual
            const card = document.querySelector(`[data-id="${tipoId}"]`);
            if (card) {
                card.classList.add('selected');
                // Encontrar o tipo
                let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === tipoId);
                if (!tipo) {
                    tipo = mascoteData.customTypes.find(t => t.id === tipoId);
                }
                if (tipo) {
                    card.style.borderColor = tipo.cor;
                    updatePassivaDisplay(tipo);
                }
            }
            
            autoSave();
        }

        function updatePassivaDisplay(tipo) {
            const container = document.getElementById('passiva-container');
            const content = document.getElementById('passiva-content');
            const passivaText = document.getElementById('passiva-text');
            
            let passiva = tipo.passiva || 'Nenhuma passiva definida.';
            
            // Se for um tipo personalizado, usar a passiva salva
            if (tipo.custom) {
                passiva = tipo.passiva;
            } else if (tipo.id === 'canino') {
                passiva = '+5% de dano em ataques noturnos';
            } else if (tipo.id === 'felino') {
                passiva = '+10% de chance de acerto crítico';
            } else if (tipo.id === 'ave') {
                passiva = 'Visão aguçada: +15% de percepção';
            } else if (tipo.id === 'reptil') {
                passiva = 'Camuflagem: +20% de esquiva em áreas naturais';
            } else if (tipo.id === 'fantastico') {
                passiva = 'Aura mágica: +1 em todas as resistências elementais';
            }
            
            content.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="p-2 rounded-lg" style="background: ${tipo.cor}20">
                        <i data-lucide="zap" style="color: ${tipo.cor}" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-semibold mb-1" style="color: ${tipo.cor}">${tipo.nome} - Passiva Especial</h4>
                        <p id="passiva-text" class="text-sm text-white">${passiva}</p>
                        <p class="text-xs text-theme-muted mt-1">Passiva sempre ativa</p>
                    </div>
                </div>
            `;
            
            container.classList.remove('hidden');
            
            // Atualizar a passiva atual
            mascoteData.currentPassiva = passiva;
            
            lucide.createIcons();
        }

        function savePassiva() {
            const novaPassiva = document.getElementById('edit-passiva-text').value.trim();
            if (novaPassiva) {
                mascoteData.currentPassiva = novaPassiva;
                document.getElementById('passiva-text').textContent = novaPassiva;
                closeEditPassivaModal();
                autoSave();
            }
        }

        // ====================================================================
        // FUNÇÕES DE STATUS (mantidas da versão anterior)
        // ====================================================================
        function updateVida() {
            const atual = parseInt(document.getElementById('vida-atual').value) || 0;
            const max = parseInt(document.getElementById('vida-max').value) || 1;
            let pct = Math.round((atual / max) * 100);
            if(pct > 100) pct = 100; 
            if(pct < 0) pct = 0;
            
            document.getElementById('bar-vida').style.width = `${pct}%`;
            document.getElementById('vida-pct').textContent = `${pct}%`;
        }

        function updateLealdade() {
            const val = parseInt(document.getElementById('input-lealdade').value);
            const bar = document.getElementById('bar-lealdade');
            const txt = document.getElementById('lealdade-texto');
            const valueSpan = document.getElementById('lealdade-value');
            
            bar.style.width = `${val}%`;
            valueSpan.textContent = `${val}%`;
            
            if (val < 20) txt.innerText = "Hostil";
            else if (val < 40) txt.innerText = "Desconfiado";
            else if (val < 60) txt.innerText = "Neutro";
            else if (val < 80) txt.innerText = "Amigável";
            else if (val < 95) txt.innerText = "Leal";
            else txt.innerText = "Devoto";
        }

        function updateAgilidade() {
            const val = document.getElementById('input-agilidade').value;
            document.getElementById('agilidade-value').textContent = val;
            document.querySelector('.stat-circle[style*="agilidade"]').style.setProperty('--percentage', `${val}%`);
        }

        function updateForca() {
            const val = document.getElementById('input-forca').value;
            document.getElementById('forca-value').textContent = val;
            document.querySelector('.stat-circle[style*="forca"]').style.setProperty('--percentage', `${val}%`);
        }

        function updatePercepcao() {}
        function updateDefesa() {}
        function updateEnergia() {}

        function updateNivelDisplay() {
            const nivel = document.getElementById('mascote-nivel').value;
            document.getElementById('mascote-nivel-display').textContent = `Nível ${nivel}`;
        }

        // ====================================================================
        // SISTEMA DE HABILIDADES (mantido da versão anterior)
        // ====================================================================
        function addSkill(type) {
            if (mascoteData.skills.length >= 3) {
                alert('Máximo de 3 habilidades alcançado!');
                return;
            }
            
            const skillId = Date.now();
            const skillTypes = {
                buff: { nome: 'Buff', cor: '#22c55e', icone: 'trending-up', desc: 'Beneficia aliados' },
                debuff: { nome: 'Debuff', cor: '#dc2626', icone: 'trending-down', desc: 'Prejudica inimigos' },
                self: { nome: 'Auto', cor: '#3b82f6', icone: 'user', desc: 'Afeta apenas o mascote' }
            };
            
            const skillType = skillTypes[type];
            
            const skill = {
                id: skillId,
                type: type,
                nome: `Nova Habilidade ${mascoteData.skills.length + 1}`,
                descricao: 'Descreva o efeito da habilidade...',
                custo: '1 Ação',
                alcance: 'Toque',
                duracao: 'Instantâneo'
            };
            
            mascoteData.skills.push(skill);
            renderSkills();
            autoSave();
        }

        function removeSkill(skillId) {
            mascoteData.skills = mascoteData.skills.filter(skill => skill.id !== skillId);
            renderSkills();
            autoSave();
        }

        function updateSkill(skillId, field, value) {
            const skill = mascoteData.skills.find(s => s.id === skillId);
            if (skill) {
                skill[field] = value;
                autoSave();
            }
        }

        function renderSkills() {
            const container = document.getElementById('skills-container');
            container.innerHTML = '';
            
            if (mascoteData.skills.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 border-2 border-dashed border-theme-border rounded-lg">
                        <i data-lucide="swords" class="w-12 h-12 mx-auto mb-3 text-theme-muted"></i>
                        <p class="text-theme-muted">Nenhuma habilidade adicionada</p>
                        <p class="text-xs text-theme-muted mt-1">Use os botões acima para adicionar habilidades</p>
                    </div>
                `;
                return;
            }
            
            mascoteData.skills.forEach(skill => {
                const skillTypes = {
                    buff: { nome: 'Buff', cor: '#22c55e', icone: 'trending-up' },
                    debuff: { nome: 'Debuff', cor: '#dc2626', icone: 'trending-down' },
                    self: { nome: 'Auto', cor: '#3b82f6', icone: 'user' }
                };
                
                const typeInfo = skillTypes[skill.type];
                
                const skillElement = document.createElement('div');
                skillElement.className = 'bg-[#0a0a0c] border border-theme-border rounded-lg p-4';
                skillElement.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="p-2 rounded-lg" style="background: ${typeInfo.cor}20; border: 1px solid ${typeInfo.cor}40">
                                <i data-lucide="${typeInfo.icone}" style="color: ${typeInfo.cor}" class="w-4 h-4"></i>
                            </div>
                            <div>
                                <input type="text" value="${skill.nome}" 
                                       oninput="updateSkill(${skill.id}, 'nome', this.value)"
                                       class="bg-transparent font-semibold text-white outline-none" 
                                       style="color: ${typeInfo.cor}">
                                <p class="text-xs text-theme-muted">${typeInfo.nome}</p>
                            </div>
                        </div>
                        <button onclick="removeSkill(${skill.id})" class="text-theme-muted hover:text-white p-1">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                        <div>
                            <label class="text-xs text-theme-muted mb-1 block">Custo</label>
                            <input type="text" value="${skill.custo}" 
                                   oninput="updateSkill(${skill.id}, 'custo', this.value)"
                                   class="w-full bg-transparent border-b border-theme-border text-sm outline-none focus:border-theme-blue px-1 py-1">
                        </div>
                        <div>
                            <label class="text-xs text-theme-muted mb-1 block">Alcance</label>
                            <input type="text" value="${skill.alcance}" 
                                   oninput="updateSkill(${skill.id}, 'alcance', this.value)"
                                   class="w-full bg-transparent border-b border-theme-border text-sm outline-none focus:border-theme-blue px-1 py-1">
                        </div>
                        <div>
                            <label class="text-xs text-theme-muted mb-1 block">Duração</label>
                            <input type="text" value="${skill.duracao}" 
                                   oninput="updateSkill(${skill.id}, 'duracao', this.value)"
                                   class="w-full bg-transparent border-b border-theme-border text-sm outline-none focus:border-theme-blue px-1 py-1">
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-xs text-theme-muted mb-1 block">Descrição do Efeito</label>
                        <textarea oninput="updateSkill(${skill.id}, 'descricao', this.value)"
                                  class="w-full bg-transparent border border-theme-border rounded p-2 text-sm outline-none focus:border-theme-blue resize-none h-20"
                                  placeholder="Descreva o efeito detalhado da habilidade...">${skill.descricao}</textarea>
                    </div>
                `;
                
                container.appendChild(skillElement);
            });
            
            lucide.createIcons();
        }

        // ====================================================================
        // SISTEMA DE PERSISTÊNCIA (atualizado)
        // ====================================================================
        function getMascoteData() {
            // Encontrar o tipo atual
            let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === mascoteData.tipoSelecionado);
            if (!tipo) {
                tipo = mascoteData.customTypes.find(t => t.id === mascoteData.tipoSelecionado);
            }
            
            return {
                nome: document.getElementById('mascote-nome').value,
                tipoId: mascoteData.tipoSelecionado,
                tipoNome: tipo ? tipo.nome : 'Desconhecido',
                tipoCor: tipo ? tipo.cor : '#ec4899',
                tipoIcone: tipo ? tipo.icone : 'dog',
                nivel: parseInt(document.getElementById('mascote-nivel').value),
                vidaAtual: parseInt(document.getElementById('vida-atual').value),
                vidaMax: parseInt(document.getElementById('vida-max').value),
                lealdade: parseInt(document.getElementById('input-lealdade').value),
                agilidade: parseInt(document.getElementById('input-agilidade').value),
                forca: parseInt(document.getElementById('input-forca').value),
                percepcao: parseInt(document.getElementById('input-percepcao').value),
                defesa: parseInt(document.getElementById('input-defesa').value),
                energia: parseInt(document.getElementById('input-energia').value),
                aparencia: document.getElementById('mascote-aparencia').value,
                personalidade: document.getElementById('mascote-personalidade').value,
                habilidades: mascoteData.skills,
                passiva: mascoteData.currentPassiva,
                historia: document.getElementById('mascote-historia').value,
                customTypes: mascoteData.customTypes,
                timestamp: new Date().toISOString()
            };
        }

        function saveMascote() {
            const data = getMascoteData();
            localStorage.setItem('rpg_mascote_completo', JSON.stringify(data));
            
            const btn = document.getElementById('btn-save');
            const originalHTML = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`;
            lucide.createIcons();

            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i>`;
                lucide.createIcons();
                
                document.getElementById('last-saved').textContent = 
                    new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                    lucide.createIcons();
                }, 2000);
            }, 800);
            
            saveToIndex();
        }

        function saveToIndex() {
            const data = getMascoteData();
            
            const mascoteResumido = {
                nome: data.nome || "Sem Nome",
                tipo: data.tipoNome || "Desconhecido",
                nivel: data.nivel || 1,
                icone: data.tipoIcone || "dog",
                cor: data.tipoCor || "#ec4899",
                lealdade: data.lealdade || 80,
                temMascote: data.nome ? true : false,
                ultimaAtualizacao: new Date().toISOString()
            };
            
            localStorage.setItem('grimorio_mascote_index', JSON.stringify(mascoteResumido));
            
            const btn = document.getElementById('btn-save-index');
            const originalHTML = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`;
            lucide.createIcons();

            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i>`;
                lucide.createIcons();
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                    lucide.createIcons();
                }, 1500);
            }, 600);
        }

        function loadMascote() {
            const data = JSON.parse(localStorage.getItem('rpg_mascote_completo'));
            
            if (data) {
                // Carregar dados básicos
                document.getElementById('mascote-nome').value = data.nome || '';
                document.getElementById('mascote-nivel').value = data.nivel || 1;
                document.getElementById('vida-atual').value = data.vidaAtual || 50;
                document.getElementById('vida-max').value = data.vidaMax || 50;
                document.getElementById('input-lealdade').value = data.lealdade || 80;
                document.getElementById('input-agilidade').value = data.agilidade || 70;
                document.getElementById('input-forca').value = data.forca || 60;
                document.getElementById('input-percepcao').value = data.percepcao || 65;
                document.getElementById('input-defesa').value = data.defesa || 55;
                document.getElementById('input-energia').value = data.energia || 75;
                document.getElementById('mascote-aparencia').value = data.aparencia || '';
                document.getElementById('mascote-personalidade').value = data.personalidade || '';
                document.getElementById('mascote-historia').value = data.historia || '';
                
                // Carregar tipo
                if (data.tipoId) {
                    mascoteData.tipoSelecionado = data.tipoId;
                }
                
                // Carregar passiva
                if (data.passiva) {
                    mascoteData.currentPassiva = data.passiva;
                }
                
                // Carregar habilidades
                if (data.habilidades) {
                    mascoteData.skills = data.habilidades;
                    renderSkills();
                }
                
                // Carregar tipos customizados
                if (data.customTypes) {
                    mascoteData.customTypes = data.customTypes;
                    localStorage.setItem('mascote_custom_types', JSON.stringify(data.customTypes));
                }
                
                // Atualizar displays
                updateVida();
                updateLealdade();
                updateAgilidade();
                updateForca();
                updateNivelDisplay();
                updateCharCounters();
                renderTipoCriaturas();
                
                // Atualizar passiva display
                if (data.tipoId) {
                    let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === data.tipoId);
                    if (!tipo) {
                        tipo = mascoteData.customTypes.find(t => t.id === data.tipoId);
                    }
                    if (tipo) {
                        updatePassivaDisplay(tipo);
                    }
                }
                
                if (data.timestamp) {
                    const date = new Date(data.timestamp);
                    document.getElementById('last-saved').textContent = 
                        date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                }
            }
        }

        function autoSave() {
            if (mascoteData.lastAutoSave) {
                clearTimeout(mascoteData.lastAutoSave);
            }
            
            mascoteData.lastAutoSave = setTimeout(() => {
                const data = getMascoteData();
                localStorage.setItem('rpg_mascote_autosave', JSON.stringify(data));
            }, 1000);
        }

        function updateCharCounters() {
            const aparencia = document.getElementById('mascote-aparencia').value.length;
            const personalidade = document.getElementById('mascote-personalidade').value.length;
            const historia = document.getElementById('mascote-historia').value.length;
            
            document.getElementById('aparencia-chars').textContent = `${aparencia}/500`;
            document.getElementById('personalidade-chars').textContent = `${personalidade}/500`;
            document.getElementById('historia-chars').textContent = `${historia}/1000`;
        }

        // ====================================================================
        // FUNÇÕES DE EXPORTAÇÃO (mantidas)
        // ====================================================================
        function downloadTXT() {
            const data = getMascoteData();
            
            let txt = "═".repeat(40) + "\n";
            txt += "          FICHA DE MASCOTE - GRIMÓRIO DIGITAL\n";
            txt += "═".repeat(40) + "\n\n";
            
            txt += `NOME: ${data.nome || "Sem Nome"}\n`;
            txt += `TIPO: ${data.tipoNome || "Desconhecido"}\n`;
            txt += `NÍVEL: ${data.nivel}\n\n`;
            
            txt += "═".repeat(40) + "\n";
            txt += "                 STATUS\n";
            txt += "═".repeat(40) + "\n\n";
            
            txt += `Vida: ${data.vidaAtual}/${data.vidaMax}\n`;
            txt += `Lealdade: ${data.lealdade}% (${getLealdadeTexto(data.lealdade)})\n`;
            txt += `Agilidade: ${data.agilidade}/100\n`;
            txt += `Força: ${data.forca}/100\n`;
            txt += `Percepção: ${data.percepcao}/100\n`;
            txt += `Defesa: ${data.defesa}/100\n`;
            txt += `Energia: ${data.energia}/100\n\n`;
            
            txt += `PASSIVA ESPECIAL: ${data.passiva || "Nenhuma passiva definida"}\n\n`;
            
            if (data.habilidades.length > 0) {
                txt += "═".repeat(40) + "\n";
                txt += "              HABILIDADES\n";
                txt += "═".repeat(40) + "\n\n";
                
                data.habilidades.forEach((skill, index) => {
                    const type = skill.type === 'buff' ? 'Buff' : skill.type === 'debuff' ? 'Debuff' : 'Auto';
                    txt += `${index + 1}. ${skill.nome} [${type}]\n`;
                    txt += `   Custo: ${skill.custo} | Alcance: ${skill.alcance} | Duração: ${skill.duracao}\n`;
                    txt += `   Efeito: ${skill.descricao}\n\n`;
                });
            }
            
            txt += "═".repeat(40) + "\n";
            txt += "                DESCRIÇÕES\n";
            txt += "═".repeat(40) + "\n\n";
            
            txt += `APARÊNCIA:\n${data.aparencia || "Não descrito"}\n\n`;
            txt += `PERSONALIDADE:\n${data.personalidade || "Não descrito"}\n\n`;
            txt += `HISTÓRIA:\n${data.historia || "Não registrada"}\n\n`;
            
            txt += "═".repeat(40) + "\n";
            txt += `Gerado em: ${new Date().toLocaleString('pt-BR')}\n`;
            txt += "═".repeat(40);
            
            const nome = data.nome.replace(/[^a-z0-9]/gi, '_') || 'Mascote';
            const blob = new Blob([txt], { type: "text/plain;charset=utf-8" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Mascote_${nome}.txt`;
            link.click();
        }

        function getLealdadeTexto(valor) {
            if (valor < 20) return "Hostil";
            if (valor < 40) return "Desconfiado";
            if (valor < 60) return "Neutro";
            if (valor < 80) return "Amigável";
            if (valor < 95) return "Leal";
            return "Devoto";
        }

        function resetMascote() {
            if (confirm('Deseja realmente resetar todos os dados do mascote? (Os tipos personalizados serão mantidos)')) {
                // Resetar valores padrão
                document.getElementById('mascote-nome').value = '';
                document.getElementById('mascote-nivel').value = 1;
                document.getElementById('vida-atual').value = 50;
                document.getElementById('vida-max').value = 50;
                document.getElementById('input-lealdade').value = 80;
                document.getElementById('input-agilidade').value = 70;
                document.getElementById('input-forca').value = 60;
                document.getElementById('input-percepcao').value = 65;
                document.getElementById('input-defesa').value = 55;
                document.getElementById('input-energia').value = 75;
                document.getElementById('mascote-aparencia').value = '';
                document.getElementById('mascote-personalidade').value = '';
                document.getElementById('mascote-historia').value = '';
                
                // Resetar habilidades
                mascoteData.skills = [];
                renderSkills();
                
                // Resetar seleção de tipo
                mascoteData.tipoSelecionado = 'canino';
                mascoteData.currentPassiva = 'Clique em "Editar" para criar uma passiva especial para seu mascote.';
                
                // Atualizar displays
                updateVida();
                updateLealdade();
                updateAgilidade();
                updateForca();
                updateNivelDisplay();
                updateCharCounters();
                renderTipoCriaturas();
                
                // Limpar salvamentos (exceto tipos customizados)
                localStorage.removeItem('rpg_mascote_completo');
                localStorage.removeItem('rpg_mascote_autosave');
                localStorage.removeItem('grimorio_mascote_index');
                
                document.getElementById('last-saved').textContent = 'Não salvo';
            }
        }

        // ====================================================================
        // INICIALIZAÇÃO
        // ====================================================================
        window.addEventListener('load', () => {
            // Carregar tipos customizados
            loadCustomTypes();
            
            // Inicializar tipos de criatura
            renderTipoCriaturas();
            
            // Carregar dados salvos
            loadMascote();
            
            // Configurar auto-save
            const textareas = ['mascote-aparencia', 'mascote-personalidade', 'mascote-historia'];
            textareas.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', autoSave);
                }
            });
            
            // Atualizar contadores iniciais
            updateCharCounters();
            
            // Verificar auto-save
            const autosave = localStorage.getItem('rpg_mascote_autosave');
            if (autosave && !localStorage.getItem('rpg_mascote_completo')) {
                if (confirm('Encontramos um auto-salvamento não salvo. Deseja restaurar?')) {
                    localStorage.setItem('rpg_mascote_completo', autosave);
                    loadMascote();
                }
            }
            
            // Inicializar ícones
            lucide.createIcons();
        });
    </script>
</body>
</html>