<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grim√≥rio Digital - Mascote</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <script src="grimorio-sync.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        theme: {
                            bg: '#0a0a0c',
                            panel: '#0f0f12',
                            border: '#2a2a2e',
                            text: '#e8e4dc',
                            pink: '#ec4899',
                            red: '#dc2626',
                            purple: '#8b5cf6',
                            yellow: '#f59e0b',
                            blue: '#4a9eff',
                            green: '#22c55e',
                            cyan: '#06b6d4',
                            orange: '#ff6b35',
                            teal: '#14b8a6',
                            indigo: '#6366f1',
                            muted: '#606060'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: #e8e4dc; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: #0f0f12;
            border: 1px solid #2a2a2e;
            border-radius: 0.75rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-bar {
            height: 0.5rem;
            background-color: #1a1a1a;
            border-radius: 9999px;
            overflow: hidden;
        }

        .stat-bar-fill {
            height: 100%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .skill-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .skill-tag:hover {
            transform: translateY(-1px);
        }

        textarea { 
            resize: none; 
            min-height: 100px;
        }

        .type-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .type-card:hover {
            transform: translateY(-2px);
        }

        .type-card.selected {
            border-color: currentColor;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .anim-entry { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .profile-badge {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(139, 92, 246, 0.2));
            border: 1px solid rgba(236, 72, 153, 0.4);
            color: #ec4899;
        }
        
        .no-profile-warning {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(185, 28, 28, 0.1));
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .active-profile-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #22c55e;
            box-shadow: 0 0 8px #22c55e;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .feedback-mascote {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen font-sans pb-12">

    <!-- Modal de Customiza√ß√£o de Tipo -->
    <div id="custom-type-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-cinzel font-bold text-xl text-white">Criar Tipo Personalizado</h3>
                    <button onclick="closeCustomTypeModal()" class="text-theme-muted hover:text-white transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Nome do Tipo</label>
                        <input type="text" id="custom-type-name" placeholder="Ex: Drag√£o, F√™nix, etc" 
                            class="w-full px-4 py-2 bg-theme-bg border border-theme-border rounded text-white placeholder-gray-500 focus:border-theme-pink focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Cor do Tipo</label>
                        <div class="flex gap-2 flex-wrap">
                            <button onclick="setCustomTypeColor('#ec4899')" class="w-8 h-8 rounded-full bg-[#ec4899] border-2 border-transparent hover:border-white"></button>
                            <button onclick="setCustomTypeColor('#8b5cf6')" class="w-8 h-8 rounded-full bg-[#8b5cf6] border-2 border-transparent hover:border-white"></button>
                            <button onclick="setCustomTypeColor('#4a9eff')" class="w-8 h-8 rounded-full bg-[#4a9eff] border-2 border-transparent hover:border-white"></button>
                            <button onclick="setCustomTypeColor('#22c55e')" class="w-8 h-8 rounded-full bg-[#22c55e] border-2 border-transparent hover:border-white"></button>
                            <button onclick="setCustomTypeColor('#f59e0b')" class="w-8 h-8 rounded-full bg-[#f59e0b] border-2 border-transparent hover:border-white"></button>
                            <button onclick="setCustomTypeColor('#06b6d4')" class="w-8 h-8 rounded-full bg-[#06b6d4] border-2 border-transparent hover:border-white"></button>
                        </div>
                        <input type="color" id="custom-type-color-picker" class="w-full mt-2" value="#ec4899">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">√çcone</label>
                        <select id="custom-type-icon" class="w-full px-4 py-2 bg-theme-bg border border-theme-border rounded text-white focus:border-theme-pink focus:outline-none">
                            <option value="sparkles">üåü M√°gico</option>
                            <option value="zap">‚ö° El√©trico</option>
                            <option value="flame">üî• Fogo</option>
                            <option value="droplet">üíß √Ågua</option>
                            <option value="wind">üí® Vento</option>
                            <option value="moon">üåô Noturno</option>
                            <option value="sun">‚òÄÔ∏è Solar</option>
                            <option value="leaf">üçÉ Natureza</option>
                            <option value="gem">üíé Cristal</option>
                            <option value="shield">üõ°Ô∏è Protetor</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Descri√ß√£o (opcional)</label>
                        <textarea id="custom-type-desc" placeholder="Descreva este tipo de criatura..." rows="3"
                            class="w-full px-4 py-2 bg-theme-bg border border-theme-border rounded text-white placeholder-gray-500 focus:border-theme-pink focus:outline-none"></textarea>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-8">
                    <button onclick="closeCustomTypeModal()" class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-theme-text hover:bg-white/5 transition-colors">
                        Cancelar
                    </button>
                    <button onclick="saveCustomType()" class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-pink to-purple-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                        <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                        Criar Tipo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Tipos -->
    <div id="manage-types-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-cinzel font-bold text-xl text-white">Tipos Personalizados</h3>
                    <button onclick="closeManageTypesModal()" class="text-theme-muted hover:text-white transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <div id="custom-types-list" class="space-y-3 mb-6 max-h-64 overflow-y-auto pr-2">
                    <!-- Tipos personalizados ser√£o carregados aqui -->
                </div>
                
                <div class="flex gap-3">
                    <button onclick="closeManageTypesModal()" class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-theme-text hover:bg-white/5 transition-colors">
                        Fechar
                    </button>
                    <button onclick="openCustomTypeModal()" class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-pink to-purple-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                        <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                        Novo Tipo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Passiva -->
    <div id="edit-passiva-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-cinzel font-bold text-xl text-white">Editar Passiva Especial</h3>
                    <button onclick="closeEditPassivaModal()" class="text-theme-muted hover:text-white transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-400 mb-2">Passiva do Mascote</label>
                    <textarea id="passiva-textarea" rows="6"
                        class="w-full px-4 py-3 bg-theme-bg border border-theme-border rounded-lg text-white placeholder-gray-500 focus:border-theme-pink focus:outline-none"></textarea>
                    <div class="text-xs text-gray-500 mt-2">Descreva a habilidade passiva especial do seu mascote.</div>
                </div>
                
                <div class="flex gap-3">
                    <button onclick="closeEditPassivaModal()" class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-theme-text hover:bg-white/5 transition-colors">
                        Cancelar
                    </button>
                    <button onclick="savePassiva()" class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-pink to-purple-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                        <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                        Salvar Passiva
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Aviso (Novo) -->
    <div id="no-profile-modal" class="modal-backdrop hidden">
        <div class="modal-content p-6">
            <div class="flex items-center gap-3 mb-4">
                <i data-lucide="alert-circle" class="w-10 h-10 text-theme-orange"></i>
                <h3 class="font-cinzel font-bold text-xl text-white">Perfil N√£o Encontrado</h3>
            </div>
            
            <p class="text-gray-300 mb-6">
                Para salvar seu mascote no perfil, voc√™ precisa criar um personagem primeiro.
                O mascote ser√° vinculado ao seu personagem principal.
            </p>
            
            <div class="flex gap-3">
                <button onclick="hideNoProfileModal()" 
                    class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-theme-text hover:bg-white/5 transition-colors">
                    Continuar sem Perfil
                </button>
                <button onclick="goToFicha()" 
                    class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-orange to-red-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                    <i data-lucide="edit-3" class="w-4 h-4 inline mr-2"></i>
                    Criar Personagem
                </button>
            </div>
        </div>
    </div>

    <!-- CONTE√öDO PRINCIPAL -->
    <div id="print-area">
        
        <nav class="w-full bg-[#0f0f12]/95 backdrop-blur-sm border-b border-theme-border sticky top-0 z-50 mb-8">
            <div class="max-w-7xl mx-auto px-4 flex items-center justify-between py-4">
                <div class="flex items-center gap-4">
                    <a href="index.html" class="text-theme-text hover:text-theme-pink transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </a>
                    <div class="h-6 w-[1px] bg-theme-border"></div>
                    <span class="font-cinzel font-bold text-lg tracking-wide text-theme-pink">Grim√≥rio Digital</span>
                    <div class="h-6 w-[1px] bg-theme-border"></div>
                    <span class="text-sm text-theme-muted">Mascote</span>
                </div>
                
                <div class="flex items-center gap-3" id="nav-buttons">
                    <!-- Bot√µes din√¢micos de navega√ß√£o -->
                </div>
            </div>
            <div class="h-[1px] bg-gradient-to-r from-transparent via-theme-pink to-transparent"></div>
        </nav>

        <div class="max-w-6xl mx-auto px-4 space-y-6">

            <!-- Cabe√ßalho com Info do Perfil -->
            <header class="flex items-center justify-between mb-6 anim-entry">
                <div class="flex items-center gap-4">
                    <div class="p-3 rounded-lg bg-gradient-to-br from-theme-pink/20 to-purple-600/20 border border-theme-pink/30">
                        <i data-lucide="dog" class="w-8 h-8 text-theme-pink"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-cinzel font-bold text-white">Mascote</h1>
                        <p class="text-gray-400">Companheiro do seu personagem</p>
                    </div>
                </div>
                
                <div class="text-right relative" id="profile-info">
                    <div class="animate-pulse">
                        <div class="h-4 bg-theme-border rounded w-32 mb-2"></div>
                        <div class="h-3 bg-theme-border rounded w-24"></div>
                    </div>
                </div>
            </header>

            <!-- Aviso se n√£o houver perfil -->
            <div id="no-profile-warning" class="no-profile-warning border border-theme-border p-4 rounded-lg mb-6 hidden anim-entry">
                <div class="flex items-center gap-3">
                    <i data-lucide="alert-triangle" class="w-5 h-5 text-theme-red flex-shrink-0"></i>
                    <div class="flex-1">
                        <p class="text-sm text-white">
                            <strong class="text-theme-red">Aten√ß√£o:</strong> Voc√™ n√£o tem um perfil ativo. 
                            Seu mascote ser√° salvo localmente, mas n√£o estar√° vinculado a um personagem.
                        </p>
                        <div class="flex gap-2 mt-2">
                            <button onclick="goToFicha()" class="text-xs px-3 py-1 bg-theme-red/20 text-theme-red rounded border border-theme-red/30 hover:bg-theme-red/30 transition-colors">
                                Criar Personagem
                            </button>
                            <button onclick="hideWarning()" class="text-xs px-3 py-1 bg-theme-border text-theme-muted rounded hover:bg-white/10 transition-colors">
                                Entendi
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 1: Identidade do Mascote -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-1" style="border-left: 4px solid #ec4899;">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-pink">
                        <i data-lucide="sparkles" class="w-4 h-4"></i> Identidade do Mascote
                    </h3>
                    <div class="text-xs text-gray-500">
                        √öltimo salvamento: <span id="last-saved">Nunca</span>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Nome e N√≠vel -->
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-400 mb-2">Nome do Mascote</label>
                            <input type="text" id="mascote-nome" placeholder="Ex: Fang, Luna, Ember" 
                                class="w-full px-4 py-3 bg-theme-bg border border-theme-border rounded-lg text-white placeholder-gray-500 focus:border-theme-pink focus:outline-none">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-400 mb-2">N√≠vel</label>
                            <div class="flex items-center gap-4">
                                <input type="number" id="mascote-nivel" min="1" max="100" value="1"
                                    class="w-20 px-4 py-3 bg-theme-bg border border-theme-border rounded-lg text-white text-center focus:border-theme-pink focus:outline-none">
                                <div class="text-sm text-gray-500">Determina a pot√™ncia geral do mascote</div>
                            </div>
                            <div id="nivel-display" class="mt-2 text-xs text-gray-500 hidden">
                                <span class="text-theme-pink">Poder estimado: </span><span id="poder-estimado">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tipo de Criatura -->
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <label class="block text-sm font-medium text-gray-400">Tipo de Criatura</label>
                            <button onclick="openManageTypesModal()" class="text-xs text-theme-pink hover:text-pink-300 transition-colors">
                                <i data-lucide="settings" class="w-3 h-3 inline mr-1"></i>
                                Gerenciar tipos
                            </button>
                        </div>
                        
                        <div id="tipo-criaturas" class="grid grid-cols-5 gap-3 mb-6">
                            <!-- Tipos ser√£o renderizados aqui -->
                        </div>
                        
                        <button onclick="openCustomTypeModal()" class="w-full py-2 border-2 border-dashed border-theme-border rounded-lg text-gray-500 hover:text-white hover:border-theme-pink transition-colors">
                            <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                            Criar Tipo Personalizado
                        </button>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 2: Status e Atributos -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-2" style="border-left: 4px solid #8b5cf6;">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-purple mb-6">
                    <i data-lucide="activity" class="w-4 h-4"></i> Status e Atributos
                </h3>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Vida e Lealdade -->
                    <div class="space-y-6">
                        <!-- Vida -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-gray-400">Vitalidade</label>
                                <span class="font-mono text-lg text-white" id="vida-display">50/50</span>
                            </div>
                            <div class="stat-bar">
                                <div id="vida-bar" class="stat-bar-fill bg-gradient-to-r from-red-600 to-red-400" style="width: 100%"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mt-2">
                                <input type="number" id="vida-atual" min="0" value="50" 
                                    class="w-full px-3 py-2 bg-theme-bg border border-theme-border rounded text-white text-center focus:border-red-500 focus:outline-none">
                                <input type="number" id="vida-max" min="1" value="50" 
                                    class="w-full px-3 py-2 bg-theme-bg border border-theme-border rounded text-white text-center focus:border-red-500 focus:outline-none">
                            </div>
                        </div>
                        
                        <!-- Lealdade -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-gray-400">Lealdade</label>
                                <span class="font-mono text-lg text-white" id="lealdade-display">80%</span>
                            </div>
                            <div class="stat-bar">
                                <div id="lealdade-bar" class="stat-bar-fill bg-gradient-to-r from-yellow-600 to-yellow-400" style="width: 80%"></div>
                            </div>
                            <input type="range" id="input-lealdade" min="0" max="100" value="80" 
                                class="w-full mt-2 accent-yellow-500">
                        </div>
                    </div>
                    
                    <!-- Atributos -->
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Agilidade -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-400">Agilidade</label>
                                <span class="font-mono text-lg text-white" id="agilidade-display">70</span>
                            </div>
                            <input type="range" id="input-agilidade" min="0" max="100" value="70" 
                                class="w-full accent-blue-500">
                        </div>
                        
                        <!-- For√ßa -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-400">For√ßa</label>
                                <span class="font-mono text-lg text-white" id="forca-display">60</span>
                            </div>
                            <input type="range" id="input-forca" min="0" max="100" value="60" 
                                class="w-full accent-red-500">
                        </div>
                        
                        <!-- Percep√ß√£o -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-400">Percep√ß√£o</label>
                                <span class="font-mono text-lg text-white" id="percepcao-display">65</span>
                            </div>
                            <input type="range" id="input-percepcao" min="0" max="100" value="65" 
                                class="w-full accent-green-500">
                        </div>
                        
                        <!-- Defesa -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-400">Defesa</label>
                                <span class="font-mono text-lg text-white" id="defesa-display">55</span>
                            </div>
                            <input type="range" id="input-defesa" min="0" max="100" value="55" 
                                class="w-full accent-purple-500">
                        </div>
                        
                        <!-- Energia -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-400">Energia</label>
                                <span class="font-mono text-lg text-white" id="energia-display">75</span>
                            </div>
                            <input type="range" id="input-energia" min="0" max="100" value="75" 
                                class="w-full accent-cyan-500">
                        </div>
                        
                        <!-- Espa√ßo para novo atributo ou informa√ß√£o -->
                        <div class="col-span-2 p-3 bg-theme-bg/50 rounded border border-theme-border">
                            <div class="text-xs text-gray-500">Total de atributos: <span id="total-atributos" class="text-white font-mono">325</span></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 3: Habilidades -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-3" style="border-left: 4px solid #4a9eff;">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-blue">
                        <i data-lucide="zap" class="w-4 h-4"></i> Habilidades
                    </h3>
                    <button onclick="addSkill()" class="flex items-center gap-2 px-3 py-2 bg-theme-blue/20 text-theme-blue text-xs rounded border border-theme-blue/30 hover:bg-theme-blue/30 transition-colors">
                        <i data-lucide="plus" class="w-3 h-3"></i>
                        Nova Habilidade
                    </button>
                </div>
                
                <!-- Passiva Especial -->
                <div class="mb-8 p-4 bg-theme-bg rounded-lg border border-theme-border">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <i data-lucide="star" class="w-4 h-4 text-theme-yellow"></i>
                            <label class="text-sm font-medium text-gray-400">Passiva Especial</label>
                        </div>
                        <button onclick="openEditPassivaModal()" class="text-xs text-theme-yellow hover:text-yellow-300 transition-colors">
                            <i data-lucide="edit-2" class="w-3 h-3 inline mr-1"></i>
                            Editar
                        </button>
                    </div>
                    <div id="passiva-display" class="text-sm text-gray-300 italic">
                        Clique em "Editar" para criar uma passiva especial para seu mascote.
                    </div>
                </div>
                
                <!-- Lista de Habilidades -->
                <div id="skills-list" class="space-y-3">
                    <!-- Habilidades ser√£o adicionadas aqui -->
                    <div class="text-center py-6 text-gray-500">
                        <i data-lucide="zap" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        <p>Nenhuma habilidade adicionada</p>
                        <p class="text-xs mt-1">Clique em "Nova Habilidade" para come√ßar</p>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 4: Descri√ß√µes -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-4" style="border-left: 4px solid #22c55e;">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-green mb-6">
                    <i data-lucide="file-text" class="w-4 h-4"></i> Descri√ß√µes
                </h3>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Apar√™ncia -->
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">
                            Apar√™ncia
                            <span class="text-xs text-gray-500 float-right">(<span id="char-count-aparencia">0</span>/500)</span>
                        </label>
                        <textarea id="mascote-aparencia" placeholder="Descreva a apar√™ncia f√≠sica do seu mascote..." maxlength="500" rows="6"
                            class="w-full px-4 py-3 bg-theme-bg border border-theme-border rounded-lg text-white placeholder-gray-500 focus:border-theme-green focus:outline-none"></textarea>
                    </div>
                    
                    <!-- Personalidade -->
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">
                            Personalidade
                            <span class="text-xs text-gray-500 float-right">(<span id="char-count-personalidade">0</span>/500)</span>
                        </label>
                        <textarea id="mascote-personalidade" placeholder="Como seu mascote se comporta? Quais s√£o seus tra√ßos de personalidade?" maxlength="500" rows="6"
                            class="w-full px-4 py-3 bg-theme-bg border border-theme-border rounded-lg text-white placeholder-gray-500 focus:border-theme-green focus:outline-none"></textarea>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 5: Hist√≥ria e Notas -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-4" style="border-left: 4px solid #f59e0b;">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-yellow">
                        <i data-lucide="book-open" class="w-4 h-4"></i> Hist√≥ria e Notas
                    </h3>
                    <div class="text-xs text-gray-500">
                        <span id="char-count-historia">0</span>/2000 caracteres
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Hist√≥ria do Mascote</label>
                    <textarea id="mascote-historia" placeholder="Como voc√™ encontrou seu mascote? Qual √© a hist√≥ria dele? Que experi√™ncias compartilharam juntos?" maxlength="2000" rows="8"
                        class="w-full px-4 py-3 bg-theme-bg border border-theme-border rounded-lg text-white placeholder-gray-500 focus:border-theme-yellow focus:outline-none"></textarea>
                </div>
            </section>

        </div>
    </div>

    <!-- Rodap√© com A√ß√µes -->
    <div class="max-w-6xl mx-auto px-4 mt-8 pb-12 flex flex-col md:flex-row justify-end gap-4 anim-entry">
        <button onclick="resetMascote()" 
                class="flex items-center justify-center gap-2 px-6 py-3 border border-theme-border rounded text-theme-text hover:bg-white/5 transition-colors font-cinzel text-sm">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
            Resetar
        </button>
        
        <button onclick="downloadTXT()" 
                class="flex items-center justify-center gap-2 px-6 py-3 bg-theme-panel border border-theme-border rounded text-theme-text hover:bg-white/5 transition-colors font-cinzel text-sm">
            <i data-lucide="file-text" class="w-4 h-4"></i>
            Exportar TXT
        </button>

        <button onclick="saveToProfile()" id="btn-save-profile" 
                class="flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-theme-purple to-indigo-600 rounded text-white shadow-lg hover:shadow-purple-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="save" class="w-4 h-4"></i>
            Salvar no Perfil
        </button>

        <button onclick="saveLocal()" id="btn-save-local" 
                class="flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-theme-pink to-purple-600 rounded text-white shadow-lg hover:shadow-pink-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="hard-drive" class="w-4 h-4"></i>
            Salvar Local
        </button>
    </div>

    <script>
        lucide.createIcons();

        // ====================================================================
        // DADOS GLOBAIS E CONFIGURA√á√ÉO
        // ====================================================================
        const TIPOS_PREDEFINIDOS = [
            { id: 'canino', nome: 'Canino', icone: 'dog', cor: '#f59e0b', custom: false },
            { id: 'felino', nome: 'Felino', icone: 'cat', cor: '#8b5cf6', custom: false },
            { id: 'ave', nome: 'Ave', icone: 'bird', cor: '#4a9eff', custom: false },
            { id: 'reptil', nome: 'R√©ptil', icone: 'snake', cor: '#22c55e', custom: false },
            { id: 'fantastico', nome: 'Fant√°stico', icone: 'sparkles', cor: '#ec4899', custom: false }
        ];

        let mascoteData = {
            tipoSelecionado: 'canino',
            skills: [],
            lastAutoSave: null,
            customTypes: [],
            currentPassiva: 'Clique em "Editar" para criar uma passiva especial para seu mascote.',
            linkedProfile: null
        };

        // ====================================================================
        // FUN√á√ïES DO SISTEMA DE TIPOS
        // ====================================================================
        function loadCustomTypes() {
            const saved = localStorage.getItem('mascote_custom_types');
            if (saved) {
                mascoteData.customTypes = JSON.parse(saved);
            }
        }

        function saveCustomTypes() {
            localStorage.setItem('mascote_custom_types', JSON.stringify(mascoteData.customTypes));
        }

        function renderTipoCriaturas() {
            const container = document.getElementById('tipo-criaturas');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Renderizar tipos predefinidos
            TIPOS_PREDEFINIDOS.forEach(tipo => {
                const isSelected = mascoteData.tipoSelecionado === tipo.id;
                const card = document.createElement('div');
                card.className = `type-card flex flex-col items-center justify-center p-3 rounded-lg cursor-pointer ${isSelected ? 'selected' : 'opacity-70 hover:opacity-100'}`;
                card.style.borderColor = isSelected ? tipo.cor : 'transparent';
                card.style.backgroundColor = isSelected ? `${tipo.cor}20` : '#0a0a0c';
                card.onclick = () => selectTipoCriatura(tipo.id);
                
                card.innerHTML = `
                    <div class="w-10 h-10 rounded-full mb-2 flex items-center justify-center" style="background: ${tipo.cor}40; color: ${tipo.cor}">
                        <i data-lucide="${tipo.icone}" class="w-5 h-5"></i>
                    </div>
                    <span class="text-xs text-center" style="color: ${isSelected ? '#fff' : tipo.cor}">${tipo.nome}</span>
                `;
                
                container.appendChild(card);
            });
            
            // Renderizar tipos personalizados
            mascoteData.customTypes.forEach(tipo => {
                const isSelected = mascoteData.tipoSelecionado === tipo.id;
                const card = document.createElement('div');
                card.className = `type-card flex flex-col items-center justify-center p-3 rounded-lg cursor-pointer ${isSelected ? 'selected' : 'opacity-70 hover:opacity-100'}`;
                card.style.borderColor = isSelected ? tipo.cor : 'transparent';
                card.style.backgroundColor = isSelected ? `${tipo.cor}20` : '#0a0a0c';
                card.onclick = () => selectTipoCriatura(tipo.id);
                
                card.innerHTML = `
                    <div class="w-10 h-10 rounded-full mb-2 flex items-center justify-center" style="background: ${tipo.cor}40; color: ${tipo.cor}">
                        <i data-lucide="${tipo.icone || 'sparkles'}" class="w-5 h-5"></i>
                    </div>
                    <span class="text-xs text-center" style="color: ${isSelected ? '#fff' : tipo.cor}">${tipo.nome}</span>
                `;
                
                container.appendChild(card);
            });
            
            lucide.createIcons();
        }

        function selectTipoCriatura(tipoId) {
            mascoteData.tipoSelecionado = tipoId;
            renderTipoCriaturas();
            
            // Atualizar passiva display
            let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === tipoId);
            if (!tipo) {
                tipo = mascoteData.customTypes.find(t => t.id === tipoId);
            }
            if (tipo) {
                updatePassivaDisplay(tipo);
            }
            
            autoSave();
        }

        function openCustomTypeModal() {
            document.getElementById('custom-type-modal').classList.remove('hidden');
        }

        function closeCustomTypeModal() {
            document.getElementById('custom-type-modal').classList.add('hidden');
        }

        function setCustomTypeColor(color) {
            document.getElementById('custom-type-color-picker').value = color;
        }

        function saveCustomType() {
            const name = document.getElementById('custom-type-name').value.trim();
            const color = document.getElementById('custom-type-color-picker').value;
            const icon = document.getElementById('custom-type-icon').value;
            const desc = document.getElementById('custom-type-desc').value.trim();
            
            if (!name) {
                alert('Por favor, digite um nome para o tipo.');
                return;
            }
            
            const newType = {
                id: 'custom_' + Date.now(),
                nome: name,
                cor: color,
                icone: icon,
                descricao: desc,
                custom: true
            };
            
            mascoteData.customTypes.push(newType);
            saveCustomTypes();
            renderTipoCriaturas();
            closeCustomTypeModal();
            
            // Selecionar o novo tipo
            mascoteData.tipoSelecionado = newType.id;
            
            mostrarFeedback('Tipo personalizado criado!', 'success');
        }

        function openManageTypesModal() {
            renderCustomTypesList();
            document.getElementById('manage-types-modal').classList.remove('hidden');
        }

        function closeManageTypesModal() {
            document.getElementById('manage-types-modal').classList.add('hidden');
        }

        function renderCustomTypesList() {
            const container = document.getElementById('custom-types-list');
            if (!container) return;
            
            if (mascoteData.customTypes.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i data-lucide="folder-open" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        <p>Nenhum tipo personalizado</p>
                        <p class="text-xs mt-1">Crie seu primeiro tipo!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            mascoteData.customTypes.forEach((tipo, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-theme-bg rounded border border-theme-border';
                
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background: ${tipo.cor}40; color: ${tipo.cor}">
                            <i data-lucide="${tipo.icone || 'sparkles'}" class="w-4 h-4"></i>
                        </div>
                        <div>
                            <div class="font-medium text-white">${tipo.nome}</div>
                            ${tipo.descricao ? `<div class="text-xs text-gray-500">${tipo.descricao.substring(0, 50)}${tipo.descricao.length > 50 ? '...' : ''}</div>` : ''}
                        </div>
                    </div>
                    <button onclick="deleteCustomType(${index})" class="text-red-500 hover:text-red-400 transition-colors">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                `;
                
                container.appendChild(div);
            });
            
            lucide.createIcons();
        }

        function deleteCustomType(index) {
            if (confirm('Tem certeza que deseja excluir este tipo? Esta a√ß√£o n√£o pode ser desfeita.')) {
                const deletedType = mascoteData.customTypes[index];
                
                // Se o tipo sendo exclu√≠do est√° selecionado, mudar para o tipo padr√£o
                if (mascoteData.tipoSelecionado === deletedType.id) {
                    mascoteData.tipoSelecionado = 'canino';
                }
                
                mascoteData.customTypes.splice(index, 1);
                saveCustomTypes();
                renderTipoCriaturas();
                renderCustomTypesList();
                
                mostrarFeedback('Tipo exclu√≠do!', 'success');
            }
        }

        // ====================================================================
        // FUN√á√ïES DE ATUALIZA√á√ÉO DE DISPLAY
        // ====================================================================
        function updateVida() {
            const atual = parseInt(document.getElementById('vida-atual').value) || 0;
            const max = parseInt(document.getElementById('vida-max').value) || 1;
            const percent = Math.min(100, (atual / max) * 100);
            
            document.getElementById('vida-display').textContent = `${atual}/${max}`;
            document.getElementById('vida-bar').style.width = `${percent}%`;
        }

        function updateLealdade() {
            const value = parseInt(document.getElementById('input-lealdade').value) || 0;
            document.getElementById('lealdade-display').textContent = `${value}%`;
            document.getElementById('lealdade-bar').style.width = `${value}%`;
        }

        function updateAgilidade() {
            const value = parseInt(document.getElementById('input-agilidade').value) || 0;
            document.getElementById('agilidade-display').textContent = value;
        }

        function updateForca() {
            const value = parseInt(document.getElementById('input-forca').value) || 0;
            document.getElementById('forca-display').textContent = value;
        }

        function updatePercepcao() {
            const value = parseInt(document.getElementById('input-percepcao').value) || 0;
            document.getElementById('percepcao-display').textContent = value;
        }

        function updateDefesa() {
            const value = parseInt(document.getElementById('input-defesa').value) || 0;
            document.getElementById('defesa-display').textContent = value;
        }

        function updateEnergia() {
            const value = parseInt(document.getElementById('input-energia').value) || 0;
            document.getElementById('energia-display').textContent = value;
        }

        function updateNivelDisplay() {
            const nivel = parseInt(document.getElementById('mascote-nivel').value) || 1;
            const poder = Math.floor(
                (parseInt(document.getElementById('input-lealdade').value) || 0) * 0.2 +
                (parseInt(document.getElementById('input-agilidade').value) || 0) * 0.15 +
                (parseInt(document.getElementById('input-forca').value) || 0) * 0.15 +
                (parseInt(document.getElementById('input-percepcao').value) || 0) * 0.15 +
                (parseInt(document.getElementById('input-defesa').value) || 0) * 0.15 +
                (parseInt(document.getElementById('input-energia').value) || 0) * 0.2 +
                (nivel * 10)
            );
            
            const display = document.getElementById('nivel-display');
            const poderDisplay = document.getElementById('poder-estimado');
            
            if (display && poderDisplay) {
                display.classList.remove('hidden');
                poderDisplay.textContent = poder;
            }
            
            // Atualizar total de atributos
            const total =
                (parseInt(document.getElementById('input-lealdade').value) || 0) +
                (parseInt(document.getElementById('input-agilidade').value) || 0) +
                (parseInt(document.getElementById('input-forca').value) || 0) +
                (parseInt(document.getElementById('input-percepcao').value) || 0) +
                (parseInt(document.getElementById('input-defesa').value) || 0) +
                (parseInt(document.getElementById('input-energia').value) || 0);
            
            const totalEl = document.getElementById('total-atributos');
            if (totalEl) {
                totalEl.textContent = total;
            }
        }

        function updatePassivaDisplay(tipo) {
            const display = document.getElementById('passiva-display');
            if (!display) return;
            
            if (mascoteData.currentPassiva && mascoteData.currentPassiva !== 'Clique em "Editar" para criar uma passiva especial para seu mascote.') {
                display.textContent = mascoteData.currentPassiva;
            } else {
                // Passivas padr√£o baseadas no tipo
                const passivasPadrao = {
                    'canino': 'Instinto protetor: +10% de defesa quando o dono est√° com menos de 50% de vida.',
                    'felino': 'Agilidade felina: +15% de chance de evitar ataques.',
                    'ave': 'Vis√£o apurada: +20% de chance de detectar perigos ocultos.',
                    'reptil': 'Camuflagem natural: +25% de chance de n√£o ser detectado.',
                    'fantastico': 'Aura m√°gica: +5 em todos os atributos durante a noite.'
                };
                
                display.textContent = passivasPadrao[tipo.id] || 'Clique em "Editar" para criar uma passiva especial para seu mascote.';
            }
        }

        function updateCharCounters() {
            const aparencia = document.getElementById('mascote-aparencia');
            const personalidade = document.getElementById('mascote-personalidade');
            const historia = document.getElementById('mascote-historia');
            
            if (aparencia) {
                document.getElementById('char-count-aparencia').textContent = aparencia.value.length;
            }
            if (personalidade) {
                document.getElementById('char-count-personalidade').textContent = personalidade.value.length;
            }
            if (historia) {
                document.getElementById('char-count-historia').textContent = historia.value.length;
            }
        }

        // ====================================================================
        // FUN√á√ïES DE HABILIDADES
        // ====================================================================
        function addSkill() {
            const skill = {
                id: Date.now(),
                nome: `Nova Habilidade ${mascoteData.skills.length + 1}`,
                descricao: 'Descreva esta habilidade...',
                tipo: 'ativo',
                nivel: 1,
                custo: 0
            };
            
            mascoteData.skills.push(skill);
            renderSkills();
            autoSave();
        }

        function removeSkill(id) {
            mascoteData.skills = mascoteData.skills.filter(skill => skill.id !== id);
            renderSkills();
            autoSave();
        }

        function renderSkills() {
            const container = document.getElementById('skills-list');
            if (!container) return;
            
            if (mascoteData.skills.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-6 text-gray-500">
                        <i data-lucide="zap" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        <p>Nenhuma habilidade adicionada</p>
                        <p class="text-xs mt-1">Clique em "Nova Habilidade" para come√ßar</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            mascoteData.skills.forEach(skill => {
                const div = document.createElement('div');
                div.className = 'p-4 bg-theme-bg rounded-lg border border-theme-border';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <input type="text" value="${skill.nome}" 
                                onchange="updateSkill(${skill.id}, 'nome', this.value)"
                                class="bg-transparent border-none text-white font-semibold focus:outline-none focus:border-b focus:border-theme-blue">
                            <div class="flex items-center gap-2 mt-1">
                                <select onchange="updateSkill(${skill.id}, 'tipo', this.value)" 
                                    class="text-xs bg-theme-border text-white px-2 py-1 rounded">
                                    <option value="ativo" ${skill.tipo === 'ativo' ? 'selected' : ''}>Ativo</option>
                                    <option value="passivo" ${skill.tipo === 'passivo' ? 'selected' : ''}>Passivo</option>
                                    <option value="suporte" ${skill.tipo === 'suporte' ? 'selected' : ''}>Suporte</option>
                                </select>
                                <span class="text-xs text-gray-500">N√≠vel <input type="number" min="1" max="10" value="${skill.nivel}" 
                                    onchange="updateSkill(${skill.id}, 'nivel', this.value)"
                                    class="w-10 bg-transparent border-none text-center text-white focus:outline-none"></span>
                                <span class="text-xs text-gray-500">Custo: <input type="number" min="0" value="${skill.custo}" 
                                    onchange="updateSkill(${skill.id}, 'custo', this.value)"
                                    class="w-10 bg-transparent border-none text-center text-white focus:outline-none"> EN</span>
                            </div>
                        </div>
                        <button onclick="removeSkill(${skill.id})" class="text-red-500 hover:text-red-400 transition-colors">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <textarea onchange="updateSkill(${skill.id}, 'descricao', this.value)" rows="2"
                        class="w-full bg-transparent border-none text-gray-300 text-sm resize-none focus:outline-none">${skill.descricao}</textarea>
                `;
                container.appendChild(div);
            });
            
            lucide.createIcons();
        }

        function updateSkill(id, field, value) {
            const skill = mascoteData.skills.find(s => s.id === id);
            if (skill) {
                skill[field] = value;
                autoSave();
            }
        }

        function openEditPassivaModal() {
            const textarea = document.getElementById('passiva-textarea');
            if (textarea) {
                textarea.value = mascoteData.currentPassiva;
            }
            document.getElementById('edit-passiva-modal').classList.remove('hidden');
        }

        function closeEditPassivaModal() {
            document.getElementById('edit-passiva-modal').classList.add('hidden');
        }

        function savePassiva() {
            const textarea = document.getElementById('passiva-textarea');
            if (textarea) {
                mascoteData.currentPassiva = textarea.value.trim() || mascoteData.currentPassiva;
                closeEditPassivaModal();
                
                // Atualizar display
                let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === mascoteData.tipoSelecionado);
                if (!tipo) {
                    tipo = mascoteData.customTypes.find(t => t.id === mascoteData.tipoSelecionado);
                }
                if (tipo) {
                    updatePassivaDisplay(tipo);
                }
                
                autoSave();
                mostrarFeedback('Passiva salva!', 'success');
            }
        }

        // ====================================================================
        // SISTEMA DE AUTO-SAVE
        // ====================================================================
        function autoSave() {
            const data = getMascoteData();
            localStorage.setItem('rpg_mascote_autosave', JSON.stringify(data));
            mascoteData.lastAutoSave = new Date();
            
            // Atualizar todos os displays
            updateVida();
            updateLealdade();
            updateAgilidade();
            updateForca();
            updatePercepcao();
            updateDefesa();
            updateEnergia();
            updateNivelDisplay();
            updateCharCounters();
        }

        // ====================================================================
        // FUN√á√ïES DE EXPORTA√á√ÉO
        // ====================================================================
        function downloadTXT() {
            const data = getMascoteData();
            let txtContent = '=== FICHA DE MASCOTE ===\n\n';
            
            txtContent += `Nome: ${data.nome || 'Sem nome'}\n`;
            txtContent += `Tipo: ${data.tipoNome}\n`;
            txtContent += `N√≠vel: ${data.nivel}\n\n`;
            
            txtContent += '=== STATUS ===\n';
            txtContent += `Vida: ${data.vidaAtual}/${data.vidaMax}\n`;
            txtContent += `Lealdade: ${data.lealdade}%\n`;
            txtContent += `Agilidade: ${data.agilidade}\n`;
            txtContent += `For√ßa: ${data.forca}\n`;
            txtContent += `Percep√ß√£o: ${data.percepcao}\n`;
            txtContent += `Defesa: ${data.defesa}\n`;
            txtContent += `Energia: ${data.energia}\n\n`;
            
            txtContent += '=== PASSIVA ESPECIAL ===\n';
            txtContent += `${data.passiva}\n\n`;
            
            txtContent += '=== HABILIDADES ===\n';
            if (data.habilidades.length > 0) {
                data.habilidades.forEach((skill, index) => {
                    txtContent += `${index + 1}. ${skill.nome} (${skill.tipo}, N√≠vel ${skill.nivel}, Custo: ${skill.custo} EN)\n`;
                    txtContent += `   ${skill.descricao}\n\n`;
                });
            } else {
                txtContent += 'Nenhuma habilidade registrada.\n\n';
            }
            
            txtContent += '=== DESCRI√á√ïES ===\n';
            txtContent += `Apar√™ncia:\n${data.aparencia || 'N√£o descrita.'}\n\n`;
            txtContent += `Personalidade:\n${data.personalidade || 'N√£o descrita.'}\n\n`;
            txtContent += `Hist√≥ria:\n${data.historia || 'N√£o registrada.'}\n\n`;
            
            txtContent += '=== METADADOS ===\n';
            txtContent += `Salvo em: ${new Date().toLocaleString()}\n`;
            txtContent += `Vinculado ao perfil: ${data.linkedProfile ? 'Sim' : 'N√£o'}\n`;
            
            const blob = new Blob([txtContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mascote_${data.nome || 'sem_nome'}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            mostrarFeedback('Ficha exportada como TXT!', 'success');
        }

        function getLealdadeTexto(valor) {
            if (valor >= 90) return 'Inabal√°vel';
            if (valor >= 75) return 'Leal';
            if (valor >= 50) return 'Confiavel';
            if (valor >= 25) return 'Hesitante';
            return 'Indisciplinado';
        }

        // ====================================================================
        // FUN√á√ïES DE INTEGRA√á√ÉO COM PERFIL (mantidas do seu c√≥digo)
        // ====================================================================
        function loadActiveProfile() {
            try {
                const perfis = localStorage.getItem('rpg_sistema_perfis');
                const perfilAtivoId = localStorage.getItem('perfil_ativo');
                
                if (!perfis || !perfilAtivoId) {
                    showNoProfileWarning();
                    mascoteData.linkedProfile = null;
                    return null;
                }
                
                const perfisObj = JSON.parse(perfis);
                const perfilAtivo = perfisObj[perfilAtivoId];
                
                if (!perfilAtivo) {
                    showNoProfileWarning();
                    mascoteData.linkedProfile = null;
                    return null;
                }
                
                mascoteData.linkedProfile = perfilAtivoId;
                updateProfileDisplay(perfilAtivo);
                hideNoProfileWarning();
                loadMascoteFromProfile(perfilAtivo);
                
                return perfilAtivo;
                
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                showNoProfileWarning();
                mascoteData.linkedProfile = null;
                return null;
            }
        }

        function updateProfileDisplay(perfil) {
            const profileInfo = document.getElementById('profile-info');
            const profileBadge = document.getElementById('profile-badge');
            const profileNameDisplay = document.getElementById('profile-name-display');
            
            if (perfil) {
                profileInfo.innerHTML = `
                    <div class="relative">
                        <div class="active-profile-indicator"></div>
                        <div class="text-sm text-theme-muted mb-1">Vinculado a</div>
                        <div class="font-cinzel font-bold text-theme-pink">${perfil.nome || 'Personagem'}</div>
                    </div>
                `;
                
                if (profileBadge) {
                    profileBadge.classList.remove('hidden');
                }
                if (profileNameDisplay) {
                    profileNameDisplay.textContent = perfil.nome || 'Personagem';
                }
                
                setupNavButtons();
                
            } else {
                profileInfo.innerHTML = `
                    <div>
                        <div class="text-sm text-theme-muted mb-1">Sem perfil ativo</div>
                        <div class="font-cinzel font-bold text-theme-muted">N√£o vinculado</div>
                    </div>
                `;
                
                if (profileBadge) {
                    profileBadge.classList.add('hidden');
                }
            }
            
            lucide.createIcons();
        }

        function setupNavButtons() {
            const navButtons = document.getElementById('nav-buttons');
            if (!navButtons) return;
            
            navButtons.innerHTML = `
                <button onclick="goToIndex()" 
                    class="flex items-center gap-2 px-3 py-2 text-sm bg-theme-panel hover:bg-theme-panel/80 border border-theme-border rounded transition-colors">
                    <i data-lucide="home" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">In√≠cio</span>
                </button>
                <button onclick="goToFicha()" 
                    class="flex items-center gap-2 px-3 py-2 text-sm bg-theme-orange/20 hover:bg-theme-orange/30 text-theme-orange border border-theme-orange/30 rounded transition-colors">
                    <i data-lucide="edit-3" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">Personagem</span>
                </button>
                <button onclick="goToPerfil()" 
                    class="flex items-center gap-2 px-3 py-2 text-sm bg-theme-blue/20 hover:bg-theme-blue/30 text-theme-blue border border-theme-blue/30 rounded transition-colors">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">Perfil</span>
                </button>
            `;
            
            lucide.createIcons();
        }

        // ====================================================================
        // NAVEGA√á√ÉO
        // ====================================================================
        function goToIndex() {
            window.location.href = 'index.html';
        }
        
        function goToFicha() {
            window.location.href = 'ficha.html';
        }
        
        function goToPerfil() {
            window.location.href = 'perfil.html';
        }

        // ====================================================================
        // SISTEMA DE PERSIST√äNCIA INTEGRADO (mantidas do seu c√≥digo)
        // ====================================================================
        function getMascoteData() {
            let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === mascoteData.tipoSelecionado);
            if (!tipo) {
                tipo = mascoteData.customTypes.find(t => t.id === mascoteData.tipoSelecionado);
            }
            
            return {
                nome: document.getElementById('mascote-nome').value,
                tipoId: mascoteData.tipoSelecionado,
                tipoNome: tipo ? tipo.nome : 'Desconhecido',
                tipoCor: tipo ? tipo.cor : '#ec4899',
                tipoIcone: tipo ? tipo.icone : 'dog',
                
                nivel: parseInt(document.getElementById('mascote-nivel').value),
                vidaAtual: parseInt(document.getElementById('vida-atual').value),
                vidaMax: parseInt(document.getElementById('vida-max').value),
                lealdade: parseInt(document.getElementById('input-lealdade').value),
                agilidade: parseInt(document.getElementById('input-agilidade').value),
                forca: parseInt(document.getElementById('input-forca').value),
                percepcao: parseInt(document.getElementById('input-percepcao').value),
                defesa: parseInt(document.getElementById('input-defesa').value),
                energia: parseInt(document.getElementById('input-energia').value),
                
                aparencia: document.getElementById('mascote-aparencia').value,
                personalidade: document.getElementById('mascote-personalidade').value,
                historia: document.getElementById('mascote-historia').value,
                
                habilidades: mascoteData.skills,
                passiva: mascoteData.currentPassiva,
                
                customTypes: mascoteData.customTypes,
                linkedProfile: mascoteData.linkedProfile,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
        }

        function saveToProfile() {
            if (!mascoteData.linkedProfile) {
                showNoProfileModal();
                return;
            }
            
            const data = getMascoteData();
            const btn = document.getElementById('btn-save-profile');
            const originalHTML = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`;
            lucide.createIcons();

            setTimeout(() => {
                try {
                    const perfis = localStorage.getItem('rpg_sistema_perfis');
                    const perfilAtivoId = localStorage.getItem('perfil_ativo');
                    
                    if (!perfis || !perfilAtivoId) {
                        throw new Error('Perfil n√£o encontrado');
                    }
                    
                    const perfisObj = JSON.parse(perfis);
                    const perfilAtivo = perfisObj[perfilAtivoId];
                    
                    if (!perfilAtivo) {
                        throw new Error('Perfil ativo inv√°lido');
                    }
                    
                    if (!perfilAtivo.dados) {
                        perfilAtivo.dados = {};
                    }
                    
                    perfilAtivo.dados.mascote = data;
                    
                    perfisObj[perfilAtivoId] = perfilAtivo;
                    localStorage.setItem('rpg_sistema_perfis', JSON.stringify(perfisObj));
                    
                    const mascoteIndex = {
                        nome: data.nome || "Sem Nome",
                        tipo: data.tipoNome || "Desconhecido",
                        nivel: data.nivel || 1,
                        icone: data.tipoIcone || "dog",
                        cor: data.tipoCor || "#ec4899",
                        temMascote: true,
                        ultimaAtualizacao: new Date().toISOString()
                    };
                    
                    localStorage.setItem('grimorio_mascote_index', JSON.stringify(mascoteIndex));
                    
                    btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> Salvo!`;
                    lucide.createIcons();
                    
                    document.getElementById('last-saved').textContent = 
                        new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    mostrarFeedback("Mascote salvo no perfil com sucesso!", "success");
                    
                } catch (error) {
                    console.error('Erro ao salvar no perfil:', error);
                    btn.innerHTML = `<i data-lucide="alert-circle" class="w-4 h-4"></i> Erro`;
                    lucide.createIcons();
                    mostrarFeedback("Erro ao salvar no perfil. Salvando localmente...", "error");
                    
                    saveLocal();
                }
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                    lucide.createIcons();
                }, 2000);
                
            }, 800);
        }

        function saveLocal() {
            const data = getMascoteData();
            localStorage.setItem('rpg_mascote_completo', JSON.stringify(data));
            
            const btn = document.getElementById('btn-save-local');
            const originalHTML = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`;
            lucide.createIcons();

            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i>`;
                lucide.createIcons();
                
                document.getElementById('last-saved').textContent = 
                    new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                    lucide.createIcons();
                }, 2000);
            }, 800);
            
            mostrarFeedback("Mascote salvo localmente!", "success");
        }

        function loadMascoteFromProfile(perfil) {
            if (!perfil || !perfil.dados || !perfil.dados.mascote) {
                loadFromLocalStorage();
                return;
            }
            
            const data = perfil.dados.mascote;
            loadMascoteData(data);
        }

        function loadFromLocalStorage() {
            const data = JSON.parse(localStorage.getItem('rpg_mascote_completo'));
            if (data) {
                loadMascoteData(data);
            } else {
                resetToDefault();
            }
        }

        function loadMascoteData(data) {
            document.getElementById('mascote-nome').value = data.nome || '';
            document.getElementById('mascote-nivel').value = data.nivel || 1;
            document.getElementById('vida-atual').value = data.vidaAtual || 50;
            document.getElementById('vida-max').value = data.vidaMax || 50;
            document.getElementById('input-lealdade').value = data.lealdade || 80;
            document.getElementById('input-agilidade').value = data.agilidade || 70;
            document.getElementById('input-forca').value = data.forca || 60;
            document.getElementById('input-percepcao').value = data.percepcao || 65;
            document.getElementById('input-defesa').value = data.defesa || 55;
            document.getElementById('input-energia').value = data.energia || 75;
            document.getElementById('mascote-aparencia').value = data.aparencia || '';
            document.getElementById('mascote-personalidade').value = data.personalidade || '';
            document.getElementById('mascote-historia').value = data.historia || '';
            
            if (data.tipoId) {
                mascoteData.tipoSelecionado = data.tipoId;
            }
            
            if (data.passiva) {
                mascoteData.currentPassiva = data.passiva;
            }
            
            if (data.habilidades) {
                mascoteData.skills = data.habilidades;
                renderSkills();
            }
            
            if (data.customTypes) {
                mascoteData.customTypes = data.customTypes;
                localStorage.setItem('mascote_custom_types', JSON.stringify(data.customTypes));
            }
            
            if (data.linkedProfile) {
                mascoteData.linkedProfile = data.linkedProfile;
            }
            
            updateAllDisplays();
        }

        function updateAllDisplays() {
            updateVida();
            updateLealdade();
            updateAgilidade();
            updateForca();
            updatePercepcao();
            updateDefesa();
            updateEnergia();
            updateNivelDisplay();
            updateCharCounters();
            renderTipoCriaturas();
            
            let tipo = TIPOS_PREDEFINIDOS.find(t => t.id === mascoteData.tipoSelecionado);
            if (!tipo) {
                tipo = mascoteData.customTypes.find(t => t.id === mascoteData.tipoSelecionado);
            }
            if (tipo) {
                updatePassivaDisplay(tipo);
            }
        }

        // ====================================================================
        // FUN√á√ïES DE FEEDBACK E MODAIS
        // ====================================================================
        function showNoProfileWarning() {
            document.getElementById('no-profile-warning').classList.remove('hidden');
        }

        function hideNoProfileWarning() {
            document.getElementById('no-profile-warning').classList.add('hidden');
        }

        function showNoProfileModal() {
            document.getElementById('no-profile-modal').classList.remove('hidden');
        }

        function hideNoProfileModal() {
            document.getElementById('no-profile-modal').classList.add('hidden');
        }

        function hideWarning() {
            document.getElementById('no-profile-warning').classList.add('hidden');
        }

        function mostrarFeedback(mensagem, tipo = 'info') {
            const existing = document.querySelectorAll('.feedback-mascote');
            existing.forEach(el => el.remove());
            
            const feedback = document.createElement('div');
            feedback.className = `feedback-mascote px-4 py-3 rounded-lg border shadow-lg ${
                tipo === 'success' ? 'bg-green-900/30 border-green-700 text-green-300' :
                tipo === 'warning' ? 'bg-yellow-900/30 border-yellow-700 text-yellow-300' :
                tipo === 'error' ? 'bg-red-900/30 border-red-700 text-red-300' :
                'bg-blue-900/30 border-blue-700 text-blue-300'
            }`;
            
            feedback.innerHTML = `
                <div class="flex items-center gap-2">
                    <i data-lucide="${
                        tipo === 'success' ? 'check-circle' :
                        tipo === 'warning' ? 'alert-triangle' :
                        tipo === 'error' ? 'x-circle' : 'info'
                    }" class="w-4 h-4"></i>
                    <span class="font-medium">${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(feedback);
            lucide.createIcons();
            
            setTimeout(() => {
                feedback.style.opacity = '0';
                feedback.style.transform = 'translateX(20px)';
                setTimeout(() => feedback.remove(), 500);
            }, 3000);
        }

        // ====================================================================
        // RESET E INICIALIZA√á√ÉO
        // ====================================================================
        function resetToDefault() {
            document.getElementById('mascote-nome').value = '';
            document.getElementById('mascote-nivel').value = 1;
            document.getElementById('vida-atual').value = 50;
            document.getElementById('vida-max').value = 50;
            document.getElementById('input-lealdade').value = 80;
            document.getElementById('input-agilidade').value = 70;
            document.getElementById('input-forca').value = 60;
            document.getElementById('input-percepcao').value = 65;
            document.getElementById('input-defesa').value = 55;
            document.getElementById('input-energia').value = 75;
            document.getElementById('mascote-aparencia').value = '';
            document.getElementById('mascote-personalidade').value = '';
            document.getElementById('mascote-historia').value = '';
            
            mascoteData.skills = [];
            renderSkills();
            
            mascoteData.tipoSelecionado = 'canino';
            mascoteData.currentPassiva = 'Clique em "Editar" para criar uma passiva especial para seu mascote.';
            
            updateAllDisplays();
        }

        function resetMascote() {
            if (confirm('Deseja realmente resetar todos os dados do mascote? (Os tipos personalizados ser√£o mantidos)')) {
                resetToDefault();
                
                localStorage.removeItem('rpg_mascote_completo');
                localStorage.removeItem('rpg_mascote_autosave');
                
                document.getElementById('last-saved').textContent = 'N√£o salvo';
                mostrarFeedback("Mascote resetado com sucesso!", "success");
            }
        }

        // ====================================================================
        // INICIALIZA√á√ÉO
        // ====================================================================
        window.addEventListener('load', () => {
            loadCustomTypes();
            renderTipoCriaturas();
            
            const perfilAtivo = loadActiveProfile();
            if (!perfilAtivo) {
                loadFromLocalStorage();
            }
            
            // Configurar eventos
            document.getElementById('vida-atual').addEventListener('input', updateVida);
            document.getElementById('vida-max').addEventListener('input', updateVida);
            document.getElementById('input-lealdade').addEventListener('input', updateLealdade);
            document.getElementById('input-agilidade').addEventListener('input', updateAgilidade);
            document.getElementById('input-forca').addEventListener('input', updateForca);
            document.getElementById('input-percepcao').addEventListener('input', updatePercepcao);
            document.getElementById('input-defesa').addEventListener('input', updateDefesa);
            document.getElementById('input-energia').addEventListener('input', updateEnergia);
            document.getElementById('mascote-nivel').addEventListener('input', updateNivelDisplay);
            
            document.getElementById('mascote-aparencia').addEventListener('input', updateCharCounters);
            document.getElementById('mascote-personalidade').addEventListener('input', updateCharCounters);
            document.getElementById('mascote-historia').addEventListener('input', updateCharCounters);
            
            document.getElementById('mascote-nome').addEventListener('input', autoSave);
            document.getElementById('mascote-nivel').addEventListener('input', autoSave);
            document.getElementById('vida-atual').addEventListener('input', autoSave);
            document.getElementById('vida-max').addEventListener('input', autoSave);
            document.getElementById('input-lealdade').addEventListener('input', autoSave);
            document.getElementById('input-agilidade').addEventListener('input', autoSave);
            document.getElementById('input-forca').addEventListener('input', autoSave);
            document.getElementById('input-percepcao').addEventListener('input', autoSave);
            document.getElementById('input-defesa').addEventListener('input', autoSave);
            document.getElementById('input-energia').addEventListener('input', autoSave);
            document.getElementById('mascote-aparencia').addEventListener('input', autoSave);
            document.getElementById('mascote-personalidade').addEventListener('input', autoSave);
            document.getElementById('mascote-historia').addEventListener('input', autoSave);
            
            // Verificar auto-save
            const autosave = localStorage.getItem('rpg_mascote_autosave');
            if (autosave && !localStorage.getItem('rpg_mascote_completo')) {
                if (confirm('Encontramos um auto-salvamento n√£o salvo. Deseja restaurar?')) {
                    const data = JSON.parse(autosave);
                    loadMascoteData(data);
                    mostrarFeedback("Auto-salvamento restaurado!", "info");
                }
            }
            
            lucide.createIcons();
        });
    // shared.js - Coloque em todas as p√°ginas
    class GrimorioSaveSystem {
        static saveCharacter(data) {
            localStorage.setItem('grimorio_character_data', JSON.stringify(data));
            this.notifyUpdate('character');
        }
        
        static saveMascot(data) {
            localStorage.setItem('grimorio_mascot_data', JSON.stringify(data));
            this.notifyUpdate('mascot');
        }
        
        static saveItems(data) {
            localStorage.setItem('grimorio_items_data', JSON.stringify(data));
            this.notifyUpdate('items');
        }
        
        static loadCharacter() {
            const data = localStorage.getItem('grimorio_character_data');
            return data ? JSON.parse(data) : null;
        }
        
        static loadMascot() {
            const data = localStorage.getItem('grimorio_mascot_data');
            return data ? JSON.parse(data) : null;
        }
        
        static loadItems() {
            const data = localStorage.getItem('grimorio_items_data');
            return data ? JSON.parse(data) : [];
        }
        
        static notifyUpdate(type) {
            // Dispara evento customizado
            const event = new CustomEvent('grimorio-update', {
                detail: { type: type, timestamp: Date.now() }
            });
            window.dispatchEvent(event);
        }
        
        static exportAll() {
            const allData = {
                character: this.loadCharacter(),
                mascot: this.loadMascot(),
                items: this.loadItems(),
                version: '2.0',
                exportDate: new Date().toISOString()
            };
            
            return JSON.stringify(allData, null, 2);
        }
        
        static importAll(jsonString) {
            try {
                const data = JSON.parse(jsonString);
                
                if (data.character) {
                    this.saveCharacter(data.character);
                }
                if (data.mascot) {
                    this.saveMascot(data.mascot);
                }
                if (data.items) {
                    this.saveItems(data.items);
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao importar:', error);
                return false;
            }
        }
    }

    // Listener para atualiza√ß√µes em tempo real
    window.addEventListener('grimorio-update', function(event) {
        console.log('Dados atualizados:', event.detail.type);
        // Atualiza a p√°gina atual com os novos dados
        refreshCurrentPage();
    });

    // Fun√ß√£o para detectar mudan√ßas no localStorage de outras abas
    window.addEventListener('storage', function(event) {
        if (event.key.startsWith('grimorio_')) {
            location.reload(); // Recarrega para mostrar dados atualizados
        }
    });
    </script>
</body>
</html>