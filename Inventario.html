<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Inventário</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        theme: {
                            bg: '#0a0a0c',
                            panel: '#0f0f12',
                            border: '#2a2a2e',
                            text: '#e8e4dc',
                            blue: '#4a9eff',
                            orange: '#ff6b35',
                            yellow: '#f59e0b',
                            red: '#dc2626',
                            green: '#22c55e',
                            purple: '#8b5cf6',
                            pink: '#ec4899',
                            muted: '#606060'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: #e8e4dc; }
        .anim-entry { animation: fadeInUp 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilo do Modal */
        #modal-overlay { transition: opacity 0.3s ease; }
        #modal-overlay.hidden { pointer-events: none; opacity: 0; }
        #modal-overlay:not(.hidden) { pointer-events: auto; opacity: 1; }

        /* Barras de progresso */
        .progress-bar { transition: width 0.5s ease; }
        .progress-bar-danger { background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%); }
        .progress-bar-warning { background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%); }
        .progress-bar-safe { background: linear-gradient(90deg, #22c55e 0%, #4ade80 100%); }

        select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e8e4dc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 0.7rem center; background-size: 1em;
        }
        
        /* Utilitário para esconder elementos na exportação */
    </style>
</head>
<body class="min-h-screen font-sans pb-12">

    <nav class="w-full bg-[#0f0f12]/95 backdrop-blur-sm border-b border-theme-border sticky top-0 z-50 mb-8">
        <div class="max-w-7xl mx-auto px-4 flex items-center gap-4 py-4">
            <a href="index.html" class="text-theme-text hover:text-theme-blue transition-colors">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
            </a>
            <div class="h-6 w-[1px] bg-theme-border"></div>
            <span class="font-cinzel font-bold text-lg tracking-wide text-theme-blue">Inventário</span>
        </div>
        <div class="h-[1px] bg-gradient-to-r from-transparent via-theme-blue to-transparent"></div>
    </nav>

    <div id="capture-area" class="max-w-6xl mx-auto px-4 space-y-6">

        <header class="flex items-center gap-4 mb-6 anim-entry">
            <div class="p-3 rounded-lg bg-[#4a9eff]/10 border border-[#4a9eff]/20">
                <i data-lucide="backpack" class="w-8 h-8 text-theme-blue"></i>
            </div>
            <div>
                <h1 class="text-3xl font-cinzel font-bold text-white">Inventário</h1>
                <p class="text-gray-400">Seus pertences e recursos</p>
            </div>
        </header>

        <!-- Seção de Configurações de Limites (Edição) -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.1s;">
            <div class="flex items-center justify-between mb-4">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-orange">
                    <i data-lucide="settings" class="w-4 h-4"></i> Configurações de Limites
                </h3>
                <button onclick="toggleLimitsEdit()" class="flex items-center gap-2 text-sm text-theme-blue hover:text-blue-400">
                    <i data-lucide="edit" class="w-4 h-4"></i>
                    <span>Editar</span>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Peso Máximo -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-sm text-theme-muted">Peso Máximo</span>
                        <span class="text-sm font-mono" id="weight-display">
                            <span id="current-weight">0.0</span>/<span id="max-weight">50.0</span> kg
                        </span>
                    </div>
                    <div class="h-2 bg-[#0a0a0c] rounded-full overflow-hidden">
                        <div id="weight-progress" class="h-full progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="weight-edit" class="hidden">
                        <input type="number" id="input-max-weight" min="1" max="999" step="0.1" value="50.0" 
                               class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white text-sm">
                    </div>
                </div>

                <!-- Itens Usáveis Máximos -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-sm text-theme-muted">Itens Usáveis</span>
                        <span class="text-sm font-mono" id="usable-display">
                            <span id="current-usable">0</span>/<span id="max-usable">10</span> itens
                        </span>
                    </div>
                    <div class="h-2 bg-[#0a0a0c] rounded-full overflow-hidden">
                        <div id="usable-progress" class="h-full progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="usable-edit" class="hidden">
                        <input type="number" id="input-max-usable" min="1" max="100" value="10" 
                               class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white text-sm">
                    </div>
                </div>

                <!-- Itens Carregáveis Máximos -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-sm text-theme-muted">Itens Carregáveis</span>
                        <span class="text-sm font-mono" id="carryable-display">
                            <span id="current-carryable">0</span>/<span id="max-carryable">20</span> itens
                        </span>
                    </div>
                    <div class="h-2 bg-[#0a0a0c] rounded-full overflow-hidden">
                        <div id="carryable-progress" class="h-full progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="carryable-edit" class="hidden">
                        <input type="number" id="input-max-carryable" min="1" max="100" value="20" 
                               class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white text-sm">
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-4 hidden" id="save-limits-buttons">
                <button onclick="saveLimits()" class="px-4 py-2 bg-theme-green hover:bg-green-600 rounded text-white text-sm">
                    Salvar Limites
                </button>
                <button onclick="toggleLimitsEdit()" class="px-4 py-2 border border-theme-border rounded text-theme-text text-sm">
                    Cancelar
                </button>
            </div>
        </section>

        <!-- Seção de Moedas -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.15s;">
            <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-yellow mb-4">
                <i data-lucide="coins" class="w-4 h-4"></i> Carteira
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Moedas de Ouro -->
                <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center">
                                <i data-lucide="circle" class="w-6 h-6 text-yellow-500"></i>
                            </div>
                            <div>
                                <p class="text-xs text-theme-muted uppercase">Ouro</p>
                                <p id="gold-amount" class="text-2xl font-bold text-yellow-500">100</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="adjustMoney('gold', -1)" class="w-8 h-8 flex items-center justify-center bg-red-900/30 hover:bg-red-900/50 rounded text-red-400">
                                -1
                            </button>
                            <button onclick="adjustMoney('gold', 1)" class="w-8 h-8 flex items-center justify-center bg-green-900/30 hover:bg-green-900/50 rounded text-green-400">
                                +1
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="number" id="input-gold" placeholder="Quantia" min="0" 
                               class="flex-1 bg-[#0f0f12] border border-theme-border rounded p-2 text-white text-sm">
                        <button onclick="setMoney('gold')" class="px-3 bg-yellow-600 hover:bg-yellow-700 rounded text-white text-sm">
                            Definir
                        </button>
                    </div>
                </div>

                <!-- Moedas de Prata -->
                <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-gray-400/20 flex items-center justify-center">
                                <i data-lucide="circle" class="w-6 h-6 text-gray-400"></i>
                            </div>
                            <div>
                                <p class="text-xs text-theme-muted uppercase">Prata</p>
                                <p id="silver-amount" class="text-2xl font-bold text-gray-300">500</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="adjustMoney('silver', -1)" class="w-8 h-8 flex items-center justify-center bg-red-900/30 hover:bg-red-900/50 rounded text-red-400">
                                -1
                            </button>
                            <button onclick="adjustMoney('silver', 1)" class="w-8 h-8 flex items-center justify-center bg-green-900/30 hover:bg-green-900/50 rounded text-green-400">
                                +1
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="number" id="input-silver" placeholder="Quantia" min="0" 
                               class="flex-1 bg-[#0f0f12] border border-theme-border rounded p-2 text-white text-sm">
                        <button onclick="setMoney('silver')" class="px-3 bg-gray-600 hover:bg-gray-700 rounded text-white text-sm">
                            Definir
                        </button>
                    </div>
                </div>

                <!-- Moedas de Cobre -->
                <div class="bg-[#0a0a0c] border border-theme-border p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-orange-600/20 flex items-center justify-center">
                                <i data-lucide="circle" class="w-6 h-6 text-orange-600"></i>
                            </div>
                            <div>
                                <p class="text-xs text-theme-muted uppercase">Cobre</p>
                                <p id="copper-amount" class="text-2xl font-bold text-orange-500">1000</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="adjustMoney('copper', -1)" class="w-8 h-8 flex items-center justify-center bg-red-900/30 hover:bg-red-900/50 rounded text-red-400">
                                -1
                            </button>
                            <button onclick="adjustMoney('copper', 1)" class="w-8 h-8 flex items-center justify-center bg-green-900/30 hover:bg-green-900/50 rounded text-green-400">
                                +1
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="number" id="input-copper" placeholder="Quantia" min="0" 
                               class="flex-1 bg-[#0f0f12] border border-theme-border rounded p-2 text-white text-sm">
                        <button onclick="setMoney('copper')" class="px-3 bg-orange-600 hover:bg-orange-700 rounded text-white text-sm">
                            Definir
                        </button>
                    </div>
                </div>
            </div>

            <!-- Total em Cobre (Conversão) -->
            <div class="mt-6 pt-4 border-t border-theme-border">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-theme-muted">Valor Total em Cobre</p>
                        <p id="total-copper" class="text-xl font-bold text-theme-yellow">0 cp</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-theme-muted">Conversão Automática</p>
                        <p class="text-sm">1 Ouro = 10 Prata = 100 Cobre</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Estatísticas -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 anim-entry" style="animation-delay: 0.2s;">
            <div class="bg-theme-panel border border-theme-border p-4 flex items-center gap-3 rounded">
                <i data-lucide="package" class="w-8 h-8 text-theme-blue"></i>
                <div>
                    <p class="text-xs text-theme-muted uppercase tracking-wide">Itens</p>
                    <p id="stat-total-itens" class="text-2xl font-bold text-white">0</p>
                </div>
            </div>
            <div class="bg-theme-panel border border-theme-border p-4 flex items-center gap-3 rounded">
                <i data-lucide="weight" class="w-8 h-8 text-theme-orange"></i>
                <div>
                    <p class="text-xs text-theme-muted uppercase tracking-wide">Peso Total</p>
                    <p id="stat-peso-total" class="text-2xl font-bold text-white">0.0 kg</p>
                </div>
            </div>
            <div class="bg-theme-panel border border-theme-border p-4 flex items-center gap-3 rounded">
                <i data-lucide="flask-conical" class="w-8 h-8 text-theme-green"></i>
                <div>
                    <p class="text-xs text-theme-muted uppercase tracking-wide">Usáveis</p>
                    <p id="stat-usaveis" class="text-2xl font-bold text-white">0</p>
                </div>
            </div>
            <div class="bg-theme-panel border border-theme-border p-4 flex items-center gap-3 rounded">
                <i data-lucide="shield" class="w-8 h-8 text-theme-purple"></i>
                <div>
                    <p class="text-xs text-theme-muted uppercase tracking-wide">Carregáveis</p>
                    <p id="stat-carregaveis" class="text-2xl font-bold text-white">0</p>
                </div>
            </div>
        </div>

        <!-- Lista de Itens -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.25s;">
            <div class="flex flex-col md:flex-row gap-4 mb-6 hide-on-export">
                <div class="relative flex-1">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-theme-muted"></i>
                    <input type="text" id="input-busca" placeholder="Buscar item..." oninput="renderItems()" 
                           class="w-full pl-10 bg-transparent border border-theme-border rounded h-10 text-theme-text focus:border-theme-blue outline-none transition-colors">
                </div>
                <select id="select-filtro" onchange="renderItems()" 
                        class="w-full md:w-48 bg-[#0a0a0c] border border-theme-border rounded h-10 text-theme-text px-3 focus:border-theme-blue outline-none cursor-pointer">
                    <option value="todos">Todas Categorias</option>
                    <option value="arma">Armas</option>
                    <option value="armadura">Armaduras</option>
                    <option value="consumivel">Consumíveis</option>
                    <option value="material">Materiais</option>
                    <option value="chave">Itens-Chave</option>
                    <option value="outro">Outros</option>
                </select>
                <button onclick="openModal()" 
                        class="flex items-center justify-center gap-2 bg-theme-blue hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors font-medium">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    Adicionar
                </button>
            </div>

            <!-- Alertas de Limite -->
            <div id="alerts-container" class="mb-4 space-y-2"></div>

            <div id="lista-itens" class="space-y-3 min-h-[200px]">
                <!-- Itens serão renderizados aqui -->
            </div>
        </section>
        
    </div>

    <!-- Botões de Ação -->
    <div class="max-w-6xl mx-auto px-4 mt-8 pb-12 flex flex-col md:flex-row justify-end gap-4 anim-entry" style="animation-delay: 0.3s;">
        
        <button onclick="resetInventory()" class="flex items-center justify-center gap-2 px-6 py-3 border border-red-900/50 text-red-500 hover:bg-red-900/20 rounded transition-colors font-cinzel text-sm">
            <i data-lucide="trash" class="w-4 h-4"></i>
            Limpar Tudo
        </button>

        <div class="flex-1 md:flex-none"></div>

        <button onclick="exportTXT()" class="flex items-center justify-center gap-2 px-6 py-3 border border-theme-border rounded text-theme-text hover:bg-white/5 transition-colors font-cinzel text-sm">
            <i data-lucide="file-text" class="w-4 h-4"></i>
            Baixar TXT
        </button>
        <button onclick="exportPDF()" id="btn-pdf" class="flex items-center justify-center gap-2 px-6 py-3 bg-theme-orange hover:bg-orange-600 rounded text-[#0a0a0c] shadow-lg hover:shadow-orange-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="file-down" class="w-4 h-4"></i>
            Baixar PDF
        </button>
        <button onclick="exportPNG()" id="btn-png" class="flex items-center justify-center gap-2 px-6 py-3 bg-theme-blue hover:bg-blue-600 rounded text-white shadow-lg hover:shadow-blue-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="image" class="w-4 h-4"></i>
            Baixar PNG
        </button>
    </div>

    <!-- Modal para Adicionar/Editar Item -->
    <div id="modal-overlay" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center hidden p-4">
        <div class="bg-theme-panel border border-theme-border w-full max-w-md rounded-lg shadow-2xl p-6 relative anim-entry">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="font-cinzel text-xl text-white">Novo Item</h2>
                <button onclick="closeModal()" class="text-theme-muted hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <form id="form-item" onsubmit="salvarItem(event)" class="space-y-4">
                <input type="hidden" id="item-id">
                <div>
                    <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Nome</label>
                    <input type="text" id="item-nome" required placeholder="Nome do item" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none">
                </div>
                <div>
                    <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Categoria</label>
                    <select id="item-categoria" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none" onchange="updateItemType()">
                        <option value="outro">Outros</option>
                        <option value="arma">Armas</option>
                        <option value="armadura">Armaduras</option>
                        <option value="consumivel">Consumíveis</option>
                        <option value="material">Materiais</option>
                        <option value="chave">Itens-Chave</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Qtd</label>
                        <input type="number" id="item-qtd" required min="1" value="1" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Tipo</label>
                        <select id="item-tipo" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none">
                            <option value="normal">Normal</option>
                            <option value="usavel">Usável</option>
                            <option value="carregavel">Carregável</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Peso (kg)</label>
                        <input type="number" id="item-peso" step="0.1" value="0" min="0" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Valor (cobre)</label>
                        <input type="number" id="item-valor" value="0" min="0" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-xs uppercase tracking-widest text-theme-muted mb-2">Descrição / Função</label>
                    <textarea id="item-desc" placeholder="Descrição, efeitos, ou função do item" rows="3" class="w-full bg-[#0a0a0c] border border-theme-border rounded p-2 text-white focus:border-theme-blue outline-none resize-none"></textarea>
                </div>
                <div id="weight-warning" class="hidden p-3 bg-red-900/30 border border-red-700/50 rounded text-sm text-red-300">
                    <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i>
                    <span id="weight-warning-text"></span>
                </div>
                <div class="flex justify-end gap-3 pt-4 border-t border-theme-border mt-4">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 text-theme-text hover:bg-white/5 rounded transition-colors">Cancelar</button>
                    <button type="submit" class="bg-theme-blue hover:bg-blue-600 text-white px-6 py-2 rounded transition-colors font-medium">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mapeamento de categorias
        const categoriasMap = {
            "arma": { label: "Armas", color: "#dc2626", icon: "sword" },
            "armadura": { label: "Armaduras", color: "#f59e0b", icon: "shield" },
            "consumivel": { label: "Consumíveis", color: "#22c55e", icon: "flask-conical" },
            "material": { label: "Materiais", color: "#8b5cf6", icon: "package" },
            "chave": { label: "Itens-Chave", color: "#ec4899", icon: "key" },
            "outro": { label: "Outros", color: "#606060", icon: "box" }
        };

        // Array do inventário
        let inventario = [];
        
        // Configurações de limites
        let limites = {
            pesoMaximo: 50.0,
            itensUsaveisMax: 10,
            itensCarregaveisMax: 20
        };
        
        // Sistema de moedas
        let moedas = {
            gold: 100,
            silver: 500,
            copper: 1000
        };

        // --- Sistema de Storage ---
        function loadFromStorage() {
            try {
                const savedData = localStorage.getItem('rpg_inventario');
                if (savedData) {
                    inventario = JSON.parse(savedData);
                } else {
                    inventario = [];
                }
                
                const savedLimits = localStorage.getItem('rpg_inventory_limits');
                if (savedLimits) {
                    limites = JSON.parse(savedLimits);
                }
                
                const savedMoney = localStorage.getItem('rpg_inventory_money');
                if (savedMoney) {
                    moedas = JSON.parse(savedMoney);
                }
            } catch (e) {
                console.error("Erro ao carregar dados:", e);
                inventario = [];
            }
            updateAllStats();
        }

        function updateStorage() {
            try {
                localStorage.setItem('rpg_inventario', JSON.stringify(inventario));
                localStorage.setItem('rpg_inventory_limits', JSON.stringify(limites));
                localStorage.setItem('rpg_inventory_money', JSON.stringify(moedas));
            } catch (e) {
                console.error("Erro ao salvar dados:", e);
            }
        }

        // --- Sistema de Limites ---
        function toggleLimitsEdit() {
            const isEditing = !document.getElementById('weight-edit').classList.contains('hidden');
            
            if (isEditing) {
                // Sair do modo edição
                document.getElementById('weight-edit').classList.add('hidden');
                document.getElementById('usable-edit').classList.add('hidden');
                document.getElementById('carryable-edit').classList.add('hidden');
                document.getElementById('save-limits-buttons').classList.add('hidden');
            } else {
                // Entrar no modo edição
                document.getElementById('weight-edit').classList.remove('hidden');
                document.getElementById('usable-edit').classList.remove('hidden');
                document.getElementById('carryable-edit').classList.remove('hidden');
                document.getElementById('save-limits-buttons').classList.remove('hidden');
                
                // Preencher valores atuais
                document.getElementById('input-max-weight').value = limites.pesoMaximo;
                document.getElementById('input-max-usable').value = limites.itensUsaveisMax;
                document.getElementById('input-max-carryable').value = limites.itensCarregaveisMax;
            }
        }

        function saveLimits() {
            const newWeight = parseFloat(document.getElementById('input-max-weight').value);
            const newUsable = parseInt(document.getElementById('input-max-usable').value);
            const newCarryable = parseInt(document.getElementById('input-max-carryable').value);
            
            if (newWeight <= 0 || newUsable <= 0 || newCarryable <= 0) {
                alert("Todos os valores devem ser maiores que zero!");
                return;
            }
            
            limites.pesoMaximo = newWeight;
            limites.itensUsaveisMax = newUsable;
            limites.itensCarregaveisMax = newCarryable;
            
            updateStorage();
            updateAllStats();
            toggleLimitsEdit();
            
            // Verificar se excede os novos limites
            checkLimits();
        }

        // --- Sistema de Moedas ---
        function adjustMoney(type, amount) {
            const newAmount = moedas[type] + amount;
            if (newAmount >= 0) {
                moedas[type] = newAmount;
                updateMoneyDisplay();
                updateStorage();
                updateTotalCopper();
            }
        }

        function setMoney(type) {
            const input = document.getElementById(`input-${type}`);
            const value = parseInt(input.value) || 0;
            if (value >= 0) {
                moedas[type] = value;
                updateMoneyDisplay();
                updateStorage();
                updateTotalCopper();
                input.value = '';
            }
        }

        function updateMoneyDisplay() {
            document.getElementById('gold-amount').textContent = moedas.gold;
            document.getElementById('silver-amount').textContent = moedas.silver;
            document.getElementById('copper-amount').textContent = moedas.copper;
        }

        function updateTotalCopper() {
            // Conversão: 1 gold = 10 silver = 100 copper
            const totalCopper = (moedas.gold * 100) + (moedas.silver * 10) + moedas.copper;
            document.getElementById('total-copper').textContent = `${totalCopper.toLocaleString()} cp`;
        }

        // --- Cálculo de Estatísticas ---
        function calculateStats() {
            let totalPeso = 0;
            let totalItens = inventario.length;
            let usaveisCount = 0;
            let carregaveisCount = 0;
            let itemCount = 0;
            
            inventario.forEach(item => {
                const pesoItem = parseFloat(item.peso) || 0;
                const qtdItem = parseInt(item.quantidade) || 1;
                totalPeso += pesoItem * qtdItem;
                itemCount += qtdItem;
                
                if (item.tipo === 'usavel') {
                    usaveisCount += qtdItem;
                } else if (item.tipo === 'carregavel') {
                    carregaveisCount += qtdItem;
                }
            });
            
            return {
                totalPeso: parseFloat(totalPeso.toFixed(1)),
                totalItens: totalItens,
                itemCount: itemCount,
                usaveisCount: usaveisCount,
                carregaveisCount: carregaveisCount
            };
        }

        function updateAllStats() {
            const stats = calculateStats();
            
            // Atualizar displays
            document.getElementById('stat-total-itens').textContent = stats.itemCount;
            document.getElementById('stat-peso-total').textContent = `${stats.totalPeso} kg`;
            document.getElementById('stat-usaveis').textContent = stats.usaveisCount;
            document.getElementById('stat-carregaveis').textContent = stats.carregaveisCount;
            
            // Atualizar barras de progresso
            updateProgressBars(stats);
            
            // Atualizar displays de limites
            document.getElementById('current-weight').textContent = stats.totalPeso;
            document.getElementById('max-weight').textContent = limites.pesoMaximo;
            document.getElementById('current-usable').textContent = stats.usaveisCount;
            document.getElementById('max-usable').textContent = limites.itensUsaveisMax;
            document.getElementById('current-carryable').textContent = stats.carregaveisCount;
            document.getElementById('max-carryable').textContent = limites.itensCarregaveisMax;
            
            // Atualizar moedas
            updateMoneyDisplay();
            updateTotalCopper();
        }

        function updateProgressBars(stats) {
            // Peso
            const pesoPercent = Math.min((stats.totalPeso / limites.pesoMaximo) * 100, 100);
            const weightBar = document.getElementById('weight-progress');
            weightBar.style.width = `${pesoPercent}%`;
            weightBar.className = `h-full progress-bar ${pesoPercent >= 90 ? 'progress-bar-danger' : pesoPercent >= 70 ? 'progress-bar-warning' : 'progress-bar-safe'}`;
            
            // Usáveis
            const usablePercent = Math.min((stats.usaveisCount / limites.itensUsaveisMax) * 100, 100);
            const usableBar = document.getElementById('usable-progress');
            usableBar.style.width = `${usablePercent}%`;
            usableBar.className = `h-full progress-bar ${usablePercent >= 90 ? 'progress-bar-danger' : usablePercent >= 70 ? 'progress-bar-warning' : 'progress-bar-safe'}`;
            
            // Carregáveis
            const carryablePercent = Math.min((stats.carregaveisCount / limites.itensCarregaveisMax) * 100, 100);
            const carryableBar = document.getElementById('carryable-progress');
            carryableBar.style.width = `${carryablePercent}%`;
            carryableBar.className = `h-full progress-bar ${carryablePercent >= 90 ? 'progress-bar-danger' : carryablePercent >= 70 ? 'progress-bar-warning' : 'progress-bar-safe'}`;
        }

        function checkLimits() {
            const stats = calculateStats();
            const alerts = [];
            
            if (stats.totalPeso > limites.pesoMaximo) {
                alerts.push({
                    type: 'danger',
                    message: `Peso excedido! ${stats.totalPeso.toFixed(1)}/${limites.pesoMaximo}kg`,
                    icon: 'weight'
                });
            } else if (stats.totalPeso > limites.pesoMaximo * 0.9) {
                alerts.push({
                    type: 'warning',
                    message: `Peso quase no limite: ${stats.totalPeso.toFixed(1)}/${limites.pesoMaximo}kg`,
                    icon: 'weight'
                });
            }
            
            if (stats.usaveisCount > limites.itensUsaveisMax) {
                alerts.push({
                    type: 'danger',
                    message: `Itens usáveis excedidos! ${stats.usaveisCount}/${limites.itensUsaveisMax}`,
                    icon: 'flask-conical'
                });
            } else if (stats.usaveisCount > limites.itensUsaveisMax * 0.9) {
                alerts.push({
                    type: 'warning',
                    message: `Itens usáveis quase no limite: ${stats.usaveisCount}/${limites.itensUsaveisMax}`,
                    icon: 'flask-conical'
                });
            }
            
            if (stats.carregaveisCount > limites.itensCarregaveisMax) {
                alerts.push({
                    type: 'danger',
                    message: `Itens carregáveis excedidos! ${stats.carregaveisCount}/${limites.itensCarregaveisMax}`,
                    icon: 'shield'
                });
            } else if (stats.carregaveisCount > limites.itensCarregaveisMax * 0.9) {
                alerts.push({
                    type: 'warning',
                    message: `Itens carregáveis quase no limite: ${stats.carregaveisCount}/${limites.itensCarregaveisMax}`,
                    icon: 'shield'
                });
            }
            
            renderAlerts(alerts);
            return alerts.length === 0;
        }

        function renderAlerts(alerts) {
            const container = document.getElementById('alerts-container');
            container.innerHTML = '';
            
            if (alerts.length === 0) return;
            
            alerts.forEach(alert => {
                const bgColor = alert.type === 'danger' ? 'bg-red-900/30 border-red-700' : 'bg-yellow-900/30 border-yellow-700';
                const textColor = alert.type === 'danger' ? 'text-red-300' : 'text-yellow-300';
                
                const alertHTML = `
                    <div class="flex items-center gap-3 p-3 ${bgColor} border rounded-lg ${textColor} anim-entry">
                        <i data-lucide="${alert.icon}" class="w-5 h-5"></i>
                        <span class="text-sm font-medium">${alert.message}</span>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', alertHTML);
            });
            
            lucide.createIcons();
        }

        // --- Sistema de Quantidade ---
        function updateQuantity(id, delta) {
            const itemIndex = inventario.findIndex(i => i.id === id);
            if (itemIndex !== -1) {
                const newQty = inventario[itemIndex].quantidade + delta;
                
                if (newQty > 0) {
                    inventario[itemIndex].quantidade = newQty;
                    updateStorage();
                    updateAllStats();
                    renderItems();
                    checkLimits();
                } else {
                    if (confirm('Remover item do inventário?')) {
                        inventario.splice(itemIndex, 1);
                        updateStorage();
                        updateAllStats();
                        renderItems();
                        checkLimits();
                    }
                }
            }
        }

        // --- Renderizar Itens ---
        function renderItems() {
            const listaEl = document.getElementById('lista-itens');
            const busca = document.getElementById('input-busca').value.toLowerCase();
            const filtro = document.getElementById('select-filtro').value;
            
            // Filtrar itens
            const itensFiltrados = inventario.filter(item => {
                const matchBusca = item.nome.toLowerCase().includes(busca) || 
                                 item.descricao.toLowerCase().includes(busca);
                const matchCat = filtro === 'todos' || item.categoria === filtro;
                return matchBusca && matchCat;
            });
            
            // Ordenar por tipo e nome
            itensFiltrados.sort((a, b) => {
                const typeOrder = { 'usavel': 0, 'carregavel': 1, 'normal': 2 };
                if (typeOrder[a.tipo] !== typeOrder[b.tipo]) {
                    return typeOrder[a.tipo] - typeOrder[b.tipo];
                }
                return a.nome.localeCompare(b.nome);
            });
            
            // Limpar lista
            listaEl.innerHTML = '';
            
            if (itensFiltrados.length === 0) {
                listaEl.innerHTML = `
                    <div class="text-center py-12 text-theme-muted">
                        <i data-lucide="package-open" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                        <p>Nenhum item encontrado</p>
                        <p class="text-sm opacity-75">Use o botão "Adicionar" para criar seu primeiro item</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            // Adicionar cada item
            itensFiltrados.forEach(item => {
                const categoria = categoriasMap[item.categoria] || categoriasMap.outro;
                const stats = calculateStats();
                const pesoExcedido = stats.totalPeso > limites.pesoMaximo;
                const isUsavel = item.tipo === 'usavel';
                const isCarregavel = item.tipo === 'carregavel';
                
                // Ícone do tipo
                let tipoIcon = 'box';
                let tipoColor = '#606060';
                if (isUsavel) {
                    tipoIcon = 'flask-conical';
                    tipoColor = '#22c55e';
                } else if (isCarregavel) {
                    tipoIcon = 'shield';
                    tipoColor = '#8b5cf6';
                }
                
                const itemElement = document.createElement('div');
                itemElement.className = `bg-[#0a0a0c] border ${pesoExcedido ? 'border-red-700/50' : 'border-theme-border'} p-4 flex flex-col md:flex-row items-center gap-4 group hover:border-theme-blue/30 transition-all rounded anim-entry`;
                itemElement.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-2 h-12 rounded-full" style="background-color: ${categoria.color}"></div>
                        <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background-color: ${tipoColor}20">
                            <i data-lucide="${tipoIcon}" class="w-4 h-4" style="color: ${tipoColor}"></i>
                        </div>
                    </div>
                    
                    <div class="flex-1 w-full text-center md:text-left">
                        <div class="flex items-center gap-2 mb-1">
                            <h4 class="text-white font-medium text-lg">${escapeHtml(item.nome)}</h4>
                            ${pesoExcedido ? '<span class="text-xs bg-red-900/50 text-red-300 px-2 py-1 rounded">PESO EXCEDIDO</span>' : ''}
                        </div>
                        <p class="text-theme-muted text-sm">${escapeHtml(item.descricao || 'Sem descrição')}</p>
                        <div class="flex gap-3 mt-2 text-xs text-theme-muted">
                            <span class="flex items-center gap-1">
                                <i data-lucide="weight" class="w-3 h-3"></i>
                                ${parseFloat(item.peso).toFixed(1)}kg cada
                            </span>
                            <span class="flex items-center gap-1">
                                <i data-lucide="coins" class="w-3 h-3"></i>
                                ${parseInt(item.valor)}c cada
                            </span>
                            <span class="flex items-center gap-1">
                                <i data-lucide="${categoria.icon}" class="w-3 h-3"></i>
                                ${categoria.label}
                            </span>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div class="text-right text-sm">
                            <p class="text-white font-bold">Total: ${(parseFloat(item.peso) * item.quantidade).toFixed(1)}kg</p>
                            <p class="text-theme-muted">${parseFloat(item.peso).toFixed(1)}kg × ${item.quantidade}</p>
                        </div>

                        <div class="flex items-center gap-3 bg-[#0f0f12] rounded px-2 py-1 border border-theme-border">
                            <button onclick="updateQuantity('${item.id}', -1)" class="hide-on-export text-theme-muted hover:text-white transition-colors w-6 h-6 flex items-center justify-center font-mono">-</button>
                            <span class="text-white font-mono w-8 text-center font-bold">x${item.quantidade}</span>
                            <button onclick="updateQuantity('${item.id}', 1)" class="hide-on-export text-theme-muted hover:text-white transition-colors w-6 h-6 flex items-center justify-center font-mono">+</button>
                        </div>
                    </div>

                    <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity hide-on-export">
                        <button onclick="openModal('${item.id}')" class="p-2 hover:bg-theme-blue/20 rounded transition-colors text-theme-blue">
                            <i data-lucide="edit-2" class="w-4 h-4"></i>
                        </button>
                        <button onclick="deletarItem('${item.id}')" class="p-2 hover:bg-theme-red/20 rounded transition-colors text-theme-red">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                
                listaEl.appendChild(itemElement);
            });
            
            lucide.createIcons();
        }

        // --- Funções do Modal ---
        function updateItemType() {
            const categoria = document.getElementById('item-categoria').value;
            const tipoSelect = document.getElementById('item-tipo');
            
            // Resetar opções
            tipoSelect.innerHTML = `
                <option value="normal">Normal</option>
                <option value="usavel">Usável</option>
                <option value="carregavel">Carregável</option>
            `;
            
            // Baseado na categoria, selecionar tipo padrão
            if (categoria === 'consumivel') {
                tipoSelect.value = 'usavel';
            } else if (categoria === 'arma' || categoria === 'armadura') {
                tipoSelect.value = 'carregavel';
            }
            
            // Verificar peso
            checkItemWeight();
        }

        function checkItemWeight() {
            const peso = parseFloat(document.getElementById('item-peso').value) || 0;
            const qtd = parseInt(document.getElementById('item-qtd').value) || 1;
            const pesoTotal = peso * qtd;
            const stats = calculateStats();
            
            const warningEl = document.getElementById('weight-warning');
            const warningText = document.getElementById('weight-warning-text');
            
            // Calcular peso futuro
            const futureWeight = stats.totalPeso + pesoTotal;
            
            if (futureWeight > limites.pesoMaximo) {
                warningEl.classList.remove('hidden');
                warningText.textContent = `Este item fará você exceder o limite de peso! (${futureWeight.toFixed(1)}/${limites.pesoMaximo}kg)`;
            } else if (futureWeight > limites.pesoMaximo * 0.9) {
                warningEl.classList.remove('hidden');
                warningText.textContent = `Cuidado! Este item fará você chegar perto do limite de peso. (${futureWeight.toFixed(1)}/${limites.pesoMaximo}kg)`;
            } else {
                warningEl.classList.add('hidden');
            }
        }

        function openModal(id = null) {
            const modal = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            
            // Adicionar listeners para verificação de peso
            document.getElementById('item-peso').addEventListener('input', checkItemWeight);
            document.getElementById('item-qtd').addEventListener('input', checkItemWeight);
            
            if (id) {
                // Modo edição
                const item = inventario.find(i => i.id === id);
                if (item) {
                    title.textContent = "Editar Item";
                    document.getElementById('item-id').value = item.id;
                    document.getElementById('item-nome').value = item.nome;
                    document.getElementById('item-categoria').value = item.categoria;
                    document.getElementById('item-qtd').value = item.quantidade;
                    document.getElementById('item-peso').value = item.peso;
                    document.getElementById('item-valor').value = item.valor;
                    document.getElementById('item-desc').value = item.descricao || '';
                    document.getElementById('item-tipo').value = item.tipo || 'normal';
                }
            } else {
                // Modo novo item
                title.textContent = "Novo Item";
                document.getElementById('form-item').reset();
                document.getElementById('item-id').value = '';
                document.getElementById('item-qtd').value = 1;
                document.getElementById('item-peso').value = 0;
                document.getElementById('item-valor').value = 0;
                document.getElementById('item-tipo').value = 'normal';
                document.getElementById('weight-warning').classList.add('hidden');
            }
            
            updateItemType();
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
            // Remover listeners
            document.getElementById('item-peso').removeEventListener('input', checkItemWeight);
            document.getElementById('item-qtd').removeEventListener('input', checkItemWeight);
        }

        function salvarItem(event) {
            event.preventDefault();
            
            const id = document.getElementById('item-id').value;
            const nome = document.getElementById('item-nome').value.trim();
            const categoria = document.getElementById('item-categoria').value;
            const quantidade = parseInt(document.getElementById('item-qtd').value) || 1;
            const peso = parseFloat(document.getElementById('item-peso').value) || 0;
            const valor = parseInt(document.getElementById('item-valor').value) || 0;
            const descricao = document.getElementById('item-desc').value.trim();
            const tipo = document.getElementById('item-tipo').value;
            
            if (!nome) {
                alert('Por favor, insira um nome para o item.');
                return;
            }
            
            // Verificar limites antes de salvar
            const stats = calculateStats();
            const pesoItemTotal = peso * quantidade;
            const futureWeight = stats.totalPeso + pesoItemTotal;
            
            if (futureWeight > limites.pesoMaximo && !confirm(`Adicionar este item fará você exceder o limite de peso (${futureWeight.toFixed(1)}/${limites.pesoMaximo}kg). Deseja continuar?`)) {
                return;
            }
            
            // Verificar limite de usáveis
            if (tipo === 'usavel') {
                const futureUsaveis = stats.usaveisCount + quantidade;
                if (futureUsaveis > limites.itensUsaveisMax && !confirm(`Adicionar este item fará você exceder o limite de itens usáveis (${futureUsaveis}/${limites.itensUsaveisMax}). Deseja continuar?`)) {
                    return;
                }
            }
            
            // Verificar limite de carregáveis
            if (tipo === 'carregavel') {
                const futureCarregaveis = stats.carregaveisCount + quantidade;
                if (futureCarregaveis > limites.itensCarregaveisMax && !confirm(`Adicionar este item fará você exceder o limite de itens carregáveis (${futureCarregaveis}/${limites.itensCarregaveisMax}). Deseja continuar?`)) {
                    return;
                }
            }
            
            const novoItem = {
                id: id || `item_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                nome: nome,
                categoria: categoria,
                quantidade: Math.max(1, quantidade),
                peso: Math.max(0, peso),
                valor: Math.max(0, valor),
                descricao: descricao,
                tipo: tipo
            };
            
            if (id) {
                // Atualizar item existente
                const index = inventario.findIndex(i => i.id === id);
                if (index !== -1) {
                    inventario[index] = novoItem;
                }
            } else {
                // Adicionar novo item
                inventario.push(novoItem);
            }
            
            updateStorage();
            updateAllStats();
            renderItems();
            checkLimits();
            closeModal();
        }

        function deletarItem(id) {
            if (confirm('Tem certeza que deseja remover este item?')) {
                inventario = inventario.filter(i => i.id !== id);
                updateStorage();
                updateAllStats();
                renderItems();
                checkLimits();
            }
        }

        // --- Exportações ---
        function exportTXT() {
            let content = "=== INVENTÁRIO DO PERSONAGEM ===\n\n";
            
            // Estatísticas
            const stats = calculateStats();
            content += `=== ESTATÍSTICAS ===\n`;
            content += `Total de Itens: ${stats.itemCount}\n`;
            content += `Peso Total: ${stats.totalPeso} kg / ${limites.pesoMaximo} kg\n`;
            content += `Itens Usáveis: ${stats.usaveisCount} / ${limites.itensUsaveisMax}\n`;
            content += `Itens Carregáveis: ${stats.carregaveisCount} / ${limites.itensCarregaveisMax}\n\n`;
            
            // Moedas
            content += `=== CARTERA ===\n`;
            content += `Ouro: ${moedas.gold}\n`;
            content += `Prata: ${moedas.silver}\n`;
            content += `Cobre: ${moedas.copper}\n`;
            content += `Total em Cobre: ${(moedas.gold * 100 + moedas.silver * 10 + moedas.copper).toLocaleString()} cp\n\n`;
            
            // Lista de itens
            content += `=== ITENS (${inventario.length} tipos) ===\n`;
            
            // Agrupar por categoria
            Object.keys(categoriasMap).forEach(catKey => {
                const itensCategoria = inventario.filter(item => item.categoria === catKey);
                if (itensCategoria.length > 0) {
                    const categoria = categoriasMap[catKey];
                    content += `\n[ ${categoria.label.toUpperCase()} ]\n`;
                    content += "-".repeat(50) + "\n";
                    
                    itensCategoria.forEach(item => {
                        const tipoText = item.tipo === 'usavel' ? '[USÁVEL]' : item.tipo === 'carregavel' ? '[CARREGÁVEL]' : '';
                        content += `• ${item.nome} ${tipoText} (x${item.quantidade})\n`;
                        content += `  Descrição: ${item.descricao || "Sem descrição"}\n`;
                        content += `  Peso: ${item.peso} kg cada | Valor: ${item.valor} cobre cada\n`;
                        content += `  Peso Total: ${(item.peso * item.quantidade).toFixed(1)} kg | Valor Total: ${item.valor * item.quantidade} cobre\n\n`;
                    });
                }
            });
            
            // Criar e baixar arquivo
            const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Inventario_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportPDF() {
            const element = document.getElementById('capture-area');
            const btn = document.getElementById('btn-pdf');
            const originalText = btn.innerHTML;
            
            // Esconder elementos que não devem aparecer no PDF
            document.querySelectorAll('.hide-on-export').forEach(el => el.style.display = 'none');
            
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Gerando...`;
            lucide.createIcons();
            
            const options = {
                margin: [10, 10, 10, 10],
                filename: `Inventario_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    backgroundColor: '#0a0a0c',
                    useCORS: true,
                    logging: false
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                }
            };
            
            html2pdf().set(options).from(element).save().then(() => {
                // Restaurar elementos escondidos
                document.querySelectorAll('.hide-on-export').forEach(el => el.style.display = '');
                btn.innerHTML = originalText;
                lucide.createIcons();
            }).catch(err => {
                console.error("Erro ao gerar PDF:", err);
                alert("Erro ao gerar PDF. Tente novamente.");
                document.querySelectorAll('.hide-on-export').forEach(el => el.style.display = '');
                btn.innerHTML = originalText;
                lucide.createIcons();
            });
        }

        function exportPNG() {
            const element = document.getElementById('capture-area');
            const btn = document.getElementById('btn-png');
            const originalText = btn.innerHTML;
            
            // Esconder elementos
            document.querySelectorAll('.hide-on-export').forEach(el => el.style.display = 'none');
            
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Gerando...`;
            lucide.createIcons();
            
            html2canvas(element, { 
                backgroundColor: '#0a0a0c', 
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Inventario_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Restaurar elementos
                document.querySelectorAll('.hide-on-export').forEach(el => el.style.display = '');
                btn.innerHTML = originalText;
                lucide.createIcons();
            }).catch(err => {
                console.error("Erro ao gerar PNG:", err);
                alert("Erro ao gerar PNG. Tente novamente.");
                document.querySelectorAll('.hide-on-export').forEach(el => el.style.display = '');
                btn.innerHTML = originalText;
                lucide.createIcons();
            });
        }

        // --- Reset do Inventário ---
        function resetInventory() {
            if (confirm("Tem certeza que deseja limpar TODO o inventário, moedas e redefinir limites? Esta ação não pode ser desfeita.")) {
                inventario = [];
                limites = {
                    pesoMaximo: 50.0,
                    itensUsaveisMax: 10,
                    itensCarregaveisMax: 20
                };
                moedas = {
                    gold: 100,
                    silver: 500,
                    copper: 1000
                };
                updateStorage();
                updateAllStats();
                renderItems();
                alert("Inventário limpo com sucesso!");
            }
        }

        // --- Utilitários ---
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // --- Inicialização ---
        window.addEventListener('load', () => {
            lucide.createIcons();
            loadFromStorage();
            updateAllStats();
            renderItems();
            checkLimits();
            
            // Adicionar evento de tecla ESC para fechar modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
            
            // Adicionar eventos para inputs de moedas (Enter para definir)
            ['gold', 'silver', 'copper'].forEach(type => {
                document.getElementById(`input-${type}`).addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        setMoney(type);
                    }
                });
            });
        });

        // Adicionar alguns itens de exemplo se o inventário estiver vazio
        window.addEventListener('load', () => {
            if (inventario.length === 0) {
                // Itens de exemplo
                const exemplos = [
                    {
                        id: 'exemplo_1',
                        nome: 'Espada Longa',
                        categoria: 'arma',
                        tipo: 'carregavel',
                        quantidade: 1,
                        peso: 2.5,
                        valor: 1500,
                        descricao: 'Uma espada de aço bem afiada'
                    },
                    {
                        id: 'exemplo_2',
                        nome: 'Poção de Cura Menor',
                        categoria: 'consumivel',
                        tipo: 'usavel',
                        quantidade: 3,
                        peso: 0.3,
                        valor: 500,
                        descricao: 'Restaura 20 pontos de vida'
                    },
                    {
                        id: 'exemplo_3',
                        nome: 'Couro de Dragão',
                        categoria: 'material',
                        tipo: 'normal',
                        quantidade: 5,
                        peso: 1.0,
                        valor: 2000,
                        descricao: 'Material raro para fabricação'
                    },
                    {
                        id: 'exemplo_4',
                        nome: 'Escudo de Madeira',
                        categoria: 'armadura',
                        tipo: 'carregavel',
                        quantidade: 1,
                        peso: 4.0,
                        valor: 800,
                        descricao: 'Escudo básico de madeira'
                    }
                ];
                
                exemplos.forEach(item => {
                    if (!inventario.some(i => i.id === item.id)) {
                        inventario.push(item);
                    }
                });
                
                updateStorage();
                updateAllStats();
                renderItems();
            }
        });
    </script>
</body>
</html>