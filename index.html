<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grim√≥rio Digital</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <!-- SEU SISTEMA DE ARMAZENAMENTO -->
    <script src="grimorio-core.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        theme: {
                            bg: '#0a0a0c',
                            panel: '#0f0f12',
                            border: '#2a2a2e',
                            text: '#e8e4dc',
                            blue: '#4a9eff',
                            orange: '#ff6b35',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: #e8e4dc; }
        
        /* Scrollbar Customizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0c; }
        ::-webkit-scrollbar-thumb { background: #2a2a2e; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4a9eff; }

        /* Efeitos de Glow */
        .text-shadow-glow { text-shadow: 0 0 10px rgba(74, 158, 255, 0.5); }
        .hover-glow-blue:hover { box-shadow: 0 0 20px rgba(74, 158, 255, 0.15); border-color: rgba(74, 158, 255, 0.5); }

        /* Anima√ß√µes (Simulando Framer Motion) */
        .anim-entry {
            animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .anim-delay-1 { animation-delay: 0.2s; }
        .anim-delay-2 { animation-delay: 0.4s; }
        .anim-delay-3 { animation-delay: 0.6s; }

        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Classes para Dropdown */
        .dropdown-content {
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease-in-out;
            pointer-events: none;
        }

        .dropdown-content.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            pointer-events: auto;
        }

        .chevron { transition: transform 0.3s ease; }
        .chevron.rotate { transform: rotate(180deg); }
    </style>
</head>
<body class="min-h-screen font-sans flex flex-col">

    <nav class="w-full bg-[#0f0f12]/95 backdrop-blur-sm border-b border-theme-border sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-center flex-wrap" id="nav-container">
                
                <div class="relative group dropdown-container">
                    <button onclick="toggleMenu('menu-personagem', this)" class="nav-btn flex items-center gap-2 px-5 py-4 text-[#e8e4dc] font-medium tracking-wide transition-all duration-300 hover:text-[#4a9eff] hover:bg-[#1a1a1e] border-b-2 border-transparent hover:border-[#4a9eff]">
                        <i data-lucide="user" class="w-4 h-4"></i>
                        <span class="font-cinzel">Personagem</span>
                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                    </button>
                    <div id="menu-personagem" class="dropdown-content absolute top-full left-0 min-w-[220px] bg-[#0f0f12] border border-[#2a2a2e] shadow-2xl shadow-black/50 z-50">
                        <a href="ficha.html" class="flex items-center gap-2 px-5 py-3 text-[#a0a0a0] text-sm transition-all duration-300 hover:bg-[#4a9eff]/10 hover:text-[#4a9eff] hover:pl-7 border-l-2 border-transparent hover:border-[#4a9eff]">
                            <i data-lucide="scroll-text" class="w-3 h-3"></i> Ficha (Lore & Corpo)
                        </a>
                        <a href="status.html" class="flex items-center gap-2 px-5 py-3 text-[#a0a0a0] text-sm transition-all duration-300 hover:bg-[#4a9eff]/10 hover:text-[#4a9eff] hover:pl-7 border-l-2 border-transparent hover:border-[#4a9eff]">
                            <i data-lucide="zap" class="w-3 h-3"></i> Status (Atributos)
                        </a>
                    </div>
                </div>

                <a href="classe.html" class="flex items-center gap-2 px-5 py-4 text-[#e8e4dc] font-medium tracking-wide transition-all duration-300 hover:text-[#4a9eff] hover:bg-[#1a1a1e] border-b-2 border-transparent hover:border-[#4a9eff]">
                    <i data-lucide="backpack" class="w-4 h-4"></i>
                    <span class="font-cinzel">Classe</span>
                </a>

                <a href="inventario.html" class="flex items-center gap-2 px-5 py-4 text-[#e8e4dc] font-medium tracking-wide transition-all duration-300 hover:text-[#4a9eff] hover:bg-[#1a1a1e] border-b-2 border-transparent hover:border-[#4a9eff]">
                    <i data-lucide="backpack" class="w-4 h-4"></i>
                    <span class="font-cinzel">Invent√°rio</span>
                </a>

                <a href="mascote.html" class="flex items-center gap-2 px-5 py-4 text-[#e8e4dc] font-medium tracking-wide transition-all duration-300 hover:text-[#4a9eff] hover:bg-[#1a1a1e] border-b-2 border-transparent hover:border-[#4a9eff]">
                    <i data-lucide="dog" class="w-4 h-4"></i>
                    <span class="font-cinzel">Mascote</span>
                </a>

                <div class="relative group dropdown-container">
                    <button onclick="toggleMenu('menu-habil', this)" class="nav-btn flex items-center gap-2 px-5 py-4 text-[#e8e4dc] font-medium tracking-wide transition-all duration-300 hover:text-[#4a9eff] hover:bg-[#1a1a1e] border-b-2 border-transparent hover:border-[#4a9eff]">
                        <i data-lucide="sparkles" class="w-4 h-4"></i>
                        <span class="font-cinzel">Habilidades</span>
                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                    </button>
                    <div id="menu-habil" class="dropdown-content absolute top-full left-0 min-w-[220px] bg-[#0f0f12] border border-[#2a2a2e] shadow-2xl shadow-black/50 z-50">
                        <a href="habilidades.html" class="block px-5 py-3 text-[#a0a0a0] text-sm transition-all duration-300 hover:bg-[#4a9eff]/10 hover:text-[#4a9eff] hover:pl-7 border-l-2 border-transparent hover:border-[#4a9eff]">‚öîÔ∏è Combate (Ativas)</a>
                        <a href="proficiencias.html" class="block px-5 py-3 text-[#a0a0a0] text-sm transition-all duration-300 hover:bg-[#4a9eff]/10 hover:text-[#4a9eff] hover:pl-7 border-l-2 border-transparent hover:border-[#4a9eff]">üî® Profici√™ncias (Passivas)</a>
                    </div>
                </div>

            </div>
        </div>
        <div class="h-[2px] bg-gradient-to-r from-transparent via-[#4a9eff] to-transparent"></div>
    </nav>

    <main class="flex-grow">
        <div class="relative w-full h-[30vh] min-h-[250px] overflow-hidden anim-entry">
            <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=1600&q=80');"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/60 to-transparent"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-[#0a0a0c]/80 via-transparent to-[#0a0a0c]/80"></div>
            
            <div class="absolute inset-0 flex flex-col items-center justify-center z-10">
                <h1 class="font-cinzel text-4xl md:text-6xl font-bold text-theme-text tracking-widest text-shadow-glow mb-4">Grim√≥rio Digital</h1>
                
                <div class="w-32 h-[2px] bg-gradient-to-r from-transparent via-theme-blue to-transparent"></div>
                
                <p class="text-[#a0a0a0] mt-3 tracking-[0.3em] text-sm font-light">HUB CENTRAL</p>
            </div>
            
            <div class="absolute bottom-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-theme-blue/50 to-transparent"></div>
        </div>
        
        <div class="max-w-6xl mx-auto px-4 py-8 anim-entry anim-delay-1">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="ficha.html" class="group flex items-center gap-3 p-4 bg-theme-panel border border-theme-border hover-glow-blue transition-all duration-300 rounded">
                    <div class="p-2 rounded bg-[#4a9eff]/20 text-theme-blue">
                        <i data-lucide="scroll-text" class="w-5 h-5"></i>
                    </div>
                    <span class="font-cinzel text-sm text-theme-text group-hover:text-theme-blue transition-colors">Criar Ficha</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-theme-border group-hover:text-theme-blue group-hover:translate-x-1 transition-all"></i>
                </a>

                <a href="status.html" class="group flex items-center gap-3 p-4 bg-theme-panel border border-theme-border hover:border-theme-orange/50 transition-all duration-300 rounded">
                    <div class="p-2 rounded bg-[#ff6b35]/20 text-theme-orange">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                    </div>
                    <span class="font-cinzel text-sm text-theme-text group-hover:text-theme-orange transition-colors">Ver Status</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-theme-border group-hover:text-theme-orange group-hover:translate-x-1 transition-all"></i>
                </a>

                <a href="inventario.html" class="group flex items-center gap-3 p-4 bg-theme-panel border border-theme-border hover-glow-blue transition-all duration-300 rounded">
                    <div class="p-2 rounded bg-[#4a9eff]/20 text-theme-blue">
                        <i data-lucide="backpack" class="w-5 h-5"></i>
                    </div>
                    <span class="font-cinzel text-sm text-theme-text group-hover:text-theme-blue transition-colors">Invent√°rio</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-theme-border group-hover:text-theme-blue group-hover:translate-x-1 transition-all"></i>
                </a>

                <a href="habilidades.html" class="group flex items-center gap-3 p-4 bg-theme-panel border border-theme-border hover:border-theme-orange/50 transition-all duration-300 rounded">
                    <div class="p-2 rounded bg-[#ff6b35]/20 text-theme-orange">
                        <i data-lucide="sword" class="w-5 h-5"></i>
                    </div>
                    <span class="font-cinzel text-sm text-theme-text group-hover:text-theme-orange transition-colors">Habilidades</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-theme-border group-hover:text-theme-orange group-hover:translate-x-1 transition-all"></i>
                </a>
            </div>
        </div>

        <!-- NOVA SE√á√ÉO: FICHA ATIVA -->
        <div class="max-w-6xl mx-auto px-4 pb-6 anim-entry anim-delay-2">
            <div class="bg-theme-panel border border-theme-border p-6 rounded-lg hover:border-theme-blue/30 transition-all duration-300">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-blue mb-4">
                    <i data-lucide="user-check" class="w-5 h-5"></i>
                    Ficha Ativa
                </h3>
                
                <div id="ficha-ativa-container" class="flex flex-col md:flex-row items-center md:items-start gap-4 p-4 bg-[#0a0a0c] rounded border border-theme-border">
                    <!-- Avatar ser√° carregado aqui -->
                    <div id="ficha-avatar" class="w-20 h-20 rounded-lg border border-theme-border bg-cover bg-center flex-shrink-0 flex items-center justify-center">
                        <i data-lucide="user" class="w-8 h-8 text-[#606060]"></i>
                    </div>
                    
                    <div class="flex-grow text-center md:text-left">
                        <div id="ficha-sem-dados">
                            <p class="text-[#606060] mb-2">Nenhuma ficha ativa encontrada.</p>
                            <a href="ficha.html" class="inline-flex items-center gap-2 text-theme-blue hover:text-theme-orange transition-colors text-sm">
                                <i data-lucide="plus" class="w-3 h-3"></i>
                                Criar sua primeira ficha
                            </a>
                        </div>
                        
                        <div id="ficha-com-dados" class="hidden">
                            <h4 id="ficha-nome" class="font-cinzel font-bold text-white text-lg"></h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span id="ficha-classe" class="px-3 py-1 bg-[#4a9eff]/10 text-theme-blue text-xs rounded-full border border-theme-border"></span>
                                <span id="ficha-raca" class="px-3 py-1 bg-[#ff6b35]/10 text-theme-orange text-xs rounded-full border border-theme-border"></span>
                            </div>
                            <p id="ficha-titulo" class="text-[#a0a0a0] text-sm mt-2 italic"></p>
                            
                            <div class="mt-4 flex gap-3">
                                <a href="ficha.html" class="flex items-center gap-2 text-theme-blue hover:text-white transition-colors text-sm">
                                    <i data-lucide="edit" class="w-3 h-3"></i>
                                    Editar Ficha
                                </a>
                                <span class="text-[#606060]">‚Ä¢</span>
                                <a href="status.html" class="flex items-center gap-2 text-theme-orange hover:text-white transition-colors text-sm">
                                    <i data-lucide="zap" class="w-3 h-3"></i>
                                    Ver Status
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-xs text-[#606060] text-center md:text-right">
                        <div id="ultima-atualizacao" class="mb-2"></div>
                        <button onclick="limparFichaAtiva()" class="text-red-400 hover:text-red-300 transition-colors flex items-center gap-1 mx-auto md:mx-0">
                            <i data-lucide="x" class="w-3 h-3"></i>
                            Limpar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto px-4 pb-12 anim-entry anim-delay-3">
            <div class="grid md:grid-cols-2 gap-6">
                
                <div class="bg-theme-panel border border-theme-border p-6 hover:border-theme-blue/30 transition-all duration-500 rounded">
                    <div class="flex items-center gap-3 mb-4 pb-4 border-b border-theme-border">
                        <div class="p-2 rounded bg-[#4a9eff]/15 text-theme-blue">
                            <i data-lucide="scroll-text" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-cinzel text-lg font-semibold text-theme-blue">Personagem & Ficha</h3>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <span class="text-theme-text font-medium block">Ficha:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">Onde reside a alma e o corpo. Foco em apar√™ncia detalhada (slots de corpo), hist√≥ria, personalidade e identidade visual.</p>
                        </div>
                        <div>
                            <span class="text-theme-text font-medium block">Status:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">A matem√°tica do poder. For√ßa, agilidade, mana e c√°lculos de combate puro.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-theme-panel border border-theme-border p-6 hover:border-theme-orange/30 transition-all duration-500 rounded">
                    <div class="flex items-center gap-3 mb-4 pb-4 border-b border-theme-border">
                        <div class="p-2 rounded bg-[#ff6b35]/15 text-theme-orange">
                            <i data-lucide="shield" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-cinzel text-lg font-semibold text-theme-orange">Classe</h3>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <span class="text-theme-text font-medium block">Papel T√°tico:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">Define seu papel em grupo. Desde a Vanguarda que abre caminho, at√© o Dom√©stico que gerencia a base, ou o Domador que controla feras.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-theme-panel border border-theme-border p-6 hover:border-theme-blue/30 transition-all duration-500 rounded">
                    <div class="flex items-center gap-3 mb-4 pb-4 border-b border-theme-border">
                        <div class="p-2 rounded bg-[#4a9eff]/15 text-theme-blue">
                            <i data-lucide="backpack" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-cinzel text-lg font-semibold text-theme-blue">Invent√°rio & Mascote</h3>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <span class="text-theme-text font-medium block">Recursos:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">Gerenciamento de armas, itens e equipamentos.</p>
                        </div>
                        <div>
                            <span class="text-theme-text font-medium block">Mascote:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">Seu companheiro possui sua pr√≥pria mini-ficha de evolu√ß√£o.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-theme-panel border border-theme-border p-6 hover:border-theme-orange/30 transition-all duration-500 rounded">
                    <div class="flex items-center gap-3 mb-4 pb-4 border-b border-theme-border">
                        <div class="p-2 rounded bg-[#ff6b35]/15 text-theme-orange">
                            <i data-lucide="sparkles" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-cinzel text-lg font-semibold text-theme-orange">Habilidades</h3>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <span class="text-theme-text font-medium block">Combate:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">Skills usadas em batalha (Dano, Cura, Buff).</p>
                        </div>
                        <div>
                            <span class="text-theme-text font-medium block">Profici√™ncias:</span>
                            <p class="text-[#808080] text-sm leading-relaxed mt-1">Talentos de vida (Ferreiro, Alquimia, Culin√°ria) e maestria com armas.</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer class="border-t border-theme-border py-8 mt-auto">
        <div class="flex justify-center items-center gap-4">
            <div class="w-16 h-[1px] bg-gradient-to-r from-transparent to-[#4a9eff]/50"></div>
            <i data-lucide="sword" class="w-4 h-4 text-[#4a9eff]/50 rotate-90 md:rotate-0"></i>
            <div class="w-16 h-[1px] bg-gradient-to-l from-transparent to-[#4a9eff]/50"></div>
        </div>
        <p class="text-center text-[#606060] text-xs mt-4">Grim√≥rio Digital - Sistema de RPG v1.0</p>
    </footer>

    <script>
        // 1. Inicializar √çcones Lucide
        if (window.lucide) {
            lucide.createIcons();
        }

        // 2. L√≥gica dos Dropdowns
        function toggleMenu(menuId, btnElement) {
            const menu = document.getElementById(menuId);
            const chevron = btnElement.querySelector('.chevron');
            const isActive = menu.classList.contains('active');

            closeAllMenus();

            if (!isActive) {
                menu.classList.add('active');
                if(chevron) chevron.classList.add('rotate');
            }
        }

        function closeAllMenus() {
            document.querySelectorAll('.dropdown-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.chevron').forEach(el => {
                el.classList.remove('rotate');
            });
        }

        window.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown-container')) {
                closeAllMenus();
            }
        });

        // 3. SISTEMA DE FICHA ATIVA - VERS√ÉO CORRIGIDA
        const CHAVE_ARMAZENAMENTO = 'personagemSalvo'; // Chave unificada para todo o sistema

        function inicializarPersonagemPadrao() {
            // Cria dados padr√£o se n√£o existirem
            if (!localStorage.getItem(CHAVE_ARMAZENAMENTO)) {
                const personagemPadrao = {
                    // Informa√ß√µes b√°sicas (da ficha.html)
                    'inp-nome': 'Novo Aventureiro',
                    'inp-titulo': 'Viajante sem Destino',
                    'inp-raca': 'Humano',
                    'inp-classe': 'N√£o Definida',
                    'inp-idade': '20',
                    'inp-altura': '175',
                    'inp-peso': '70',
                    'inp-olhos': 'Castanhos',
                    'inp-pele': 'Clara',
                    'inp-cabelo': 'Preto',
                    
                    // Avatar/Imagem
                    avatar: '', // URL da imagem, se houver
                    
                    // Status (de status.html) - TODOS COME√áAM EM 0
                    atributos: {
                        forca: 0,
                        destreza: 0,
                        constituicao: 0,
                        inteligencia: 0,
                        sabedoria: 0,
                        carisma: 0
                    },
                    
                    // Sistema de Pontos
                    pontosDisponiveis: 0,
                    nivel: 1,
                    
                    // Modos
                    modoChefe: false, // Permite edi√ß√£o livre quando true
                    
                    // Outras se√ß√µes
                    inventario: [],
                    habilidades: [],
                    proficiencias: [],
                    mascoteVinculado: false,
                    
                    // Metadados
                    ultimaAtualizacao: new Date().toISOString(),
                    versaoSistema: '1.0'
                };
                
                localStorage.setItem(CHAVE_ARMAZENAMENTO, JSON.stringify(personagemPadrao));
                console.log('Personagem padr√£o criado com sucesso!');
            }
        }

        function carregarFichaAtiva() {
            // Garante que existe um personagem para carregar
            inicializarPersonagemPadrao();
            
            const dadosSalvos = localStorage.getItem(CHAVE_ARMAZENAMENTO);
            const containerVazio = document.getElementById('ficha-sem-dados');
            const containerComDados = document.getElementById('ficha-com-dados');
            const avatarContainer = document.getElementById('ficha-avatar');
            
            if (!dadosSalvos) {
                if (containerVazio) containerVazio.classList.remove('hidden');
                if (containerComDados) containerComDados.classList.add('hidden');
                return;
            }
            
            try {
                const dados = JSON.parse(dadosSalvos);
                
                // Atualizar timestamp
                dados.ultimaAtualizacao = new Date().toISOString();
                localStorage.setItem(CHAVE_ARMAZENAMENTO, JSON.stringify(dados));
                
                // Mostrar container com dados
                if (containerVazio) containerVazio.classList.add('hidden');
                if (containerComDados) containerComDados.classList.remove('hidden');
                
                // Preencher informa√ß√µes
                document.getElementById('ficha-nome').textContent = dados['inp-nome'] || 'Sem nome';
                document.getElementById('ficha-titulo').textContent = dados['inp-titulo'] || 'Aventureiro sem t√≠tulo';
                document.getElementById('ficha-classe').textContent = dados['inp-classe'] || 'N√£o Definida';
                document.getElementById('ficha-raca').textContent = dados['inp-raca'] || 'N√£o Definida';
                
                // Carregar avatar
                if (avatarContainer && dados.avatar && dados.avatar.trim() !== '') {
                    avatarContainer.style.backgroundImage = `url('${dados.avatar}')`;
                    avatarContainer.style.backgroundSize = 'cover';
                    avatarContainer.style.backgroundPosition = 'center';
                    avatarContainer.innerHTML = '';
                } else {
                    avatarContainer.style.backgroundImage = '';
                    avatarContainer.innerHTML = '<i data-lucide="user" class="w-8 h-8 text-[#606060]"></i>';
                    if (window.lucide) lucide.createIcons();
                }
                
                // Atualizar √∫ltima modifica√ß√£o
                const atualizacaoEl = document.getElementById('ultima-atualizacao');
                if (atualizacaoEl && dados.ultimaAtualizacao) {
                    const data = new Date(dados.ultimaAtualizacao);
                    const agora = new Date();
                    const diferencaMin = Math.floor((agora - data) / (1000 * 60));
                    
                    if (diferencaMin < 1) {
                        atualizacaoEl.textContent = 'Agora mesmo';
                    } else if (diferencaMin < 60) {
                        atualizacaoEl.textContent = `H√° ${diferencaMin} min`;
                    } else if (diferencaMin < 1440) {
                        atualizacaoEl.textContent = `Hoje √†s ${data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
                    } else {
                        atualizacaoEl.textContent = data.toLocaleDateString('pt-BR');
                    }
                }
                
            } catch (error) {
                console.error('Erro ao carregar ficha ativa:', error);
            }
        }

        // 4. SISTEMA DE ATUALIZA√á√ÉO AUTOM√ÅTICA DE CLASSE
        function atualizarClasseNaFicha(novaClasse) {
            try {
                const dadosSalvos = localStorage.getItem(CHAVE_ARMAZENAMENTO);
                if (!dadosSalvos) return;
                
                const dados = JSON.parse(dadosSalvos);
                
                // Atualiza a classe
                dados['inp-classe'] = novaClasse;
                dados.ultimaAtualizacao = new Date().toISOString();
                
                // Salva de volta
                localStorage.setItem(CHAVE_ARMAZENAMENTO, JSON.stringify(dados));
                
                // Atualiza a exibi√ß√£o se estiver no index.html
                if (window.location.pathname.endsWith('index.html') || window.location.pathname === '/') {
                    carregarFichaAtiva();
                }
                
                console.log(`Classe atualizada para: ${novaClasse}`);
                
            } catch (error) {
                console.error('Erro ao atualizar classe:', error);
            }
        }

        // 5. FUN√á√ÉO PARA LIMPAR FICHA
        function limparFichaAtiva() {
            if (confirm('Deseja resetar TODOS os dados do personagem?\n\nIsso apagar√° nome, classe, status, invent√°rio...')) {
                // Remove tudo e recria o padr√£o
                localStorage.removeItem(CHAVE_ARMAZENAMENTO);
                
                // Feedback visual
                const feedback = document.createElement('div');
                feedback.className = 'fixed top-4 right-4 px-4 py-3 rounded-lg bg-red-900/20 border border-red-700 text-red-300 z-[100] animate-fadeIn';
                feedback.textContent = 'Personagem resetado!';
                document.body.appendChild(feedback);
                
                // Recria personagem padr√£o e recarrega
                setTimeout(() => {
                    inicializarPersonagemPadrao();
                    carregarFichaAtiva();
                    
                    setTimeout(() => {
                        feedback.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                        setTimeout(() => feedback.remove(), 500);
                    }, 2000);
                }, 500);
            }
        }

        // 6. LISTENER PARA EVENTOS DE ATUALIZA√á√ÉO DE CLASSE
        // Isso permite que a p√°gina classe.html comunique mudan√ßas
        window.addEventListener('storage', function(e) {
            if (e.key === CHAVE_ARMAZENAMENTO) {
                carregarFichaAtiva();
            }
        });

        // 7. INICIALIZA√á√ÉO DA P√ÅGINA
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa sistema
            inicializarPersonagemPadrao();
            
            // Carrega ficha ap√≥s um breve delay
            setTimeout(carregarFichaAtiva, 100);
            
            // Atualizar periodicamente (para sincronizar entre abas)
            setInterval(carregarFichaAtiva, 3000);
            
            // Verificar se h√° par√¢metros de classe na URL
            const urlParams = new URLSearchParams(window.location.search);
            const classeParam = urlParams.get('classe');
            if (classeParam) {
                atualizarClasseNaFicha(classeParam);
            }
        });

        // 8. Adicionar estilo para anima√ß√£o de feedback
        const estiloAnimacao = document.createElement('style');
        estiloAnimacao.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        `;
        document.head.appendChild(estiloAnimacao);
    </script>
</body>
</html>