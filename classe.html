<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Sistema de Classes</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        theme: {
                            bg: '#0a0a0c',
                            panel: '#0f0f12',
                            border: '#2a2a2e',
                            text: '#e8e4dc',
                            pink: '#ec4899',
                            red: '#dc2626',
                            purple: '#8b5cf6',
                            yellow: '#f59e0b',
                            blue: '#4a9eff',
                            green: '#22c55e',
                            cyan: '#06b6d4',
                            orange: '#ff6b35',
                            teal: '#14b8a6',
                            indigo: '#6366f1',
                            rose: '#f43f5e',
                            amber: '#fbbf24',
                            lime: '#84cc16',
                            emerald: '#10b981',
                            sky: '#0ea5e9',
                            violet: '#7c3aed',
                            fuchsia: '#d946ef',
                            muted: '#606060'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: #e8e4dc; }
        
        /* Animações simplificadas */
        .anim-entry { animation: fadeInUp 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeInUp { 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        /* Modal simplificado */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            background: #0f0f12; border: 1px solid #2a2a2e;
            border-radius: 12px; width: 100%; max-width: 700px;
            max-height: 90vh; overflow-y: auto;
        }
        
        /* Cards simplificados */
        .class-card {
            transition: transform 0.2s ease;
        }
        .class-card:hover {
            transform: translateY(-2px);
        }
        
        /* Sistema de cores simplificado */
        .color-option {
            width: 32px; height: 32px; border-radius: 6px;
            cursor: pointer; transition: transform 0.2s ease;
        }
        
        /* Sliders simplificados */
        .attr-slider {
            width: 100%; height: 8px; appearance: none; -webkit-appearance: none;
            background: transparent;
        }
        .attr-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px;
            border-radius: 50%; background: currentColor;
            cursor: pointer; border: 2px solid #0a0a0c;
        }
        
        /* Remover animações complexas para performance */
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    </style>
</head>
<body class="min-h-screen font-sans">

    <nav class="w-full bg-[#0f0f12]/95 backdrop-blur-sm border-b border-theme-border sticky top-0 z-50 mb-8">
        <div class="max-w-7xl mx-auto px-4 flex items-center gap-4 py-4">
            <a href="index.html" class="text-theme-text hover:text-theme-pink transition-colors">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
            </a>
            <div class="h-6 w-[1px] bg-theme-border"></div>
            <span class="font-cinzel font-bold text-lg tracking-wide text-theme-pink">Grimório Digital</span>
            <div class="h-6 w-[1px] bg-theme-border"></div>
            <span class="text-sm text-theme-muted">Sistema de Classes</span>
        </div>
        <div class="h-[1px] bg-gradient-to-r from-transparent via-theme-pink to-transparent"></div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 space-y-6">

        <!-- Cabeçalho -->
        <header class="flex items-center gap-4 mb-8 anim-entry">
            <div class="p-3 rounded-lg bg-gradient-to-br from-theme-purple/20 to-pink-600/20 border border-theme-purple/30">
                <i data-lucide="swords" class="w-8 h-8 text-theme-purple"></i>
            </div>
            <div>
                <h1 class="text-3xl font-cinzel font-bold text-white">Sistema de Classes</h1>
                <p class="text-gray-400">Crie, edite e personalize classes totalmente customizáveis</p>
            </div>
        </header>

        <!-- Seção 1: Sistema de Classes -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.1s; border-left: 4px solid #8b5cf6;">
            <div class="flex items-center justify-between mb-6">
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-purple">
                    <i data-lucide="library" class="w-4 h-4"></i> Biblioteca de Classes
                </h3>
                <div class="flex items-center gap-2">
                    <button onclick="exportClasses()" class="px-4 py-2 bg-theme-bg border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors text-sm">
                        <i data-lucide="download" class="w-3 h-3 inline mr-1"></i> Exportar
                    </button>
                    <button onclick="importClasses()" class="px-4 py-2 bg-theme-bg border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors text-sm">
                        <i data-lucide="upload" class="w-3 h-3 inline mr-1"></i> Importar
                    </button>
                    <button onclick="openClassEditor()" class="px-4 py-2 bg-gradient-to-r from-theme-purple to-pink-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity text-sm">
                        <i data-lucide="plus" class="w-3 h-3 inline mr-1"></i> Nova Classe
                    </button>
                </div>
            </div>
            
            <!-- Filtros -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="filterClasses('all')" id="filter-all" class="px-3 py-1 bg-theme-purple text-white rounded-lg text-sm font-medium">
                        Todas
                    </button>
                    <button onclick="filterClasses('default')" id="filter-default" class="px-3 py-1 bg-theme-bg border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors text-sm">
                        <i data-lucide="shield" class="w-3 h-3 inline mr-1"></i> Padrão
                    </button>
                    <button onclick="filterClasses('custom')" id="filter-custom" class="px-3 py-1 bg-theme-bg border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors text-sm">
                        <i data-lucide="sparkles" class="w-3 h-3 inline mr-1"></i> Personalizadas
                    </button>
                    <button onclick="filterClasses('favorite')" id="filter-favorite" class="px-3 py-1 bg-theme-bg border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors text-sm">
                        <i data-lucide="star" class="w-3 h-3 inline mr-1"></i> Favoritas
                    </button>
                    <div class="flex-1"></div>
                    <input type="text" id="search-classes" placeholder="Buscar classe..." 
                           class="px-3 py-1 bg-theme-bg border border-theme-border rounded-lg text-white placeholder-gray-500 outline-none focus:border-theme-purple text-sm w-48">
                </div>
            </div>
            
            <!-- Lista de Classes -->
            <div id="classes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Classes serão inseridas aqui -->
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-theme-muted">
                    <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                    Clique em uma classe para editar ou usar no personagem
                </p>
            </div>
        </section>

        <!-- Seção 2: Estatísticas -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.2s; border-left: 4px solid #4a9eff;">
            <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-blue mb-6">
                <i data-lucide="bar-chart-3" class="w-4 h-4"></i> Estatísticas do Sistema
            </h3>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-theme-bg border border-theme-border p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-white mb-1" id="stats-total">0</div>
                    <div class="text-xs text-theme-muted">Total de Classes</div>
                </div>
                
                <div class="bg-theme-bg border border-theme-border p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-theme-green mb-1" id="stats-custom">0</div>
                    <div class="text-xs text-theme-muted">Personalizadas</div>
                </div>
                
                <div class="bg-theme-bg border border-theme-border p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-theme-yellow mb-1" id="stats-favorites">0</div>
                    <div class="text-xs text-theme-muted">Favoritas</div>
                </div>
                
                <div class="bg-theme-bg border border-theme-border p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-theme-purple mb-1" id="stats-used">0</div>
                    <div class="text-xs text-theme-muted">Em Uso</div>
                </div>
            </div>
        </section>

        <!-- Seção 3: Configurações do Sistema -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.3s; border-left: 4px solid #f59e0b;">
            <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-yellow mb-6">
                <i data-lucide="settings" class="w-4 h-4"></i> Configurações do Sistema
            </h3>
            
            <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-theme-bg rounded-lg border border-theme-border">
                    <div class="flex items-center gap-3">
                        <i data-lucide="shield-off" class="w-5 h-5 text-theme-yellow"></i>
                        <div>
                            <h4 class="font-medium text-white">Desativar Classes Padrão</h4>
                            <p class="text-sm text-theme-muted">Mostrar apenas classes personalizadas</p>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="disable-default-classes" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-theme-yellow"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between p-4 bg-theme-bg rounded-lg border border-theme-border">
                    <div class="flex items-center gap-3">
                        <i data-lucide="copy" class="w-5 h-5 text-theme-blue"></i>
                        <div>
                            <h4 class="font-medium text-white">Duplicar ao Editar</h4>
                            <p class="text-sm text-theme-muted">Criar cópia ao editar classes padrão</p>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="duplicate-on-edit" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-theme-blue"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between p-4 bg-theme-bg rounded-lg border border-theme-border">
                    <div class="flex items-center gap-3">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-theme-red"></i>
                        <div>
                            <h4 class="font-medium text-white">Resetar Sistema</h4>
                            <p class="text-sm text-theme-muted">Restaurar classes padrão e limpar personalizadas</p>
                        </div>
                    </div>
                    <button onclick="resetClassSystem()" 
                            class="px-4 py-2 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded-lg border border-red-800 transition-colors text-sm">
                        Resetar Tudo
                    </button>
                </div>
            </div>
        </section>

        <!-- Seção 4: Pré-visualização -->
        <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry" style="animation-delay: 0.4s; border-left: 4px solid #22c55e;">
            <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold text-theme-green mb-6">
                <i data-lucide="eye" class="w-4 h-4"></i> Pré-visualização
            </h3>
            
            <div id="preview-container" class="bg-theme-bg border border-theme-border rounded-lg p-6">
                <div class="text-center py-12">
                    <i data-lucide="swords" class="w-12 h-12 mx-auto mb-3 text-theme-muted"></i>
                    <p class="text-theme-muted">Selecione uma classe para ver a pré-visualização</p>
                    <p class="text-xs text-theme-muted mt-1">Clique em uma classe na lista acima</p>
                </div>
            </div>
        </section>

    </div>

    <!-- Modal Editor de Classe -->
    <div id="class-editor-modal" class="modal-backdrop hidden">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-cinzel text-xl font-bold" id="modal-title" style="color: var(--class-color, #8b5cf6)">
                    <i data-lucide="plus-circle" class="w-5 h-5 inline mr-2"></i>
                    Criar Nova Classe
                </h3>
                <button onclick="closeClassEditor()" class="text-theme-muted hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Informações Básicas -->
                <div>
                    <h4 class="font-semibold text-white mb-3">Informações Básicas</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-theme-muted mb-2">Nome da Classe</label>
                            <input type="text" id="class-name" placeholder="Ex: Necromante, Engenheiro, Druida..."
                                   class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-current outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-theme-muted mb-2">Dificuldade</label>
                            <select id="class-difficulty" 
                                    class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-current outline-none cursor-pointer">
                                <option value="easy" style="color: #22c55e">Fácil</option>
                                <option value="medium" style="color: #f59e0b">Médio</option>
                                <option value="hard" style="color: #ef4444">Difícil</option>
                                <option value="expert" style="color: #8b5cf6">Especialista</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm text-theme-muted mb-2">Descrição</label>
                        <textarea id="class-description" placeholder="Descreva a classe, seu papel no grupo, estilo de jogo..."
                                  class="w-full bg-theme-bg border border-theme-border rounded-lg px-4 py-3 text-white focus:border-current outline-none h-24 resize-none"></textarea>
                    </div>
                </div>
                
                <!-- Cor e Ícone -->
                <div>
                    <h4 class="font-semibold text-white mb-3">Aparência</h4>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm text-theme-muted mb-2">Cor da Classe</label>
                            <div class="grid grid-cols-8 gap-2" id="color-palette">
                                <!-- Cores via JS -->
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-theme-muted mb-2">Ícone</label>
                            <div class="grid grid-cols-8 gap-2" id="icon-palette">
                                <!-- Ícones via JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Atributos Base -->
                <div>
                    <h4 class="font-semibold text-white mb-3">Atributos Base</h4>
                    <div class="space-y-4" id="attributes-container">
                        <!-- Atributos via JS -->
                    </div>
                    <div class="mt-4 p-3 bg-theme-bg/50 rounded-lg border border-theme-border">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-theme-muted">Total de Pontos</span>
                            <span class="font-bold text-white" id="total-points">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Habilidades Especiais -->
                <div>
                    <h4 class="font-semibold text-white mb-3">Habilidades Especiais</h4>
                    <div id="skills-container">
                        <!-- Habilidades via JS -->
                    </div>
                    <button onclick="addSkill()" class="mt-2 w-full py-2 border border-dashed border-theme-border rounded-lg text-theme-muted hover:text-white hover:border-current transition-colors">
                        <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                        Adicionar Habilidade
                    </button>
                </div>
                
                <!-- Ações -->
                <div class="flex gap-3 pt-4 border-t border-theme-border">
                    <button onclick="closeClassEditor()" 
                            class="flex-1 px-4 py-3 border border-theme-border rounded-lg text-white hover:bg-white/5 transition-colors">
                        Cancelar
                    </button>
                    <button onclick="saveClass()" id="save-class-btn"
                            class="flex-1 px-4 py-3 bg-gradient-to-r from-theme-purple to-pink-600 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity">
                        Salvar Classe
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 mt-8 pb-12">
        <div class="text-center text-sm text-theme-muted">
            <p><i data-lucide="code" class="w-3 h-3 inline mr-1"></i> Sistema de Classes Totalmente Customizável</p>
        </div>
    </div>

    <script>
        // ====================================================================
        // SISTEMA OTIMIZADO - SEM TRAVAMENTOS
        // ====================================================================
        
        lucide.createIcons();
        
        // Classes padrão
        const DEFAULT_CLASSES = [
            {
                id: 'guerreiro',
                name: 'Guerreiro',
                description: 'Mestre das armas e da armadura pesada.',
                color: '#dc2626',
                icon: 'sword',
                difficulty: 'medium',
                attributes: { for: 4, dex: 2, con: 4, int: 1, wis: 2, cha: 1 },
                skills: ['Provocar', 'Postura de Combate', 'Golpe Poderoso'],
                tags: ['combate', 'tanque'],
                isDefault: true,
                isFavorite: false,
                usageCount: 0
            },
            {
                id: 'mago',
                name: 'Mago',
                description: 'Estudioso das artes arcanas.',
                color: '#4a9eff',
                icon: 'sparkles',
                difficulty: 'hard',
                attributes: { for: 1, dex: 2, con: 2, int: 6, wis: 4, cha: 3 },
                skills: ['Conjurar Magia', 'Foco Arcano'],
                tags: ['magia', 'suporte'],
                isDefault: true,
                isFavorite: false,
                usageCount: 0
            }
        ];

        // Paleta simplificada
        const COLOR_PALETTE = ['#dc2626', '#ea580c', '#d97706', '#16a34a', '#0284c7', '#4f46e5', '#7c3aed', '#db2777'];
        const ICON_PALETTE = ['sword', 'shield', 'sparkles', 'target', 'brain', 'heart', 'skull', 'star'];

        // Sistema principal
        let classes = [];
        let editingClass = null;
        let currentFilter = 'all';
        let searchTimeout;

        // ====================================================================
        // FUNÇÕES UTILITÁRIAS OTIMIZADAS
        // ====================================================================
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // ====================================================================
        // INICIALIZAÇÃO
        // ====================================================================
        
        function init() {
            loadClasses();
            setupEventListeners();
            renderClasses();
            updateStatistics();
        }

        function loadClasses() {
            const saved = localStorage.getItem('grimorio_custom_classes');
            const customClasses = saved ? JSON.parse(saved) : [];
            classes = [...DEFAULT_CLASSES, ...customClasses];
        }

        function saveClasses() {
            const customClasses = classes.filter(c => !c.isDefault);
            localStorage.setItem('grimorio_custom_classes', JSON.stringify(customClasses));
        }

        // ====================================================================
        // RENDERIZAÇÃO OTIMIZADA
        // ====================================================================
        
        function renderClasses() {
            const container = document.getElementById('classes-container');
            if (!container) return;
            
            const searchTerm = document.getElementById('search-classes')?.value.toLowerCase() || '';
            let filtered = classes;
            
            // Aplicar filtro
            if (currentFilter === 'custom') {
                filtered = filtered.filter(c => !c.isDefault);
            } else if (currentFilter === 'default') {
                filtered = filtered.filter(c => c.isDefault);
            } else if (currentFilter === 'favorite') {
                filtered = filtered.filter(c => c.isFavorite);
            }
            
            // Aplicar busca
            if (searchTerm) {
                filtered = filtered.filter(c => 
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.description.toLowerCase().includes(searchTerm)
                );
            }
            
            // Limitar renderização
            filtered = filtered.slice(0, 30);
            
            // Usar DocumentFragment para renderização rápida
            const fragment = document.createDocumentFragment();
            
            filtered.forEach(cls => {
                const element = createClassCard(cls);
                fragment.appendChild(element);
            });
            
            container.innerHTML = '';
            container.appendChild(fragment);
            
            updateStatistics();
        }

        function createClassCard(cls) {
            const div = document.createElement('div');
            div.className = 'class-card bg-theme-bg border border-theme-border p-4 rounded-lg cursor-pointer';
            div.style.borderColor = cls.color;
            
            const attrSum = Object.values(cls.attributes).reduce((a, b) => a + b, 0);
            
            div.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: ${cls.color}20; color: ${cls.color}">
                            <i data-lucide="${cls.icon}" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-white">${cls.name}</h4>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="px-2 py-1 rounded text-xs ${getDifficultyClass(cls.difficulty)}">
                                    ${getDifficultyText(cls.difficulty)}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-1">
                        <button class="p-1 ${cls.isFavorite ? 'text-amber-400' : 'text-theme-muted'}">
                            <i data-lucide="star" class="w-4 h-4 ${cls.isFavorite ? 'fill-current' : ''}"></i>
                        </button>
                    </div>
                </div>
                
                <p class="text-sm text-theme-muted mb-3">${cls.description.substring(0, 80)}...</p>
                
                <div class="mb-3">
                    <div class="flex justify-between text-xs text-white mb-1">
                        <span>Atributos</span>
                        <span>${attrSum} pontos</span>
                    </div>
                </div>
                
                <div class="mt-3 pt-3 border-t border-theme-border flex items-center justify-between text-xs">
                    <span class="text-theme-muted">${cls.usageCount} uso${cls.usageCount !== 1 ? 's' : ''}</span>
                    <button class="px-2 py-1 rounded bg-theme-bg border border-theme-border text-white hover:bg-white/5">
                        Editar
                    </button>
                </div>
            `;
            
            // Adicionar eventos
            div.onclick = () => openClassEditor(cls.id);
            const starBtn = div.querySelector('button');
            starBtn.onclick = (e) => {
                e.stopPropagation();
                toggleFavorite(cls.id);
            };
            
            return div;
        }

        function getDifficultyText(difficulty) {
            const texts = { 'easy': 'Fácil', 'medium': 'Médio', 'hard': 'Difícil', 'expert': 'Especialista' };
            return texts[difficulty] || difficulty;
        }

        function getDifficultyClass(difficulty) {
            const classes = {
                'easy': 'bg-green-900/30 text-green-400 border border-green-800',
                'medium': 'bg-yellow-900/30 text-yellow-400 border border-yellow-800',
                'hard': 'bg-red-900/30 text-red-400 border border-red-800',
                'expert': 'bg-purple-900/30 text-purple-400 border border-purple-800'
            };
            return classes[difficulty] || classes.medium;
        }

        // ====================================================================
        // GERENCIAMENTO DE CLASSES
        // ====================================================================
        
        function openClassEditor(classId = null) {
            if (classId) {
                const cls = classes.find(c => c.id === classId);
                if (!cls) return;
                editingClass = { ...cls };
            } else {
                editingClass = {
                    id: 'custom_' + Date.now(),
                    name: '',
                    description: '',
                    color: COLOR_PALETTE[0],
                    icon: ICON_PALETTE[0],
                    difficulty: 'medium',
                    attributes: { for: 0, dex: 0, con: 0, int: 0, wis: 0, cha: 0 },
                    skills: [],
                    tags: [],
                    isDefault: false,
                    isFavorite: false,
                    usageCount: 0
                };
            }
            
            // Preencher formulário simplificado
            document.getElementById('class-name').value = editingClass.name;
            document.getElementById('class-description').value = editingClass.description;
            document.getElementById('class-difficulty').value = editingClass.difficulty;
            
            // Inicializar paletas
            initColorPalette();
            initIconPalette();
            initAttributes();
            
            // Abrir modal
            document.getElementById('class-editor-modal').classList.remove('hidden');
            updateTotalPoints();
        }

        function closeClassEditor() {
            document.getElementById('class-editor-modal').classList.add('hidden');
            editingClass = null;
        }

        function initColorPalette() {
            const container = document.getElementById('color-palette');
            if (!container) return;
            
            container.innerHTML = COLOR_PALETTE.map(color => `
                <div class="color-option ${editingClass.color === color ? 'border-2 border-white' : ''}" 
                     style="background-color: ${color}"
                     onclick="selectColor('${color}')"></div>
            `).join('');
        }

        function initIconPalette() {
            const container = document.getElementById('icon-palette');
            if (!container) return;
            
            container.innerHTML = ICON_PALETTE.map(icon => `
                <button class="p-2 rounded border ${editingClass.icon === icon ? 'border-current bg-current/20' : 'border-theme-border bg-theme-bg'}" 
                        style="${editingClass.icon === icon ? `border-color: ${editingClass.color}; background-color: ${editingClass.color}20` : ''}"
                        onclick="selectIcon('${icon}')">
                    <i data-lucide="${icon}" class="w-4 h-4 text-white"></i>
                </button>
            `).join('');
            
            lucide.createIcons();
        }

        function initAttributes() {
            const container = document.getElementById('attributes-container');
            const attributes = [
                { key: 'for', name: 'Força' },
                { key: 'dex', name: 'Destreza' },
                { key: 'con', name: 'Constituição' },
                { key: 'int', name: 'Inteligência' },
                { key: 'wis', name: 'Sabedoria' },
                { key: 'cha', name: 'Carisma' }
            ];
            
            container.innerHTML = attributes.map(attr => `
                <div>
                    <div class="flex justify-between mb-1">
                        <span class="font-medium text-white">${attr.name}</span>
                        <span class="font-bold text-white" id="attr-value-${attr.key}">${editingClass.attributes[attr.key] || 0}</span>
                    </div>
                    <input type="range" min="0" max="10" value="${editingClass.attributes[attr.key] || 0}" 
                           class="attr-slider w-full" 
                           oninput="updateAttribute('${attr.key}', this.value)"
                           style="color: ${editingClass.color}">
                </div>
            `).join('');
        }

        function selectColor(color) {
            editingClass.color = color;
            initColorPalette();
            initIconPalette();
            initAttributes();
        }

        function selectIcon(icon) {
            editingClass.icon = icon;
            initIconPalette();
        }

        function updateAttribute(key, value) {
            editingClass.attributes[key] = parseInt(value);
            document.getElementById(`attr-value-${key}`).textContent = value;
            updateTotalPoints();
        }

        function updateTotalPoints() {
            if (!editingClass) return;
            const total = Object.values(editingClass.attributes).reduce((a, b) => a + b, 0);
            const element = document.getElementById('total-points');
            if (element) {
                element.textContent = total;
                element.style.color = total > 20 ? '#ef4444' : total >= 15 ? '#22c55e' : '#f59e0b';
            }
        }

        function addSkill() {
            if (!editingClass.skills) editingClass.skills = [];
            editingClass.skills.push('');
            updateSkillsForm();
        }

        function updateSkillsForm() {
            const container = document.getElementById('skills-container');
            if (!container) return;
            
            container.innerHTML = (editingClass.skills || []).map((skill, index) => `
                <div class="flex gap-2 mb-2">
                    <input type="text" value="${skill}" placeholder="Nome da habilidade..."
                           oninput="editingClass.skills[${index}] = this.value"
                           class="flex-1 bg-theme-bg border border-theme-border rounded-lg px-3 py-2 text-white outline-none focus:border-current text-sm">
                    <button onclick="editingClass.skills.splice(${index}, 1); updateSkillsForm()" 
                            class="px-3 py-2 bg-theme-bg border border-theme-border rounded-lg text-white hover:bg-white/5 text-sm">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function saveClass() {
            if (!editingClass.name.trim()) {
                alert('Por favor, insira um nome para a classe.');
                return;
            }
            
            const index = classes.findIndex(c => c.id === editingClass.id);
            if (index !== -1) {
                classes[index] = { ...editingClass };
            } else {
                classes.unshift(editingClass);
            }
            
            saveClasses();
            renderClasses();
            closeClassEditor();
            showNotification(`Classe "${editingClass.name}" salva!`);
        }

        // ====================================================================
        // FUNÇÕES DE INTERFACE
        // ====================================================================
        
        function filterClasses(filter) {
            currentFilter = filter;
            ['all', 'default', 'custom', 'favorite'].forEach(f => {
                const btn = document.getElementById(`filter-${f}`);
                if (btn) {
                    btn.classList.toggle('bg-theme-purple', f === filter);
                    btn.classList.toggle('bg-theme-bg', f !== filter);
                }
            });
            renderClasses();
        }

        function toggleFavorite(classId) {
            const index = classes.findIndex(c => c.id === classId);
            if (index !== -1) {
                classes[index].isFavorite = !classes[index].isFavorite;
                saveClasses();
                renderClasses();
                updateStatistics();
            }
        }

        function updateStatistics() {
            const total = classes.length;
            const custom = classes.filter(c => !c.isDefault).length;
            const favorites = classes.filter(c => c.isFavorite).length;
            const used = classes.reduce((sum, c) => sum + c.usageCount, 0);
            
            document.getElementById('stats-total').textContent = total;
            document.getElementById('stats-custom').textContent = custom;
            document.getElementById('stats-favorites').textContent = favorites;
            document.getElementById('stats-used').textContent = used;
        }

        function exportClasses() {
            const data = {
                classes: classes.filter(c => !c.isDefault),
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `classes_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Classes exportadas!');
        }

        function importClasses() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.classes) {
                            data.classes.forEach(cls => {
                                cls.id = 'imported_' + Date.now() + '_' + cls.id;
                                cls.isDefault = false;
                                classes.unshift(cls);
                            });
                            
                            saveClasses();
                            renderClasses();
                            showNotification(`${data.classes.length} classes importadas!`);
                        }
                    } catch (error) {
                        showNotification('Erro ao importar arquivo');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetClassSystem() {
            if (confirm('Resetar todas as classes personalizadas?')) {
                localStorage.removeItem('grimorio_custom_classes');
                classes = [...DEFAULT_CLASSES];
                renderClasses();
                showNotification('Sistema resetado!');
            }
        }

        function showNotification(message) {
            // Notificação simples
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 p-4 bg-theme-panel border border-theme-border rounded-lg shadow-lg z-50';
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
                    <span class="text-white">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 3000);
        }

        // ====================================================================
        // EVENT LISTENERS OTIMIZADOS
        // ====================================================================
        
        function setupEventListeners() {
            // Busca com debounce
            const searchInput = document.getElementById('search-classes');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(renderClasses, 300));
            }
            
            // Configurações
            const disableDefault = document.getElementById('disable-default-classes');
            if (disableDefault) {
                disableDefault.addEventListener('change', (e) => {
                    localStorage.setItem('disable_default_classes', e.target.checked);
                    renderClasses();
                });
            }
            
            // Carregar configurações salvas
            const savedDisable = localStorage.getItem('disable_default_classes');
            if (disableDefault && savedDisable) {
                disableDefault.checked = savedDisable === 'true';
            }
        }

        // ====================================================================
        // INICIALIZAÇÃO FINAL
        // ====================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Animação inicial simplificada
            const entries = document.querySelectorAll('.anim-entry');
            entries.forEach((el, i) => {
                el.style.animationDelay = `${i * 0.1}s`;
            });
            
            // Inicializar sistema
            init();
            
            // Forçar um reflow para ativar animações
            setTimeout(() => {
                document.body.style.visibility = 'visible';
            }, 10);
        });

        // Esconder body até carregar
        document.body.style.visibility = 'hidden';
    </script>
</body>
</html>