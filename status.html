<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Sistema de Status Avançado</title>
    <script src="js/grimorio-core.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        :root {
            --bg-primary: #0a0a0c;
            --bg-panel: #0f0f12;
            --border-color: #2a2a2e;
            --text-primary: #e8e4dc;
            --text-secondary: #a0a0a0;
            --accent-blue: #4a9eff;
            --accent-red: #ff4757;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --accent-yellow: #f59e0b;
            --accent-pink: #ec4899;
            --destiny-gold: #d4a76a;
            --status-active: rgba(34, 197, 94, 0.2);
            --status-inactive: rgba(255, 71, 87, 0.2);
            --status-locked: rgba(245, 158, 11, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .font-cinzel { 
            font-family: 'Cinzel', serif; 
            font-weight: 600;
        }
        
        /* NAVBAR */
        .navbar {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }
        
        .back-button {
            padding: 0.5rem 0.75rem;
            background: rgba(74, 158, 255, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(74, 158, 255, 0.3);
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-button {
            padding: 0.5rem 0.75rem;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .nav-button:hover {
            transform: translateY(-1px);
            filter: brightness(110%);
        }
        
        .nav-button-save {
            background: var(--accent-green);
        }
        
        .nav-button-import {
            background: var(--accent-blue);
        }
        
        .nav-button-export {
            background: var(--accent-purple);
        }
        
        /* LAYOUT PRINCIPAL */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            color: var(--accent-blue);
            font-family: 'Cinzel', serif;
            font-size: 1.25rem;
        }
        
        /* SESSÕES */
        .section-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        /* CONTROLE DE CATEGORIAS */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .category-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            position: relative;
        }
        
        .category-card.active {
            border-color: var(--accent-green);
            background: var(--status-active);
        }
        
        .category-card.inactive {
            border-color: var(--accent-red);
            background: var(--status-inactive);
        }
        
        .category-card.locked {
            border-color: var(--accent-yellow);
            background: var(--status-locked);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .category-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .category-info {
            flex: 1;
        }
        
        .category-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .category-value {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin: 0.5rem 0;
        }
        
        .category-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .control-btn {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .control-btn-small {
            padding: 0.125rem 0.25rem;
            font-size: 0.625rem;
        }
        
        .btn-active { background: var(--accent-green); color: white; }
        .btn-inactive { background: var(--accent-red); color: white; }
        .btn-lock { background: var(--accent-yellow); color: white; }
        .btn-unlock { background: var(--accent-blue); color: white; }
        
        /* SISTEMA DE ATRIBUTOS */
        .attributes-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1.5rem;
        }
        
        @media (max-width: 1024px) {
            .attributes-section {
                grid-template-columns: 1fr;
            }
        }
        
        .attributes-controls {
            background: rgba(74, 158, 255, 0.1);
            border: 1px solid rgba(74, 158, 255, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
        }
        
        .attributes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .attribute-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
        }
        
        .attribute-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .attribute-name {
            font-weight: 600;
            flex: 1;
        }
        
        .attribute-value {
            font-size: 1.25rem;
            font-weight: 700;
            text-align: center;
            margin: 0.5rem 0;
        }
        
        .attribute-input {
            width: 100%;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            color: var(--text-primary);
            text-align: center;
            font-size: 1rem;
        }
        
        /* DERIVADOS */
        .derived-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .derived-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
        }
        
        .derived-formula {
            font-family: monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.25rem;
        }
        
        /* SISTEMA DE SORTE */
        .sorcery-system {
            background: linear-gradient(135deg, rgba(26, 21, 16, 0.9), rgba(42, 35, 24, 0.9));
            border: 1px solid rgba(212, 167, 106, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
        }
        
        .sorcery-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--destiny-gold);
            text-align: center;
            margin: 1rem 0;
        }
        
        .sentiments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .sentiment-card {
            background: rgba(26, 21, 16, 0.5);
            border: 1px solid rgba(212, 167, 106, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
        }
        
        .sentiment-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        /* UTILITIES */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        
        /* BOTÕES */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }
        
        .btn-success {
            background: var(--accent-green);
            color: white;
        }
        
        .btn-danger {
            background: var(--accent-red);
            color: white;
        }
        
        .btn-warning {
            background: var(--accent-yellow);
            color: white;
        }
        
        .btn-purple {
            background: var(--accent-purple);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            filter: brightness(110%);
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-panel);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-family: 'Cinzel', serif;
            font-size: 1.25rem;
            color: var(--accent-blue);
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        /* ALERTAS */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: var(--accent-yellow);
        }
        
        /* RESPONSIVO */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .categories-grid,
            .attributes-grid,
            .derived-grid,
            .sentiments-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                gap: 0.25rem;
            }
            
            .nav-button span {
                display: none;
            }
        }
        
        /* ANIMAÇÕES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="flex items-center gap-3">
                <a href="index.html" class="back-button">
                    <i data-lucide="arrow-left"></i>
                    <span class="font-cinzel">Voltar</span>
                </a>
                <h1 class="font-cinzel" style="color: var(--accent-blue);">Sistema de Status Avançado</h1>
            </div>
            
            <div class="nav-buttons">
                <button id="btn-save-all" class="nav-button nav-button-save">
                    <i data-lucide="save"></i>
                    <span>Salvar Tudo</span>
                </button>
                <button id="btn-import" class="nav-button nav-button-import">
                    <i data-lucide="upload"></i>
                    <span>Importar</span>
                </button>
                <button id="btn-export" class="nav-button nav-button-export">
                    <i data-lucide="download"></i>
                    <span>Exportar</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="container">
        <!-- ALERTA DE INFORMAÇÃO -->
        <div class="alert alert-warning mb-6">
            <i data-lucide="alert-triangle"></i>
            Sistema em desenvolvimento - Algumas funcionalidades podem estar em incremento
        </div>

        <!-- 1. CATEGORIAS DE CONTROLE -->
        <section class="section-panel">
            <div class="section-title">
                <div class="flex items-center gap-3">
                    <i data-lucide="heart-pulse"></i>
                    <h2>Categorias de Controle (Máx: 8)</h2>
                </div>
                <button onclick="openCategoryModal()" class="btn btn-primary">
                    <i data-lucide="plus"></i>
                    Adicionar
                </button>
            </div>
            
            <div class="categories-grid" id="categories-container">
                <!-- Categorias serão geradas dinamicamente -->
            </div>
        </section>

        <!-- 2. SISTEMA DE ATRIBUTOS -->
        <section class="section-panel">
            <div class="section-title">
                <div class="flex items-center gap-3">
                    <i data-lucide="activity"></i>
                    <h2>Atributos Principais (Máx: 8)</h2>
                </div>
                <button onclick="openAttributeModal()" class="btn btn-primary">
                    <i data-lucide="plus"></i>
                    Adicionar
                </button>
            </div>
            
            <div class="attributes-section">
                <!-- CONTROLES DE DISTRIBUIÇÃO -->
                <div class="attributes-controls">
                    <h3 class="mb-4" style="color: var(--accent-blue);">Opções de Distribuição</h3>
                    
                    <!-- Opção 1: Sorteio Aleatório -->
                    <div class="mb-4">
                        <h4 class="mb-2">1. Sorteio Aleatório</h4>
                        <div class="flex gap-2 mb-2">
                            <input type="number" id="total-points" placeholder="Total de pontos" 
                                   class="form-input" min="1" max="1000">
                            <button onclick="distributeRandom()" class="btn btn-success">
                                Sortear
                            </button>
                        </div>
                    </div>
                    
                    <!-- Opção 2: Valor Mínimo -->
                    <div class="mb-4">
                        <h4 class="mb-2">2. Valor Mínimo</h4>
                        <div class="flex gap-2 mb-2">
                            <input type="number" id="min-value" placeholder="Valor mínimo" 
                                   class="form-input" min="0" max="100">
                            <button onclick="distributeWithMin()" class="btn btn-warning">
                                Distribuir
                            </button>
                        </div>
                    </div>
                    
                    <!-- Opção 3: Valor Manual -->
                    <div class="mb-4">
                        <h4 class="mb-2">3. Valor Manual</h4>
                        <div class="text-sm mb-2">
                            Defina manualmente e use o cadeado para fixar
                        </div>
                    </div>
                    
                    <!-- Controles Gerais -->
                    <div class="mt-6">
                        <div class="flex gap-2">
                            <button onclick="saveAttributes()" class="btn btn-success flex-1">
                                <i data-lucide="save"></i>
                                Salvar Atributos
                            </button>
                            <button onclick="resetAttributes()" class="btn btn-danger">
                                <i data-lucide="trash-2"></i>
                                Resetar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- LISTA DE ATRIBUTOS -->
                <div class="attributes-grid" id="attributes-container">
                    <!-- Atributos serão gerados dinamicamente -->
                </div>
            </div>
        </section>

        <!-- 3. ATRIBUTOS DERIVADOS -->
        <section class="section-panel">
            <div class="section-title">
                <div class="flex items-center gap-3">
                    <i data-lucide="layers"></i>
                    <h2>Atributos Derivados (Máx: 8)</h2>
                </div>
                <button onclick="openDerivedModal()" class="btn btn-primary">
                    <i data-lucide="plus"></i>
                    Adicionar
                </button>
            </div>
            
            <div class="derived-grid" id="derived-container">
                <!-- Derivados serão gerados dinamicamente -->
            </div>
        </section>

        <!-- 4. SISTEMA DE SORTE -->
        <section class="section-panel">
            <div class="section-title">
                <div class="flex items-center gap-3">
                    <i data-lucide="clover"></i>
                    <h2>Sistema de Sorte (Máx: 8 sentimentos)</h2>
                </div>
                <button onclick="addSentiment()" class="btn btn-primary">
                    <i data-lucide="plus"></i>
                    Adicionar Sentimento
                </button>
            </div>
            
            <div class="sorcery-system">
                <!-- DISPLAY DA SORTE -->
                <div class="text-center mb-6">
                    <div class="text-lg mb-2">Sorte Atual</div>
                    <div class="sorcery-display" id="luck-value">50</div>
                    <div class="flex justify-center gap-3 mt-4">
                        <button onclick="rollLuck()" class="btn btn-warning">
                            <i data-lucide="dice-5"></i>
                            Rolar Sorte
                        </button>
                        <button onclick="saveLuck()" class="btn btn-success">
                            <i data-lucide="save"></i>
                            Salvar Sorte
                        </button>
                    </div>
                </div>
                
                <!-- SENTIMENTOS -->
                <h3 class="mb-3" style="color: var(--destiny-gold);">Modificadores de Sorte</h3>
                <div class="sentiments-grid" id="sentiments-container">
                    <!-- Sentimentos base serão gerados -->
                </div>
            </div>
        </section>

        <!-- CONTROLES FINAIS -->
        <section class="section-panel text-center">
            <h2 class="mb-4" style="color: var(--accent-blue);">Controles do Sistema</h2>
            <div class="flex gap-3 justify-center flex-wrap">
                <button onclick="saveAll()" class="btn btn-success btn-lg">
                    <i data-lucide="save-all"></i>
                    Salvar Tudo no Storage
                </button>
                <button onclick="exportToTXT()" class="btn btn-primary btn-lg">
                    <i data-lucide="file-text"></i>
                    Exportar Ficha (TXT)
                </button>
                <button onclick="generateVisualSheet()" class="btn btn-purple btn-lg">
                    <i data-lucide="download"></i>
                    Baixar Ficha Visual
                </button>
            </div>
        </section>
    </div>

    <!-- MODAL: ADICIONAR CATEGORIA -->
    <div id="modal-category" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Adicionar Categoria</h3>
            
            <div class="form-group">
                <label class="form-label">Nome da Categoria</label>
                <input type="text" id="category-name" class="form-input" placeholder="Ex: Saúde Mental">
            </div>
            
            <div class="form-group">
                <label class="form-label">Valor Inicial</label>
                <input type="number" id="category-value" class="form-input" value="100" min="0" max="1000">
            </div>
            
            <div class="form-group">
                <label class="form-label">Valor Máximo</label>
                <input type="number" id="category-max" class="form-input" value="100" min="0" max="1000">
            </div>
            
            <div class="form-group">
                <label class="form-label">Cor</label>
                <select style="color: #ffffff; font-style:var(--text-primary) ;" id="category-color" class="form-select">
                    <option value="vida">Vermelho (Vida)</option>
                    <option value="mana">Azul (Mana)</option>
                    <option value="estamina">Verde (Estamina)</option>
                    <option value="psicologico">Roxo (Psicológico)</option>
                    <option value="espiritual">Dourado (Espiritual)</option>
                </select>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="closeModal('modal-category')" class="btn flex-1">
                    Cancelar
                </button>
                <button onclick="addCategory()" class="btn btn-success flex-1">
                    Adicionar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: ADICIONAR ATRIBUTO -->
    <div id="modal-attribute" class="modal">
        <div class="modal-content" style="color: #ffffff; font-style:var(--text-primary) ;">
            <h3 class="modal-title">Adicionar Atributo</h3>
            
            <div class="form-group">
                <label class="form-label">Nome do Atributo</label>
                <input type="text" id="attribute-name" class="form-input" placeholder="Ex: Força">
            </div>
            
            <div class="form-group">
                <label class="form-label">Valor Inicial</label>
                <input type="number" id="attribute-value" class="form-input" value="0" min="0" max="100">
            </div>
            
            <div class="form-group">
                <label class="form-label">Valor Máximo</label>
                <input type="number" id="attribute-max" class="form-input" value="100" min="0" max="1000">
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="closeModal('modal-attribute')" class="btn flex-1">
                    Cancelar
                </button>
                <button onclick="addAttribute()" class="btn btn-success flex-1">
                    Adicionar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: ADICIONAR DERIVADO -->
    <div id="modal-derived" class="modal">
        <div class="modal-content" style="color: #ffffff; font-style:var(--text-primary) ;">
            <h3 class="modal-title">Adicionar Atributo Derivado</h3>
            
            <div class="form-group">
                <label class="form-label">Nome</label>
                <input type="text" id="derived-name" class="form-input" placeholder="Ex: Dano Crítico">
            </div>
            
            <div class="form-group">
                <label class="form-label">Atributo Base</label>
                <select id="derived-base" class="form-select">
                    <!-- Opções serão preenchidas dinamicamente -->
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Operação</label>
                <select id="derived-operation" class="form-select" style="color: #fdfdff; font-style:var(--text-primary) ;">
                    <option value="+">Somar (+)</option>
                    <option value="-">Subtrair (-)</option>
                    <option value="*">Multiplicar (*)</option>
                    <option value="/">Dividir (/)</option>
                    <option value="%">Porcentagem (%)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Valor</label>
                <input type="number" id="derived-modifier" class="form-input" value="0" step="0.1">
            </div>
            
            <div class="form-group">
                <label class="form-label">Fórmula Completa</label>
                <input type="text" id="derived-formula" class="form-input" 
                       placeholder="Ex: Força * 1.5 + Destreza * 0.5" readonly>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="closeModal('modal-derived')" class="btn flex-1">
                    Cancelar
                </button>
                <button onclick="addDerived()" class="btn btn-success flex-1">
                    Adicionar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: CONFIGURAR SENTIMENTO -->
    <div id="modal-sentiment" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Configurar Sentimento</h3>
            
            <div class="form-group" style="color: #0a0a0c; font-style:var(--text-primary) ;">
                <label class="form-label">Sentimento</label>
                <select id="sentiment-type" class="form-select">
                    <option value="alegria">Alegria</option>
                    <option value="tristeza">Tristeza</option>
                    <option value="raiva">Raiva</option>
                    <option value="medo">Medo</option>
                    <option value="indiferenca">Indiferença</option>
                    <option value="amor">Amor</option>
                    <option value="custom">Personalizado</option>
                </select>
            </div>
            
            <div class="form-group" id="custom-sentiment-group" style="display: none;">
                <label class="form-label">Nome Personalizado</label>
                <input type="text" id="custom-sentiment-name" class="form-input" placeholder="Nome do sentimento">
            </div>
            
            <div class="form-group" style="color: #0a0a0c; font-style:var(--text-primary) ;">
                <label class="form-label">Efeito</label>
                <select id="sentiment-effect" class="form-select">
                    <option value="buff">Buff (Aumenta sorte)</option>
                    <option value="debuff">Debuff (Reduz sorte)</option>
                    <option value="neutral">Neutro (Não interfere)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Intensidade (0.0 a 1.0)</label>
                <input type="range" id="sentiment-intensity" min="0" max="10" value="5" step="0.1" class="w-full">
                <div class="flex justify-between text-sm">
                    <span>0.0</span>
                    <span id="intensity-value">0.5</span>
                    <span>1.0</span>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="closeModal('modal-sentiment')" class="btn flex-1">
                    Cancelar
                </button>
                <button onclick="saveSentimentConfig()" class="btn btn-success flex-1">
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <script>
    // =========== SISTEMA DE DADOS ===========
    const systemData = {
        // Categorias (máx 8)
        categories: [
            { id: 1, name: "Vida", value: 100, max: 100, color: "vida", active: true, locked: false },
            { id: 2, name: "Mana", value: 100, max: 100, color: "mana", active: true, locked: false },
            { id: 3, name: "Estamina", value: 100, max: 100, color: "estamina", active: true, locked: false }
        ],
        
        // Atributos (máx 8)
        attributes: [
            { id: 1, name: "Força", value: 0, max: 100, locked: false, active: true },
            { id: 2, name: "Destreza", value: 0, max: 100, locked: false, active: true },
            { id: 3, name: "Constituição", value: 0, max: 100, locked: false, active: true },
            { id: 4, name: "Inteligência", value: 0, max: 100, locked: false, active: true },
            { id: 5, name: "Sabedoria", value: 0, max: 100, locked: false, active: true },
            { id: 6, name: "Carisma", value: 0, max: 100, locked: false, active: true }
        ],
        
        // Atributos derivados (máx 8)
        derived: [
            { 
                id: 1, 
                name: "Dano Físico", 
                formula: "Força * 1.5", 
                value: 0,
                operation: "*",
                modifier: 1.5,
                baseAttr: "forca",
                active: true 
            },
            { 
                id: 2, 
                name: "Defesa", 
                formula: "Constituição * 2 + Força * 0.5", 
                value: 0,
                operation: "+",
                modifier: 0.5,
                baseAttr: "constituicao",
                active: true 
            }
        ],
        
        // Sistema de sorte
        luck: {
            value: 50,
            rollHistory: [],
            sentiments: [
                { type: "alegria", effect: "buff", intensity: 0.7, active: true },
                { type: "tristeza", effect: "debuff", intensity: 0.3, active: true },
                { type: "raiva", effect: "buff", intensity: 0.5, active: true },
                { type: "medo", effect: "debuff", intensity: 0.4, active: true },
                { type: "indiferenca", effect: "neutral", intensity: 0.0, active: true },
                { type: "amor", effect: "buff", intensity: 0.8, active: true }
            ]
        },
        
        config: {
            maxCategories: 8,
            maxAttributes: 8,
            maxDerived: 8,
            maxSentiments: 8
        }
    };
    
    // =========== FUNÇÕES DE UTILIDADE ===========
    function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.className = `alert alert-${type}`;
        notification.innerHTML = `
            <i data-lucide="${type === 'success' ? 'check-circle' : 
                           type === 'error' ? 'x-circle' : 
                           type === 'warning' ? 'alert-triangle' : 'info'}"></i>
            <span>${message}</span>
        `;
        
        document.querySelector(".container").prepend(notification);
        lucide.createIcons();
        
        setTimeout(() => notification.remove(), 3000);
    }
    
    function openModal(id) {
        document.getElementById(id).classList.add("active");
    }
    
    function closeModal(id) {
        document.getElementById(id).classList.remove("active");
    }
    
    // =========== SISTEMA DE CATEGORIAS ===========
    function openCategoryModal() {
        if (systemData.categories.length >= systemData.config.maxCategories) {
            showNotification(`Limite de ${systemData.config.maxCategories} categorias atingido!`, "error");
            return;
        }
        openModal("modal-category");
    }
    
    function addCategory() {
        const name = document.getElementById("category-name").value;
        const value = parseInt(document.getElementById("category-value").value);
        const max = parseInt(document.getElementById("category-max").value);
        const color = document.getElementById("category-color").value;
        
        if (!name || isNaN(value) || isNaN(max)) {
            showNotification("Preencha todos os campos corretamente!", "error");
            return;
        }
        
        const newCategory = {
            id: Date.now(),
            name,
            value,
            max,
            color,
            active: true,
            locked: false
        };
        
        systemData.categories.push(newCategory);
        renderCategories();
        closeModal("modal-category");
        showNotification(`Categoria "${name}" adicionada!`, "success");
    }
    
    function toggleCategory(categoryId, action) {
        const category = systemData.categories.find(c => c.id === categoryId);
        if (!category) return;
        
        switch(action) {
            case "active":
                category.active = !category.active;
                break;
            case "lock":
                category.locked = !category.locked;
                break;
            case "delete":
                systemData.categories = systemData.categories.filter(c => c.id !== categoryId);
                break;
        }
        
        renderCategories();
        saveToStorage();
    }
    
    function updateCategoryValue(categoryId, newValue) {
        const category = systemData.categories.find(c => c.id === categoryId);
        if (category && !category.locked) {
            category.value = Math.max(0, Math.min(category.max, newValue));
            renderCategories();
            saveToStorage();
        }
    }
    
    function renderCategories() {
        const container = document.getElementById("categories-container");
        container.innerHTML = "";
        
        systemData.categories.forEach(category => {
            const card = document.createElement("div");
            card.className = `category-card ${category.active ? "active" : "inactive"} ${category.locked ? "locked" : ""}`;
            
            const colorClass = `color-${category.color}`;
            const bgClass = `bg-${category.color}`;
            
            card.innerHTML = `
                <div class="category-header">
                    <div class="category-icon ${bgClass}">
                        <i data-lucide="heart" class="${colorClass}"></i>
                    </div>
                    <div class="category-info">
                        <div class="category-name ${colorClass}">${category.name}</div>
                        <div class="text-sm">${category.active ? "Ativo" : "Inativo"} | ${category.locked ? "Trancado" : "Destrancado"}</div>
                    </div>
                </div>
                
                <div class="category-value ${colorClass}">${category.value}/${category.max}</div>
                
                <input type="range" min="0" max="${category.max}" value="${category.value}" 
                       ${category.locked ? "disabled" : ""} 
                       onchange="updateCategoryValue(${category.id}, parseInt(this.value))"
                       class="w-full">
                
                <div class="category-controls">
                    <button onclick="toggleCategory(${category.id}, 'active')" 
                            class="control-btn ${category.active ? 'btn-inactive' : 'btn-active'}">
                        <i data-lucide="${category.active ? 'pause' : 'play'}"></i>
                        ${category.active ? "Desativar" : "Ativar"}
                    </button>
                    
                    <button onclick="toggleCategory(${category.id}, 'lock')" 
                            class="control-btn ${category.locked ? 'btn-unlock' : 'btn-lock'}">
                        <i data-lucide="${category.locked ? 'unlock' : 'lock'}"></i>
                        ${category.locked ? "Destrancar" : "Trancar"}
                    </button>
                    
                    <button onclick="toggleCategory(${category.id}, 'delete')" 
                            class="control-btn btn-danger">
                        <i data-lucide="trash-2"></i>
                        Remover
                    </button>
                </div>
            `;
            
            container.appendChild(card);
        });
        
        lucide.createIcons();
    }
    
    // =========== SISTEMA DE ATRIBUTOS ===========
    function openAttributeModal() {
        if (systemData.attributes.length >= systemData.config.maxAttributes) {
            showNotification(`Limite de ${systemData.config.maxAttributes} atributos atingido!`, "error");
            return;
        }
        openModal("modal-attribute");
    }
    
    function addAttribute() {
        const name = document.getElementById("attribute-name").value;
        const value = parseInt(document.getElementById("attribute-value").value);
        const max = parseInt(document.getElementById("attribute-max").value);
        
        if (!name || isNaN(value) || isNaN(max)) {
            showNotification("Preencha todos os campos corretamente!", "error");
            return;
        }
        
        const newAttribute = {
            id: Date.now(),
            name,
            value,
            max,
            locked: false,
            active: true
        };
        
        systemData.attributes.push(newAttribute);
        renderAttributes();
        closeModal("modal-attribute");
        showNotification(`Atributo "${name}" adicionado!`, "success");
    }
    
    function distributeRandom() {
        const totalPoints = parseInt(document.getElementById("total-points").value);
        if (!totalPoints || totalPoints <= 0) {
            showNotification("Digite um número válido de pontos!", "error");
            return;
        }
        
        const activeAttributes = systemData.attributes.filter(attr => attr.active);
        if (activeAttributes.length === 0) {
            showNotification("Nenhum atributo ativo para distribuir!", "error");
            return;
        }
        
        // Distribuir aleatoriamente
        let pointsLeft = totalPoints;
        const distribution = {};
        
        while (pointsLeft > 0) {
            const randomIndex = Math.floor(Math.random() * activeAttributes.length);
            const attr = activeAttributes[randomIndex];
            
            if (!attr.locked && attr.value < attr.max) {
                if (!distribution[attr.id]) distribution[attr.id] = 0;
                
                distribution[attr.id]++;
                attr.value = Math.min(attr.max, attr.value + 1);
                pointsLeft--;
            }
        }
        
        renderAttributes();
        updateDerivedAttributes();
        saveToStorage();
        
        const summary = activeAttributes.map(attr => 
            `${attr.name}: ${attr.value}`
        ).join(", ");
        
        showNotification(`${totalPoints} pontos distribuídos: ${summary}`, "success");
    }
    
    function distributeWithMin() {
        const minValue = parseInt(document.getElementById("min-value").value);
        if (isNaN(minValue) || minValue < 0) {
            showNotification("Digite um valor mínimo válido!", "error");
            return;
        }
        
        const activeAttributes = systemData.attributes.filter(attr => attr.active);
        let totalNeeded = 0;
        
        // Primeiro, garantir o mínimo para todos
        activeAttributes.forEach(attr => {
            if (!attr.locked && attr.value < minValue) {
                const needed = minValue - attr.value;
                attr.value = minValue;
                totalNeeded += needed;
            }
        });
        
        // Distribuir o restante aleatoriamente
        const remainingPoints = 100 - (activeAttributes.length * minValue);
        if (remainingPoints > 0) {
            let pointsLeft = remainingPoints;
            while (pointsLeft > 0) {
                const randomIndex = Math.floor(Math.random() * activeAttributes.length);
                const attr = activeAttributes[randomIndex];
                
                if (!attr.locked && attr.value < attr.max) {
                    attr.value = Math.min(attr.max, attr.value + 1);
                    pointsLeft--;
                }
            }
        }
        
        renderAttributes();
        updateDerivedAttributes();
        saveToStorage();
        
        showNotification(`Distribuído com mínimo de ${minValue} para todos os atributos!`, "success");
    }
    
    function saveAttributes() {
        // Salvar os valores atuais dos atributos
        saveToStorage();
        showNotification("Atributos salvos com sucesso!", "success");
    }
    
    function resetAttributes() {
        if (confirm("Resetar todos os atributos para 0? Isso não pode ser desfeito.")) {
            systemData.attributes.forEach(attr => {
                if (!attr.locked) {
                    attr.value = 0;
                }
            });
            
            renderAttributes();
            updateDerivedAttributes();
            saveToStorage();
            showNotification("Atributos resetados!", "info");
        }
    }
    
    function toggleAttribute(attrId, action) {
        const attr = systemData.attributes.find(a => a.id === attrId);
        if (!attr) return;
        
        switch(action) {
            case "active":
                attr.active = !attr.active;
                break;
            case "lock":
                attr.locked = !attr.locked;
                break;
            case "delete":
                systemData.attributes = systemData.attributes.filter(a => a.id !== attrId);
                break;
        }
        
        renderAttributes();
        updateDerivedAttributes();
        saveToStorage();
    }
    
    function updateAttributeValue(attrId, newValue) {
        const attr = systemData.attributes.find(a => a.id === attrId);
        if (attr && !attr.locked) {
            attr.value = Math.max(0, Math.min(attr.max, newValue));
            renderAttributes();
            updateDerivedAttributes();
            saveToStorage();
        }
    }
    
    function renderAttributes() {
        const container = document.getElementById("attributes-container");
        container.innerHTML = "";
        
        systemData.attributes.forEach(attr => {
            const card = document.createElement("div");
            card.className = `attribute-card ${attr.active ? "active" : "inactive"} ${attr.locked ? "locked" : ""}`;
            
            card.innerHTML = `
                <div class="attribute-header">
                    <div class="attribute-name">${attr.name}</div>
                    <div class="flex items-center gap-2">
                        <button onclick="toggleAttribute(${attr.id}, 'lock')" 
                                class="control-btn control-btn-small ${attr.locked ? 'btn-unlock' : 'btn-lock'}">
                            <i data-lucide="${attr.locked ? 'unlock' : 'lock'}"></i>
                        </button>
                        
                        <button onclick="toggleAttribute(${attr.id}, 'active')" 
                                class="control-btn control-btn-small ${attr.active ? 'btn-inactive' : 'btn-active'}">
                            <i data-lucide="${attr.active ? 'pause' : 'play'}"></i>
                        </button>
                    </div>
                </div>
                
                <div class="attribute-value">${attr.value}</div>
                
                <input type="range" min="0" max="${attr.max}" value="${attr.value}" 
                       ${attr.locked ? "disabled" : ""} 
                       onchange="updateAttributeValue(${attr.id}, parseInt(this.value))"
                       class="w-full">
                
                <div class="flex gap-2 mt-2">
                    <input type="number" min="0" max="${attr.max}" value="${attr.value}" 
                           ${attr.locked ? "disabled" : ""}
                           onchange="updateAttributeValue(${attr.id}, parseInt(this.value))"
                           class="attribute-input">
                    
                    <button onclick="toggleAttribute(${attr.id}, 'delete')" 
                            class="control-btn btn-danger">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(card);
        });
        
        lucide.createIcons();
    }
    
    // =========== ATRIBUTOS DERIVADOS ===========
    function openDerivedModal() {
        if (systemData.derived.length >= systemData.config.maxDerived) {
            showNotification(`Limite de ${systemData.config.maxDerived} atributos derivados atingido!`, "error");
            return;
        }
        
        // Preencher opções de atributos base
        const baseSelect = document.getElementById("derived-base");
        baseSelect.innerHTML = "";
        
        systemData.attributes.forEach(attr => {
            const option = document.createElement("option");
            option.value = attr.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            option.textContent = attr.name;
            baseSelect.appendChild(option);
        });
        
        openModal("modal-derived");
    }
    
    function addDerived() {
        const name = document.getElementById("derived-name").value;
        const baseAttr = document.getElementById("derived-base").value;
        const operation = document.getElementById("derived-operation").value;
        const modifier = parseFloat(document.getElementById("derived-modifier").value);
        
        if (!name || !baseAttr || isNaN(modifier)) {
            showNotification("Preencha todos os campos corretamente!", "error");
            return;
        }
        
        const formula = `${getAttributeName(baseAttr)} ${operation} ${modifier}`;
        
        const newDerived = {
            id: Date.now(),
            name,
            formula,
            value: 0,
            operation,
            modifier,
            baseAttr,
            active: true
        };
        
        systemData.derived.push(newDerived);
        updateDerivedAttributes();
        renderDerived();
        closeModal("modal-derived");
        showNotification(`Atributo derivado "${name}" adicionado!`, "success");
    }
    
    function getAttributeName(key) {
        const attr = systemData.attributes.find(a => 
            a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") === key
        );
        return attr ? attr.name : key;
    }
    
    function updateDerivedAttributes() {
        systemData.derived.forEach(derived => {
            if (!derived.active) return;
            
            const baseAttr = systemData.attributes.find(a => 
                a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") === derived.baseAttr
            );
            
            if (!baseAttr) {
                derived.value = 0;
                return;
            }
            
            let result = 0;
            const baseValue = baseAttr.value;
            
            switch(derived.operation) {
                case "+":
                    result = baseValue + derived.modifier;
                    break;
                case "-":
                    result = baseValue - derived.modifier;
                    break;
                case "*":
                    result = baseValue * derived.modifier;
                    break;
                case "/":
                    result = derived.modifier !== 0 ? baseValue / derived.modifier : 0;
                    break;
                case "%":
                    result = (baseValue * derived.modifier) / 100;
                    break;
            }
            
            derived.value = Math.round(result * 100) / 100;
        });
        
        renderDerived();
    }
    
    function toggleDerived(derivedId, action) {
        const derived = systemData.derived.find(d => d.id === derivedId);
        if (!derived) return;
        
        switch(action) {
            case "active":
                derived.active = !derived.active;
                break;
            case "delete":
                systemData.derived = systemData.derived.filter(d => d.id !== derivedId);
                break;
        }
        
        renderDerived();
        saveToStorage();
    }
    
    function renderDerived() {
        const container = document.getElementById("derived-container");
        container.innerHTML = "";
        
        systemData.derived.forEach(derived => {
            const card = document.createElement("div");
            card.className = `derived-card ${derived.active ? "active" : "inactive"}`;
            
            card.innerHTML = `
                <div class="category-header">
                    <div class="category-icon" style="background: rgba(139, 92, 246, 0.2);">
                        <i data-lucide="function" style="color: #8b5cf6;"></i>
                    </div>
                    <div class="category-info">
                        <div class="category-name" style="color: #8b5cf6;">${derived.name}</div>
                        <div class="text-sm">${derived.active ? "Ativo" : "Inativo"}</div>
                    </div>
                </div>
                
                <div class="category-value" style="color: #8b5cf6;">${derived.value}</div>
                
                <div class="derived-formula">
                    Fórmula: ${derived.formula}
                </div>
                
                <div class="category-controls">
                    <button onclick="toggleDerived(${derived.id}, 'active')" 
                            class="control-btn ${derived.active ? 'btn-inactive' : 'btn-active'}">
                        <i data-lucide="${derived.active ? 'pause' : 'play'}"></i>
                        ${derived.active ? "Desativar" : "Ativar"}
                    </button>
                    
                    <button onclick="toggleDerived(${derived.id}, 'delete')" 
                            class="control-btn btn-danger">
                        <i data-lucide="trash-2"></i>
                        Remover
                    </button>
                </div>
            `;
            
            container.appendChild(card);
        });
        
        lucide.createIcons();
    }
    
    // =========== SISTEMA DE SORTE ===========
    function addSentiment() {
        if (systemData.luck.sentiments.length >= systemData.config.maxSentiments) {
            showNotification(`Limite de ${systemData.config.maxSentiments} sentimentos atingido!`, "error");
            return;
        }
        
        document.getElementById("intensity-value").textContent = "0.5";
        document.getElementById("sentiment-intensity").value = 5;
        openModal("modal-sentiment");
    }
    
    function saveSentimentConfig() {
        const type = document.getElementById("sentiment-type").value;
        const effect = document.getElementById("sentiment-effect").value;
        const intensity = parseFloat(document.getElementById("sentiment-intensity").value) / 10;
        
        let name = type;
        if (type === "custom") {
            name = document.getElementById("custom-sentiment-name").value || "Personalizado";
        }
        
        const newSentiment = {
            type: name,
            effect,
            intensity,
            active: true
        };
        
        systemData.luck.sentiments.push(newSentiment);
        renderSentiments();
        closeModal("modal-sentiment");
        showNotification(`Sentimento "${name}" configurado!`, "success");
    }
    
    function rollLuck() {
        // Sorte base aleatória 1-100
        const baseLuck = Math.floor(Math.random() * 100) + 1;
        
        // Aplicar modificadores dos sentimentos ativos
        let finalLuck = baseLuck;
        let modifiersText = [];
        
        systemData.luck.sentiments.forEach(sentiment => {
            if (!sentiment.active || sentiment.effect === "neutral") return;
            
            const modifier = sentiment.intensity * 20; // Convert 0-1 para 0-20
            if (sentiment.effect === "buff") {
                finalLuck += modifier;
                modifiersText.push(`+${modifier.toFixed(1)} (${sentiment.type})`);
            } else if (sentiment.effect === "debuff") {
                finalLuck -= modifier;
                modifiersText.push(`-${modifier.toFixed(1)} (${sentiment.type})`);
            }
        });
        
        // Garantir limites 1-100
        finalLuck = Math.max(1, Math.min(100, Math.round(finalLuck)));
        
        // Salvar no histórico
        systemData.luck.rollHistory.push({
            base: baseLuck,
            final: finalLuck,
            modifiers: modifiersText,
            timestamp: new Date().toLocaleString()
        });
        
        // Atualizar display
        systemData.luck.value = finalLuck;
        document.getElementById("luck-value").textContent = finalLuck;
        
        // Mostrar resultado
        let message = `Sorte: ${finalLuck}%`;
        if (modifiersText.length > 0) {
            message += `\nModificadores: ${modifiersText.join(", ")}`;
        }
        
        showNotification(message, finalLuck > 50 ? "success" : "warning");
        saveToStorage();
    }
    
    function saveLuck() {
        // Salvar configurações de sorte
        saveToStorage();
        showNotification("Configurações de sorte salvas!", "success");
    }
    
    function toggleSentiment(index, action) {
        if (index < 0 || index >= systemData.luck.sentiments.length) return;
        
        const sentiment = systemData.luck.sentiments[index];
        
        switch(action) {
            case "active":
                sentiment.active = !sentiment.active;
                break;
            case "delete":
                systemData.luck.sentiments.splice(index, 1);
                break;
        }
        
        renderSentiments();
        saveToStorage();
    }
    
    function renderSentiments() {
        const container = document.getElementById("sentiments-container");
        container.innerHTML = "";
        
        systemData.luck.sentiments.forEach((sentiment, index) => {
            const card = document.createElement("div");
            card.className = `sentiment-card ${sentiment.active ? "active" : "inactive"}`;
            
            const effectColor = sentiment.effect === "buff" ? "#22c55e" : 
                              sentiment.effect === "debuff" ? "#ff4757" : "#a0a0a0";
            
            card.innerHTML = `
                <div class="category-name" style="color: ${effectColor};">
                    ${sentiment.type}
                </div>
                
                <div class="text-sm mb-2">
                    Efeito: ${sentiment.effect === "buff" ? "Buff" : 
                            sentiment.effect === "debuff" ? "Debuff" : "Neutro"} 
                    | Intensidade: ${sentiment.intensity.toFixed(1)}
                </div>
                
                <div class="sentiment-controls">
                    <button onclick="toggleSentiment(${index}, 'active')" 
                            class="control-btn ${sentiment.active ? 'btn-inactive' : 'btn-active'}">
                        <i data-lucide="${sentiment.active ? 'pause' : 'play'}"></i>
                        ${sentiment.active ? "Desativar" : "Ativar"}
                    </button>
                    
                    <button onclick="toggleSentiment(${index}, 'delete')" 
                            class="control-btn btn-danger">
                        <i data-lucide="trash-2"></i>
                        Remover
                    </button>
                </div>
            `;
            
            container.appendChild(card);
        });
        
        lucide.createIcons();
    }
    
    // =========== CONTROLES GERAIS ===========
    function saveAll() {
        saveToStorage();
        showNotification("Todos os dados foram salvos no storage!", "success");
    }
    
    function exportToTXT() {
        let txtContent = "=== FICHA DO PERSONAGEM ===\n";
        txtContent += `Gerado em: ${new Date().toLocaleString()}\n\n`;
        
        // Categorias
        txtContent += "--- CATEGORIAS ---\n";
        systemData.categories.forEach(cat => {
            if (cat.active) {
                txtContent += `${cat.name}: ${cat.value}/${cat.max} ${cat.locked ? "(Trancado)" : ""}\n`;
            }
        });
        
        // Atributos
        txtContent += "\n--- ATRIBUTOS ---\n";
        systemData.attributes.forEach(attr => {
            if (attr.active) {
                txtContent += `${attr.name}: ${attr.value}/${attr.max} ${attr.locked ? "(Trancado)" : ""}\n`;
            }
        });
        
        // Derivados
        txtContent += "\n--- ATRIBUTOS DERIVADOS ---\n";
        systemData.derived.forEach(derived => {
            if (derived.active) {
                txtContent += `${derived.name}: ${derived.value}\n`;
                txtContent += `  Fórmula: ${derived.formula}\n`;
            }
        });
        
        // Sorte
        txtContent += "\n--- SISTEMA DE SORTE ---\n";
        txtContent += `Sorte Atual: ${systemData.luck.value}%\n`;
        txtContent += "Modificadores Ativos:\n";
        systemData.luck.sentiments.forEach(sent => {
            if (sent.active) {
                txtContent += `  ${sent.type}: ${sent.effect} (${sent.intensity.toFixed(1)})\n`;
            }
        });
        
        // Histórico
        if (systemData.luck.rollHistory.length > 0) {
            txtContent += "\nÚltimas Rolagens:\n";
            const lastRolls = systemData.luck.rollHistory.slice(-3);
            lastRolls.forEach(roll => {
                txtContent += `  ${roll.timestamp}: ${roll.final}% (Base: ${roll.base}%)\n`;
            });
        }
        
        // Criar e baixar arquivo
        const blob = new Blob([txtContent], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "ficha_personagem.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification("Ficha exportada como TXT!", "success");
    }
    
    function generateVisualSheet() {
        showNotification("Funcionalidade em desenvolvimento - Em breve!", "warning");
        // Aqui seria implementada a geração de uma ficha visual em PDF/HTML
    }
    
    // =========== PERSISTÊNCIA ===========
    function saveToStorage() {
        try {
            localStorage.setItem("grimorio_advanced_status", JSON.stringify(systemData));
            console.log("Dados salvos no localStorage");
        } catch (error) {
            console.error("Erro ao salvar:", error);
        }
    }
    
    function loadFromStorage() {
        try {
            const saved = localStorage.getItem("grimorio_advanced_status");
            if (saved) {
                const parsed = JSON.parse(saved);
                Object.assign(systemData, parsed);
                console.log("Dados carregados do localStorage");
            }
        } catch (error) {
            console.error("Erro ao carregar:", error);
        }
    }
    
    // =========== INICIALIZAÇÃO ===========
    document.addEventListener("DOMContentLoaded", function() {
        // Inicializar ícones
        lucide.createIcons();
        
        // Carregar dados salvos
        loadFromStorage();
        
        // Renderizar todos os componentes
        renderCategories();
        renderAttributes();
        updateDerivedAttributes();
        renderDerived();
        renderSentiments();
        
        // Atualizar display da sorte
        document.getElementById("luck-value").textContent = systemData.luck.value;
        
        // Configurar eventos
        document.getElementById("btn-save-all").addEventListener("click", saveAll);
        document.getElementById("btn-import").addEventListener("click", () => {
            showNotification("Importação em desenvolvimento", "warning");
        });
        document.getElementById("btn-export").addEventListener("click", exportToTXT);
        
        // Configurar slider de intensidade
        const intensitySlider = document.getElementById("sentiment-intensity");
        const intensityValue = document.getElementById("intensity-value");
        
        intensitySlider.addEventListener("input", function() {
            intensityValue.textContent = (this.value / 10).toFixed(1);
        });
        
        // Configurar campo personalizado
        const sentimentType = document.getElementById("sentiment-type");
        sentimentType.addEventListener("change", function() {
            const customGroup = document.getElementById("custom-sentiment-group");
            customGroup.style.display = this.value === "custom" ? "block" : "none";
        });
        
        console.log("Sistema de Status Avançado carregado!");
        showNotification("Sistema carregado com sucesso!", "success");
    });
    
    // =========== EVENT LISTENERS ADICIONAIS ===========
    document.addEventListener("keydown", function(e) {
        if (e.key === "Escape") {
            document.querySelectorAll(".modal.active").forEach(modal => {
                modal.classList.remove("active");
            });
        }
    });
    </script>
</body>
</html>