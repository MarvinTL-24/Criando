<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Sistema Avançado de Status</title>
    <!-- SEU SISTEMA DE ARMAZENAMENTO -->
    <script src="js/grimorio-core.js"></script>
    <!-- NO HEADER DO status.html -->
    <script src="js/integration.js"></script>
    <script src="js/status-integration.js"></script>

    <style>
        /* RESET E ESTILOS GLOBAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-smooth: always;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        :root {
            --bg-primary: #0a0a0c;
            --bg-panel: #0f0f12;
            --border-color: #2a2a2e;
            --text-primary: #e8e4dc;
            --text-secondary: #a0a0a0;
            --accent-blue: #4a9eff;
            --accent-orange: #ff6b35;
            --accent-red: #dc2626;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --accent-yellow: #f59e0b;
            --accent-pink: #ec4899;
            --accent-teal: #14b8a6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* UTILITY CLASSES */
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* SCROLLBAR CUSTOMIZADA */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-panel);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }
        
        /* ANIMAÇÕES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .animate-slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .dice-rolling {
            animation: diceRoll 0.8s ease-out;
        }
        
        /* ESTILOS PARA SLIDERS */
        input[type="range"] {
            appearance: none;
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-blue);
            cursor: pointer;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-blue);
            cursor: pointer;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
        }
        
        /* ESTILOS PARA INPUTS NUMBER */
        input[type="number"] {
            appearance: textfield;
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* ESTILOS PARA MODAIS */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal-backdrop.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-backdrop.active .modal-content {
            transform: translateY(0);
        }
        
        /* NOTIFICAÇÕES */
        .status-notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .status-notification-success {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.5);
            color: #86efac;
        }
        
        .status-notification-warning {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.5);
            color: #fde68a;
        }
        
        .status-notification-error {
            background: rgba(220, 38, 38, 0.15);
            border-color: rgba(220, 38, 38, 0.5);
            color: #fca5a5;
        }
        
        .status-notification-info {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.5);
            color: #93c5fd;
        }
        
        .notification-icon {
            width: 1.25rem;
            height: 1.25rem;
        }
        
        .fade-out {
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s ease-out;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ESTILOS PARA CARTÕES DE RECURSOS */
        .card-vida {
            border-color: rgba(220, 38, 38, 0.3) !important;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05)) !important;
        }
        
        .card-mana {
            border-color: rgba(59, 130, 246, 0.3) !important;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05)) !important;
        }
        
        .card-estamina {
            border-color: rgba(34, 197, 94, 0.3) !important;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05)) !important;
        }
        
        .card-sorte {
            border-color: rgba(212, 167, 106, 0.3) !important;
            background: linear-gradient(135deg, rgba(212, 167, 106, 0.1), rgba(139, 115, 85, 0.05)) !important;
        }
        
        .high-roll {
            box-shadow: 0 0 20px rgba(212, 167, 106, 0.5);
            border-color: #d4a76a !important;
        }
        
        /* ESTILOS PARA DERIVADOS */
        .derivado-card {
            transition: all 0.3s ease;
        }
        
        .derivado-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* FEEDBACK */
        .feedback-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
        
        .feedback-item {
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            animation: slideInRight 0.3s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid;
            max-width: 400px;
        }
        
        .feedback-success {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.5);
            color: #86efac;
        }
        
        .feedback-warning {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.5);
            color: #fde68a;
        }
        
        .feedback-error {
            background: rgba(220, 38, 38, 0.15);
            border-color: rgba(220, 38, 38, 0.5);
            color: #fca5a5;
        }
        
        .feedback-info {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.5);
            color: #93c5fd;
        }
        
        /* UTILITY CLASSES */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .inline { display: inline; }
        .inline-block { display: inline-block; }
        .list-disc { list-style-type: disc; }
        .list-inside { list-style-position: inside; }
        .transition-colors { transition: background-color 0.3s, border-color 0.3s; }
        .transition-opacity { transition: opacity 0.3s; }
        .hover\:opacity-90:hover { opacity: 0.9; }
        .fixed { position: fixed; }
        .top-4 { top: 1rem; }
        .right-4 { right: 1rem; }
        .z-50 { z-index: 50; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .cursor-pointer { cursor: pointer; }
        .opacity-70 { opacity: 0.7; }
        .opacity-90 { opacity: 0.9; }
        .capitalize { text-transform: capitalize; }
        .flex-1 { flex: 1; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        
        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        
        @media (max-width: 640px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        }
    </style>
    
    <!-- FONTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- ICONES -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- BARRA DE NAVEGAÇÃO -->
    <nav style="
        position: sticky;
        top: 0;
        background: rgba(15, 15, 18, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
        z-index: 100;
        padding: 1rem 0;
    ">
        <div style="
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        ">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="index.html" style="
                    color: var(--text-primary);
                    text-decoration: none;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" 
                   onmouseout="this.style.backgroundColor='transparent'">
                    <i data-lucide="arrow-left" style="width: 1.25rem; height: 1.25rem;"></i>
                    <span class="font-cinzel" style="font-weight: 600;">Voltar</span>
                </a>
                
                <div style="width: 1px; height: 1.5rem; background: var(--border-color);"></div>
                
                <h1 class="font-cinzel" style="
                    font-size: 1.5rem;
                    font-weight: 700;
                    background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
                    -webkit-background-clip: text;
                    background-clip: text;
                    color: transparent;
                    white-space: nowrap;
                ">
                    Sistema Avançado de Status
                </h1>
            </div>
            
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <button id="btn-importar-txt" style="
                    padding: 0.5rem 1rem;
                    background: linear-gradient(135deg, var(--accent-blue), #0ea5e9);
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.3)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i data-lucide="upload" style="width: 1rem; height: 1rem;"></i>
                    Importar TXT
                </button>
                
                <button id="btn-exportar-txt" style="
                    padding: 0.5rem 1rem;
                    background: linear-gradient(135deg, var(--accent-green), #10b981);
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(34, 197, 94, 0.3)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i data-lucide="download" style="width: 1rem; height: 1rem;"></i>
                    Exportar TXT
                </button>
                
                <!-- BOTÃO DE SINCRONIZAÇÃO COM GRIMÓRIO -->
                <button id="btn-exportar-grimorio" style="
                    padding: 0.5rem 1rem;
                    background: linear-gradient(135deg, #22c55e, #10b981);
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(34, 197, 94, 0.3)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i data-lucide="upload-cloud" style="width: 1rem; height: 1rem;"></i>
                    Sincronizar
                </button>
                
                <button id="btn-config" style="
                    padding: 0.5rem 1rem;
                    background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(139, 92, 246, 0.3)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i data-lucide="settings" style="width: 1rem; height: 1rem;"></i>
                    Configurações
                </button>
                
                <button id="btn-chefe" style="
                    padding: 0.5rem 1rem;
                    background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(139, 92, 246, 0.3)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <i data-lucide="crown" style="width: 1rem; height: 1rem;"></i>
                    Modo Mestre
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main style="
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    ">
        <!-- CABEÇALHO COM INFORMAÇÕES -->
        <header class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            ">
                <!-- CARD DE PONTOS -->
                <div style="
                    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
                    border: 1px solid rgba(59, 130, 246, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                ">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="
                                width: 3rem;
                                height: 3rem;
                                background: rgba(59, 130, 246, 0.2);
                                border-radius: 0.75rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <i data-lucide="star" style="width: 1.5rem; height: 1.5rem; color: var(--accent-blue);"></i>
                            </div>
                            <div>
                                <h3 style="font-weight: 600; color: var(--accent-blue);">Pontos Disponíveis</h3>
                                <p style="color: var(--text-secondary); font-size: 0.875rem;">Para distribuir nos atributos</p>
                            </div>
                        </div>
                        <div id="pontos-disponiveis" style="
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 2.5rem;
                            font-weight: 700;
                            color: var(--accent-blue);
                        ">0</div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Usado/Total</span>
                            <span id="pontos-ratio" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0/0</span>
                        </div>
                        <div style="
                            height: 8px;
                            background: rgba(59, 130, 246, 0.2);
                            border-radius: 4px;
                            overflow: hidden;
                        ">
                            <div id="pontos-bar" style="
                                height: 100%;
                                background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
                                border-radius: 4px;
                                width: 0%;
                                transition: width 0.5s ease;
                            "></div>
                        </div>
                    </div>
                </div>
                
                <!-- CARD DE NÍVEL E XP -->
                <div style="
                    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(220, 38, 38, 0.1));
                    border: 1px solid rgba(245, 158, 11, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                ">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="
                                width: 3rem;
                                height: 3rem;
                                background: rgba(245, 158, 11, 0.2);
                                border-radius: 0.75rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <i data-lucide="trending-up" style="width: 1.5rem; height: 1.5rem; color: var(--accent-yellow);"></i>
                            </div>
                            <div>
                                <h3 style="font-weight: 600; color: var(--accent-yellow);">Nível & XP</h3>
                                <p style="color: var(--text-secondary); font-size: 0.875rem;">Progressão do personagem</p>
                            </div>
                        </div>
                        <div id="nivel-atual" style="
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 2.5rem;
                            font-weight: 700;
                            color: var(--accent-yellow);
                        ">1</div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">XP: <span id="xp-atual">0</span>/<span id="xp-proximo">1000</span></span>
                            <span id="xp-restante" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">1000 restante</span>
                        </div>
                        <div style="
                            height: 8px;
                            background: rgba(245, 158, 11, 0.2);
                            border-radius: 4px;
                            overflow: hidden;
                        ">
                            <div id="xp-bar" style="
                                height: 100%;
                                background: linear-gradient(90deg, var(--accent-yellow), var(--accent-red));
                                border-radius: 4px;
                                width: 0%;
                                transition: width 0.5s ease;
                            "></div>
                        </div>
                        <button id="btn-add-xp" style="
                            margin-top: 1rem;
                            width: 100%;
                            padding: 0.75rem;
                            background: rgba(245, 158, 11, 0.2);
                            color: var(--accent-yellow);
                            border: 1px solid rgba(245, 158, 11, 0.4);
                            border-radius: 0.5rem;
                            font-weight: 600;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 0.5rem;
                            transition: all 0.2s;
                        " onmouseover="this.style.backgroundColor='rgba(245, 158, 11, 0.3)'; this.style.borderColor='rgba(245, 158, 11, 0.6)'" 
                           onmouseout="this.style.backgroundColor='rgba(245, 158, 11, 0.2)'; this.style.borderColor='rgba(245, 158, 11, 0.4)'">
                            <i data-lucide="plus" style="width: 1rem; height: 1rem;"></i>
                            Adicionar XP
                        </button>
                    </div>
                </div>
                
                <!-- CARD DE CONFIGURAÇÕES -->
                <div style="
                    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(20, 184, 166, 0.1));
                    border: 1px solid rgba(34, 197, 94, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                ">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <div style="
                            width: 3rem;
                            height: 3rem;
                            background: rgba(34, 197, 94, 0.2);
                            border-radius: 0.75rem;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        ">
                            <i data-lucide="sliders" style="width: 1.5rem; height: 1.5rem; color: var(--accent-green);"></i>
                        </div>
                        <div>
                            <h3 style="font-weight: 600; color: var(--accent-green);">Configurações do Sistema</h3>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">Limites e regras</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Limite de Pontos</span>
                            <span id="limite-pontos" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Pontos por Nível</span>
                            <span id="pontos-por-nivel" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Mínimo para Aleatório</span>
                            <span id="minimo-aleatorio" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">18</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CONTROLES RÁPIDOS -->
            <div style="
                display: flex;
                flex-wrap: wrap;
                gap: 0.75rem;
                justify-content: center;
                margin-top: 1.5rem;
            ">
                <button id="btn-distribuir-aleatorio" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(139, 92, 246, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="dice-5" style="width: 1.25rem; height: 1.25rem;"></i>
                    Distribuição Aleatória
                </button>
                
                <button id="btn-adicionar-pontos" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-blue), #0ea5e9);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="plus-circle" style="width: 1.25rem; height: 1.25rem;"></i>
                    Adicionar Pontos
                </button>
                
                <button id="btn-subir-nivel" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-green), #10b981);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(34, 197, 94, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="arrow-up" style="width: 1.25rem; height: 1.25rem;"></i>
                    Subir de Nível
                </button>
                
                <button id="btn-reset-tudo" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-red), #ef4444);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(220, 38, 38, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="trash-2" style="width: 1.25rem; height: 1.25rem;"></i>
                    Resetar Tudo
                </button>
            </div>
        </header>

        <!-- SEÇÃO DE RECURSOS VITAIS -->
        <section id="secao-recursos" class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 2px solid var(--border-color);
            ">
                <h2 class="font-cinzel" style="
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: var(--accent-red);
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                ">
                    <i data-lucide="heart" style="width: 1.5rem; height: 1.5rem;"></i>
                    Recursos Vitais
                </h2>
                
                <div style="display: flex; gap: 1rem;">
                    <button onclick="resetarRecursos()" style="
                        padding: 0.5rem 1rem;
                        background: rgba(34, 197, 94, 0.1);
                        color: var(--accent-green);
                        border: 1px solid rgba(34, 197, 94, 0.3);
                        border-radius: 0.5rem;
                        font-weight: 500;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="refresh-cw" style="width: 1rem; height: 1rem;"></i>
                        Restaurar Tudo
                    </button>
                </div>
            </div>
            
            <!-- CARDS DE RECURSOS -->
            <div id="recursos-container" style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
            ">
                <!-- Cards serão gerados por JavaScript -->
            </div>
        </section>

        <!-- SEÇÃO DE SORTE/DESTINO -->
        <section id="secao-sorte" class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 2px solid var(--border-color);
            ">
                <h2 class="font-cinzel" style="
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: #d4a76a;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                ">
                    <i data-lucide="compass" style="width: 1.5rem; height: 1.5rem;"></i>
                    Sistema de Destino
                </h2>
            </div>
            
            <!-- CONTEÚDO DA SORTE -->
            <div id="conteudo-sorte" style="
                background: linear-gradient(135deg, rgba(26, 21, 16, 0.8), rgba(42, 35, 24, 0.8));
                border: 1px solid #8b7355;
                border-radius: 1rem;
                padding: 2rem;
            ">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- DADOS DE SORTE -->
                    <div>
                        <h3 style="font-weight: 600; margin-bottom: 1rem; color: #f4d29a; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="dice-5" style="width: 1.25rem; height: 1.25rem;"></i>
                            Rolagem do Destino
                        </h3>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2 dado-container" id="dado-sorte-1">0</div>
                                <div class="text-sm text-[#8b7355]">Fé</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2 dado-container" id="dado-sorte-2">0</div>
                                <div class="text-sm text-[#8b7355]">Sorte</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2 dado-container" id="dado-sorte-3">0</div>
                                <div class="text-sm text-[#8b7355]">Destino</div>
                            </div>
                        </div>
                        
                        <div class="text-center mb-6">
                            <div class="text-4xl font-bold font-mono text-[#d4a76a]" id="calc-sorte">--</div>
                            <div class="text-sm text-[#8b7355] mt-2" id="calculo-sorte">
                                ((0 + 0) × 2 - 0) ÷ 2 = 0
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <button id="btn-rolar-sorte" style="
                                flex: 1;
                                padding: 0.75rem;
                                background: linear-gradient(135deg, #1a1510, #2a2318);
                                color: #d4a76a;
                                border: 1px solid #8b7355;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 0.5rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.backgroundColor='#2a2318'; this.style.borderColor='#d4a76a';" 
                               onmouseout="this.style.backgroundColor='linear-gradient(135deg, #1a1510, #2a2318)'; this.style.borderColor='#8b7355';">
                                <i data-lucide="dice-5" style="width: 1rem; height: 1rem;"></i>
                                Rolar Destino
                            </button>
                            <button id="btn-fixar-sorte" style="
                                flex: 1;
                                padding: 0.75rem;
                                background: linear-gradient(135deg, #1a1510, #2a2318);
                                color: #d4a76a;
                                border: 1px solid #8b7355;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 0.5rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.backgroundColor='#2a2318'; this.style.borderColor='#d4a76a';" 
                               onmouseout="this.style.backgroundColor='linear-gradient(135deg, #1a1510, #2a2318)'; this.style.borderColor='#8b7355';">
                                <i data-lucide="lock" style="width: 1rem; height: 1rem;"></i>
                                Fixar Destino
                            </button>
                        </div>
                    </div>
                    
                    <!-- RECOMENDAÇÕES -->
                    <div>
                        <h3 style="font-weight: 600; margin-bottom: 1rem; color: #f4d29a; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="target" style="width: 1.25rem; height: 1.25rem;"></i>
                            Recomendações do Destino
                        </h3>
                        
                        <div id="recomendacoes-container" style="
                            background: rgba(26, 21, 16, 0.5);
                            border: 1px solid #8b7355;
                            border-radius: 0.75rem;
                            padding: 1.5rem;
                            min-height: 200px;
                        ">
                            <div style="text-align: center; padding: 2rem; color: #8b7355;">
                                <i data-lucide="compass" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                                <p>Role os dados para revelar seu destino</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SEÇÃO DE ATRIBUTOS -->
        <section id="secao-atributos" class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 2px solid var(--border-color);
            ">
                <h2 class="font-cinzel" style="
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: var(--accent-blue);
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                ">
                    <i data-lucide="activity" style="width: 1.5rem; height: 1.5rem;"></i>
                    Atributos (0-100)
                </h2>
                
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="color: var(--text-secondary);">Total:</span>
                    <span id="total-atributos" style="
                        font-family: 'JetBrains Mono', monospace;
                        font-size: 1.5rem;
                        font-weight: 700;
                        color: var(--accent-blue);
                    ">0</span>
                    <span style="color: var(--text-secondary); font-size: 0.875rem;">/ <span id="limite-total">0</span></span>
                </div>
            </div>
            
            <!-- GRID DE ATRIBUTOS -->
            <div id="atributos-container" style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            ">
                <!-- Atributos serão carregados por JavaScript -->
            </div>
        </section>

        <!-- SEÇÃO DE DERIVADOS AVANÇADOS -->
        <section id="secao-derivados" class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 2px solid var(--border-color);
            ">
                <h2 class="font-cinzel" style="
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: var(--accent-purple);
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                ">
                    <i data-lucide="layers" style="width: 1.5rem; height: 1.5rem;"></i>
                    Derivados Avançados
                </h2>
                
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="calcularTodosDerivados()" style="
                        padding: 0.5rem 1rem;
                        background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                        color: white;
                        border: none;
                        border-radius: 0.5rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="calculator" style="width: 1rem; height: 1rem;"></i>
                        Calcular Todos
                    </button>
                    <button onclick="resetarApenasDerivados()" style="
                        padding: 0.5rem 1rem;
                        background: rgba(245, 158, 11, 0.1);
                        color: var(--accent-yellow);
                        border: 1px solid rgba(245, 158, 11, 0.3);
                        border-radius: 0.5rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="rotate-ccw" style="width: 1rem; height: 1rem;"></i>
                        Resetar
                    </button>
                </div>
            </div>
            
            <!-- GRID DE DERIVADOS -->
            <div id="derivados-container" style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            ">
                <!-- Derivados serão carregados por JavaScript -->
            </div>
        </section>

        <!-- SEÇÃO DE HISTÓRICO E CONTROLES -->
        <section class="animate-fadeIn" style="
            background: linear-gradient(135deg, rgba(30, 30, 40, 0.8), rgba(20, 20, 30, 0.8));
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        ">
            <h3 class="font-cinzel" style="
                font-size: 1.5rem;
                font-weight: 600;
                margin-bottom: 1.5rem;
                color: var(--accent-purple);
                display: flex;
                align-items: center;
                gap: 0.75rem;
            ">
                <i data-lucide="history" style="width: 1.25rem; height: 1.25rem;"></i>
                Histórico e Controles Avançados
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr; gap: 2rem;">
                <!-- CONTROLES DE DISTRIBUIÇÃO -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Distribuição de Pontos</h4>
                    
                    <div style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 1rem;
                        margin-bottom: 1.5rem;
                    ">
                        <div style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid var(--border-color);
                            border-radius: 0.75rem;
                            padding: 1rem;
                        ">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Pontos Mínimos para Aleatório
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-minimo-aleatorio" min="0" max="1000" value="18" 
                                       style="
                                        flex: 1;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <button id="btn-aplicar-minimo" style="
                                    padding: 0.5rem 1rem;
                                    background: var(--accent-purple);
                                    color: white;
                                    border: none;
                                    border-radius: 0.5rem;
                                    font-weight: 500;
                                    cursor: pointer;
                                ">Aplicar</button>
                            </div>
                        </div>
                        
                        <div style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid var(--border-color);
                            border-radius: 0.75rem;
                            padding: 1rem;
                        ">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Pontos por Nível
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-pontos-nivel" min="0" max="100" value="5" 
                                       style="
                                        flex: 1;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <button id="btn-aplicar-pontos-nivel" style="
                                    padding: 0.5rem 1rem;
                                    background: var(--accent-blue);
                                    color: white;
                                    border: none;
                                    border-radius: 0.5rem;
                                    font-weight: 500;
                                    cursor: pointer;
                                ">Aplicar</button>
                            </div>
                        </div>
                        
                        <div style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid var(--border-color);
                            border-radius: 0.75rem;
                            padding: 1rem;
                        ">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Limite Total de Pontos
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-limite-total" min="0" max="10000" value="100" 
                                       style="
                                        flex: 1;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <button id="btn-aplicar-limite" style="
                                    padding: 0.5rem 1rem;
                                    background: var(--accent-green);
                                    color: white;
                                    border: none;
                                    border-radius: 0.5rem;
                                    font-weight: 500;
                                    cursor: pointer;
                                ">Aplicar</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- DISTRIBUIÇÃO ALEATÓRIA AVANÇADA -->
                    <div style="
                        background: rgba(139, 92, 246, 0.1);
                        border: 1px solid rgba(139, 92, 246, 0.3);
                        border-radius: 0.75rem;
                        padding: 1rem;
                        margin-top: 1rem;
                    ">
                        <h5 style="font-weight: 600; margin-bottom: 0.75rem; color: var(--accent-purple); display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="dice-5" style="width: 1rem; height: 1rem;"></i>
                            Distribuição Aleatória Avançada
                        </h5>
                        
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                    Quantidade de Pontos
                                </label>
                                <input type="number" id="input-pontos-aleatorio" min="1" max="1000" value="10" 
                                       style="
                                        width: 100%;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                            </div>
                            
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                    Método de Distribuição
                                </label>
                                <select id="select-metodo-aleatorio" style="
                                    width: 100%;
                                    padding: 0.5rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'Inter', sans-serif;
                                    cursor: pointer;
                                ">
                                    <option value="total">Baseado no Total (≥ 18)</option>
                                    <option value="fixo">Quantidade Fixa</option>
                                    <option value="porcentagem">Porcentagem dos Atributos</option>
                                    <option value="balanceado">Distribuição Balanceada</option>
                                </select>
                            </div>
                            
                            <button id="btn-distribuir-avancado" style="
                                align-self: flex-end;
                                padding: 0.5rem 1.5rem;
                                background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                                color: white;
                                border: none;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            ">
                                <i data-lucide="zap" style="width: 1rem; height: 1rem;"></i>
                                Distribuir
                            </button>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.875rem;">
                            <i data-lucide="info" style="width: 0.875rem; height: 0.875rem; vertical-align: middle; margin-right: 0.25rem;"></i>
                            <span>Atualmente: <span id="status-distribuicao" style="color: var(--accent-yellow); font-weight: 600;">Pendente</span></span>
                        </div>
                    </div>
                </div>
                
                <!-- HISTÓRICO DE AÇÕES -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Histórico Recente</h4>
                    
                    <div id="historico-container" style="
                        background: rgba(0, 0, 0, 0.2);
                        border: 1px solid var(--border-color);
                        border-radius: 0.75rem;
                        padding: 1rem;
                        max-height: 200px;
                        overflow-y: auto;
                    ">
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <i data-lucide="history" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                            <p>Nenhuma ação registrada ainda</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 1rem;">
                        <button id="btn-limpar-historico" style="
                            padding: 0.5rem 1rem;
                            background: rgba(220, 38, 38, 0.1);
                            color: var(--accent-red);
                            border: 1px solid rgba(220, 38, 38, 0.3);
                            border-radius: 0.5rem;
                            font-weight: 500;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                        ">
                            <i data-lucide="trash" style="width: 1rem; height: 1rem;"></i>
                            Limpar Histórico
                        </button>
                        
                        <button id="btn-exportar-dados" style="
                            padding: 0.5rem 1rem;
                            background: rgba(59, 130, 246, 0.1);
                            color: var(--accent-blue);
                            border: 1px solid rgba(59, 130, 246, 0.3);
                            border-radius: 0.5rem;
                            font-weight: 500;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                        ">
                            <i data-lucide="download" style="width: 1rem; height: 1rem;"></i>
                            Exportar Dados
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- RODAPÉ -->
    <footer style="
        border-top: 1px solid var(--border-color);
        padding: 2rem 1rem;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.875rem;
    ">
        <p>Sistema Avançado de Status - Grimório Digital v3.0</p>
        <p style="margin-top: 0.5rem; font-size: 0.75rem;">Modo Mestre: Controle total sobre distribuição de pontos e progressão</p>
    </footer>

    <!-- MODAL DE CONFIGURAÇÕES -->
    <div id="modal-config" class="modal-backdrop">
        <div class="modal-content" style="padding: 2rem;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3 class="font-cinzel" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-blue);">
                    <i data-lucide="settings" style="width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem;"></i>
                    Configurações do Sistema
                </h3>
                <button id="btn-fechar-modal" style="
                    background: none;
                    border: none;
                    color: var(--text-secondary);
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-primary)'" 
                   onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-secondary)'">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            
            <div style="display: grid; gap: 1.5rem;">
                <!-- CONFIGURAÇÕES DE LIMITES -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Limites do Sistema</h4>
                    
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Limite Máximo por Atributo (0-100)
                            </label>
                            <input type="range" id="slider-limite-atributo" min="10" max="100" value="100" 
                                   style="width: 100%; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">10</span>
                                <span id="valor-limite-atributo" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">100</span>
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">100</span>
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Limite Total de Pontos
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-config-limite-total" min="0" max="10000" value="100" 
                                       style="
                                        flex: 1;
                                        padding: 0.75rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <span style="color: var(--text-secondary);">pontos</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CONFIGURAÇÕES DE PROGRESSÃO -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Configurações de Progressão</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Pontos por Nível
                            </label>
                            <input type="number" id="input-config-pontos-nivel" min="0" max="100" value="5" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                XP para Próximo Nível
                            </label>
                            <input type="number" id="input-config-xp-proximo" min="100" max="100000" value="1000" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                    </div>
                </div>
                
                <!-- CONFIGURAÇÕES DE DISTRIBUIÇÃO -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Distribuição Aleatória</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Mínimo para Aleatório
                            </label>
                            <input type="number" id="input-config-minimo-aleatorio" min="0" max="1000" value="18" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Pontos para Distribuir
                            </label>
                            <input type="number" id="input-config-pontos-aleatorio" min="1" max="1000" value="10" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                    </div>
                </div>
                
                <!-- BOTÕES DE AÇÃO -->
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button id="btn-salvar-config" style="
                        flex: 1;
                        padding: 1rem;
                        background: linear-gradient(135deg, var(--accent-green), #10b981);
                        color: white;
                        border: none;
                        border-radius: 0.75rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="save" style="width: 1rem; height: 1rem;"></i>
                        Salvar Configurações
                    </button>
                    
                    <button id="btn-restaurar-padrao" style="
                        flex: 1;
                        padding: 1rem;
                        background: rgba(255, 255, 255, 0.05);
                        color: var(--text-primary);
                        border: 1px solid var(--border-color);
                        border-radius: 0.75rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="rotate-ccw" style="width: 1rem; height: 1rem;"></i>
                        Restaurar Padrão
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE ADICIONAR XP -->
    <div id="modal-xp" class="modal-backdrop">
        <div class="modal-content" style="padding: 2rem; max-width: 400px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3 class="font-cinzel" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-yellow);">
                    <i data-lucide="trending-up" style="width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem;"></i>
                    Adicionar XP
                </h3>
                <button onclick="fecharModal('modal-xp')" style="
                    background: none;
                    border: none;
                    color: var(--text-secondary);
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-primary)'" 
                   onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-secondary)'">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Adicione experiência para progressão do personagem. Ao atingir o XP necessário, você pode subir de nível.
                </p>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                        Quantidade de XP
                    </label>
                    <input type="number" id="input-xp-quantidade" min="0" max="100000" value="100" 
                           style="
                            width: 100%;
                            padding: 0.75rem;
                            background: var(--bg-panel);
                            border: 1px solid var(--border-color);
                            border-radius: 0.5rem;
                            color: var(--text-primary);
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 1.25rem;
                            text-align: center;
                           ">
                </div>
                
                <div style="
                    background: rgba(245, 158, 11, 0.1);
                    border: 1px solid rgba(245, 158, 11, 0.3);
                    border-radius: 0.75rem;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                ">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">XP Atual:</span>
                        <span id="modal-xp-atual" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">XP Necessário:</span>
                        <span id="modal-xp-necessario" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">1000</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Faltam:</span>
                        <span id="modal-xp-faltam" style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--accent-yellow);">1000</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button onclick="fecharModal('modal-xp')" style="
                    flex: 1;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    color: var(--text-primary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                ">
                    Cancelar
                </button>
                
                <button id="btn-confirmar-xp" style="
                    flex: 1;
                    padding: 1rem;
                    background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                ">
                    <i data-lucide="plus" style="width: 1rem; height: 1rem;"></i>
                    Adicionar XP
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE ADICIONAR PONTOS -->
    <div id="modal-pontos" class="modal-backdrop">
        <div class="modal-content" style="padding: 2rem; max-width: 400px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3 class="font-cinzel" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-blue);">
                    <i data-lucide="plus-circle" style="width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem;"></i>
                    Adicionar Pontos
                </h3>
                <button onclick="fecharModal('modal-pontos')" style="
                    background: none;
                    border: none;
                    color: var(--text-secondary);
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-primary)'" 
                   onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-secondary)'">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Adicione pontos para distribuir entre os atributos. O mestre pode adicionar pontos extras ou recompensas.
                </p>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                        Quantidade de Pontos
                    </label>
                    <input type="number" id="input-pontos-quantidade" min="0" max="1000" value="5" 
                           style="
                            width: 100%;
                            padding: 0.75rem;
                            background: var(--bg-panel);
                            border: 1px solid var(--border-color);
                            border-radius: 0.5rem;
                            color: var(--text-primary);
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 1.25rem;
                            text-align: center;
                           ">
                </div>
                
                <div style="
                    background: rgba(59, 130, 246, 0.1);
                    border: 1px solid rgba(59, 130, 246, 0.3);
                    border-radius: 0.75rem;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                ">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Pontos Disponíveis:</span>
                        <span id="modal-pontos-disponiveis" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Limite Total:</span>
                        <span id="modal-limite-total" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">100</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Restantes:</span>
                        <span id="modal-pontos-restantes" style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--accent-blue);">100</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button onclick="fecharModal('modal-pontos')" style="
                    flex: 1;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    color: var(--text-primary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                ">
                    Cancelar
                </button>
                
                <button id="btn-confirmar-pontos" style="
                    flex: 1;
                    padding: 1rem;
                    background: linear-gradient(135deg, var(--accent-blue), #0ea5e9);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                ">
                    <i data-lucide="check" style="width: 1rem; height: 1rem;"></i>
                    Adicionar Pontos
                </button>
            </div>
        </div>
    </div>

    <!-- SISTEMA AVANÇADO DE STATUS -->
    <script>
        // ============================================================
        // SISTEMA AVANÇADO DE STATUS - VERSÃO 3.0
        // ============================================================

        // CONSTANTES E VARIÁVEIS GLOBAIS
        const STATUS_STORAGE_KEY = 'grimorio_status_avancado';
        let statusData = null;
        let historico = [];

        // CLASSE PRINCIPAL DO SISTEMA
        class StatusSystemAvancado {
            // INICIALIZAR SISTEMA
            static init() {
                if (!localStorage.getItem(STATUS_STORAGE_KEY)) {
                    const defaultData = {
                        // ATRIBUTOS (0-100)
                        atributos: {
                            forca: 0,
                            destreza: 0,
                            constituicao: 0,
                            inteligencia: 0,
                            sabedoria: 0,
                            carisma: 0
                        },
                        
                        // SISTEMA DE PONTOS
                        pontosDisponiveis: 0,
                        pontosUsados: 0,
                        limiteTotalPontos: 100,
                        
                        // SISTEMA DE NÍVEL E XP
                        nivel: 1,
                        experiencia: 0,
                        experienciaProximoNivel: 1000,
                        pontosPorNivel: 2,
                        
                        // CONFIGURAÇÕES DO SISTEMA
                        modoMestre: false,
                        limitePorAtributo: 100,
                        minimoParaAleatorio: 18,
                        pontosDistribuicaoAleatoria: 0,
                        metodoDistribuicao: 'total',
                        
                        // HISTÓRICO E METADADOS
                        historico: [],
                        criadoEm: new Date().toISOString(),
                        atualizadoEm: new Date().toISOString(),
                        ultimaDistribuicao: null
                    };
                    
                    localStorage.setItem(STATUS_STORAGE_KEY, JSON.stringify(defaultData));
                    console.log('Sistema avançado inicializado');
                }
            }
            
            // CARREGAR DADOS
            static load() {
                this.init();
                const data = localStorage.getItem(STATUS_STORAGE_KEY);
                return JSON.parse(data);
            }
            
            // SALVAR DADOS
            static save(data) {
                data.atualizadoEm = new Date().toISOString();
                localStorage.setItem(STATUS_STORAGE_KEY, JSON.stringify(data));
                window.dispatchEvent(new CustomEvent('statusAvancadoUpdated'));
                return true;
            }
            
            // ADICIONAR REGISTRO AO HISTÓRICO
            static addHistorico(acao, detalhes) {
                const data = this.load();
                const registro = {
                    data: new Date().toISOString(),
                    acao: acao,
                    detalhes: detalhes,
                    nivel: data.nivel,
                    xp: data.experiencia
                };
                
                data.historico.unshift(registro);
                if (data.historico.length > 50) {
                    data.historico = data.historico.slice(0, 50);
                }
                
                this.save(data);
                return registro;
            }
            
            // ADICIONAR PONTO A UM ATRIBUTO
            static addPoint(atributo, quantidade = 1) {
                const data = this.load();
                
                if (data.atributos[atributo] + quantidade > data.limitePorAtributo) {
                    this.showNotification(`Limite de ${data.limitePorAtributo} atingido para ${atributo}!`, 'error');
                    return false;
                }
                
                const novoTotal = data.pontosUsados + quantidade;
                if (novoTotal > data.limiteTotalPontos) {
                    this.showNotification(`Limite total de ${data.limiteTotalPontos} pontos atingido!`, 'error');
                    return false;
                }
                
                if (!data.modoMestre && data.pontosDisponiveis < quantidade) {
                    this.showNotification('Pontos insuficientes!', 'error');
                    return false;
                }
                
                data.atributos[atributo] += quantidade;
                data.pontosUsados += quantidade;
                
                if (!data.modoMestre) {
                    data.pontosDisponiveis -= quantidade;
                }
                
                this.save(data);
                
                this.addHistorico(
                    'Adicionar ponto',
                    `${quantidade} ponto(s) em ${atributo} (agora: ${data.atributos[atributo]})`
                );
                
                this.showNotification(`${quantidade} ponto(s) adicionado(s) em ${atributo}`, 'success');
                
                this.checkRandomDistribution(data);
                
                return data;
            }
            
            // REMOVER PONTO DE UM ATRIBUTO
            static removePoint(atributo, quantidade = 1) {
                const data = this.load();
                
                if (data.atributos[atributo] >= quantidade) {
                    data.atributos[atributo] -= quantidade;
                    data.pontosUsados -= quantidade;
                    
                    if (!data.modoMestre) {
                        data.pontosDisponiveis += quantidade;
                    }
                    
                    this.save(data);
                    
                    this.addHistorico(
                        'Remover ponto',
                        `${quantidade} ponto(s) removido(s) de ${atributo} (agora: ${data.atributos[atributo]})`
                    );
                    
                    this.showNotification(`${quantidade} ponto(s) removido(s) de ${atributo}`, 'info');
                    return data;
                }
                
                return false;
            }
            
            // ADICIONAR PONTOS DISPONÍVEIS (MESTRE)
            static addPontosDisponiveis(quantidade) {
                const data = this.load();
                data.pontosDisponiveis += parseInt(quantidade);
                this.save(data);
                
                this.addHistorico(
                    'Adicionar pontos',
                    `${quantidade} ponto(s) adicionado(s) ao total disponível`
                );
                
                this.showNotification(`${quantidade} ponto(s) adicionado(s)`, 'success');
                return data;
            }
            
            // VERIFICAR DISTRIBUIÇÃO ALEATÓRIA
            static checkRandomDistribution(data) {
                const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                
                if (totalAtual >= data.minimoParaAleatorio && !data.ultimaDistribuicao) {
                    const pontosDistribuir = data.pontosDistribuicaoAleatoria;
                    const atributos = Object.keys(data.atributos);
                    let pontosRestantes = pontosDistribuir;
                    
                    while (pontosRestantes > 0) {
                        const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                        
                        if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                            data.atributos[attrAleatorio]++;
                            pontosRestantes--;
                        }
                    }
                    
                    data.ultimaDistribuicao = new Date().toISOString();
                    data.pontosUsados += pontosDistribuir;
                    
                    if (!data.modoMestre) {
                        data.pontosDisponiveis = Math.max(0, data.pontosDisponiveis - pontosDistribuir);
                    }
                    
                    this.save(data);
                    
                    this.addHistorico(
                        'Distribuição aleatória',
                        `${pontosDistribuir} ponto(s) distribuído(s) aleatoriamente (total ≥ ${data.minimoParaAleatorio})`
                    );
                    
                    this.showNotification(
                        `🎲 ${pontosDistribuir} pontos distribuídos aleatoriamente!`, 
                        'success'
                    );
                    
                    return true;
                }
                
                return false;
            }
            
            // DISTRIBUIÇÃO ALEATÓRIA AVANÇADA
            static distribuirAleatorioAvancado(quantidade, metodo = 'total') {
                const data = this.load();
                const pontosDistribuir = parseInt(quantidade);
                const atributos = Object.keys(data.atributos);
                
                if (metodo === 'total') {
                    const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                    
                    if (totalAtual >= data.minimoParaAleatorio) {
                        return this.distribuirPontosAleatorios(data, pontosDistribuir);
                    } else {
                        const pontosParaMinimo = data.minimoParaAleatorio - totalAtual;
                        
                        for (let i = 0; i < pontosParaMinimo; i++) {
                            const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                            if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                                data.atributos[attrAleatorio]++;
                            }
                        }
                        
                        return this.distribuirPontosAleatorios(data, pontosDistribuir);
                    }
                } else if (metodo === 'fixo') {
                    return this.distribuirPontosAleatorios(data, pontosDistribuir);
                } else if (metodo === 'porcentagem') {
                    const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                    const pontosDistribuirCalc = Math.floor(totalAtual * (pontosDistribuir / 100));
                    return this.distribuirPontosAleatorios(data, pontosDistribuirCalc);
                } else if (metodo === 'balanceado') {
                    const pontosPorAtributo = Math.floor(pontosDistribuir / atributos.length);
                    const pontosRestantes = pontosDistribuir % atributos.length;
                    
                    atributos.forEach(attr => {
                        data.atributos[attr] = Math.min(
                            data.limitePorAtributo,
                            data.atributos[attr] + pontosPorAtributo
                        );
                    });
                    
                    for (let i = 0; i < pontosRestantes; i++) {
                        const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                        if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                            data.atributos[attrAleatorio]++;
                        }
                    }
                    
                    data.pontosUsados += pontosDistribuir;
                    this.save(data);
                    
                    this.addHistorico(
                        'Distribuição balanceada',
                        `${pontosDistribuir} ponto(s) distribuído(s) balanceadamente`
                    );
                    
                    this.showNotification(
                        `⚖️ ${pontosDistribuir} pontos distribuídos balanceadamente`,
                        'success'
                    );
                    
                    return data;
                }
                
                return false;
            }
            
            // DISTRIBUIR PONTOS ALEATORIAMENTE (FUNÇÃO AUXILIAR)
            static distribuirPontosAleatorios(data, pontosDistribuir) {
                const atributos = Object.keys(data.atributos);
                let pontosRestantes = pontosDistribuir;
                
                while (pontosRestantes > 0) {
                    const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                    
                    if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                        data.atributos[attrAleatorio]++;
                        pontosRestantes--;
                    }
                }
                
                data.pontosUsados += pontosDistribuir;
                data.ultimaDistribuicao = new Date().toISOString();
                this.save(data);
                
                return data;
            }
            
            // ADICIONAR EXPERIÊNCIA
            static addExperiencia(quantidade) {
                const data = this.load();
                const xpAntes = data.experiencia;
                
                data.experiencia += parseInt(quantidade);
                
                let niveisGanhos = 0;
                while (data.experiencia >= data.experienciaProximoNivel) {
                    data.experiencia -= data.experienciaProximoNivel;
                    data.nivel++;
                    niveisGanhos++;
                    
                    data.experienciaProximoNivel = Math.floor(data.experienciaProximoNivel * 1.5);
                    data.pontosDisponiveis += data.pontosPorNivel;
                }
                
                this.save(data);
                
                this.addHistorico(
                    'Adicionar XP',
                    `${quantidade} XP adicionado(s) (nível: ${data.nivel})`
                );
                
                if (niveisGanhos > 0) {
                    this.showNotification(
                        `🎉 Nível ${data.nivel}! +${data.pontosPorNivel * niveisGanhos} pontos ganhos`,
                        'success'
                    );
                } else {
                    this.showNotification(
                        `${quantidade} XP adicionado(s) (faltam ${data.experienciaProximoNivel - data.experiencia} XP para o próximo nível)`,
                        'info'
                    );
                }
                
                return { data, niveisGanhos, xpAntes };
            }
            
            // SUBIR DE NÍVEL MANUALMENTE
            static subirNivel() {
                const data = this.load();
                data.nivel++;
                data.pontosDisponiveis += data.pontosPorNivel;
                data.experiencia = 0;
                
                data.experienciaProximoNivel = Math.floor(data.experienciaProximoNivel * 1.5);
                
                this.save(data);
                
                this.addHistorico(
                    'Subir de nível',
                    `Nível ${data.nivel} alcançado manualmente`
                );
                
                this.showNotification(
                    `⬆️ Nível ${data.nivel}! +${data.pontosPorNivel} pontos ganhos`,
                    'success'
                );
                
                return data;
            }
            
            // ALTERAR CONFIGURAÇÕES
            static updateConfig(config) {
                const data = this.load();
                
                Object.keys(config).forEach(key => {
                    if (data[key] !== undefined) {
                        data[key] = config[key];
                    }
                });
                
                this.save(data);
                
                this.addHistorico(
                    'Atualizar configurações',
                    'Configurações do sistema modificadas'
                );
                
                this.showNotification('Configurações atualizadas com sucesso!', 'success');
                return data;
            }
            
            // ALTERNAR MODO MESTRE
            static toggleModoMestre() {
                const data = this.load();
                data.modoMestre = !data.modoMestre;
                this.save(data);
                
                this.showNotification(
                    `Modo Mestre ${data.modoMestre ? 'ATIVADO' : 'DESATIVADO'}`,
                    data.modoMestre ? 'warning' : 'info'
                );
                
                return data;
            }
            
            // RESETAR TUDO
            static reset() {
                if (confirm('Tem certeza que deseja resetar TODOS os status para 0?\n\nIsso irá resetar atributos, pontos, nível e XP.')) {
                    const data = this.load();
                    
                    Object.keys(data.atributos).forEach(key => {
                        data.atributos[key] = 0;
                    });
                    
                    data.pontosDisponiveis = 0;
                    data.pontosUsados = 0;
                    
                    data.nivel = 1;
                    data.experiencia = 0;
                    data.experienciaProximoNivel = 1000;
                    
                    data.ultimaDistribuicao = null;
                    
                    this.save(data);
                    
                    this.addHistorico(
                        'Resetar tudo',
                        'Todos os status foram resetados para 0'
                    );
                    
                    this.showNotification('Sistema resetado com sucesso!', 'info');
                    return data;
                }
                
                return false;
            }
            
            // EXPORTAR DADOS PARA TXT
            static exportToTxt() {
                const data = this.load();
                const recursos = window.sistemaDerivados ? window.sistemaDerivados.recursos : null;
                const sorte = window.sorteAtual || null;
                
                let txtContent = '=== SISTEMA DE STATUS AVANÇADO ===\n';
                txtContent += `Exportado em: ${new Date().toLocaleString()}\n\n`;
                
                // Atributos
                txtContent += '=== ATRIBUTOS ===\n';
                Object.entries(data.atributos).forEach(([attr, valor]) => {
                    txtContent += `${attr.charAt(0).toUpperCase() + attr.slice(1)}: ${valor}/100\n`;
                });
                txtContent += '\n';
                
                // Pontos e Nível
                txtContent += '=== PONTOS E NÍVEL ===\n';
                txtContent += `Pontos Disponíveis: ${data.pontosDisponiveis}\n`;
                txtContent += `Pontos Usados: ${data.pontosUsados}/${data.limiteTotalPontos}\n`;
                txtContent += `Nível: ${data.nivel}\n`;
                txtContent += `XP: ${data.experiencia}/${data.experienciaProximoNivel}\n`;
                txtContent += `Pontos por Nível: ${data.pontosPorNivel}\n\n`;
                
                // Recursos Vitais
                if (recursos) {
                    txtContent += '=== RECURSOS VITAIS ===\n';
                    txtContent += `Vida: ${recursos.vida.atual}/${recursos.vida.max}\n`;
                    txtContent += `Mana: ${recursos.mana.atual}/${recursos.mana.max}\n`;
                    txtContent += `Estamina: ${recursos.estamina.atual}/${recursos.estamina.max}\n\n`;
                }
                
                // Sorte
                if (sorte !== null) {
                    txtContent += '=== DESTINO ===\n';
                    txtContent += `Destino: ${sorte}%\n`;
                    if (window.dadosSorte) {
                        txtContent += `Dados: Fé=${window.dadosSorte[0]}, Sorte=${window.dadosSorte[1]}, Destino=${window.dadosSorte[2]}\n`;
                    }
                    txtContent += `Fixado: ${window.sorteFixada ? 'Sim' : 'Não'}\n\n`;
                }
                
                // Derivados
                if (window.sistemaDerivados && window.sistemaDerivados.derivados) {
                    txtContent += '=== DERIVADOS AVANÇADOS ===\n';
                    Object.entries(window.sistemaDerivados.derivados).forEach(([key, derivado]) => {
                        if (derivado.ativo) {
                            txtContent += `${key.replace(/([A-Z])/g, ' $1').toUpperCase()}: ${derivado.valor}/${derivado.max}\n`;
                        }
                    });
                    txtContent += '\n';
                }
                
                // Configurações
                txtContent += '=== CONFIGURAÇÕES ===\n';
                txtContent += `Limite por Atributo: ${data.limitePorAtributo}\n`;
                txtContent += `Limite Total: ${data.limiteTotalPontos}\n`;
                txtContent += `Mínimo para Aleatório: ${data.minimoParaAleatorio}\n`;
                txtContent += `Pontos Distribuição Aleatória: ${data.pontosDistribuicaoAleatoria}\n`;
                txtContent += `Modo Mestre: ${data.modoMestre ? 'Ativo' : 'Inativo'}\n`;
                
                return txtContent;
            }
            
            // IMPORTAR DADOS DE TXT
            static importFromTxt(txtContent) {
                try {
                    const lines = txtContent.split('\n');
                    const data = this.load();
                    const novosAtributos = { ...data.atributos };
                    
                    // Regex para capturar valores
                    lines.forEach(line => {
                        // Atributos
                        for (const attr in data.atributos) {
                            const regex = new RegExp(`^${attr}\\s*[=:]\\s*(\\d+)`, 'i');
                            const match = line.match(regex);
                            if (match) {
                                const valor = parseInt(match[1]);
                                novosAtributos[attr] = Math.min(100, Math.max(0, valor));
                                return;
                            }
                        }
                        
                        // Pontos e Nível
                        if (line.toLowerCase().includes('pontos disponíveis')) {
                            const match = line.match(/(\d+)/);
                            if (match) data.pontosDisponiveis = parseInt(match[1]);
                        } else if (line.toLowerCase().includes('nível')) {
                            const match = line.match(/(\d+)/);
                            if (match) data.nivel = parseInt(match[1]);
                        } else if (line.toLowerCase().includes('xp:')) {
                            const match = line.match(/(\d+)\/(\d+)/);
                            if (match) {
                                data.experiencia = parseInt(match[1]);
                                data.experienciaProximoNivel = parseInt(match[2]);
                            }
                        }
                    });
                    
                    // Atualizar atributos
                    data.atributos = novosAtributos;
                    data.pontosUsados = Object.values(novosAtributos).reduce((a, b) => a + b, 0);
                    
                    // Tentar extrair recursos
                    const vidaMatch = txtContent.match(/vida\s*[=:]\s*(\d+)\/(\d+)/i);
                    const manaMatch = txtContent.match(/mana\s*[=:]\s*(\d+)\/(\d+)/i);
                    const estaminaMatch = txtContent.match(/estamina\s*[=:]\s*(\d+)\/(\d+)/i);
                    
                    if (vidaMatch && window.ajustarRecurso) {
                        window.ajustarRecurso('vida', parseInt(vidaMatch[1]));
                        window.ajustarRecurso('vida', parseInt(vidaMatch[1]));
                    }
                    
                    if (manaMatch && window.ajustarRecurso) {
                        window.ajustarRecurso('mana', parseInt(manaMatch[1]));
                    }
                    
                    if (estaminaMatch && window.ajustarRecurso) {
                        window.ajustarRecurso('estamina', parseInt(estaminaMatch[1]));
                    }
                    
                    // Tentar extrair sorte
                    const sorteMatch = txtContent.match(/destino\s*[=:]\s*(\d+)%/i);
                    if (sorteMatch && window.rolarSorte) {
                        const sorteValor = parseInt(sorteMatch[1]);
                        if (window.sorteAtual === null) {
                            // Simular uma rolagem
                            window.sorteAtual = sorteValor;
                            window.dadosSorte = [sorteValor, sorteValor, sorteValor];
                            window.atualizarDisplaySorte();
                            window.gerarRecomendacoesBaseadasNaSorte(sorteValor);
                        }
                    }
                    
                    this.save(data);
                    this.showNotification('Dados importados com sucesso!', 'success');
                    return true;
                    
                } catch (error) {
                    console.error('Erro ao importar dados:', error);
                    this.showNotification('Erro ao importar dados! Formato inválido.', 'error');
                    return false;
                }
            }
            
            // MOSTRAR NOTIFICAÇÃO
            static showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `status-notification status-notification-${type}`;
                notification.innerHTML = `
                    <i data-lucide="${type === 'success' ? 'check-circle' : 
                                    type === 'warning' ? 'alert-triangle' : 
                                    type === 'error' ? 'x-circle' : 'info'}" 
                    class="notification-icon"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                if (window.lucide) {
                    lucide.createIcons();
                }
                
                setTimeout(() => {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 500);
                }, 3000);
                
                return notification;
            }
        }

        // ====================================================================
        // SISTEMA DE SORTE/DERIVADOS
        // ====================================================================

        // Variáveis globais do sistema de sorte
        let sorteAtual = null;
        let dadosSorte = [0, 0, 0];
        let sorteFixada = false;

        // Sistema de derivados avançados
        const sistemaDerivados = {
            derivados: {
                blindagem: { ativo: false, valor: 0, max: 100, cor: '#dc2626', icone: 'shield' },
                velocidade: { ativo: false, valor: 0, max: 100, cor: '#22c55e', icone: 'wind' },
                iniciativa: { ativo: false, valor: 0, max: 100, cor: '#4a9eff', icone: 'zap' },
                percepcao: { ativo: false, valor: 0, max: 100, cor: '#8b5cf6', icone: 'eye' },
                visaoNoturna: { ativo: false, valor: 0, max: 100, cor: '#f59e0b', icone: 'moon' },
                esquiva: { ativo: false, valor: 0, max: 100, cor: '#ec4899', icone: 'move' },
                resistencia: { ativo: false, valor: 0, max: 100, cor: '#14b8a6', icone: 'shield-off' }
            },
            
            recursos: {
                vida: { atual: 100, max: 100, cor: '#dc2626', icone: 'heart' },
                mana: { atual: 100, max: 100, cor: '#4a9eff', icone: 'sparkles' },
                estamina: { atual: 100, max: 100, cor: '#22c55e', icone: 'zap' }
            },
            
            atributos: {
                forca: 0,
                destreza: 0,
                constituicao: 0,
                inteligencia: 0,
                sabedoria: 0,
                carisma: 0
            }
        };

        // FUNÇÕES DO SISTEMA DE SORTE
        function rolarSorte() {
            if (sorteFixada) {
                if (!confirm("O destino está fixado! Deseja rolar novamente e sobrescrever?")) {
                    return;
                }
                sorteFixada = false;
            }
            
            const dado1 = Math.floor(Math.random() * 100) + 1;
            const dado2 = Math.floor(Math.random() * 100) + 1;
            const dado3 = Math.floor(Math.random() * 100) + 1;
            
            dadosSorte = [dado1, dado2, dado3];
            
            const resultadoBruto = ((dado1 + dado3) * 2 - dado2) / 2;
            let resultadoFinal = Math.round(resultadoBruto);
            resultadoFinal = Math.max(1, Math.min(100, resultadoFinal));
            
            sorteAtual = resultadoFinal;
            
            atualizarDisplaySorte();
            
            const secaoSorte = document.getElementById('secao-sorte');
            if (secaoSorte) secaoSorte.style.display = 'block';
            
            gerarRecomendacoesBaseadasNaSorte(sorteAtual);
            salvarSorteNoLocalStorage();
            aplicarEfeitoSorteNosDerivados();
            
            mostrarFeedback(`🎲 Destino rolado: ${sorteAtual}%`, 'success');
        }

        function fixarSorte() {
            sorteFixada = true;
            
            const botaoFixar = document.getElementById('btn-fixar-sorte');
            if (botaoFixar) {
                botaoFixar.innerHTML = '<i data-lucide="check" style="width: 1rem; height: 1rem;"></i> Destino Selado!';
                botaoFixar.style.background = 'linear-gradient(135deg, rgba(139, 115, 85, 0.3), rgba(212, 167, 106, 0.3))';
                botaoFixar.style.borderColor = '#d4a76a';
                botaoFixar.disabled = true;
                if (window.lucide) lucide.createIcons();
            }
            
            const secaoSorte = document.getElementById('secao-sorte');
            if (secaoSorte) {
                secaoSorte.style.borderColor = '#d4a76a';
                secaoSorte.style.boxShadow = '0 0 30px rgba(212, 167, 106, 0.2)';
                setTimeout(() => {
                    secaoSorte.style.boxShadow = '';
                }, 1000);
            }
            
            salvarSorteNoLocalStorage();
            
            let mensagem = '';
            if (sorteAtual >= 75) {
                mensagem = `✨ Destino glorioso fixado em ${sorteAtual}%! A fortuna sorri para você.`;
            } else if (sorteAtual <= 25) {
                mensagem = `🌑 Destino sombrio fixado em ${sorteAtual}%. O caminho será árduo, mas não impossível.`;
            } else {
                mensagem = `⚖️ Destino fixado em ${sorteAtual}%. O equilíbrio está em suas mãos.`;
            }
            
            mostrarFeedback(mensagem, 'success');
        }

        function atualizarDisplaySorte() {
            const cardSorte = document.getElementById('calc-sorte');
            if (cardSorte) {
                cardSorte.textContent = sorteAtual !== null ? `${sorteAtual}%` : '--';
                
                const cardContainer = cardSorte.closest('#conteudo-sorte');
                if (cardContainer) {
                    if (sorteAtual >= 75) {
                        cardContainer.style.borderColor = '#f4d29a';
                        cardContainer.style.boxShadow = '0 0 20px rgba(244, 210, 154, 0.2)';
                    } else if (sorteAtual <= 25) {
                        cardContainer.style.borderColor = '#8b4513';
                        cardContainer.style.boxShadow = '';
                    } else {
                        cardContainer.style.borderColor = '#8b7355';
                        cardContainer.style.boxShadow = '';
                    }
                }
            }
            
            const dadosIds = ['dado-sorte-1', 'dado-sorte-2', 'dado-sorte-3'];
            dadosIds.forEach((id, index) => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.classList.add('dice-rolling');
                    setTimeout(() => {
                        elemento.textContent = dadosSorte[index];
                        
                        const dadoContainer = elemento.closest('.dado-container');
                        if (dadosSorte[index] > 80 && dadoContainer) {
                            dadoContainer.classList.add('high-roll');
                        } else {
                            dadoContainer.classList.remove('high-roll');
                        }
                        
                        setTimeout(() => {
                            elemento.classList.remove('dice-rolling');
                        }, 800);
                    }, 300);
                }
            });
            
            const calculoEl = document.getElementById('calculo-sorte');
            if (calculoEl) {
                const calculo = `((<span style="color: white">${dadosSorte[0]}</span> + <span style="color: white">${dadosSorte[2]}</span>) × 2 - <span style="color: white">${dadosSorte[1]}</span>) ÷ 2 = <span style="color: ${sorteAtual >= 75 ? '#f4d29a' : sorteAtual <= 25 ? '#8b4513' : '#d4a76a'}; font-weight: bold">${sorteAtual}</span>`;
                calculoEl.innerHTML = calculo;
            }
            
            const titulo = document.querySelector('#secao-sorte h2');
            if (titulo) {
                if (sorteAtual >= 75) {
                    titulo.innerHTML = '<i data-lucide="crown" style="width: 1.5rem; height: 1.5rem;"></i> Destino Glorioso';
                } else if (sorteAtual <= 25) {
                    titulo.innerHTML = '<i data-lucide="cloud-rain" style="width: 1.5rem; height: 1.5rem;"></i> Destino Sombrio';
                } else {
                    titulo.innerHTML = '<i data-lucide="compass" style="width: 1.5rem; height: 1.5rem;"></i> Sistema de Destino';
                }
                if (window.lucide) lucide.createIcons();
            }
        }

        function gerarRecomendacoesBaseadasNaSorte(sorte) {
            const container = document.getElementById('recomendacoes-container');
            if (!container) return;
            
            let recomendacao = '';
            let icone = '🎯';
            let titulo = 'DESTINO: ' + sorte + '%';
            
            if (sorte >= 90) {
                recomendacao = 'SORTE LENDÁRIA! Você é abençoado pelos deuses. Armas com crítico máximo são obrigatórias.';
                icone = '✨';
                titulo = '✨ DESTINO GLORIOSO: ' + sorte + '%';
            } else if (sorte >= 75) {
                recomendacao = 'Sorte excelente! Foque em armas com alto dano crítico e efeitos especiais.';
                icone = '🎲';
                titulo = '🎲 DESTINO FAVORÁVEL: ' + sorte + '%';
            } else if (sorte >= 60) {
                recomendacao = 'Sorte acima da média. Armas balanceadas com chance de crítico são ideais.';
                icone = '🍀';
                titulo = '🍀 DESTINO POSITIVO: ' + sorte + '%';
            } else if (sorte >= 40) {
                recomendacao = 'Sorte mediana. Use armas confiáveis com dano constante.';
                icone = '⚖️';
                titulo = '⚖️ DESTINO EQUILIBRADO: ' + sorte + '%';
            } else if (sorte >= 25) {
                recomendacao = 'Sorte abaixo da média. Prefira armas defensivas e equipamentos de proteção.';
                icone = '🛡️';
                titulo = '🛡️ DESTINO DESAFIADOR: ' + sorte + '%';
            } else {
                recomendacao = 'Sorte crítica baixa. Foque em sobrevivência e evite riscos desnecessários.';
                icone = '⚠️';
                titulo = '⚠️ DESTINO SOMBRIO: ' + sorte + '%';
            }
            
            container.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <span style="font-size: 1.5rem;">${icone}</span>
                    <span style="font-family: Cinzel; font-weight: bold; color: #f4d29a;">${titulo}</span>
                </div>
                <p style="color: #d4a76a; margin-bottom: 1rem;">${recomendacao}</p>
                ${sorte >= 75 ? `
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(139, 115, 85, 0.1); border: 1px solid rgba(139, 115, 85, 0.2); border-radius: 0.5rem;">
                    <p style="color: #f4d29a; font-weight: 500; margin-bottom: 0.5rem;">🎯 Armas recomendadas (Alto Crítico):</p>
                    <ul style="color: #d4a76a; font-size: 0.875rem; margin-left: 1rem;">
                        <li>Adagas Gêmeas da Sorte (19-20/x3)</li>
                        <li>Espada Vorpal (18-20/x2)</li>
                        <li>Arco do Acerto Certeiro (x4 crítico)</li>
                    </ul>
                </div>
                ` : ''}
            `;
        }

        function salvarSorteNoLocalStorage() {
            const dadosSorteParaSalvar = {
                valor: sorteAtual,
                dados: dadosSorte,
                fixada: sorteFixada,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('grimorio_sorte', JSON.stringify(dadosSorteParaSalvar));
        }

        function carregarSorteDoLocalStorage() {
            const dadosSalvos = localStorage.getItem('grimorio_sorte');
            if (!dadosSalvos) return;
            
            try {
                const dados = JSON.parse(dadosSalvos);
                sorteAtual = dados.valor;
                dadosSorte = dados.dados || [0, 0, 0];
                sorteFixada = dados.fixada || false;
                
                if (sorteAtual !== null) {
                    atualizarDisplaySorte();
                    
                    if (sorteFixada) {
                        const botaoFixar = document.getElementById('btn-fixar-sorte');
                        if (botaoFixar) {
                            botaoFixar.innerHTML = '<i data-lucide="check" style="width: 1rem; height: 1rem;"></i> Destino Selado!';
                            botaoFixar.disabled = true;
                        }
                    }
                    
                    gerarRecomendacoesBaseadasNaSorte(sorteAtual);
                }
            } catch (error) {
                console.error('Erro ao carregar sorte:', error);
            }
        }

        function configurarEventosSorte() {
            const btnRolar = document.getElementById('btn-rolar-sorte');
            if (btnRolar) {
                btnRolar.addEventListener('click', rolarSorte);
            }
            
            const btnFixar = document.getElementById('btn-fixar-sorte');
            if (btnFixar) {
                btnFixar.addEventListener('click', fixarSorte);
            }
        }

        // FUNÇÕES DO SISTEMA DE RECURSOS
        function renderRecursos() {
            const container = document.getElementById('recursos-container');
            if (!container) return;
            
            const recursos = sistemaDerivados.recursos;
            
            container.innerHTML = Object.entries(recursos).map(([key, recurso]) => {
                const porcentagem = (recurso.atual / recurso.max) * 100;
                const classe = `card-${key}`;
                
                return `
                    <div class="${classe} animate-fadeIn" style="
                        border: 1px solid;
                        border-radius: 1rem;
                        padding: 1.5rem;
                        position: relative;
                        overflow: hidden;
                    ">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="
                                    width: 3rem;
                                    height: 3rem;
                                    background: ${recurso.cor}20;
                                    border-radius: 0.75rem;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                ">
                                    <i data-lucide="${recurso.icone}" style="width: 1.5rem; height: 1.5rem; color: ${recurso.cor};"></i>
                                </div>
                                <div>
                                    <h4 style="
                                        font-weight: 600;
                                        font-size: 1.25rem;
                                        color: ${recurso.cor};
                                        margin-bottom: 0.25rem;
                                        text-transform: capitalize;
                                    ">${key}</h4>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                        Recursos vitais do personagem
                                    </p>
                                </div>
                            </div>
                            
                            <div style="text-align: right;">
                                <div id="${key}-atual" style="
                                    font-family: 'JetBrains Mono', monospace;
                                    font-size: 2.5rem;
                                    font-weight: 700;
                                    color: ${recurso.cor};
                                ">${recurso.atual}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">
                                    / <span id="${key}-max">${recurso.max}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Progresso</span>
                                <span style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: ${recurso.cor};">
                                    ${porcentagem.toFixed(1)}%
                                </span>
                            </div>
                            <div style="
                                height: 8px;
                                background: ${recurso.cor}20;
                                border-radius: 4px;
                                overflow: hidden;
                            ">
                                <div id="barra-${key}" style="
                                    height: 100%;
                                    background: ${recurso.cor};
                                    border-radius: 4px;
                                    width: ${porcentagem}%;
                                    transition: width 0.5s ease;
                                "></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem;">
                            <input type="range" 
                                id="input-${key}"
                                min="0" 
                                max="${recurso.max}" 
                                value="${recurso.atual}" 
                                oninput="ajustarRecurso('${key}', this.value)"
                                style="
                                    width: 100%;
                                    height: 8px;
                                    background: ${recurso.cor}20;
                                    border-radius: 4px;
                            ">
                            <input type="number" 
                                min="0" 
                                max="${recurso.max}" 
                                value="${recurso.atual}"
                                onchange="ajustarRecurso('${key}', this.value)"
                                style="
                                    width: 60px;
                                    padding: 0.25rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.25rem;
                                    color: ${recurso.cor};
                                    font-family: 'JetBrains Mono', monospace;
                                    text-align: center;
                            ">
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // FUNÇÕES DO SISTEMA DE DERIVADOS
        function renderDerivados() {
            const container = document.getElementById('derivados-container');
            if (!container) return;
            
            container.innerHTML = Object.entries(sistemaDerivados.derivados).map(([key, derivado]) => {
                const porcentagem = (derivado.valor / derivado.max) * 100;
                const ativoClass = derivado.ativo ? 'border-opacity-100' : 'border-opacity-30 opacity-70';
                const nomeExibicao = key.replace(/([A-Z])/g, ' $1').toUpperCase();
                
                return `
                    <div class="derivado-card animate-fadeIn" onclick="toggleDerivado('${key}')" style="
                        background: var(--bg-panel);
                        border: 1px solid ${derivado.cor};
                        ${ativoClass ? 'border-opacity: ' + (derivado.ativo ? '1' : '0.3') + ';' : ''}
                        ${!derivado.ativo ? 'opacity: 0.7;' : ''}
                        border-radius: 1rem;
                        padding: 1.5rem;
                        cursor: pointer;
                        transition: all 0.3s;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.3)';" 
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="
                                    width: 3rem;
                                    height: 3rem;
                                    background: ${derivado.cor}20;
                                    border-radius: 0.75rem;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                ">
                                    <i data-lucide="${derivado.icone}" style="width: 1.5rem; height: 1.5rem; color: ${derivado.cor};"></i>
                                </div>
                                <div>
                                    <h4 style="
                                        font-weight: 600;
                                        font-size: 1.25rem;
                                        color: ${derivado.cor};
                                        margin-bottom: 0.25rem;
                                    ">${nomeExibicao}</h4>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                        ${derivado.ativo ? 'Ativo' : 'Inativo'} - ${obterDescricaoDerivado(key)}
                                    </p>
                                </div>
                            </div>
                            
                            <div style="text-align: right;">
                                <div id="valor-${key}" style="
                                    font-family: 'JetBrains Mono', monospace;
                                    font-size: 2.5rem;
                                    font-weight: 700;
                                    color: ${derivado.cor};
                                ">${derivado.valor}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">
                                    / ${derivado.max}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Progresso</span>
                                <span style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: ${derivado.cor};">
                                    ${porcentagem.toFixed(1)}%
                                </span>
                            </div>
                            <div style="
                                height: 8px;
                                background: ${derivado.cor}20;
                                border-radius: 4px;
                                overflow: hidden;
                            ">
                                <div id="barra-${key}" style="
                                    height: 100%;
                                    background: ${derivado.cor};
                                    border-radius: 4px;
                                    width: ${porcentagem}%;
                                    transition: width 0.5s ease;
                                "></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem;">
                            <input type="range" 
                                min="0" 
                                max="${derivado.max}" 
                                value="${derivado.valor}" 
                                oninput="ajustarDerivado('${key}', this.value)"
                                style="
                                    width: 100%;
                                    height: 8px;
                                    background: ${derivado.cor}20;
                                    border-radius: 4px;
                            ">
                            <button onclick="event.stopPropagation(); calcularDerivado('${key}');" style="
                                padding: 0.5rem;
                                background: ${derivado.cor};
                                color: white;
                                border: none;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s;
                            " onmouseover="this.style.opacity='0.9';" 
                               onmouseout="this.style.opacity='1';">
                                <i data-lucide="refresh-cw" style="width: 1rem; height: 1rem;"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function toggleDerivado(key) {
            if (!sistemaDerivados.derivados[key]) return;
            
            sistemaDerivados.derivados[key].ativo = !sistemaDerivados.derivados[key].ativo;
            
            // Atualizar display
            const card = document.querySelector(`[onclick="toggleDerivado('${key}')"]`);
            if (card) {
                if (sistemaDerivados.derivados[key].ativo) {
                    card.style.borderOpacity = '1';
                    card.style.opacity = '1';
                } else {
                    card.style.borderOpacity = '0.3';
                    card.style.opacity = '0.7';
                }
            }
            
            salvarDerivadosNoLocalStorage();
            mostrarFeedback(`${key.replace(/([A-Z])/g, ' $1')} ${sistemaDerivados.derivados[key].ativo ? 'ativado' : 'desativado'}`, 'info');
        }

        function ajustarDerivado(key, valor) {
            if (!sistemaDerivados.derivados[key]) return;
            
            const valorInt = parseInt(valor);
            if (isNaN(valorInt)) return;
            
            sistemaDerivados.derivados[key].valor = Math.max(0, Math.min(valorInt, sistemaDerivados.derivados[key].max));
            
            const valorEl = document.getElementById(`valor-${key}`);
            const barraEl = document.getElementById(`barra-${key}`);
            
            if (valorEl) {
                valorEl.textContent = sistemaDerivados.derivados[key].valor;
            }
            
            if (barraEl) {
                const porcentagem = (sistemaDerivados.derivados[key].valor / sistemaDerivados.derivados[key].max) * 100;
                barraEl.style.width = `${porcentagem}%`;
            }
            
            salvarDerivadosNoLocalStorage();
        }

        function ajustarRecurso(tipo, valor) {
            if (!sistemaDerivados.recursos[tipo]) return;
            
            const valorInt = parseInt(valor);
            if (isNaN(valorInt)) return;
            
            sistemaDerivados.recursos[tipo].atual = Math.max(0, Math.min(valorInt, sistemaDerivados.recursos[tipo].max));
            atualizarDisplayRecurso(tipo);
            salvarDerivadosNoLocalStorage();
        }

        function atualizarDisplayRecurso(tipo) {
            const recurso = sistemaDerivados.recursos[tipo];
            if (!recurso) return;
            
            const atualEl = document.getElementById(`${tipo}-atual`);
            const maxEl = document.getElementById(`${tipo}-max`);
            const barraEl = document.getElementById(`barra-${tipo}`);
            const inputEl = document.getElementById(`input-${tipo}`);
            
            if (atualEl) atualEl.textContent = recurso.atual;
            if (maxEl) maxEl.textContent = recurso.max;
            if (inputEl) inputEl.value = recurso.atual;
            
            if (barraEl) {
                const porcentagem = (recurso.atual / recurso.max) * 100;
                barraEl.style.width = `${porcentagem}%`;
            }
        }

        function calcularDerivado(key) {
            if (!sistemaDerivados.derivados[key]) return;
            
            // Obter atributos atualizados do sistema principal
            const data = StatusSystemAvancado.load();
            const { forca, destreza, constituicao, inteligencia, sabedoria, carisma } = data.atributos;
            const nivel = data.nivel;
            
            let valor = 0;
            let descricao = '';
            
            switch(key) {
                case 'blindagem':
                    const blindagemBase = Math.floor(constituicao * 0.7 + forca * 0.3);
                    valor = Math.floor(blindagemBase * (1 + nivel * 0.1));
                    descricao = `CON(${constituicao})×0.7 + STR(${forca})×0.3 = ${blindagemBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'velocidade':
                    const velocidadeBase = Math.floor(destreza * 0.8 + constituicao * 0.2);
                    valor = Math.floor(velocidadeBase * (1 + nivel * 0.08));
                    descricao = `DEX(${destreza})×0.8 + CON(${constituicao})×0.2 = ${velocidadeBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'iniciativa':
                    const iniciativaBase = Math.floor(destreza * 0.6 + inteligencia * 0.4);
                    valor = Math.floor(iniciativaBase * (1 + nivel * 0.06));
                    descricao = `DEX(${destreza})×0.6 + INT(${inteligencia})×0.4 = ${iniciativaBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'percepcao':
                    const percepcaoBase = Math.floor(sabedoria * 0.7 + inteligencia * 0.3);
                    valor = Math.floor(percepcaoBase * (1 + nivel * 0.07));
                    descricao = `WIS(${sabedoria})×0.7 + INT(${inteligencia})×0.3 = ${percepcaoBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'visaoNoturna':
                    const visaoNoturnaBase = Math.floor((sabedoria + inteligencia) * 0.5);
                    valor = Math.floor(visaoNoturnaBase * (1 + nivel * 0.05));
                    descricao = `(WIS(${sabedoria}) + INT(${inteligencia}))×0.5 = ${visaoNoturnaBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'esquiva':
                    const esquivaBase = Math.floor(destreza * 0.9);
                    valor = Math.floor(esquivaBase * (1 + nivel * 0.12));
                    descricao = `DEX(${destreza})×0.9 = ${esquivaBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'resistencia':
                    const resistenciaBase = Math.floor(constituicao * 0.8);
                    valor = Math.floor(resistenciaBase * (1 + nivel * 0.05));
                    descricao = `CON(${constituicao})×0.8 = ${resistenciaBase} × nível(${nivel}) = ${valor}`;
                    break;
            }
            
            // Aplicar limite máximo
            valor = Math.min(valor, sistemaDerivados.derivados[key].max);
            
            // Aplicar bônus da sorte
            if (sorteAtual !== null) {
                const bonusSorte = Math.floor(valor * (sorteAtual / 500));
                valor += bonusSorte;
                descricao += ` + Sorte(${sorteAtual}%): +${bonusSorte}`;
            }
            
            // Atualizar valor
            sistemaDerivados.derivados[key].valor = valor;
            
            // Atualizar display
            const valorEl = document.getElementById(`valor-${key}`);
            const barraEl = document.getElementById(`barra-${key}`);
            
            if (valorEl) valorEl.textContent = valor;
            if (barraEl) {
                const porcentagem = (valor / sistemaDerivados.derivados[key].max) * 100;
                barraEl.style.width = `${porcentagem}%`;
            }
            
            salvarDerivadosNoLocalStorage();
            mostrarFeedback(`${key.replace(/([A-Z])/g, ' $1')} calculado: ${valor}`, 'success');
        }

        function calcularTodosDerivados() {
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                if (sistemaDerivados.derivados[key].ativo) {
                    calcularDerivado(key);
                }
            });
        }

        function obterDescricaoDerivado(key) {
            const descricoes = {
                blindagem: 'Defesa contra danos físicos',
                velocidade: 'Velocidade de movimento e ataque',
                iniciativa: 'Quem age primeiro no combate',
                percepcao: 'Detectar perigos e detalhes',
                visaoNoturna: 'Ver no escuro',
                esquiva: 'Evitar ataques',
                resistencia: 'Resistir a efeitos e condições'
            };
            
            return descricoes[key] || 'Derivado calculado a partir de atributos e nível';
        }

        function aplicarEfeitoSorteNosDerivados() {
            if (sorteAtual === null) return;
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                if (sistemaDerivados.derivados[key].ativo) {
                    setTimeout(() => calcularDerivado(key), 100);
                }
            });
            
            aplicarBonusSorteRecursos();
        }

        function aplicarBonusSorteRecursos() {
            if (sorteAtual >= 75) {
                Object.keys(sistemaDerivados.recursos).forEach(key => {
                    const bonus = Math.floor(sistemaDerivados.recursos[key].max * 0.1);
                    sistemaDerivados.recursos[key].atual = Math.min(
                        sistemaDerivados.recursos[key].max,
                        sistemaDerivados.recursos[key].atual + bonus
                    );
                });
                
                mostrarFeedback(`✨ Bônus da sorte aplicado! Recursos aumentados.`, 'success');
            } else if (sorteAtual <= 25) {
                Object.keys(sistemaDerivados.recursos).forEach(key => {
                    const penalidade = Math.floor(sistemaDerivados.recursos[key].atual * 0.1);
                    sistemaDerivados.recursos[key].atual = Math.max(
                        0,
                        sistemaDerivados.recursos[key].atual - penalidade
                    );
                });
                
                mostrarFeedback(`🌑 Penalidade da sorte aplicada. Cuidado!`, 'warning');
            }
            
            Object.keys(sistemaDerivados.recursos).forEach(key => {
                atualizarDisplayRecurso(key);
            });
            
            salvarDerivadosNoLocalStorage();
        }

        function salvarDerivadosNoLocalStorage() {
            const dadosParaSalvar = {
                derivados: sistemaDerivados.derivados,
                recursos: sistemaDerivados.recursos,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('grimorio_derivados', JSON.stringify(dadosParaSalvar));
        }

        function carregarDerivadosDoLocalStorage() {
            const dadosSalvos = localStorage.getItem('grimorio_derivados');
            if (!dadosSalvos) return;
            
            try {
                const dados = JSON.parse(dadosSalvos);
                
                if (dados.derivados) {
                    Object.keys(dados.derivados).forEach(key => {
                        if (sistemaDerivados.derivados[key]) {
                            sistemaDerivados.derivados[key] = {
                                ...sistemaDerivados.derivados[key],
                                ...dados.derivados[key]
                            };
                        }
                    });
                }
                
                if (dados.recursos) {
                    Object.keys(dados.recursos).forEach(key => {
                        if (sistemaDerivados.recursos[key]) {
                            sistemaDerivados.recursos[key] = {
                                ...sistemaDerivados.recursos[key],
                                ...dados.recursos[key]
                            };
                        }
                    });
                }
                
                console.log('Derivados carregados do localStorage');
                
            } catch (error) {
                console.error('Erro ao carregar derivados:', error);
            }
        }

        function mostrarFeedback(mensagem, tipo = 'info') {
            let container = document.getElementById('feedback-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'feedback-container';
                container.className = 'feedback-container';
                document.body.appendChild(container);
            }
            
            const feedback = document.createElement('div');
            
            const classes = {
                success: 'feedback-success',
                warning: 'feedback-warning',
                error: 'feedback-error',
                info: 'feedback-info'
            };
            
            feedback.className = `feedback-item ${classes[tipo] || classes.info}`;
            feedback.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${mensagem}</span>
                </div>
            `;
            
            container.appendChild(feedback);
            
            setTimeout(() => {
                feedback.style.opacity = '0';
                feedback.style.transition = 'opacity 0.5s';
                setTimeout(() => feedback.remove(), 500);
            }, 3000);
        }

        function resetarRecursos() {
            if (confirm('Restaurar todos os recursos vitais para o máximo?')) {
                Object.keys(sistemaDerivados.recursos).forEach(key => {
                    sistemaDerivados.recursos[key].atual = sistemaDerivados.recursos[key].max;
                });
                
                renderRecursos();
                salvarDerivadosNoLocalStorage();
                mostrarFeedback('Recursos vitais restaurados!', 'success');
            }
        }

        function resetarApenasDerivados() {
            if (!confirm('Resetar todos os derivados avançados para 0?')) {
                return;
            }
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                sistemaDerivados.derivados[key].valor = 0;
            });
            
            renderDerivados();
            salvarDerivadosNoLocalStorage();
            mostrarFeedback('Derivados resetados!', 'info');
        }

        function resetarDerivadosAvancados() {
            if (!confirm('Resetar TODOS os derivados avançados?\n\nIsso incluirá blindagem, velocidade, etc.')) {
                return;
            }
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                sistemaDerivados.derivados[key].valor = 0;
                sistemaDerivados.derivados[key].ativo = false;
            });
            
            renderDerivados();
            salvarDerivadosNoLocalStorage();
            mostrarFeedback('Derivados avançados resetados!', 'success');
        }

        // ====================================================================
        // INTERFACE DO USUÁRIO (SISTEMA PRINCIPAL)
        // ====================================================================

        // CARREGAR DADOS DO SISTEMA
        function loadStatusData() {
            statusData = StatusSystemAvancado.load();
            renderAtributos(statusData);
            updateUI(statusData);
            renderHistorico(statusData.historico);
            
            // Atualizar recursos e derivados com dados do sistema principal
            sistemaDerivados.atributos = { ...statusData.atributos };
            
            // Renderizar recursos e derivados
            renderRecursos();
            renderDerivados();
        }

        // RENDERIZAR ATRIBUTOS
        function renderAtributos(data) {
            const container = document.getElementById('atributos-container');
            const atributos = data.atributos;
            
            const config = {
                forca: { 
                    nome: 'Força', 
                    cor: '#dc2626', 
                    icone: 'sword',
                    descricao: 'Poder físico, capacidade de carga, dano corpo-a-corpo'
                },
                destreza: { 
                    nome: 'Destreza', 
                    cor: '#22c55e', 
                    icone: 'wind',
                    descricao: 'Agilidade, reflexos, precisão, ataques à distância'
                },
                constituicao: { 
                    nome: 'Constituição', 
                    cor: '#f59e0b', 
                    icone: 'shield',
                    descricao: 'Resistência, saúde, recuperação, tolerância a dano'
                },
                inteligencia: { 
                    nome: 'Inteligência', 
                    cor: '#4a9eff', 
                    icone: 'brain',
                    descricao: 'Conhecimento, lógica, magias arcanas, análise'
                },
                sabedoria: { 
                    nome: 'Sabedoria', 
                    cor: '#8b5cf6', 
                    icone: 'eye',
                    descricao: 'Percepção, intuição, magias divinas, sobrevivência'
                },
                carisma: { 
                    nome: 'Carisma', 
                    cor: '#ec4899', 
                    icone: 'sparkles',
                    descricao: 'Persuasão, liderança, interação social, presença'
                }
            };
            
            container.innerHTML = Object.keys(atributos).map(attr => {
                const cfg = config[attr];
                const porcentagem = (atributos[attr] / data.limitePorAtributo) * 100;
                const isNearLimit = atributos[attr] >= data.limitePorAtributo * 0.9;
                
                return `
                    <div class="atributo-card animate-fadeIn" style="
                        background: var(--bg-panel);
                        border: 2px solid ${cfg.cor}40;
                        border-radius: 1rem;
                        padding: 1.5rem;
                        transition: all 0.3s;
                        position: relative;
                        overflow: hidden;
                    " onmouseover="this.style.borderColor='${cfg.cor}80'; this.style.transform='translateY(-2px)';" 
                    onmouseout="this.style.borderColor='${cfg.cor}40'; this.style.transform='translateY(0)';">
                        
                        ${isNearLimit ? `
                        <div style="
                            position: absolute;
                            top: 0.5rem;
                            right: 0.5rem;
                            background: rgba(220, 38, 38, 0.9);
                            color: white;
                            padding: 0.25rem 0.5rem;
                            border-radius: 0.5rem;
                            font-size: 0.75rem;
                            font-weight: 600;
                            z-index: 2;
                        ">
                            <i data-lucide="alert-triangle" style="width: 0.75rem; height: 0.75rem; vertical-align: middle;"></i>
                            Limite
                        </div>
                        ` : ''}
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="
                                    width: 3rem;
                                    height: 3rem;
                                    background: ${cfg.cor}20;
                                    border-radius: 0.75rem;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                ">
                                    <i data-lucide="${cfg.icone}" style="width: 1.5rem; height: 1.5rem; color: ${cfg.cor};"></i>
                                </div>
                                <div>
                                    <h4 style="
                                        font-weight: 600;
                                        font-size: 1.25rem;
                                        color: ${cfg.cor};
                                        margin-bottom: 0.25rem;
                                    ">${cfg.nome}</h4>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                        ${cfg.descricao}
                                    </p>
                                </div>
                            </div>
                            
                            <div style="text-align: right;">
                                <div id="valor-${attr}" style="
                                    font-family: 'JetBrains Mono', monospace;
                                    font-size: 2.5rem;
                                    font-weight: 700;
                                    color: ${cfg.cor};
                                ">${atributos[attr]}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">
                                    / ${data.limitePorAtributo}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Progresso</span>
                                <span style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: ${cfg.cor};">
                                    ${porcentagem.toFixed(1)}%
                                </span>
                            </div>
                            <div style="
                                height: 8px;
                                background: ${cfg.cor}20;
                                border-radius: 4px;
                                overflow: hidden;
                            ">
                                <div style="
                                    height: 100%;
                                    background: ${cfg.cor};
                                    border-radius: 4px;
                                    width: ${porcentagem}%;
                                    transition: width 0.5s ease;
                                "></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                            <button onclick="removerPontoAvancado('${attr}')" style="
                                padding: 0.75rem;
                                background: ${cfg.cor}20;
                                color: ${cfg.cor};
                                border: 1px solid ${cfg.cor}40;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 0.5rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.backgroundColor='${cfg.cor}30'; this.style.borderColor='${cfg.cor}60';" 
                            onmouseout="this.style.backgroundColor='${cfg.cor}20'; this.style.borderColor='${cfg.cor}40';">
                                <i data-lucide="minus" style="width: 1rem; height: 1rem;"></i>
                                Remover
                            </button>
                            
                            <button onclick="adicionarPontoAvancado('${attr}')" style="
                                padding: 0.75rem;
                                background: ${cfg.cor};
                                color: white;
                                border: none;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 0.5rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.backgroundColor='${cfg.cor}90'; this.style.transform='translateY(-1px)';" 
                            onmouseout="this.style.backgroundColor='${cfg.cor}'; this.style.transform='translateY(0)';">
                                <i data-lucide="plus" style="width: 1rem; height: 1rem;"></i>
                                Adicionar
                            </button>
                        </div>
                        
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <i data-lucide="sliders" style="width: 1rem; height: 1rem; color: ${cfg.cor};"></i>
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Ajuste preciso</span>
                            </div>
                            <input type="range" 
                                min="0" 
                                max="${data.limitePorAtributo}" 
                                value="${atributos[attr]}" 
                                oninput="atualizarSliderAvancado('${attr}', this.value)"
                                style="
                                    width: 100%;
                                    height: 8px;
                                    background: ${cfg.cor}20;
                                    border-radius: 4px;
                            ">
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.75rem;">0</span>
                                <span style="color: var(--text-secondary); font-size: 0.75rem;">${data.limitePorAtributo}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // ATUALIZAR INTERFACE
        function updateUI(data) {
            document.getElementById('pontos-disponiveis').textContent = data.pontosDisponiveis;
            document.getElementById('pontos-ratio').textContent = `${data.pontosUsados}/${data.limiteTotalPontos}`;
            
            const pontosPercent = (data.pontosUsados / data.limiteTotalPontos) * 100;
            document.getElementById('pontos-bar').style.width = `${pontosPercent}%`;
            
            document.getElementById('nivel-atual').textContent = data.nivel;
            document.getElementById('xp-atual').textContent = data.experiencia;
            document.getElementById('xp-proximo').textContent = data.experienciaProximoNivel;
            document.getElementById('xp-restante').textContent = `${data.experienciaProximoNivel - data.experiencia} restante`;
            
            const xpPercent = (data.experiencia / data.experienciaProximoNivel) * 100;
            document.getElementById('xp-bar').style.width = `${xpPercent}%`;
            
            document.getElementById('limite-pontos').textContent = data.limiteTotalPontos;
            document.getElementById('pontos-por-nivel').textContent = data.pontosPorNivel;
            document.getElementById('minimo-aleatorio').textContent = data.minimoParaAleatorio;
            document.getElementById('limite-total').textContent = data.limiteTotalPontos;
            
            const total = Object.values(data.atributos).reduce((a, b) => a + b, 0);
            document.getElementById('total-atributos').textContent = total;
            
            const btnChefe = document.getElementById('btn-chefe');
            if (data.modoMestre) {
                btnChefe.innerHTML = '<i data-lucide="crown" style="width: 1rem; height: 1rem;"></i> Modo Mestre (ATIVO)';
                btnChefe.style.background = 'linear-gradient(135deg, #f59e0b, #dc2626)';
            } else {
                btnChefe.innerHTML = '<i data-lucide="crown" style="width: 1rem; height: 1rem;"></i> Modo Mestre';
                btnChefe.style.background = 'linear-gradient(135deg, var(--accent-purple), var(--accent-pink))';
            }
            
            const statusDistribuicao = document.getElementById('status-distribuicao');
            if (data.ultimaDistribuicao) {
                statusDistribuicao.textContent = 'Concluída';
                statusDistribuicao.style.color = '#22c55e';
            } else {
                const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                if (totalAtual >= data.minimoParaAleatorio) {
                    statusDistribuicao.textContent = 'Pronto!';
                    statusDistribuicao.style.color = '#dc2626';
                } else {
                    statusDistribuicao.textContent = `Faltam ${data.minimoParaAleatorio - totalAtual} pontos`;
                    statusDistribuicao.style.color = '#f59e0b';
                }
            }
            
            document.getElementById('modal-xp-atual').textContent = data.experiencia;
            document.getElementById('modal-xp-necessario').textContent = data.experienciaProximoNivel;
            document.getElementById('modal-xp-faltam').textContent = data.experienciaProximoNivel - data.experiencia;
            
            document.getElementById('modal-pontos-disponiveis').textContent = data.pontosDisponiveis;
            document.getElementById('modal-limite-total').textContent = data.limiteTotalPontos;
            document.getElementById('modal-pontos-restantes').textContent = data.limiteTotalPontos - data.pontosUsados;
            
            document.getElementById('input-minimo-aleatorio').value = data.minimoParaAleatorio;
            document.getElementById('input-pontos-nivel').value = data.pontosPorNivel;
            document.getElementById('input-limite-total').value = data.limiteTotalPontos;
            document.getElementById('input-pontos-aleatorio').value = data.pontosDistribuicaoAleatoria;
            document.getElementById('select-metodo-aleatorio').value = data.metodoDistribuicao;
            
            document.getElementById('input-config-limite-total').value = data.limiteTotalPontos;
            document.getElementById('input-config-pontos-nivel').value = data.pontosPorNivel;
            document.getElementById('input-config-xp-proximo').value = data.experienciaProximoNivel;
            document.getElementById('input-config-minimo-aleatorio').value = data.minimoParaAleatorio;
            document.getElementById('input-config-pontos-aleatorio').value = data.pontosDistribuicaoAleatoria;
            document.getElementById('slider-limite-atributo').value = data.limitePorAtributo;
            document.getElementById('valor-limite-atributo').textContent = data.limitePorAtributo;
        }

        // RENDERIZAR HISTÓRICO
        function renderHistorico(historico) {
            const container = document.getElementById('historico-container');
            
            if (historico.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i data-lucide="history" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                        <p>Nenhuma ação registrada ainda</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = historico.map((item, index) => {
                const data = new Date(item.data);
                const hora = data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                let icone = 'circle';
                let cor = 'var(--text-secondary)';
                
                if (item.acao.includes('Adicionar')) {
                    icone = 'plus-circle';
                    cor = '#22c55e';
                } else if (item.acao.includes('Remover')) {
                    icone = 'minus-circle';
                    cor = '#dc2626';
                } else if (item.acao.includes('Distribuição')) {
                    icone = 'dice-5';
                    cor = '#8b5cf6';
                } else if (item.acao.includes('nível')) {
                    icone = 'trending-up';
                    cor = '#f59e0b';
                } else if (item.acao.includes('Resetar')) {
                    icone = 'trash-2';
                    cor = '#ef4444';
                }
                
                return `
                    <div style="
                        padding: 0.75rem;
                        border-bottom: 1px solid var(--border-color);
                        display: flex;
                        align-items: center;
                        gap: 0.75rem;
                        transition: all 0.2s;
                    " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)';" 
                    onmouseout="this.style.backgroundColor='transparent';">
                        <div style="
                            width: 2rem;
                            height: 2rem;
                            border-radius: 0.5rem;
                            background: ${cor}20;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-shrink: 0;
                        ">
                            <i data-lucide="${icone}" style="width: 1rem; height: 1rem; color: ${cor};"></i>
                        </div>
                        
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); font-size: 0.875rem;">
                                ${item.acao}
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem;">
                                ${item.detalhes}
                            </div>
                        </div>
                        
                        <div style="text-align: right;">
                            <div style="color: var(--text-secondary); font-size: 0.75rem;">${hora}</div>
                            <div style="color: var(--text-secondary); font-size: 0.625rem; margin-top: 0.25rem;">
                                Nv. ${item.nivel}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // FUNÇÕES DE MANIPULAÇÃO DE PONTOS
        function adicionarPontoAvancado(atributo) {
            const novoStatus = StatusSystemAvancado.addPoint(atributo);
            if (novoStatus) {
                document.getElementById(`valor-${atributo}`).textContent = novoStatus.atributos[atributo];
                updateUI(novoStatus);
            }
        }

        function removerPontoAvancado(atributo) {
            const novoStatus = StatusSystemAvancado.removePoint(atributo);
            if (novoStatus) {
                document.getElementById(`valor-${atributo}`).textContent = novoStatus.atributos[atributo];
                updateUI(novoStatus);
            }
        }

        function atualizarSliderAvancado(atributo, valor) {
            const status = StatusSystemAvancado.load();
            const diferenca = valor - status.atributos[atributo];
            
            if (diferenca > 0) {
                for (let i = 0; i < diferenca; i++) {
                    if (!StatusSystemAvancado.addPoint(atributo)) break;
                }
            } else if (diferenca < 0) {
                for (let i = 0; i < Math.abs(diferenca); i++) {
                    if (!StatusSystemAvancado.removePoint(atributo)) break;
                }
            }
            
            loadStatusData();
        }

        // FUNÇÕES DE MODAL
        function abrirModal(id) {
            const modal = document.getElementById(id);
            modal.classList.add('active');
        }

        function fecharModal(id) {
            const modal = document.getElementById(id);
            modal.classList.remove('active');
        }

        // FUNÇÕES DE EXPORT/IMPORT
        function exportarParaTxt() {
            const txtContent = StatusSystemAvancado.exportToTxt();
            const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `status_avancado_${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            StatusSystemAvancado.showNotification('Dados exportados para TXT com sucesso!', 'success');
        }

        function importarDeTxt() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const sucesso = StatusSystemAvancado.importFromTxt(content);
                    if (sucesso) {
                        loadStatusData();
                        mostrarFeedback('Dados importados com sucesso!', 'success');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // CONFIGURAR EVENTOS
        function setupEventListeners() {
            // Configurações
            document.getElementById('btn-config').addEventListener('click', () => abrirModal('modal-config'));
            document.getElementById('btn-fechar-modal').addEventListener('click', () => fecharModal('modal-config'));
            
            // Modo Mestre
            document.getElementById('btn-chefe').addEventListener('click', function() {
                StatusSystemAvancado.toggleModoMestre();
                loadStatusData();
            });
            
            // XP
            document.getElementById('btn-add-xp').addEventListener('click', () => abrirModal('modal-xp'));
            document.getElementById('btn-confirmar-xp').addEventListener('click', function() {
                const quantidade = document.getElementById('input-xp-quantidade').value;
                const resultado = StatusSystemAvancado.addExperiencia(quantidade);
                if (resultado) {
                    loadStatusData();
                    fecharModal('modal-xp');
                }
            });
            
            // Pontos
            document.getElementById('btn-adicionar-pontos').addEventListener('click', () => abrirModal('modal-pontos'));
            document.getElementById('btn-confirmar-pontos').addEventListener('click', function() {
                const quantidade = document.getElementById('input-pontos-quantidade').value;
                const resultado = StatusSystemAvancado.addPontosDisponiveis(quantidade);
                if (resultado) {
                    loadStatusData();
                    fecharModal('modal-pontos');
                }
            });
            
            // Distribuição Aleatória
            document.getElementById('btn-distribuir-aleatorio').addEventListener('click', function() {
                const data = StatusSystemAvancado.load();
                const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                
                if (totalAtual >= data.minimoParaAleatorio) {
                    StatusSystemAvancado.showNotification('Distribuição automática já foi feita ou está pronta!', 'info');
                } else {
                    StatusSystemAvancado.showNotification(`Adicione mais ${data.minimoParaAleatorio - totalAtual} pontos para distribuição aleatória`, 'warning');
                }
            });
            
            document.getElementById('btn-distribuir-avancado').addEventListener('click', function() {
                const quantidade = document.getElementById('input-pontos-aleatorio').value;
                const metodo = document.getElementById('select-metodo-aleatorio').value;
                
                const resultado = StatusSystemAvancado.distribuirAleatorioAvancado(quantidade, metodo);
                if (resultado) {
                    loadStatusData();
                }
            });
            
            // Subir nível
            document.getElementById('btn-subir-nivel').addEventListener('click', function() {
                const resultado = StatusSystemAvancado.subirNivel();
                if (resultado) {
                    loadStatusData();
                }
            });
            
            // Resetar tudo
            document.getElementById('btn-reset-tudo').addEventListener('click', function() {
                const resultado = StatusSystemAvancado.reset();
                if (resultado) {
                    loadStatusData();
                }
            });
            
            // Configurações avançadas
            document.getElementById('btn-aplicar-minimo').addEventListener('click', function() {
                const valor = document.getElementById('input-minimo-aleatorio').value;
                StatusSystemAvancado.updateConfig({ minimoParaAleatorio: parseInt(valor) });
                loadStatusData();
            });
            
            document.getElementById('btn-aplicar-pontos-nivel').addEventListener('click', function() {
                const valor = document.getElementById('input-pontos-nivel').value;
                StatusSystemAvancado.updateConfig({ pontosPorNivel: parseInt(valor) });
                loadStatusData();
            });
            
            document.getElementById('btn-aplicar-limite').addEventListener('click', function() {
                const valor = document.getElementById('input-limite-total').value;
                StatusSystemAvancado.updateConfig({ limiteTotalPontos: parseInt(valor) });
                loadStatusData();
            });
            
            // Configurações do modal
            document.getElementById('slider-limite-atributo').addEventListener('input', function() {
                document.getElementById('valor-limite-atributo').textContent = this.value;
            });
            
            document.getElementById('btn-salvar-config').addEventListener('click', function() {
                const config = {
                    limitePorAtributo: parseInt(document.getElementById('slider-limite-atributo').value),
                    limiteTotalPontos: parseInt(document.getElementById('input-config-limite-total').value),
                    pontosPorNivel: parseInt(document.getElementById('input-config-pontos-nivel').value),
                    experienciaProximoNivel: parseInt(document.getElementById('input-config-xp-proximo').value),
                    minimoParaAleatorio: parseInt(document.getElementById('input-config-minimo-aleatorio').value),
                    pontosDistribuicaoAleatoria: parseInt(document.getElementById('input-config-pontos-aleatorio').value)
                };
                
                StatusSystemAvancado.updateConfig(config);
                loadStatusData();
                fecharModal('modal-config');
            });
            
            document.getElementById('btn-restaurar-padrao').addEventListener('click', function() {
                if (confirm('Restaurar configurações padrão?')) {
                    StatusSystemAvancado.updateConfig({
                        limitePorAtributo: 100,
                        limiteTotalPontos: 100,
                        pontosPorNivel: 5,
                        experienciaProximoNivel: 1000,
                        minimoParaAleatorio: 18,
                        pontosDistribuicaoAleatoria: 10
                    });
                    loadStatusData();
                }
            });
            
            // Histórico
            document.getElementById('btn-limpar-historico').addEventListener('click', function() {
                if (confirm('Limpar todo o histórico de ações?')) {
                    const data = StatusSystemAvancado.load();
                    data.historico = [];
                    StatusSystemAvancado.save(data);
                    renderHistorico([]);
                    StatusSystemAvancado.showNotification('Histórico limpo!', 'info');
                }
            });
            
            // Exportar dados
            document.getElementById('btn-exportar-dados').addEventListener('click', function() {
                const data = StatusSystemAvancado.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `status_avancado_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                StatusSystemAvancado.showNotification('Dados exportados para JSON com sucesso!', 'success');
            });
            
            // Exportar/Importar TXT
            document.getElementById('btn-exportar-txt').addEventListener('click', exportarParaTxt);
            document.getElementById('btn-importar-txt').addEventListener('click', importarDeTxt);
            
            // Atualização de outras abas
            window.addEventListener('statusAvancadoUpdated', function() {
                loadStatusData();
                StatusSystemAvancado.showNotification('Dados atualizados de outra aba', 'info');
            });
        }

        // EXPOR FUNÇÕES GLOBAIS
        window.StatusSystemAvancado = StatusSystemAvancado;
        window.loadStatusData = loadStatusData;
        window.abrirModal = abrirModal;
        window.fecharModal = fecharModal;
        window.adicionarPontoAvancado = adicionarPontoAvancado;
        window.removerPontoAvancado = removerPontoAvancado;
        window.atualizarSliderAvancado = atualizarSliderAvancado;
        window.exportarParaTxt = exportarParaTxt;
        window.importarDeTxt = importarDeTxt;

        // SISTEMA DE SORTE/DERIVADOS
        window.rolarSorte = rolarSorte;
        window.fixarSorte = fixarSorte;
        window.calcularDerivado = calcularDerivado;
        window.calcularTodosDerivados = calcularTodosDerivados;
        window.ajustarDerivado = ajustarDerivado;
        window.ajustarRecurso = ajustarRecurso;
        window.toggleDerivado = toggleDerivado;
        window.resetarRecursos = resetarRecursos;
        window.resetarApenasDerivados = resetarApenasDerivados;
        window.resetarDerivadosAvancados = resetarDerivadosAvancados;
        window.sistemaDerivados = sistemaDerivados;
        window.sorteAtual = sorteAtual;
        window.dadosSorte = dadosSorte;
        window.sorteFixada = sorteFixada;

        // No final do status.html, atualize o evento DOMContentLoaded:

        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('DOM carregado - Inicializando sistemas...');
                
                // Inicializar ícones
                if (window.lucide) {
                    lucide.createIcons();
                }
                
                // Inicializar sistema principal
                StatusSystemAvancado.init();
                
                // Carregar dados iniciais
                loadStatusData();
                
                // Carregar dados do sistema de sorte/derivados
                if (window.carregarSorteDoLocalStorage) carregarSorteDoLocalStorage();
                if (window.carregarDerivadosDoLocalStorage) carregarDerivadosDoLocalStorage();
                
                // Configurar eventos
                if (window.setupEventListeners) setupEventListeners();
                if (window.configurarEventosSorte) configurarEventosSorte();
                
                // INICIALIZAR INTEGRAÇÃO COM FICHA
                if (window.inicializarIntegracao) {
                    inicializarIntegracao();
                } else {
                    console.error('Função inicializarIntegracao não encontrada!');
                }
                
                console.log('Todos os sistemas inicializados com sucesso');
                
            } catch (error) {
                console.error('Erro na inicialização:', error);
                StatusSystemAvancado.showNotification('Erro ao inicializar sistemas!', 'error');
            }
        });

        // ============================================================
        // SISTEMA DE INTEGRAÇÃO DIRETO NO STATUS.HTML
        // ============================================================

        class StatusIntegration {
            
            static sincronizarParaFicha() {
                try {
                    console.log('Sincronizando status para ficha...');
                    
                    // Carregar dados do status
                    const statusData = StatusSystemAvancado.load();
                    
                    if (!statusData) {
                        StatusSystemAvancado.showNotification('❌ Nenhum dado de status para sincronizar', 'error');
                        return false;
                    }
                    
                    // Verificar se o GrimorioSystem está disponível
                    if (typeof GrimorioSystem === 'undefined') {
                        StatusSystemAvancado.showNotification('❌ Sistema Grimório não encontrado', 'error');
                        return false;
                    }
                    
                    // Usar a função de sincronização
                    const sucesso = GrimorioSystem.sincronizarStatus(statusData);
                    
                    if (sucesso) {
                        StatusSystemAvancado.showNotification('✅ Status sincronizado com ficha!', 'success');
                        
                        // Forçar atualização do perfil
                        window.dispatchEvent(new CustomEvent('grimorio:personagemAtualizado'));
                        
                        // Opcional: redirecionar para o perfil
                        setTimeout(() => {
                            if (confirm('Sincronização concluída! Deseja ver o perfil?')) {
                                window.open('perfil.html', '_blank');
                            }
                        }, 1000);
                        
                        return true;
                    } else {
                        StatusSystemAvancado.showNotification('❌ Erro ao sincronizar status', 'error');
                        return false;
                    }
                    
                } catch (error) {
                    console.error('Erro na sincronização:', error);
                    StatusSystemAvancado.showNotification('❌ Erro na sincronização', 'error');
                    return false;
                }
            }
            
            static carregarDaFicha() {
                try {
                    console.log('Carregando dados da ficha para status...');
                    
                    if (typeof GrimorioSystem === 'undefined') {
                        StatusSystemAvancado.showNotification('❌ Sistema Grimório não encontrado', 'error');
                        return false;
                    }
                    
                    const personagem = GrimorioSystem.carregarPersonagem();
                    
                    if (!personagem) {
                        StatusSystemAvancado.showNotification('❌ Nenhum personagem encontrado', 'error');
                        return false;
                    }
                    
                    const statusData = StatusSystemAvancado.load();
                    
                    // Converter atributos de 0-30 para 0-100
                    const escala = 100;
                    const attrs = personagem.atributos || {};
                    
                    Object.keys(attrs).forEach(attr => {
                        if (statusData.atributos[attr] !== undefined) {
                            const valorConvertido = Math.round((attrs[attr] / 30) * 100);
                            statusData.atributos[attr] = Math.min(100, valorConvertido);
                        }
                    });
                    
                    // Atualizar progressão
                    statusData.nivel = personagem.nivel || 1;
                    statusData.experiencia = personagem.experiencia || 0;
                    statusData.experienciaProximoNivel = personagem.experienciaProximoNivel || 1000;
                    statusData.pontosDisponiveis = personagem.pontosDisponiveis || 0;
                    
                    // Recalcular pontos usados
                    statusData.pontosUsados = Object.values(statusData.atributos).reduce((a, b) => a + b, 0);
                    
                    // Salvar dados atualizados
                    StatusSystemAvancado.save(statusData);
                    
                    // Atualizar interface
                    if (window.loadStatusData) loadStatusData();
                    if (window.renderRecursos) renderRecursos();
                    if (window.renderDerivados) renderDerivados();
                    
                    StatusSystemAvancado.showNotification('✅ Dados carregados da ficha!', 'success');
                    return true;
                    
                } catch (error) {
                    console.error('Erro ao carregar da ficha:', error);
                    StatusSystemAvancado.showNotification('❌ Erro ao carregar dados', 'error');
                    return false;
                }
            }
        }

        // ============================================================
        // CONFIGURAR BOTÕES DE INTEGRAÇÃO
        // ============================================================

        function configurarIntegracao() {
            console.log('Configurando botões de integração...');
            
            // 1. Botão na navbar para sincronizar
            const btnExportar = document.getElementById('btn-exportar-grimorio');
            if (btnExportar) {
                btnExportar.onclick = () => {
                    StatusIntegration.sincronizarParaFicha();
                };
            } else {
                // Criar botão se não existir
                const navButtons = document.querySelector('nav div[style*="display: flex; gap: 0.75rem; flex-wrap: wrap;"]');
                if (navButtons) {
                    const btn = document.createElement('button');
                    btn.id = 'btn-exportar-grimorio';
                    btn.innerHTML = `
                        <i data-lucide="upload-cloud" style="width: 1rem; height: 1rem;"></i>
                        Sincronizar
                    `;
                    btn.style = `
                        padding: 0.5rem 1rem;
                        background: linear-gradient(135deg, #22c55e, #10b981);
                        color: white;
                        border: none;
                        border-radius: 0.5rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                        transition: all 0.2s;
                    `;
                    btn.onmouseover = function() {
                        this.style.transform = 'translateY(-2px)';
                        this.style.boxShadow = '0 4px 15px rgba(34, 197, 94, 0.3)';
                    };
                    btn.onmouseout = function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = 'none';
                    };
                    btn.onclick = () => {
                        StatusIntegration.sincronizarParaFicha();
                    };
                    
                    navButtons.appendChild(btn);
                }
            }
            
            // 2. Botão no header para carregar da ficha
            const btnImportar = document.createElement('button');
            btnImportar.innerHTML = `
                <i data-lucide="download-cloud" style="width: 1rem; height: 1rem;"></i>
                Carregar da Ficha
            `;
            btnImportar.style = `
                padding: 0.75rem 1.5rem;
                background: linear-gradient(135deg, #4a9eff, #0ea5e9);
                color: white;
                border: none;
                border-radius: 0.75rem;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                transition: all 0.2s;
            `;
            btnImportar.onmouseover = function() {
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 8px 25px rgba(59, 130, 246, 0.4)';
            };
            btnImportar.onmouseout = function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'none';
            };
            btnImportar.onclick = () => {
                StatusIntegration.carregarDaFicha();
            };
            
            // Adicionar ao header
            const headerControls = document.querySelector('header > div[style*="display: flex; flex-wrap: wrap; gap: 0.75rem;"]');
            if (headerControls) {
                headerControls.appendChild(btnImportar);
            } else {
                // Alternativa: adicionar no início da página
                const primeiraSecao = document.querySelector('section');
                if (primeiraSecao) {
                    primeiraSecao.insertBefore(btnImportar, primeiraSecao.firstChild);
                }
            }
            
            // 3. Criar um card de integração se quiser
            const cardIntegracao = `
                <div style="
                    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
                    border: 1px solid rgba(59, 130, 246, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                    margin-bottom: 2rem;
                ">
                    <h3 style="font-weight: 600; color: #4a9eff; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i data-lucide="link" style="width: 1.25rem; height: 1.25rem;"></i>
                        Integração com Ficha do Personagem
                    </h3>
                    <p style="color: #a0a0a0; margin-bottom: 1.5rem; font-size: 0.875rem;">
                        Sincronize seus atributos entre o sistema de status e a ficha do personagem.
                        As alterações serão refletidas no perfil e no hub.
                    </p>
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="StatusIntegration.carregarDaFicha()" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: rgba(59, 130, 246, 0.2);
                            color: #4a9eff;
                            border: 1px solid rgba(59, 130, 246, 0.4);
                            border-radius: 0.5rem;
                            font-weight: 600;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 0.5rem;
                            transition: all 0.2s;
                        " onmouseover="this.style.backgroundColor='rgba(59, 130, 246, 0.3)'; this.style.borderColor='rgba(59, 130, 246, 0.6)'" 
                        onmouseout="this.style.backgroundColor='rgba(59, 130, 246, 0.2)'; this.style.borderColor='rgba(59, 130, 246, 0.4)'">
                            <i data-lucide="download" style="width: 1rem; height: 1rem;"></i>
                            Carregar da Ficha
                        </button>
                        
                        <button onclick="StatusIntegration.sincronizarParaFicha()" style="
                            flex: 1;
                            padding: 0.75rem;
                            background: rgba(34, 197, 94, 0.2);
                            color: #22c55e;
                            border: 1px solid rgba(34, 197, 94, 0.4);
                            border-radius: 0.5rem;
                            font-weight: 600;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 0.5rem;
                            transition: all 0.2s;
                        " onmouseover="this.style.backgroundColor='rgba(34, 197, 94, 0.3)'; this.style.borderColor='rgba(34, 197, 94, 0.6)'" 
                        onmouseout="this.style.backgroundColor='rgba(34, 197, 94, 0.2)'; this.style.borderColor='rgba(34, 197, 94, 0.4)'">
                            <i data-lucide="upload" style="width: 1rem; height: 1rem;"></i>
                            Sincronizar com Ficha
                        </button>
                    </div>
                </div>
            `;
            
            // Adicionar card antes da seção de atributos
            const secaoAtributos = document.getElementById('secao-atributos');
            if (secaoAtributos) {
                const card = document.createElement('div');
                card.innerHTML = cardIntegracao;
                secaoAtributos.parentNode.insertBefore(card, secaoAtributos);
            }
            
            // Atualizar ícones
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function inicializarIntegracaoPerfil() {
            console.log('Inicializando integração com ficha do personagem...');
            configurarIntegracao();
        }
        // Expor para o evento DOMContentLoaded
        window.inicializarIntegracaoPerfil = inicializarIntegracaoPerfil;

        // ATUALIZE AQUI O EVENTO DOMContentLoaded:
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('DOM carregado - Inicializando sistemas...');
                
                // Inicializar ícones Lucide
                if (window.lucide) {
                    lucide.createIcons();
                }
                
                // Inicializar sistema principal de status
                StatusSystemAvancado.init();
                
                // Carregar dados iniciais
                if (window.loadStatusData) loadStatusData();
                
                // Carregar dados do sistema de sorte/derivados
                if (window.carregarSorteDoLocalStorage) carregarSorteDoLocalStorage();
                if (window.carregarDerivadosDoLocalStorage) carregarDerivadosDoLocalStorage();
                
                // Configurar eventos
                if (window.setupEventListeners) setupEventListeners();
                if (window.configurarEventosSorte) configurarEventosSorte();
                
                // INICIALIZAR INTEGRAÇÃO
                inicializarIntegracao();
                
                console.log('✅ Todos os sistemas inicializados com sucesso');
                
            } catch (error) {
                console.error('Erro na inicialização:', error);
                if (window.StatusSystemAvancado && window.StatusSystemAvancado.showNotification) {
                    StatusSystemAvancado.showNotification('Erro ao inicializar sistemas!', 'error');
                }
            }
        });
    </script>
</body>
</html>