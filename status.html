<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Sistema Avançado de Status</title>
    
    <style>
        /* RESET E ESTILOS GLOBAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-smooth: always;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        :root {
            --bg-primary: #0a0a0c;
            --bg-panel: #0f0f12;
            --border-color: #2a2a2e;
            --text-primary: #e8e4dc;
            --text-secondary: #a0a0a0;
            --accent-blue: #4a9eff;
            --accent-orange: #ff6b35;
            --accent-red: #dc2626;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --accent-yellow: #f59e0b;
            --accent-pink: #ec4899;
            --accent-teal: #14b8a6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* UTILITY CLASSES */
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* SCROLLBAR CUSTOMIZADA */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-panel);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }
        
        /* ANIMAÇÕES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .animate-slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        
        /* ESTILOS PARA SLIDERS */
        input[type="range"] {
            appearance: none;
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-blue);
            cursor: pointer;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-blue);
            cursor: pointer;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
        }
        
        /* ESTILOS PARA INPUTS NUMBER */
        input[type="number"] {
            appearance: textfield;
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* ESTILOS PARA MODAIS */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal-backdrop.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-backdrop.active .modal-content {
            transform: translateY(0);
        }
        
        /* NOTIFICAÇÕES */
        .status-notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .status-notification-success {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.5);
            color: #86efac;
        }
        
        .status-notification-warning {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.5);
            color: #fde68a;
        }
        
        .status-notification-error {
            background: rgba(220, 38, 38, 0.15);
            border-color: rgba(220, 38, 38, 0.5);
            color: #fca5a5;
        }
        
        .status-notification-info {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.5);
            color: #93c5fd;
        }
        
        .notification-icon {
            width: 1.25rem;
            height: 1.25rem;
        }
        
        .fade-out {
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s ease-out;
        }
        .hidden {
            display: none !important;
        }
        /* Adicione ao final do bloco <style> existente */

        /* Estilos para substituir classes Tailwind */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .inline { display: inline; }
        .inline-block { display: inline-block; }
        .list-disc { list-style-type: disc; }
        .list-inside { list-style-position: inside; }
        .transition-colors { transition: background-color 0.3s, border-color 0.3s; }
        .transition-opacity { transition: opacity 0.3s; }
        .hover\:opacity-90:hover { opacity: 0.9; }
        .fixed { position: fixed; }
        .top-4 { top: 1rem; }
        .right-4 { right: 1rem; }
        .z-50 { z-index: 50; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .cursor-pointer { cursor: pointer; }
        .opacity-70 { opacity: 0.7; }
        .opacity-90 { opacity: 0.9; }
        .capitalize { text-transform: capitalize; }
        .flex-1 { flex: 1; }

        /* Grid para substituir grid-cols- */
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }

        /* Para responsividade */
        @media (max-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }

        @media (max-width: 640px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        }
    </style>
    
    <!-- FONTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- ICONES -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- BARRA DE NAVEGAÇÃO -->
    <nav style="
        position: sticky;
        top: 0;
        background: rgba(15, 15, 18, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
        z-index: 100;
        padding: 1rem 0;
    ">
        <div style="
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        ">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="index.html" style="
                    color: var(--text-primary);
                    text-decoration: none;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'" 
                   onmouseout="this.style.backgroundColor='transparent'">
                    <i data-lucide="arrow-left" style="width: 1.25rem; height: 1.25rem;"></i>
                    <span class="font-cinzel" style="font-weight: 600;">Voltar</span>
                </a>
                
                <div style="width: 1px; height: 1.5rem; background: var(--border-color);"></div>
                
                <h1 class="font-cinzel" style="
                    font-size: 1.5rem;
                    font-weight: 700;
                    background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
                    -webkit-background-clip: text;
                    background-clip: text;
                    color: transparent;
                    white-space: nowrap;
                ">
                    Sistema Avançado de Status
                </h1>
            </div>
            
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <button id="btn-config" style="
                    padding: 0.5rem 1rem;
                    background: var(--bg-panel);
                    color: var(--text-primary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.5rem;
                    font-weight: 500;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.borderColor='var(--accent-blue)'; this.style.backgroundColor='rgba(74, 158, 255, 0.1)'" 
                   onmouseout="this.style.borderColor='var(--border-color)'; this.style.backgroundColor='var(--bg-panel)'">
                    <i data-lucide="settings" style="width: 1rem; height: 1rem;"></i>
                    Configurações
                </button>
                
                <button id="btn-chefe" style="
                    padding: 0.5rem 1rem;
                    background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(139, 92, 246, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(139, 92, 246, 0.3)'">
                    <i data-lucide="crown" style="width: 1rem; height: 1rem;"></i>
                    Modo Mestre
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main style="
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    ">
        <!-- CABEÇALHO COM INFORMAÇÕES -->
        <header class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            ">
                <!-- CARD DE PONTOS -->
                <div style="
                    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
                    border: 1px solid rgba(59, 130, 246, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                ">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="
                                width: 3rem;
                                height: 3rem;
                                background: rgba(59, 130, 246, 0.2);
                                border-radius: 0.75rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <i data-lucide="star" style="width: 1.5rem; height: 1.5rem; color: var(--accent-blue);"></i>
                            </div>
                            <div>
                                <h3 style="font-weight: 600; color: var(--accent-blue);">Pontos Disponíveis</h3>
                                <p style="color: var(--text-secondary); font-size: 0.875rem;">Para distribuir nos atributos</p>
                            </div>
                        </div>
                        <div id="pontos-disponiveis" style="
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 2.5rem;
                            font-weight: 700;
                            color: var(--accent-blue);
                        ">0</div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Usado/Total</span>
                            <span id="pontos-ratio" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0/0</span>
                        </div>
                        <div style="
                            height: 8px;
                            background: rgba(59, 130, 246, 0.2);
                            border-radius: 4px;
                            overflow: hidden;
                        ">
                            <div id="pontos-bar" style="
                                height: 100%;
                                background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
                                border-radius: 4px;
                                width: 0%;
                                transition: width 0.5s ease;
                            "></div>
                        </div>
                    </div>
                </div>
                
                <!-- CARD DE NÍVEL E XP -->
                <div style="
                    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(220, 38, 38, 0.1));
                    border: 1px solid rgba(245, 158, 11, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                ">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="
                                width: 3rem;
                                height: 3rem;
                                background: rgba(245, 158, 11, 0.2);
                                border-radius: 0.75rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <i data-lucide="trending-up" style="width: 1.5rem; height: 1.5rem; color: var(--accent-yellow);"></i>
                            </div>
                            <div>
                                <h3 style="font-weight: 600; color: var(--accent-yellow);">Nível & XP</h3>
                                <p style="color: var(--text-secondary); font-size: 0.875rem;">Progressão do personagem</p>
                            </div>
                        </div>
                        <div id="nivel-atual" style="
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 2.5rem;
                            font-weight: 700;
                            color: var(--accent-yellow);
                        ">1</div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">XP: <span id="xp-atual">0</span>/<span id="xp-proximo">1000</span></span>
                            <span id="xp-restante" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">1000 restante</span>
                        </div>
                        <div style="
                            height: 8px;
                            background: rgba(245, 158, 11, 0.2);
                            border-radius: 4px;
                            overflow: hidden;
                        ">
                            <div id="xp-bar" style="
                                height: 100%;
                                background: linear-gradient(90deg, var(--accent-yellow), var(--accent-red));
                                border-radius: 4px;
                                width: 0%;
                                transition: width 0.5s ease;
                            "></div>
                        </div>
                        <button id="btn-add-xp" style="
                            margin-top: 1rem;
                            width: 100%;
                            padding: 0.75rem;
                            background: rgba(245, 158, 11, 0.2);
                            color: var(--accent-yellow);
                            border: 1px solid rgba(245, 158, 11, 0.4);
                            border-radius: 0.5rem;
                            font-weight: 600;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 0.5rem;
                            transition: all 0.2s;
                        " onmouseover="this.style.backgroundColor='rgba(245, 158, 11, 0.3)'; this.style.borderColor='rgba(245, 158, 11, 0.6)'" 
                           onmouseout="this.style.backgroundColor='rgba(245, 158, 11, 0.2)'; this.style.borderColor='rgba(245, 158, 11, 0.4)'">
                            <i data-lucide="plus" style="width: 1rem; height: 1rem;"></i>
                            Adicionar XP
                        </button>
                    </div>
                </div>
                
                <!-- CARD DE CONFIGURAÇÕES -->
                <div style="
                    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(20, 184, 166, 0.1));
                    border: 1px solid rgba(34, 197, 94, 0.3);
                    border-radius: 1rem;
                    padding: 1.5rem;
                ">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <div style="
                            width: 3rem;
                            height: 3rem;
                            background: rgba(34, 197, 94, 0.2);
                            border-radius: 0.75rem;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        ">
                            <i data-lucide="sliders" style="width: 1.5rem; height: 1.5rem; color: var(--accent-green);"></i>
                        </div>
                        <div>
                            <h3 style="font-weight: 600; color: var(--accent-green);">Configurações do Sistema</h3>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">Limites e regras</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Limite de Pontos</span>
                            <span id="limite-pontos" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Pontos por Nível</span>
                            <span id="pontos-por-nivel" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Mínimo para Aleatório</span>
                            <span id="minimo-aleatorio" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">18</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CONTROLES RÁPIDOS -->
            <div style="
                display: flex;
                flex-wrap: wrap;
                gap: 0.75rem;
                justify-content: center;
                margin-top: 1.5rem;
            ">
                <button id="btn-distribuir-aleatorio" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(139, 92, 246, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="dice-5" style="width: 1.25rem; height: 1.25rem;"></i>
                    Distribuição Aleatória
                </button>
                
                <button id="btn-adicionar-pontos" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-blue), #0ea5e9);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="plus-circle" style="width: 1.25rem; height: 1.25rem;"></i>
                    Adicionar Pontos
                </button>
                
                <button id="btn-subir-nivel" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-green), #10b981);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(34, 197, 94, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="arrow-up" style="width: 1.25rem; height: 1.25rem;"></i>
                    Subir de Nível
                </button>
                
                <button id="btn-reset-tudo" style="
                    padding: 0.75rem 1.5rem;
                    background: linear-gradient(135deg, var(--accent-red), #ef4444);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    transition: all 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(220, 38, 38, 0.4)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i data-lucide="trash-2" style="width: 1.25rem; height: 1.25rem;"></i>
                    Resetar Tudo
                </button>
            </div>
        </header>

        <!-- SEÇÃO DE ATRIBUTOS -->
        <section class="animate-fadeIn" style="margin-bottom: 3rem;">
            <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 2px solid var(--border-color);
            ">
                <h2 class="font-cinzel" style="
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: var(--accent-blue);
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                ">
                    <i data-lucide="activity" style="width: 1.5rem; height: 1.5rem;"></i>
                    Atributos (0-100)
                </h2>
                
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="color: var(--text-secondary);">Total:</span>
                    <span id="total-atributos" style="
                        font-family: 'JetBrains Mono', monospace;
                        font-size: 1.5rem;
                        font-weight: 700;
                        color: var(--accent-blue);
                    ">0</span>
                    <span style="color: var(--text-secondary); font-size: 0.875rem;">/ <span id="limite-total">0</span></span>
                </div>
            </div>
            
            <!-- GRID DE ATRIBUTOS -->
            <div id="atributos-container" style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            ">
                <!-- Atributos serão carregados por JavaScript -->
            </div>
        </section>

        <!-- SEÇÃO DE HISTÓRICO E CONTROLES -->
        <section class="animate-fadeIn" style="
            background: linear-gradient(135deg, rgba(30, 30, 40, 0.8), rgba(20, 20, 30, 0.8));
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        ">
            <h3 class="font-cinzel" style="
                font-size: 1.5rem;
                font-weight: 600;
                margin-bottom: 1.5rem;
                color: var(--accent-purple);
                display: flex;
                align-items: center;
                gap: 0.75rem;
            ">
                <i data-lucide="history" style="width: 1.25rem; height: 1.25rem;"></i>
                Histórico e Controles Avançados
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr; gap: 2rem;">
                <!-- CONTROLES DE DISTRIBUIÇÃO -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Distribuição de Pontos</h4>
                    
                    <div style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 1rem;
                        margin-bottom: 1.5rem;
                    ">
                        <div style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid var(--border-color);
                            border-radius: 0.75rem;
                            padding: 1rem;
                        ">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Pontos Mínimos para Aleatório
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-minimo-aleatorio" min="0" max="1000" value="18" 
                                       style="
                                        flex: 1;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <button id="btn-aplicar-minimo" style="
                                    padding: 0.5rem 1rem;
                                    background: var(--accent-purple);
                                    color: white;
                                    border: none;
                                    border-radius: 0.5rem;
                                    font-weight: 500;
                                    cursor: pointer;
                                ">Aplicar</button>
                            </div>
                        </div>
                        
                        <div style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid var(--border-color);
                            border-radius: 0.75rem;
                            padding: 1rem;
                        ">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Pontos por Nível
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-pontos-nivel" min="0" max="100" value="5" 
                                       style="
                                        flex: 1;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <button id="btn-aplicar-pontos-nivel" style="
                                    padding: 0.5rem 1rem;
                                    background: var(--accent-blue);
                                    color: white;
                                    border: none;
                                    border-radius: 0.5rem;
                                    font-weight: 500;
                                    cursor: pointer;
                                ">Aplicar</button>
                            </div>
                        </div>
                        
                        <div style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid var(--border-color);
                            border-radius: 0.75rem;
                            padding: 1rem;
                        ">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                Limite Total de Pontos
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-limite-total" min="0" max="10000" value="100" 
                                       style="
                                        flex: 1;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <button id="btn-aplicar-limite" style="
                                    padding: 0.5rem 1rem;
                                    background: var(--accent-green);
                                    color: white;
                                    border: none;
                                    border-radius: 0.5rem;
                                    font-weight: 500;
                                    cursor: pointer;
                                ">Aplicar</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- DISTRIBUIÇÃO ALEATÓRIA AVANÇADA -->
                    <div style="
                        background: rgba(139, 92, 246, 0.1);
                        border: 1px solid rgba(139, 92, 246, 0.3);
                        border-radius: 0.75rem;
                        padding: 1rem;
                        margin-top: 1rem;
                    ">
                        <h5 style="font-weight: 600; margin-bottom: 0.75rem; color: var(--accent-purple); display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="dice-5" style="width: 1rem; height: 1rem;"></i>
                            Distribuição Aleatória Avançada
                        </h5>
                        
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                    Quantidade de Pontos
                                </label>
                                <input type="number" id="input-pontos-aleatorio" min="1" max="1000" value="10" 
                                       style="
                                        width: 100%;
                                        padding: 0.5rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                            </div>
                            
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                    Método de Distribuição
                                </label>
                                <select id="select-metodo-aleatorio" style="
                                    width: 100%;
                                    padding: 0.5rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'Inter', sans-serif;
                                    cursor: pointer;
                                ">
                                    <option value="total">Baseado no Total (≥ 18)</option>
                                    <option value="fixo">Quantidade Fixa</option>
                                    <option value="porcentagem">Porcentagem dos Atributos</option>
                                    <option value="balanceado">Distribuição Balanceada</option>
                                </select>
                            </div>
                            
                            <button id="btn-distribuir-avancado" style="
                                align-self: flex-end;
                                padding: 0.5rem 1.5rem;
                                background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
                                color: white;
                                border: none;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            ">
                                <i data-lucide="zap" style="width: 1rem; height: 1rem;"></i>
                                Distribuir
                            </button>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.875rem;">
                            <i data-lucide="info" style="width: 0.875rem; height: 0.875rem; vertical-align: middle; margin-right: 0.25rem;"></i>
                            <span>Atualmente: <span id="status-distribuicao" style="color: var(--accent-yellow); font-weight: 600;">Pendente</span></span>
                        </div>
                    </div>
                </div>
                <!-- Seção de Destino/Sorte -->
                <div id="secao-dados-sorte" class="hidden">
                    <div class="bg-[#1a1510] border border-[#8b7355] p-6 rounded-xl">
                        <h3 class="font-cinzel text-xl font-bold text-[#f4d29a] mb-4">
                            <i data-lucide="compass" class="w-5 h-5 inline mr-2"></i>
                            Destino Incerto
                        </h3>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2" id="dado-sorte-1">0</div>
                                <div class="text-sm text-[#8b7355]">Fé</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2" id="dado-sorte-2">0</div>
                                <div class="text-sm text-[#8b7355]">Sorte</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2" id="dado-sorte-3">0</div>
                                <div class="text-sm text-[#8b7355]">Destino</div>
                            </div>
                        </div>
                        
                        <div class="text-center mb-6">
                            <div class="text-4xl font-bold font-mono text-[#d4a76a]" id="calc-sorte">--</div>
                            <div class="text-sm text-[#8b7355] mt-2" id="calculo-sorte">
                                ((0 + 0) × 2 - 0) ÷ 2 = 0
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <button id="btn-rolar-sorte" class="flex-1 px-4 py-3 bg-gradient-to-r from-[#1a1510] to-[#2a2318] border border-[#8b7355] rounded-lg text-[#d4a76a] font-semibold hover:bg-[#2a2318] transition-colors">
                                <i data-lucide="dice-5" class="w-4 h-4 inline mr-2"></i>
                                Rolar Destino
                            </button>
                            <button id="btn-fixar-sorte" class="flex-1 px-4 py-3 bg-gradient-to-r from-[#1a1510] to-[#2a2318] border border-[#8b7355] rounded-lg text-[#d4a76a] font-semibold hover:bg-[#2a2318] transition-colors">
                                <i data-lucide="lock" class="w-4 h-4 inline mr-2"></i>
                                Fixar Destino
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Container para derivados -->
                <div id="derivados-container"></div>
                
                <!-- HISTÓRICO DE AÇÕES -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Histórico Recente</h4>
                    
                    <div id="historico-container" style="
                        background: rgba(0, 0, 0, 0.2);
                        border: 1px solid var(--border-color);
                        border-radius: 0.75rem;
                        padding: 1rem;
                        max-height: 200px;
                        overflow-y: auto;
                    ">
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <i data-lucide="history" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                            <p>Nenhuma ação registrada ainda</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 1rem;">
                        <button id="btn-limpar-historico" style="
                            padding: 0.5rem 1rem;
                            background: rgba(220, 38, 38, 0.1);
                            color: var(--accent-red);
                            border: 1px solid rgba(220, 38, 38, 0.3);
                            border-radius: 0.5rem;
                            font-weight: 500;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                        ">
                            <i data-lucide="trash" style="width: 1rem; height: 1rem;"></i>
                            Limpar Histórico
                        </button>
                        
                        <button id="btn-exportar-dados" style="
                            padding: 0.5rem 1rem;
                            background: rgba(59, 130, 246, 0.1);
                            color: var(--accent-blue);
                            border: 1px solid rgba(59, 130, 246, 0.3);
                            border-radius: 0.5rem;
                            font-weight: 500;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                        ">
                            <i data-lucide="download" style="width: 1rem; height: 1rem;"></i>
                            Exportar Dados
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- RODAPÉ -->
    <footer style="
        border-top: 1px solid var(--border-color);
        padding: 2rem 1rem;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.875rem;
    ">
        <p>Sistema Avançado de Status - Grimório Digital v3.0</p>
        <p style="margin-top: 0.5rem; font-size: 0.75rem;">Modo Mestre: Controle total sobre distribuição de pontos e progressão</p>
    </footer>

    <!-- MODAL DE CONFIGURAÇÕES -->
    <div id="modal-config" class="modal-backdrop">
        <div class="modal-content" style="padding: 2rem;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3 class="font-cinzel" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-blue);">
                    <i data-lucide="settings" style="width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem;"></i>
                    Configurações do Sistema
                </h3>
                <button id="btn-fechar-modal" style="
                    background: none;
                    border: none;
                    color: var(--text-secondary);
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-primary)'" 
                   onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-secondary)'">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            
            <div style="display: grid; gap: 1.5rem;">
                <!-- CONFIGURAÇÕES DE LIMITES -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Limites do Sistema</h4>
                    
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Limite Máximo por Atributo (0-100)
                            </label>
                            <input type="range" id="slider-limite-atributo" min="10" max="100" value="100" 
                                   style="width: 100%; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">10</span>
                                <span id="valor-limite-atributo" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">100</span>
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">100</span>
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Limite Total de Pontos
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="input-config-limite-total" min="0" max="10000" value="100" 
                                       style="
                                        flex: 1;
                                        padding: 0.75rem;
                                        background: var(--bg-panel);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        color: var(--text-primary);
                                        font-family: 'JetBrains Mono', monospace;
                                       ">
                                <span style="color: var(--text-secondary);">pontos</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CONFIGURAÇÕES DE PROGRESSÃO -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Configurações de Progressão</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Pontos por Nível
                            </label>
                            <input type="number" id="input-config-pontos-nivel" min="0" max="100" value="5" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                XP para Próximo Nível
                            </label>
                            <input type="number" id="input-config-xp-proximo" min="100" max="100000" value="1000" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                    </div>
                </div>
                
                <!-- CONFIGURAÇÕES DE DISTRIBUIÇÃO -->
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Distribuição Aleatória</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Mínimo para Aleatório
                            </label>
                            <input type="number" id="input-config-minimo-aleatorio" min="0" max="1000" value="18" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                                Pontos para Distribuir
                            </label>
                            <input type="number" id="input-config-pontos-aleatorio" min="1" max="1000" value="10" 
                                   style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: var(--bg-panel);
                                    border: 1px solid var(--border-color);
                                    border-radius: 0.5rem;
                                    color: var(--text-primary);
                                    font-family: 'JetBrains Mono', monospace;
                                   ">
                        </div>
                    </div>
                </div>
                
                <!-- BOTÕES DE AÇÃO -->
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button id="btn-salvar-config" style="
                        flex: 1;
                        padding: 1rem;
                        background: linear-gradient(135deg, var(--accent-green), #10b981);
                        color: white;
                        border: none;
                        border-radius: 0.75rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="save" style="width: 1rem; height: 1rem;"></i>
                        Salvar Configurações
                    </button>
                    
                    <button id="btn-restaurar-padrao" style="
                        flex: 1;
                        padding: 1rem;
                        background: rgba(255, 255, 255, 0.05);
                        color: var(--text-primary);
                        border: 1px solid var(--border-color);
                        border-radius: 0.75rem;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                    ">
                        <i data-lucide="rotate-ccw" style="width: 1rem; height: 1rem;"></i>
                        Restaurar Padrão
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE ADICIONAR XP -->
    <div id="modal-xp" class="modal-backdrop">
        <div class="modal-content" style="padding: 2rem; max-width: 400px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3 class="font-cinzel" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-yellow);">
                    <i data-lucide="trending-up" style="width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem;"></i>
                    Adicionar XP
                </h3>
                <button onclick="fecharModal('modal-xp')" style="
                    background: none;
                    border: none;
                    color: var(--text-secondary);
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-primary)'" 
                   onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-secondary)'">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Adicione experiência para progressão do personagem. Ao atingir o XP necessário, você pode subir de nível.
                </p>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                        Quantidade de XP
                    </label>
                    <input type="number" id="input-xp-quantidade" min="0" max="100000" value="100" 
                           style="
                            width: 100%;
                            padding: 0.75rem;
                            background: var(--bg-panel);
                            border: 1px solid var(--border-color);
                            border-radius: 0.5rem;
                            color: var(--text-primary);
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 1.25rem;
                            text-align: center;
                           ">
                </div>
                
                <div style="
                    background: rgba(245, 158, 11, 0.1);
                    border: 1px solid rgba(245, 158, 11, 0.3);
                    border-radius: 0.75rem;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                ">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">XP Atual:</span>
                        <span id="modal-xp-atual" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">XP Necessário:</span>
                        <span id="modal-xp-necessario" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">1000</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Faltam:</span>
                        <span id="modal-xp-faltam" style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--accent-yellow);">1000</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button onclick="fecharModal('modal-xp')" style="
                    flex: 1;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    color: var(--text-primary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                ">
                    Cancelar
                </button>
                
                <button id="btn-confirmar-xp" style="
                    flex: 1;
                    padding: 1rem;
                    background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                ">
                    <i data-lucide="plus" style="width: 1rem; height: 1rem;"></i>
                    Adicionar XP
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE ADICIONAR PONTOS -->
    <div id="modal-pontos" class="modal-backdrop">
        <div class="modal-content" style="padding: 2rem; max-width: 400px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3 class="font-cinzel" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-blue);">
                    <i data-lucide="plus-circle" style="width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem;"></i>
                    Adicionar Pontos
                </h3>
                <button onclick="fecharModal('modal-pontos')" style="
                    background: none;
                    border: none;
                    color: var(--text-secondary);
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: all 0.2s;
                " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-primary)'" 
                   onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-secondary)'">
                    <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Adicione pontos para distribuir entre os atributos. O mestre pode adicionar pontos extras ou recompensas.
                </p>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">
                        Quantidade de Pontos
                    </label>
                    <input type="number" id="input-pontos-quantidade" min="0" max="1000" value="5" 
                           style="
                            width: 100%;
                            padding: 0.75rem;
                            background: var(--bg-panel);
                            border: 1px solid var(--border-color);
                            border-radius: 0.5rem;
                            color: var(--text-primary);
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 1.25rem;
                            text-align: center;
                           ">
                </div>
                
                <div style="
                    background: rgba(59, 130, 246, 0.1);
                    border: 1px solid rgba(59, 130, 246, 0.3);
                    border-radius: 0.75rem;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                ">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Pontos Disponíveis:</span>
                        <span id="modal-pontos-disponiveis" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Limite Total:</span>
                        <span id="modal-limite-total" style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">100</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Restantes:</span>
                        <span id="modal-pontos-restantes" style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--accent-blue);">100</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button onclick="fecharModal('modal-pontos')" style="
                    flex: 1;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    color: var(--text-primary);
                    border: 1px solid var(--border-color);
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                ">
                    Cancelar
                </button>
                
                <button id="btn-confirmar-pontos" style="
                    flex: 1;
                    padding: 1rem;
                    background: linear-gradient(135deg, var(--accent-blue), #0ea5e9);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                ">
                    <i data-lucide="check" style="width: 1rem; height: 1rem;"></i>
                    Adicionar Pontos
                </button>
            </div>
        </div>
    </div>

    <!-- SISTEMA AVANÇADO DE STATUS -->
    <script>
        // ============================================================
        // SISTEMA AVANÇADO DE STATUS - VERSÃO 3.0
        // ============================================================

        // CONSTANTES E VARIÁVEIS GLOBAIS
        const STATUS_STORAGE_KEY = 'grimorio_status_avancado';
        let statusData = null;
        let historico = [];

        // CLASSE PRINCIPAL DO SISTEMA
        class StatusSystemAvancado {
            // INICIALIZAR SISTEMA
            static init() {
                if (!localStorage.getItem(STATUS_STORAGE_KEY)) {
                    const defaultData = {
                        // ATRIBUTOS (0-100)
                        atributos: {
                            forca: 0,
                            destreza: 0,
                            constituicao: 0,
                            inteligencia: 0,
                            sabedoria: 0,
                            carisma: 0
                        },
                        
                        // SISTEMA DE PONTOS
                        pontosDisponiveis: 0,
                        pontosUsados: 0,
                        limiteTotalPontos: 100,
                        
                        // SISTEMA DE NÍVEL E XP
                        nivel: 1,
                        experiencia: 0,
                        experienciaProximoNivel: 1000,
                        pontosPorNivel: 5,
                        
                        // CONFIGURAÇÕES DO SISTEMA
                        modoMestre: false,
                        limitePorAtributo: 100,
                        minimoParaAleatorio: 18,
                        pontosDistribuicaoAleatoria: 10,
                        metodoDistribuicao: 'total',
                        
                        // HISTÓRICO E METADADOS
                        historico: [],
                        criadoEm: new Date().toISOString(),
                        atualizadoEm: new Date().toISOString(),
                        ultimaDistribuicao: null
                    };
                    
                    localStorage.setItem(STATUS_STORAGE_KEY, JSON.stringify(defaultData));
                    console.log('Sistema avançado inicializado');
                }
            }
            
            // CARREGAR DADOS
            static load() {
                this.init();
                const data = localStorage.getItem(STATUS_STORAGE_KEY);
                return JSON.parse(data);
            }
            
            // SALVAR DADOS
            static save(data) {
                data.atualizadoEm = new Date().toISOString();
                localStorage.setItem(STATUS_STORAGE_KEY, JSON.stringify(data));
                window.dispatchEvent(new CustomEvent('statusAvancadoUpdated'));
                return true;
            }
            
            // ADICIONAR REGISTRO AO HISTÓRICO
            static addHistorico(acao, detalhes) {
                const data = this.load();
                const registro = {
                    data: new Date().toISOString(),
                    acao: acao,
                    detalhes: detalhes,
                    nivel: data.nivel,
                    xp: data.experiencia
                };
                
                data.historico.unshift(registro);
                if (data.historico.length > 50) {
                    data.historico = data.historico.slice(0, 50);
                }
                
                this.save(data);
                return registro;
            }
            
            // ADICIONAR PONTO A UM ATRIBUTO
            static addPoint(atributo, quantidade = 1) {
                const data = this.load();
                
                if (data.atributos[atributo] + quantidade > data.limitePorAtributo) {
                    this.showNotification(`Limite de ${data.limitePorAtributo} atingido para ${atributo}!`, 'error');
                    return false;
                }
                
                const novoTotal = data.pontosUsados + quantidade;
                if (novoTotal > data.limiteTotalPontos) {
                    this.showNotification(`Limite total de ${data.limiteTotalPontos} pontos atingido!`, 'error');
                    return false;
                }
                
                if (!data.modoMestre && data.pontosDisponiveis < quantidade) {
                    this.showNotification('Pontos insuficientes!', 'error');
                    return false;
                }
                
                data.atributos[atributo] += quantidade;
                data.pontosUsados += quantidade;
                
                if (!data.modoMestre) {
                    data.pontosDisponiveis -= quantidade;
                }
                
                this.save(data);
                
                this.addHistorico(
                    'Adicionar ponto',
                    `${quantidade} ponto(s) em ${atributo} (agora: ${data.atributos[atributo]})`
                );
                
                this.showNotification(`${quantidade} ponto(s) adicionado(s) em ${atributo}`, 'success');
                
                this.checkRandomDistribution(data);
                
                return data;
            }
            
            // REMOVER PONTO DE UM ATRIBUTO
            static removePoint(atributo, quantidade = 1) {
                const data = this.load();
                
                if (data.atributos[atributo] >= quantidade) {
                    data.atributos[atributo] -= quantidade;
                    data.pontosUsados -= quantidade;
                    
                    if (!data.modoMestre) {
                        data.pontosDisponiveis += quantidade;
                    }
                    
                    this.save(data);
                    
                    this.addHistorico(
                        'Remover ponto',
                        `${quantidade} ponto(s) removido(s) de ${atributo} (agora: ${data.atributos[atributo]})`
                    );
                    
                    this.showNotification(`${quantidade} ponto(s) removido(s) de ${atributo}`, 'info');
                    return data;
                }
                
                return false;
            }
            
            // ADICIONAR PONTOS DISPONÍVEIS (MESTRE)
            static addPontosDisponiveis(quantidade) {
                const data = this.load();
                data.pontosDisponiveis += parseInt(quantidade);
                this.save(data);
                
                this.addHistorico(
                    'Adicionar pontos',
                    `${quantidade} ponto(s) adicionado(s) ao total disponível`
                );
                
                this.showNotification(`${quantidade} ponto(s) adicionado(s)`, 'success');
                return data;
            }
            
            // VERIFICAR DISTRIBUIÇÃO ALEATÓRIA
            static checkRandomDistribution(data) {
                const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                
                if (totalAtual >= data.minimoParaAleatorio && !data.ultimaDistribuicao) {
                    const pontosDistribuir = data.pontosDistribuicaoAleatoria;
                    const atributos = Object.keys(data.atributos);
                    let pontosRestantes = pontosDistribuir;
                    
                    while (pontosRestantes > 0) {
                        const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                        
                        if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                            data.atributos[attrAleatorio]++;
                            pontosRestantes--;
                        }
                    }
                    
                    data.ultimaDistribuicao = new Date().toISOString();
                    data.pontosUsados += pontosDistribuir;
                    
                    if (!data.modoMestre) {
                        data.pontosDisponiveis = Math.max(0, data.pontosDisponiveis - pontosDistribuir);
                    }
                    
                    this.save(data);
                    
                    this.addHistorico(
                        'Distribuição aleatória',
                        `${pontosDistribuir} ponto(s) distribuído(s) aleatoriamente (total ≥ ${data.minimoParaAleatorio})`
                    );
                    
                    this.showNotification(
                        `🎲 ${pontosDistribuir} pontos distribuídos aleatoriamente!`, 
                        'success'
                    );
                    
                    return true;
                }
                
                return false;
            }
            
            // DISTRIBUIÇÃO ALEATÓRIA AVANÇADA
            static distribuirAleatorioAvancado(quantidade, metodo = 'total') {
                const data = this.load();
                const pontosDistribuir = parseInt(quantidade);
                const atributos = Object.keys(data.atributos);
                
                if (metodo === 'total') {
                    const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                    
                    if (totalAtual >= data.minimoParaAleatorio) {
                        return this.distribuirPontosAleatorios(data, pontosDistribuir);
                    } else {
                        const pontosParaMinimo = data.minimoParaAleatorio - totalAtual;
                        
                        for (let i = 0; i < pontosParaMinimo; i++) {
                            const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                            if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                                data.atributos[attrAleatorio]++;
                            }
                        }
                        
                        return this.distribuirPontosAleatorios(data, pontosDistribuir);
                    }
                } else if (metodo === 'fixo') {
                    return this.distribuirPontosAleatorios(data, pontosDistribuir);
                } else if (metodo === 'porcentagem') {
                    const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                    const pontosDistribuirCalc = Math.floor(totalAtual * (pontosDistribuir / 100));
                    return this.distribuirPontosAleatorios(data, pontosDistribuirCalc);
                } else if (metodo === 'balanceado') {
                    const pontosPorAtributo = Math.floor(pontosDistribuir / atributos.length);
                    const pontosRestantes = pontosDistribuir % atributos.length;
                    
                    atributos.forEach(attr => {
                        data.atributos[attr] = Math.min(
                            data.limitePorAtributo,
                            data.atributos[attr] + pontosPorAtributo
                        );
                    });
                    
                    for (let i = 0; i < pontosRestantes; i++) {
                        const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                        if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                            data.atributos[attrAleatorio]++;
                        }
                    }
                    
                    data.pontosUsados += pontosDistribuir;
                    this.save(data);
                    
                    this.addHistorico(
                        'Distribuição balanceada',
                        `${pontosDistribuir} ponto(s) distribuído(s) balanceadamente`
                    );
                    
                    this.showNotification(
                        `⚖️ ${pontosDistribuir} pontos distribuídos balanceadamente`,
                        'success'
                    );
                    
                    return data;
                }
                
                return false;
            }
            
            // DISTRIBUIR PONTOS ALEATORIAMENTE (FUNÇÃO AUXILIAR)
            static distribuirPontosAleatorios(data, pontosDistribuir) {
                const atributos = Object.keys(data.atributos);
                let pontosRestantes = pontosDistribuir;
                
                while (pontosRestantes > 0) {
                    const attrAleatorio = atributos[Math.floor(Math.random() * atributos.length)];
                    
                    if (data.atributos[attrAleatorio] < data.limitePorAtributo) {
                        data.atributos[attrAleatorio]++;
                        pontosRestantes--;
                    }
                }
                
                data.pontosUsados += pontosDistribuir;
                data.ultimaDistribuicao = new Date().toISOString();
                this.save(data);
                
                return data;
            }
            
            // ADICIONAR EXPERIÊNCIA
            static addExperiencia(quantidade) {
                const data = this.load();
                const xpAntes = data.experiencia;
                
                data.experiencia += parseInt(quantidade);
                
                let niveisGanhos = 0;
                while (data.experiencia >= data.experienciaProximoNivel) {
                    data.experiencia -= data.experienciaProximoNivel;
                    data.nivel++;
                    niveisGanhos++;
                    
                    data.experienciaProximoNivel = Math.floor(data.experienciaProximoNivel * 1.5);
                    data.pontosDisponiveis += data.pontosPorNivel;
                }
                
                this.save(data);
                
                this.addHistorico(
                    'Adicionar XP',
                    `${quantidade} XP adicionado(s) (nível: ${data.nivel})`
                );
                
                if (niveisGanhos > 0) {
                    this.showNotification(
                        `🎉 Nível ${data.nivel}! +${data.pontosPorNivel * niveisGanhos} pontos ganhos`,
                        'success'
                    );
                } else {
                    this.showNotification(
                        `${quantidade} XP adicionado(s) (faltam ${data.experienciaProximoNivel - data.experiencia} XP para o próximo nível)`,
                        'info'
                    );
                }
                
                return { data, niveisGanhos, xpAntes };
            }
            
            // SUBIR DE NÍVEL MANUALMENTE
            static subirNivel() {
                const data = this.load();
                data.nivel++;
                data.pontosDisponiveis += data.pontosPorNivel;
                data.experiencia = 0;
                
                data.experienciaProximoNivel = Math.floor(data.experienciaProximoNivel * 1.5);
                
                this.save(data);
                
                this.addHistorico(
                    'Subir de nível',
                    `Nível ${data.nivel} alcançado manualmente`
                );
                
                this.showNotification(
                    `⬆️ Nível ${data.nivel}! +${data.pontosPorNivel} pontos ganhos`,
                    'success'
                );
                
                return data;
            }
            
            // ALTERAR CONFIGURAÇÕES
            static updateConfig(config) {
                const data = this.load();
                
                Object.keys(config).forEach(key => {
                    if (data[key] !== undefined) {
                        data[key] = config[key];
                    }
                });
                
                this.save(data);
                
                this.addHistorico(
                    'Atualizar configurações',
                    'Configurações do sistema modificadas'
                );
                
                this.showNotification('Configurações atualizadas com sucesso!', 'success');
                return data;
            }
            
            // ALTERNAR MODO MESTRE
            static toggleModoMestre() {
                const data = this.load();
                data.modoMestre = !data.modoMestre;
                this.save(data);
                
                this.showNotification(
                    `Modo Mestre ${data.modoMestre ? 'ATIVADO' : 'DESATIVADO'}`,
                    data.modoMestre ? 'warning' : 'info'
                );
                
                return data;
            }
            
            // RESETAR TUDO
            static reset() {
                if (confirm('Tem certeza que deseja resetar TODOS os status para 0?\n\nIsso irá resetar atributos, pontos, nível e XP.')) {
                    const data = this.load();
                    
                    Object.keys(data.atributos).forEach(key => {
                        data.atributos[key] = 0;
                    });
                    
                    data.pontosDisponiveis = 0;
                    data.pontosUsados = 0;
                    
                    data.nivel = 1;
                    data.experiencia = 0;
                    data.experienciaProximoNivel = 1000;
                    
                    data.ultimaDistribuicao = null;
                    
                    this.save(data);
                    
                    this.addHistorico(
                        'Resetar tudo',
                        'Todos os status foram resetados para 0'
                    );
                    
                    this.showNotification('Sistema resetado com sucesso!', 'info');
                    return data;
                }
                
                return false;
            }
            
            // EXPORTAR DADOS
            static exportData() {
                const data = this.load();
                const exportData = {
                    ...data,
                    exportadoEm: new Date().toISOString(),
                    versao: '3.0'
                };
                
                return JSON.stringify(exportData, null, 2);
            }
            
            // IMPORTAR DADOS
            static importData(jsonString) {
                try {
                    const imported = JSON.parse(jsonString);
                    
                    if (imported.versao === '3.0') {
                        localStorage.setItem(STATUS_STORAGE_KEY, jsonString);
                        
                        this.showNotification('Dados importados com sucesso!', 'success');
                        return true;
                    } else {
                        this.showNotification('Versão incompatível dos dados!', 'error');
                        return false;
                    }
                } catch (error) {
                    this.showNotification('Erro ao importar dados!', 'error');
                    return false;
                }
            }
            
            // MOSTRAR NOTIFICAÇÃO
            static showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `status-notification status-notification-${type}`;
                notification.innerHTML = `
                    <i data-lucide="${type === 'success' ? 'check-circle' : 
                                    type === 'warning' ? 'alert-triangle' : 
                                    type === 'error' ? 'x-circle' : 'info'}" 
                    class="notification-icon"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                if (window.lucide) {
                    lucide.createIcons();
                }
                
                setTimeout(() => {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 500);
                }, 3000);
                
                return notification;
            }
        }

        // ====================================================================
        // SISTEMA DE SORTE/DERIVADOS (DEVE VIR ANTES DA INTERFACE)
        // ====================================================================

        // Variáveis globais do sistema de sorte
        let sorteAtual = null;
        let dadosSorte = [0, 0, 0];
        let sorteFixada = false;
        let nivelAtual = 1;
        let xpAtual = 0;
        let xpProximoNivel = 1000;

        // Sistema de derivados avançados
        const sistemaDerivados = {
            derivados: {
                blindagem: { ativo: false, valor: 0, max: 100, cor: '#dc2626', icone: 'shield' },
                velocidade: { ativo: false, valor: 0, max: 100, cor: '#22c55e', icone: 'wind' },
                iniciativa: { ativo: false, valor: 0, max: 100, cor: '#4a9eff', icone: 'zap' },
                percepcao: { ativo: false, valor: 0, max: 100, cor: '#8b5cf6', icone: 'eye' },
                visaoNoturna: { ativo: false, valor: 0, max: 100, cor: '#f59e0b', icone: 'moon' },
                esquiva: { ativo: false, valor: 0, max: 100, cor: '#ec4899', icone: 'move' },
                resistencia: { ativo: false, valor: 0, max: 100, cor: '#14b8a6', icone: 'shield-off' }
            },
            
            recursos: {
                vida: { atual: 100, max: 100, cor: '#dc2626', icone: 'heart' },
                mana: { atual: 100, max: 100, cor: '#4a9eff', icone: 'sparkles' },
                estamina: { atual: 100, max: 100, cor: '#22c55e', icone: 'zap' }
            },
            
            atributos: {
                forca: 0,
                destreza: 0,
                constituicao: 0,
                inteligencia: 0,
                sabedoria: 0,
                carisma: 0
            }
        };

        // FUNÇÕES DO SISTEMA DE SORTE
        function rolarSorte() {
            if (sorteFixada) {
                if (!confirm("O destino está fixado! Deseja rolar novamente e sobrescrever?")) {
                    return;
                }
                sorteFixada = false;
            }
            
            const dado1 = Math.floor(Math.random() * 100) + 1;
            const dado2 = Math.floor(Math.random() * 100) + 1;
            const dado3 = Math.floor(Math.random() * 100) + 1;
            
            dadosSorte = [dado1, dado2, dado3];
            
            const resultadoBruto = ((dado1 + dado3) * 2 - dado2) / 2;
            let resultadoFinal = Math.round(resultadoBruto);
            resultadoFinal = Math.max(1, Math.min(100, resultadoFinal));
            
            sorteAtual = resultadoFinal;
            
            atualizarDisplaySorte();
            
            const secaoSorte = document.getElementById('secao-dados-sorte');
            if (secaoSorte) secaoSorte.classList.remove('hidden');
            
            gerarRecomendacoesBaseadasNaSorte(sorteAtual);
            salvarSorteNoLocalStorage();
            aplicarEfeitoSorteNosDerivados();
            
            mostrarFeedback(`🎲 Destino rolado: ${sorteAtual}%`, 'success');
        }

        function fixarSorte() {
            sorteFixada = true;
            
            const botaoFixar = document.getElementById('btn-fixar-sorte');
            if (botaoFixar) {
                botaoFixar.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Destino Selado!';
                botaoFixar.classList.remove('bg-gradient-to-r', 'from-[#1a1510]', 'to-[#2a2318]', 'hover:bg-[#2a2318]');
                botaoFixar.classList.add('bg-gradient-to-r', 'from-[#8b7355]/30', 'to-[#d4a76a]/30', 'border-[#d4a76a]');
                botaoFixar.disabled = true;
                if (window.lucide) lucide.createIcons();
            }
            
            const secaoSorte = document.getElementById('secao-dados-sorte');
            if (secaoSorte) {
                secaoSorte.classList.add('border-[#d4a76a]');
                secaoSorte.style.boxShadow = '0 0 30px rgba(212, 167, 106, 0.2)';
                setTimeout(() => {
                    secaoSorte.style.boxShadow = '';
                }, 1000);
            }
            
            salvarSorteNoLocalStorage();
            
            let mensagem = '';
            if (sorteAtual >= 75) {
                mensagem = `✨ Destino glorioso fixado em ${sorteAtual}%! A fortuna sorri para você.`;
            } else if (sorteAtual <= 25) {
                mensagem = `🌑 Destino sombrio fixado em ${sorteAtual}%. O caminho será árduo, mas não impossível.`;
            } else {
                mensagem = `⚖️ Destino fixado em ${sorteAtual}%. O equilíbrio está em suas mãos.`;
            }
            
            mostrarFeedback(mensagem, 'success');
        }

        function atualizarDisplaySorte() {
            const cardSorte = document.getElementById('calc-sorte');
            if (cardSorte) {
                cardSorte.textContent = sorteAtual !== null ? `${sorteAtual}%` : '--';
                
                const cardContainer = cardSorte.closest('.bg-\\[\\#1a1510\\]') || cardSorte.closest('.card-destino');
                if (cardContainer) {
                    cardContainer.classList.remove('border-[#8b7355]', 'border-[#f4d29a]', 'border-[#8b4513]');
                    cardContainer.classList.remove('shadow-lg', 'shadow-[#f4d29a]/20');
                    
                    if (sorteAtual >= 75) {
                        cardContainer.classList.add('border-[#f4d29a]', 'shadow-lg', 'shadow-[#f4d29a]/20');
                    } else if (sorteAtual <= 25) {
                        cardContainer.classList.add('border-[#8b4513]');
                    } else {
                        cardContainer.classList.add('border-[#8b7355]');
                    }
                }
            }
            
            const dadosIds = ['dado-sorte-1', 'dado-sorte-2', 'dado-sorte-3'];
            dadosIds.forEach((id, index) => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.classList.add('dice-rolling');
                    setTimeout(() => {
                        elemento.textContent = dadosSorte[index];
                        
                        const dadoContainer = elemento.closest('.rounded-xl') || elemento.closest('.dado-container');
                        if (dadosSorte[index] > 80 && dadoContainer) {
                            dadoContainer.classList.add('high-roll');
                        } else {
                            dadoContainer.classList.remove('high-roll');
                        }
                        
                        setTimeout(() => {
                            elemento.classList.remove('dice-rolling');
                        }, 800);
                    }, 300);
                }
            });
            
            const calculoEl = document.getElementById('calculo-sorte');
            if (calculoEl) {
                const calculo = `((<span class="text-white">${dadosSorte[0]}</span> + <span class="text-white">${dadosSorte[2]}</span>) × 2 - <span class="text-white">${dadosSorte[1]}</span>) ÷ 2 = <span class="${sorteAtual >= 75 ? 'text-[#f4d29a]' : sorteAtual <= 25 ? 'text-[#8b4513]' : 'text-[#d4a76a]'} font-bold">${sorteAtual}</span>`;
                calculoEl.innerHTML = calculo;
            }
            
            const titulo = document.querySelector('#secao-dados-sorte h3') || document.querySelector('.titulo-destino');
            if (titulo) {
                if (sorteAtual >= 75) {
                    titulo.innerHTML = '<i data-lucide="crown" class="w-5 h-5 inline mr-2 text-[#f4d29a]"></i>Destino Glorioso';
                } else if (sorteAtual <= 25) {
                    titulo.innerHTML = '<i data-lucide="cloud-rain" class="w-5 h-5 inline mr-2 text-[#8b4513]"></i>Destino Sombrio';
                } else {
                    titulo.innerHTML = '<i data-lucide="compass" class="w-5 h-5 inline mr-2 text-[#d4a76a]"></i>Destino Incerto';
                }
                if (window.lucide) lucide.createIcons();
            }
        }

        function gerarRecomendacoesBaseadasNaSorte(sorte) {
            const container = document.getElementById('card-personagem-output') || document.getElementById('recomendacoes-container');
            if (!container) return;
            
            let recomendacao = '';
            let icone = '🎯';
            
            if (sorte >= 90) {
                recomendacao = 'SORTE LENDÁRIA! Você é abençoado pelos deuses. Armas com crítico máximo são obrigatórias.';
                icone = '✨';
            } else if (sorte >= 75) {
                recomendacao = 'Sorte excelente! Foque em armas com alto dano crítico e efeitos especiais.';
                icone = '🎲';
            } else if (sorte >= 60) {
                recomendacao = 'Sorte acima da média. Armas balanceadas com chance de crítico são ideais.';
                icone = '🍀';
            } else if (sorte >= 40) {
                recomendacao = 'Sorte mediana. Use armas confiáveis com dano constante.';
                icone = '⚖️';
            } else if (sorte >= 25) {
                recomendacao = 'Sorte abaixo da média. Prefira armas defensivas e equipamentos de proteção.';
                icone = '🛡️';
            } else {
                recomendacao = 'Sorte crítica baixa. Foque em sobrevivência e evite riscos desnecessários.';
                icone = '⚠️';
            }
            
            let cardSorte = document.getElementById('card-recomendacao-sorte');
            if (!cardSorte) {
                cardSorte = document.createElement('div');
                cardSorte.id = 'card-recomendacao-sorte';
                cardSorte.className = `bg-[#1a1510] border border-[#8b7355] p-4 rounded-lg mb-4`;
                container.prepend(cardSorte);
            }
            
            cardSorte.innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">${icone}</span>
                    <span class="font-cinzel font-bold text-[#f4d29a]">DESTINO: ${sorte}%</span>
                </div>
                <p class="text-[#d4a76a]">${recomendacao}</p>
                ${sorte >= 75 ? `
                <div class="mt-3 p-2 bg-[#8b7355]/10 border border-[#8b7355]/20 rounded">
                    <p class="text-sm text-[#f4d29a] font-medium">🎯 Armas recomendadas (Alto Crítico):</p>
                    <ul class="text-xs text-[#d4a76a] mt-1 list-disc list-inside">
                        <li>Adagas Gêmeas da Sorte (19-20/x3)</li>
                        <li>Espada Vorpal (18-20/x2)</li>
                        <li>Arco do Acerto Certeiro (x4 crítico)</li>
                    </ul>
                </div>
                ` : ''}
            `;
        }

        function salvarSorteNoLocalStorage() {
            const dadosSorteParaSalvar = {
                valor: sorteAtual,
                dados: dadosSorte,
                fixada: sorteFixada,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('grimorio_sorte', JSON.stringify(dadosSorteParaSalvar));
        }

        function carregarSorteDoLocalStorage() {
            const dadosSalvos = localStorage.getItem('grimorio_sorte');
            if (!dadosSalvos) return;
            
            try {
                const dados = JSON.parse(dadosSalvos);
                sorteAtual = dados.valor;
                dadosSorte = dados.dados || [0, 0, 0];
                sorteFixada = dados.fixada || false;
                
                if (sorteAtual !== null) {
                    atualizarDisplaySorte();
                    
                    if (sorteFixada) {
                        const secaoSorte = document.getElementById('secao-dados-sorte');
                        if (secaoSorte) secaoSorte.classList.remove('hidden');
                        
                        const botaoFixar = document.getElementById('btn-fixar-sorte');
                        if (botaoFixar) {
                            botaoFixar.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Destino Selado!';
                            botaoFixar.disabled = true;
                        }
                    }
                    
                    gerarRecomendacoesBaseadasNaSorte(sorteAtual);
                }
            } catch (error) {
                console.error('Erro ao carregar sorte:', error);
            }
        }

        function configurarEventosSorte() {
            const btnRolar = document.getElementById('btn-rolar-sorte');
            if (btnRolar) {
                btnRolar.addEventListener('click', rolarSorte);
            }
            
            const btnFixar = document.getElementById('btn-fixar-sorte');
            if (btnFixar) {
                btnFixar.addEventListener('click', fixarSorte);
            }
            
            const btnReset = document.getElementById('btn-reset-sorte');
            if (btnReset) {
                btnReset.addEventListener('click', function() {
                    if (confirm('Resetar sorte e desfazer destino fixado?')) {
                        sorteAtual = null;
                        dadosSorte = [0, 0, 0];
                        sorteFixada = false;
                        atualizarDisplaySorte();
                        salvarSorteNoLocalStorage();
                        mostrarFeedback('Destino resetado!', 'info');
                    }
                });
            }
        }
        // Adicione esta função no sistema de derivados
        function resetarDerivadosAvancados() {
            if (!confirm('Tem certeza que deseja resetar TODOS os derivados avançados?\n\nIsso irá resetar blindagem, velocidade, iniciativa, percepção, visão noturna, esquiva e resistência para 0.')) {
                return;
            }
            
            // Resetar derivados
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                sistemaDerivados.derivados[key].valor = 0;
                sistemaDerivados.derivados[key].ativo = false;
            });
            
            // Resetar recursos
            sistemaDerivados.recursos.vida.atual = 100;
            sistemaDerivados.recursos.mana.atual = 100;
            sistemaDerivados.recursos.estamina.atual = 100;
            
            // Atualizar interface
            atualizarDisplayRecurso('vida');
            atualizarDisplayRecurso('mana');
            atualizarDisplayRecurso('estamina');
            gerarCardsDerivados();
            
            // Salvar
            salvarDerivadosNoLocalStorage();
            
            mostrarFeedback('Derivados avançados resetados com sucesso!', 'success');
        }

        // Adicione também uma função para resetar apenas recursos
        function resetarRecursos() {
            if (confirm('Resetar recursos vitais para valores máximos?')) {
                sistemaDerivados.recursos.vida.atual = sistemaDerivados.recursos.vida.max;
                sistemaDerivados.recursos.mana.atual = sistemaDerivados.recursos.mana.max;
                sistemaDerivados.recursos.estamina.atual = sistemaDerivados.recursos.estamina.max;
                
                atualizarDisplayRecurso('vida');
                atualizarDisplayRecurso('mana');
                atualizarDisplayRecurso('estamina');
                
                salvarDerivadosNoLocalStorage();
                mostrarFeedback('Recursos restaurados!', 'success');
            }
        }

        // Adicione também uma função para resetar apenas derivados (sem recursos)
        function resetarApenasDerivados() {
            if (!confirm('Resetar apenas derivados (blindagem, velocidade, etc.) para 0?')) {
                return;
            }
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                sistemaDerivados.derivados[key].valor = 0;
            });
            
            gerarCardsDerivados();
            salvarDerivadosNoLocalStorage();
            mostrarFeedback('Derivados resetados!', 'info');
        }

        // FUNÇÕES DO SISTEMA DE DERIVADOS
        function inicializarSistemaDerivados() {
            carregarDerivadosDoLocalStorage();
            criarInterfaceDerivados();
            configurarEventosRecursos();
            console.log('Sistema de Derivados inicializado');
        }

        function criarInterfaceDerivados() {
            const container = document.getElementById('derivados-container') || document.getElementById('status-container');
            if (!container) return;
            
            const estilo = document.createElement('style');
            estilo.textContent = `
                /* ... estilos existentes ... */
                
                /* Novas classes para recursos */
                .card-vida {
                    border-color: var(--recurso-vida) !important;
                }
                
                .card-mana {
                    border-color: var(--recurso-mana) !important;
                }
                
                .card-estamina {
                    border-color: var(--recurso-estamina) !important;
                }
            `;
            document.head.appendChild(estilo);
            
            const recursosHTML = `
                <div class="mb-8">
                    <h3 class="font-cinzel text-xl font-bold text-white mb-4 flex items-center justify-between">
                        <span class="flex items-center gap-2">
                            <i data-lucide="heart" class="w-5 h-5 text-red-400"></i>
                            Recursos Vitais (0-100)
                        </span>
                        <button onclick="resetarDerivadosAvancados()" 
                                class="px-4 py-2 bg-gradient-to-r from-red-600 to-red-800 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity flex items-center gap-2 text-sm">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            Resetar Derivados
                        </button>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Vida -->
                        <div class="card-vida bg-[#0f0f12] border-2 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-lg flex items-center justify-center recurso-vida">
                                        <i data-lucide="heart" class="w-4 h-4"></i>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-white">Vida</span>
                                        <p class="text-xs text-gray-400">Saúde do personagem</p>
                                    </div>
                                </div>
                                <div class="font-mono text-lg">
                                    <span id="vida-atual" class="recurso-vida">${sistemaDerivados.recursos.vida.atual}</span>
                                    <span class="text-gray-500">/</span>
                                    <span id="vida-max">${sistemaDerivados.recursos.vida.max}</span>
                                </div>
                            </div>
                            
                            <div class="h-2 bg-[#2a2a2e] rounded-full overflow-hidden mb-3">
                                <div id="barra-vida" class="h-full bg-gradient-to-r from-red-600 to-red-400 rounded-full" 
                                    style="width: ${(sistemaDerivados.recursos.vida.atual / sistemaDerivados.recursos.vida.max) * 100}%">
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <input type="number" id="input-vida" min="0" max="${sistemaDerivados.recursos.vida.max}" 
                                    value="${sistemaDerivados.recursos.vida.atual}"
                                    class="flex-1 bg-[#0a0a0c] border border-[#2a2a2e] rounded-lg px-3 py-2 text-white text-center recurso-vida">
                                <button onclick="ajustarRecurso('vida', document.getElementById('input-vida').value)" 
                                        class="px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Mana -->
                        <div class="card-mana bg-[#0f0f12] border-2 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-lg flex items-center justify-center recurso-mana">
                                        <i data-lucide="sparkles" class="w-4 h-4"></i>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-white">Mana</span>
                                        <p class="text-xs text-gray-400">Poder mágico</p>
                                    </div>
                                </div>
                                <div class="font-mono text-lg">
                                    <span id="mana-atual" class="recurso-mana">${sistemaDerivados.recursos.mana.atual}</span>
                                    <span class="text-gray-500">/</span>
                                    <span id="mana-max">${sistemaDerivados.recursos.mana.max}</span>
                                </div>
                            </div>
                            
                            <div class="h-2 bg-[#2a2a2e] rounded-full overflow-hidden mb-3">
                                <div id="barra-mana" class="h-full bg-gradient-to-r from-blue-600 to-blue-400 rounded-full" 
                                    style="width: ${(sistemaDerivados.recursos.mana.atual / sistemaDerivados.recursos.mana.max) * 100}%">
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <input type="number" id="input-mana" min="0" max="${sistemaDerivados.recursos.mana.max}" 
                                    value="${sistemaDerivados.recursos.mana.atual}"
                                    class="flex-1 bg-[#0a0a0c] border border-[#2a2a2e] rounded-lg px-3 py-2 text-white text-center recurso-mana">
                                <button onclick="ajustarRecurso('mana', document.getElementById('input-mana').value)" 
                                        class="px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Estamina -->
                        <div class="card-estamina bg-[#0f0f12] border-2 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-lg flex items-center justify-center recurso-estamina">
                                        <i data-lucide="zap" class="w-4 h-4"></i>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-white">Estamina</span>
                                        <p class="text-xs text-gray-400">Energia física</p>
                                    </div>
                                </div>
                                <div class="font-mono text-lg">
                                    <span id="estamina-atual" class="recurso-estamina">${sistemaDerivados.recursos.estamina.atual}</span>
                                    <span class="text-gray-500">/</span>
                                    <span id="estamina-max">${sistemaDerivados.recursos.estamina.max}</span>
                                </div>
                            </div>
                            
                            <div class="h-2 bg-[#2a2a2e] rounded-full overflow-hidden mb-3">
                                <div id="barra-estamina" class="h-full bg-gradient-to-r from-green-600 to-green-400 rounded-full" 
                                    style="width: ${(sistemaDerivados.recursos.estamina.atual / sistemaDerivados.recursos.estamina.max) * 100}%">
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <input type="number" id="input-estamina" min="0" max="${sistemaDerivados.recursos.estamina.max}" 
                                    value="${sistemaDerivados.recursos.estamina.atual}"
                                    class="flex-1 bg-[#0a0a0c] border border-[#2a2a2e] rounded-lg px-3 py-2 text-white text-center recurso-estamina">
                                <button onclick="ajustarRecurso('estamina', document.getElementById('input-estamina').value)" 
                                        class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ... resto do código permanece igual ...
        }

        function gerarCardsDerivados() {
            const grid = document.getElementById('grid-derivados');
            if (!grid) return;
            
            grid.innerHTML = Object.entries(sistemaDerivados.derivados).map(([key, derivado]) => {
                const porcentagem = (derivado.valor / derivado.max) * 100;
                const ativoClass = derivado.ativo ? 'border-opacity-100' : 'border-opacity-30 opacity-70';
                
                return `
                    <div class="derivado-card bg-[#0f0f12] border ${ativoClass} rounded-xl p-4 cursor-pointer"
                        onclick="toggleDerivado('${key}')"
                        style="border-color: ${derivado.cor}">
                        
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 rounded-lg flex items-center justify-center" 
                                    style="background: ${derivado.cor}20">
                                    <i data-lucide="${derivado.icone}" style="color: ${derivado.cor}" class="w-4 h-4"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white capitalize">${key.replace(/([A-Z])/g, ' $1')}</h4>
                                    <p class="text-xs text-gray-400">${derivado.ativo ? 'Ativo' : 'Inativo'}</p>
                                </div>
                            </div>
                            
                            <div class="text-right">
                                <div class="font-mono text-2xl font-bold" style="color: ${derivado.cor}" 
                                    id="valor-${key}">${derivado.valor}</div>
                                <div class="text-xs text-gray-500">/ ${derivado.max}</div>
                            </div>
                        </div>
                        
                        <div class="h-2 bg-[#2a2a2e] rounded-full overflow-hidden mb-3">
                            <div class="h-full rounded-full" id="barra-${key}" 
                                style="width: ${porcentagem}%; background: ${derivado.cor}">
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <input type="range" min="0" max="${derivado.max}" value="${derivado.valor}" 
                                oninput="ajustarDerivado('${key}', this.value)"
                                class="flex-1" style="color: ${derivado.cor}">
                            
                            <button onclick="calcularDerivado('${key}')" 
                                    class="px-3 py-2 rounded-lg text-white" 
                                    style="background: ${derivado.cor}">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            </button>
                        </div>
                        
                        <div class="mt-3 text-xs text-gray-400" id="desc-${key}">
                            ${obterDescricaoDerivado(key)}
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function toggleDerivado(key) {
            if (!sistemaDerivados.derivados[key]) return;
            
            sistemaDerivados.derivados[key].ativo = !sistemaDerivados.derivados[key].ativo;
            
            const card = document.querySelector(`[onclick="toggleDerivado('${key}')"]`);
            if (card) {
                if (sistemaDerivados.derivados[key].ativo) {
                    card.classList.remove('border-opacity-30', 'opacity-70');
                    card.classList.add('border-opacity-100');
                } else {
                    card.classList.remove('border-opacity-100');
                    card.classList.add('border-opacity-30', 'opacity-70');
                }
                
                const statusText = card.querySelector('p.text-xs');
                if (statusText) {
                    statusText.textContent = sistemaDerivados.derivados[key].ativo ? 'Ativo' : 'Inativo';
                }
            }
            
            salvarDerivadosNoLocalStorage();
            mostrarFeedback(`${key.replace(/([A-Z])/g, ' $1')} ${sistemaDerivados.derivados[key].ativo ? 'ativado' : 'desativado'}`, 'info');
        }

        function ajustarDerivado(key, valor) {
            if (!sistemaDerivados.derivados[key]) return;
            
            const valorInt = parseInt(valor);
            if (isNaN(valorInt)) return;
            
            sistemaDerivados.derivados[key].valor = Math.max(0, Math.min(valorInt, sistemaDerivados.derivados[key].max));
            
            const valorEl = document.getElementById(`valor-${key}`);
            const barraEl = document.getElementById(`barra-${key}`);
            
            if (valorEl) {
                valorEl.textContent = sistemaDerivados.derivados[key].valor;
            }
            
            if (barraEl) {
                const porcentagem = (sistemaDerivados.derivados[key].valor / sistemaDerivados.derivados[key].max) * 100;
                barraEl.style.width = `${porcentagem}%`;
            }
            
            salvarDerivadosNoLocalStorage();
        }

        function ajustarRecurso(tipo, valor) {
            if (!sistemaDerivados.recursos[tipo]) return;
            
            const valorInt = parseInt(valor);
            if (isNaN(valorInt)) return;
            
            sistemaDerivados.recursos[tipo].atual = Math.max(0, Math.min(valorInt, sistemaDerivados.recursos[tipo].max));
            atualizarDisplayRecurso(tipo);
            salvarDerivadosNoLocalStorage();
        }

        function atualizarDisplayRecurso(tipo) {
            const recurso = sistemaDerivados.recursos[tipo];
            if (!recurso) return;
            
            const atualEl = document.getElementById(`${tipo}-atual`);
            const maxEl = document.getElementById(`${tipo}-max`);
            const barraEl = document.getElementById(`barra-${tipo}`);
            const inputEl = document.getElementById(`input-${tipo}`);
            
            if (atualEl) atualEl.textContent = recurso.atual;
            if (maxEl) maxEl.textContent = recurso.max;
            if (inputEl) inputEl.value = recurso.atual;
            
            if (barraEl) {
                const porcentagem = (recurso.atual / recurso.max) * 100;
                barraEl.style.width = `${porcentagem}%`;
            }
        }

        function calcularDerivado(key) {
            if (!sistemaDerivados.derivados[key]) return;
            
            const { forca, destreza, constituicao, inteligencia, sabedoria, carisma } = sistemaDerivados.atributos;
            const nivel = nivelAtual;
            let valor = 0;
            let descricao = '';
            
            switch(key) {
                case 'blindagem':
                    const blindagemBase = Math.floor(constituicao * 0.7 + forca * 0.3);
                    valor = Math.floor(blindagemBase * (1 + nivel * 0.1));
                    descricao = `CON(${constituicao})×0.7 + STR(${forca})×0.3 = ${blindagemBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'velocidade':
                    const velocidadeBase = Math.floor(destreza * 0.8 + constituicao * 0.2);
                    valor = Math.floor(velocidadeBase * (1 + nivel * 0.08));
                    descricao = `DEX(${destreza})×0.8 + CON(${constituicao})×0.2 = ${velocidadeBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'iniciativa':
                    const iniciativaBase = Math.floor(destreza * 0.6 + inteligencia * 0.4);
                    valor = Math.floor(iniciativaBase * (1 + nivel * 0.06));
                    descricao = `DEX(${destreza})×0.6 + INT(${inteligencia})×0.4 = ${iniciativaBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'percepcao':
                    const percepcaoBase = Math.floor(sabedoria * 0.7 + inteligencia * 0.3);
                    valor = Math.floor(percepcaoBase * (1 + nivel * 0.07));
                    descricao = `WIS(${sabedoria})×0.7 + INT(${inteligencia})×0.3 = ${percepcaoBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'visaoNoturna':
                    const visaoNoturnaBase = Math.floor((sabedoria + inteligencia) * 0.5);
                    valor = Math.floor(visaoNoturnaBase * (1 + nivel * 0.05));
                    descricao = `(WIS(${sabedoria}) + INT(${inteligencia}))×0.5 = ${visaoNoturnaBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'esquiva':
                    const esquivaBase = Math.floor(destreza * 0.9);
                    valor = Math.floor(esquivaBase * (1 + nivel * 0.12));
                    descricao = `DEX(${destreza})×0.9 = ${esquivaBase} × nível(${nivel}) = ${valor}`;
                    break;
                    
                case 'resistencia':
                    const resistenciaBase = Math.floor(constituicao * 0.8);
                    valor = Math.floor(resistenciaBase * (1 + nivel * 0.05));
                    descricao = `CON(${constituicao})×0.8 = ${resistenciaBase} × nível(${nivel}) = ${valor}`;
                    break;
            }
            
            valor = Math.min(valor, sistemaDerivados.derivados[key].max);
            
            if (sorteAtual !== null) {
                const bonusSorte = Math.floor(valor * (sorteAtual / 500));
                valor += bonusSorte;
                descricao += ` + Sorte(${sorteAtual}%): +${bonusSorte}`;
            }
            
            sistemaDerivados.derivados[key].valor = valor;
            
            const valorEl = document.getElementById(`valor-${key}`);
            const barraEl = document.getElementById(`barra-${key}`);
            const descEl = document.getElementById(`desc-${key}`);
            
            if (valorEl) valorEl.textContent = valor;
            if (barraEl) {
                const porcentagem = (valor / sistemaDerivados.derivados[key].max) * 100;
                barraEl.style.width = `${porcentagem}%`;
            }
            if (descEl) descEl.textContent = descricao;
            
            salvarDerivadosNoLocalStorage();
            mostrarFeedback(`${key.replace(/([A-Z])/g, ' $1')} calculado: ${valor}`, 'success');
        }

        function calcularTodosDerivados() {
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                if (sistemaDerivados.derivados[key].ativo) {
                    calcularDerivado(key);
                }
            });
        }

        function obterDescricaoDerivado(key) {
            const descricoes = {
                blindagem: 'Defesa contra danos físicos (CON×0.7 + STR×0.3 + nível)',
                velocidade: 'Velocidade de movimento e ataque (DEX×0.8 + CON×0.2 + nível)',
                iniciativa: 'Quem age primeiro no combate (DEX×0.6 + INT×0.4 + nível)',
                percepcao: 'Detectar perigos e detalhes (WIS×0.7 + INT×0.3 + nível)',
                visaoNoturna: 'Ver no escuro (WIS + INT + nível)',
                esquiva: 'Evitar ataques (DEX×0.9 + nível)',
                resistencia: 'Resistir a efeitos e condições (CON×0.8 + nível)'
            };
            
            return descricoes[key] || 'Derivado calculado a partir de atributos e nível';
        }

        function aplicarEfeitoSorteNosDerivados() {
            if (sorteAtual === null) return;
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                if (sistemaDerivados.derivados[key].ativo) {
                    setTimeout(() => calcularDerivado(key), 100);
                }
            });
            
            aplicarBonusSorteRecursos();
        }

        function aplicarBonusSorteRecursos() {
            if (sorteAtual >= 75) {
                Object.keys(sistemaDerivados.recursos).forEach(key => {
                    const bonus = Math.floor(sistemaDerivados.recursos[key].max * 0.1);
                    sistemaDerivados.recursos[key].atual = Math.min(
                        sistemaDerivados.recursos[key].max,
                        sistemaDerivados.recursos[key].atual + bonus
                    );
                });
                
                mostrarFeedback(`✨ Bônus da sorte aplicado! Recursos aumentados.`, 'success');
            } else if (sorteAtual <= 25) {
                Object.keys(sistemaDerivados.recursos).forEach(key => {
                    const penalidade = Math.floor(sistemaDerivados.recursos[key].atual * 0.1);
                    sistemaDerivados.recursos[key].atual = Math.max(
                        0,
                        sistemaDerivados.recursos[key].atual - penalidade
                    );
                });
                
                mostrarFeedback(`🌑 Penalidade da sorte aplicada. Cuidado!`, 'warning');
            }
            
            Object.keys(sistemaDerivados.recursos).forEach(key => {
                atualizarDisplayRecurso(key);
            });
            
            salvarDerivadosNoLocalStorage();
        }

        function salvarDerivadosNoLocalStorage() {
            const dadosParaSalvar = {
                derivados: sistemaDerivados.derivados,
                recursos: sistemaDerivados.recursos,
                atributos: sistemaDerivados.atributos,
                nivel: nivelAtual,
                xp: xpAtual,
                xpProximo: xpProximoNivel,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('grimorio_derivados', JSON.stringify(dadosParaSalvar));
        }

        function carregarDerivadosDoLocalStorage() {
            const dadosSalvos = localStorage.getItem('grimorio_derivados');
            if (!dadosSalvos) return;
            
            try {
                const dados = JSON.parse(dadosSalvos);
                
                if (dados.derivados) {
                    Object.keys(dados.derivados).forEach(key => {
                        if (sistemaDerivados.derivados[key]) {
                            sistemaDerivados.derivados[key] = {
                                ...sistemaDerivados.derivados[key],
                                ...dados.derivados[key]
                            };
                        }
                    });
                }
                
                if (dados.recursos) {
                    Object.keys(dados.recursos).forEach(key => {
                        if (sistemaDerivados.recursos[key]) {
                            sistemaDerivados.recursos[key] = {
                                ...sistemaDerivados.recursos[key],
                                ...dados.recursos[key]
                            };
                        }
                    });
                }
                
                if (dados.atributos) {
                    sistemaDerivados.atributos = { ...dados.atributos };
                }
                
                if (dados.nivel) nivelAtual = dados.nivel;
                if (dados.xp) xpAtual = dados.xp;
                if (dados.xpProximo) xpProximoNivel = dados.xpProximo;
                
                console.log('Derivados carregados do localStorage');
                
            } catch (error) {
                console.error('Erro ao carregar derivados:', error);
            }
        }

        function mostrarFeedback(mensagem, tipo = 'info') {
            let container = document.getElementById('feedback-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'feedback-container';
                container.className = 'fixed top-4 right-4 z-50 space-y-2';
                document.body.appendChild(container);
            }
            
            const feedback = document.createElement('div');
            
            const classes = {
                success: 'bg-green-900/80 border-green-700 text-green-300',
                warning: 'bg-yellow-900/80 border-yellow-700 text-yellow-300',
                error: 'bg-red-900/80 border-red-700 text-red-300',
                info: 'bg-blue-900/80 border-blue-700 text-blue-300'
            };
            
            feedback.className = `px-4 py-3 rounded-lg border shadow-lg animate-slide-in-right ${classes[tipo] || classes.info}`;
            feedback.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>${mensagem}</span>
                </div>
            `;
            
            container.appendChild(feedback);
            
            setTimeout(() => {
                feedback.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                setTimeout(() => feedback.remove(), 500);
            }, 3000);
        }

        function configurarEventosRecursos() {
            ['vida', 'mana', 'estamina'].forEach(tipo => {
                const input = document.getElementById(`input-${tipo}`);
                if (input) {
                    input.addEventListener('input', function() {
                        const valor = parseInt(this.value);
                        if (!isNaN(valor)) {
                            const barra = document.getElementById(`barra-${tipo}`);
                            const porcentagem = (valor / sistemaDerivados.recursos[tipo].max) * 100;
                            if (barra) {
                                barra.style.width = `${Math.min(100, Math.max(0, porcentagem))}%`;
                            }
                        }
                    });
                }
            });
        }

        function atualizarAtributos(novosAtributos) {
            sistemaDerivados.atributos = { ...novosAtributos };
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                if (sistemaDerivados.derivados[key].ativo) {
                    calcularDerivado(key);
                }
            });
            
            salvarDerivadosNoLocalStorage();
            mostrarFeedback('Atributos atualizados! Derivados recalculados.', 'success');
        }

        function atualizarNivel(novoNivel, novoXP) {
            nivelAtual = novoNivel;
            xpAtual = novoXP;
            
            xpProximoNivel = Math.floor(1000 * Math.pow(1.5, nivelAtual - 1));
            
            Object.keys(sistemaDerivados.derivados).forEach(key => {
                if (sistemaDerivados.derivados[key].ativo) {
                    calcularDerivado(key);
                }
            });
            
            salvarDerivadosNoLocalStorage();
            mostrarFeedback(`Nível ${nivelAtual} atualizado!`, 'success');
        }

        function inicializarSistemaSorte() {
            carregarSorteDoLocalStorage();
            inicializarSistemaDerivados();
            configurarEventosSorte();
            console.log('Sistema de Sorte inicializado');
        }

        // ====================================================================
        // INTERFACE DO USUÁRIO (SISTEMA PRINCIPAL)
        // ====================================================================

        // CARREGAR DADOS DO SISTEMA
        function loadStatusData() {
            statusData = StatusSystemAvancado.load();
            renderAtributos(statusData);
            updateUI(statusData);
            renderHistorico(statusData.historico);
        }

        // ============================================================
        // FUNÇÃO PARA INICIALIZAR TODOS OS SISTEMAS
        // ============================================================
        function inicializarTodosSistemas() {
            // Inicializar sistema principal
            StatusSystemAvancado.init();
            
            // Carregar dados iniciais do sistema principal
            loadStatusData();
            
            // Configurar eventos do sistema principal
            setupEventListeners();
            
            // Inicializar sistema de sorte/derivados
            if (typeof inicializarSistemaSorte !== 'undefined') {
                inicializarSistemaSorte();
                
                // Integrar os dois sistemas
                const data = StatusSystemAvancado.load();
                
                // Atualizar atributos no sistema de derivados
                if (window.atualizarAtributos) {
                    window.atualizarAtributos(data.atributos);
                }
                
                // Atualizar nível no sistema de derivados
                if (window.atualizarNivel) {
                    window.atualizarNivel(data.nivel, data.experiencia);
                }
            } else {
                console.warn('Sistema de sorte não disponível');
            }
            
            console.log('Todos os sistemas inicializados');
        }

        // ============================================================
        // REMOVER CLASSES TAILWIND E SUBSTITUIR POR ESTILOS INLINE
        // ============================================================
        function corrigirEstilosTailwind() {
            const elementos = document.querySelectorAll('[class*="bg-\\["], [class*="border-\\["], [class*="text-\\["], [class*="grid-cols-"]');
            
            elementos.forEach(elemento => {
                const classes = elemento.className.split(' ');
                const novosEstilos = {};
                
                classes.forEach(classe => {
                    if (classe.startsWith('bg-[')) {
                        const cor = classe.match(/bg-\[(.*?)\]/)[1];
                        novosEstilos.background = cor;
                    } else if (classe.startsWith('border-[')) {
                        const cor = classe.match(/border-\[(.*?)\]/)[1];
                        novosEstilos.borderColor = cor;
                    } else if (classe.startsWith('text-[')) {
                        const cor = classe.match(/text-\[(.*?)\]/)[1];
                        novosEstilos.color = cor;
                    } else if (classe.startsWith('grid-cols-')) {
                        const cols = classe.match(/grid-cols-(\d+)/)[1];
                        elemento.parentElement.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
                    } else if (classe.startsWith('p-')) {
                        const padding = classe.match(/p-(\d+)/)[1];
                        novosEstilos.padding = `${padding * 0.25}rem`;
                    } else if (classe.startsWith('m-')) {
                        const margin = classe.match(/m-(\d+)/)[1];
                        novosEstilos.margin = `${margin * 0.25}rem`;
                    }
                });
                
                Object.keys(novosEstilos).forEach(estilo => {
                    elemento.style[estilo] = novosEstilos[estilo];
                });
                
                elemento.className = elemento.className.replace(/bg-\[.*?\]|border-\[.*?\]|text-\[.*?\]|grid-cols-\d+|p-\d+|m-\d+/g, '').trim();
            });
        }

        // RENDERIZAR ATRIBUTOS
        function renderAtributos(data) {
            const container = document.getElementById('atributos-container');
            const atributos = data.atributos;
            
            const config = {
                forca: { 
                    nome: 'Força', 
                    cor: '#dc2626', 
                    icone: 'sword',
                    descricao: 'Poder físico, capacidade de carga, dano corpo-a-corpo'
                },
                destreza: { 
                    nome: 'Destreza', 
                    cor: '#22c55e', 
                    icone: 'wind',
                    descricao: 'Agilidade, reflexos, precisão, ataques à distância'
                },
                constituicao: { 
                    nome: 'Constituição', 
                    cor: '#f59e0b', 
                    icone: 'shield',
                    descricao: 'Resistência, saúde, recuperação, tolerância a dano'
                },
                inteligencia: { 
                    nome: 'Inteligência', 
                    cor: '#4a9eff', 
                    icone: 'brain',
                    descricao: 'Conhecimento, lógica, magias arcanas, análise'
                },
                sabedoria: { 
                    nome: 'Sabedoria', 
                    cor: '#8b5cf6', 
                    icone: 'eye',
                    descricao: 'Percepção, intuição, magias divinas, sobrevivência'
                },
                carisma: { 
                    nome: 'Carisma', 
                    cor: '#ec4899', 
                    icone: 'sparkles',
                    descricao: 'Persuasão, liderança, interação social, presença'
                }
            };
            
            container.innerHTML = Object.keys(atributos).map(attr => {
                const cfg = config[attr];
                const porcentagem = (atributos[attr] / data.limitePorAtributo) * 100;
                const isNearLimit = atributos[attr] >= data.limitePorAtributo * 0.9;
                
                return `
                    <div class="atributo-card animate-fadeIn" style="
                        background: var(--bg-panel);
                        border: 2px solid ${cfg.cor}40;
                        border-radius: 1rem;
                        padding: 1.5rem;
                        transition: all 0.3s;
                        position: relative;
                        overflow: hidden;
                    " onmouseover="this.style.borderColor='${cfg.cor}80'; this.style.transform='translateY(-2px)';" 
                    onmouseout="this.style.borderColor='${cfg.cor}40'; this.style.transform='translateY(0)';">
                        
                        ${isNearLimit ? `
                        <div style="
                            position: absolute;
                            top: 0.5rem;
                            right: 0.5rem;
                            background: rgba(220, 38, 38, 0.9);
                            color: white;
                            padding: 0.25rem 0.5rem;
                            border-radius: 0.5rem;
                            font-size: 0.75rem;
                            font-weight: 600;
                            z-index: 2;
                        ">
                            <i data-lucide="alert-triangle" style="width: 0.75rem; height: 0.75rem; vertical-align: middle;"></i>
                            Limite
                        </div>
                        ` : ''}
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="
                                    width: 3rem;
                                    height: 3rem;
                                    background: ${cfg.cor}20;
                                    border-radius: 0.75rem;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                ">
                                    <i data-lucide="${cfg.icone}" style="width: 1.5rem; height: 1.5rem; color: ${cfg.cor};"></i>
                                </div>
                                <div>
                                    <h4 style="
                                        font-weight: 600;
                                        font-size: 1.25rem;
                                        color: ${cfg.cor};
                                        margin-bottom: 0.25rem;
                                    ">${cfg.nome}</h4>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                        ${cfg.descricao}
                                    </p>
                                </div>
                            </div>
                            
                            <div style="text-align: right;">
                                <div id="valor-${attr}" style="
                                    font-family: 'JetBrains Mono', monospace;
                                    font-size: 2.5rem;
                                    font-weight: 700;
                                    color: ${cfg.cor};
                                ">${atributos[attr]}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">
                                    / ${data.limitePorAtributo}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Progresso</span>
                                <span style="font-family: 'JetBrains Mono', monospace; font-weight: 600; color: ${cfg.cor};">
                                    ${porcentagem.toFixed(1)}%
                                </span>
                            </div>
                            <div style="
                                height: 8px;
                                background: ${cfg.cor}20;
                                border-radius: 4px;
                                overflow: hidden;
                            ">
                                <div style="
                                    height: 100%;
                                    background: ${cfg.cor};
                                    border-radius: 4px;
                                    width: ${porcentagem}%;
                                    transition: width 0.5s ease;
                                "></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                            <button onclick="removerPontoAvancado('${attr}')" style="
                                padding: 0.75rem;
                                background: ${cfg.cor}20;
                                color: ${cfg.cor};
                                border: 1px solid ${cfg.cor}40;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 0.5rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.backgroundColor='${cfg.cor}30'; this.style.borderColor='${cfg.cor}60';" 
                            onmouseout="this.style.backgroundColor='${cfg.cor}20'; this.style.borderColor='${cfg.cor}40';">
                                <i data-lucide="minus" style="width: 1rem; height: 1rem;"></i>
                                Remover
                            </button>
                            
                            <button onclick="adicionarPontoAvancado('${attr}')" style="
                                padding: 0.75rem;
                                background: ${cfg.cor};
                                color: white;
                                border: none;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 0.5rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.backgroundColor='${cfg.cor}90'; this.style.transform='translateY(-1px)';" 
                            onmouseout="this.style.backgroundColor='${cfg.cor}'; this.style.transform='translateY(0)';">
                                <i data-lucide="plus" style="width: 1rem; height: 1rem;"></i>
                                Adicionar
                            </button>
                        </div>
                        
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <i data-lucide="sliders" style="width: 1rem; height: 1rem; color: ${cfg.cor};"></i>
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Ajuste preciso</span>
                            </div>
                            <input type="range" 
                                min="0" 
                                max="${data.limitePorAtributo}" 
                                value="${atributos[attr]}" 
                                oninput="atualizarSliderAvancado('${attr}', this.value)"
                                style="
                                    width: 100%;
                                    height: 8px;
                                    background: ${cfg.cor}20;
                                    border-radius: 4px;
                            ">
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.75rem;">0</span>
                                <span style="color: var(--text-secondary); font-size: 0.75rem;">${data.limitePorAtributo}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // ATUALIZAR INTERFACE
        function updateUI(data) {
            document.getElementById('pontos-disponiveis').textContent = data.pontosDisponiveis;
            document.getElementById('pontos-ratio').textContent = `${data.pontosUsados}/${data.limiteTotalPontos}`;
            
            const pontosPercent = (data.pontosUsados / data.limiteTotalPontos) * 100;
            document.getElementById('pontos-bar').style.width = `${pontosPercent}%`;
            
            document.getElementById('nivel-atual').textContent = data.nivel;
            document.getElementById('xp-atual').textContent = data.experiencia;
            document.getElementById('xp-proximo').textContent = data.experienciaProximoNivel;
            document.getElementById('xp-restante').textContent = `${data.experienciaProximoNivel - data.experiencia} restante`;
            
            const xpPercent = (data.experiencia / data.experienciaProximoNivel) * 100;
            document.getElementById('xp-bar').style.width = `${xpPercent}%`;
            
            document.getElementById('limite-pontos').textContent = data.limiteTotalPontos;
            document.getElementById('pontos-por-nivel').textContent = data.pontosPorNivel;
            document.getElementById('minimo-aleatorio').textContent = data.minimoParaAleatorio;
            document.getElementById('limite-total').textContent = data.limiteTotalPontos;
            
            const total = Object.values(data.atributos).reduce((a, b) => a + b, 0);
            document.getElementById('total-atributos').textContent = total;
            
            const btnChefe = document.getElementById('btn-chefe');
            if (data.modoMestre) {
                btnChefe.innerHTML = '<i data-lucide="crown" style="width: 1rem; height: 1rem;"></i> Modo Mestre (ATIVO)';
                btnChefe.style.background = 'linear-gradient(135deg, #f59e0b, #dc2626)';
            } else {
                btnChefe.innerHTML = '<i data-lucide="crown" style="width: 1rem; height: 1rem;"></i> Modo Mestre';
                btnChefe.style.background = 'linear-gradient(135deg, var(--accent-purple), var(--accent-pink))';
            }
            
            const statusDistribuicao = document.getElementById('status-distribuicao');
            if (data.ultimaDistribuicao) {
                statusDistribuicao.textContent = 'Concluída';
                statusDistribuicao.style.color = '#22c55e';
            } else {
                const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                if (totalAtual >= data.minimoParaAleatorio) {
                    statusDistribuicao.textContent = 'Pronto!';
                    statusDistribuicao.style.color = '#dc2626';
                } else {
                    statusDistribuicao.textContent = `Faltam ${data.minimoParaAleatorio - totalAtual} pontos`;
                    statusDistribuicao.style.color = '#f59e0b';
                }
            }
            
            document.getElementById('modal-xp-atual').textContent = data.experiencia;
            document.getElementById('modal-xp-necessario').textContent = data.experienciaProximoNivel;
            document.getElementById('modal-xp-faltam').textContent = data.experienciaProximoNivel - data.experiencia;
            
            document.getElementById('modal-pontos-disponiveis').textContent = data.pontosDisponiveis;
            document.getElementById('modal-limite-total').textContent = data.limiteTotalPontos;
            document.getElementById('modal-pontos-restantes').textContent = data.limiteTotalPontos - data.pontosUsados;
            
            document.getElementById('input-minimo-aleatorio').value = data.minimoParaAleatorio;
            document.getElementById('input-pontos-nivel').value = data.pontosPorNivel;
            document.getElementById('input-limite-total').value = data.limiteTotalPontos;
            document.getElementById('input-pontos-aleatorio').value = data.pontosDistribuicaoAleatoria;
            document.getElementById('select-metodo-aleatorio').value = data.metodoDistribuicao;
            
            document.getElementById('input-config-limite-total').value = data.limiteTotalPontos;
            document.getElementById('input-config-pontos-nivel').value = data.pontosPorNivel;
            document.getElementById('input-config-xp-proximo').value = data.experienciaProximoNivel;
            document.getElementById('input-config-minimo-aleatorio').value = data.minimoParaAleatorio;
            document.getElementById('input-config-pontos-aleatorio').value = data.pontosDistribuicaoAleatoria;
            document.getElementById('slider-limite-atributo').value = data.limitePorAtributo;
            document.getElementById('valor-limite-atributo').textContent = data.limitePorAtributo;
        }

        // RENDERIZAR HISTÓRICO
        function renderHistorico(historico) {
            const container = document.getElementById('historico-container');
            
            if (historico.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i data-lucide="history" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                        <p>Nenhuma ação registrada ainda</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = historico.map((item, index) => {
                const data = new Date(item.data);
                const hora = data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                let icone = 'circle';
                let cor = 'var(--text-secondary)';
                
                if (item.acao.includes('Adicionar')) {
                    icone = 'plus-circle';
                    cor = '#22c55e';
                } else if (item.acao.includes('Remover')) {
                    icone = 'minus-circle';
                    cor = '#dc2626';
                } else if (item.acao.includes('Distribuição')) {
                    icone = 'dice-5';
                    cor = '#8b5cf6';
                } else if (item.acao.includes('nível')) {
                    icone = 'trending-up';
                    cor = '#f59e0b';
                } else if (item.acao.includes('Resetar')) {
                    icone = 'trash-2';
                    cor = '#ef4444';
                }
                
                return `
                    <div style="
                        padding: 0.75rem;
                        border-bottom: 1px solid var(--border-color);
                        display: flex;
                        align-items: center;
                        gap: 0.75rem;
                        transition: all 0.2s;
                    " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)';" 
                    onmouseout="this.style.backgroundColor='transparent';">
                        <div style="
                            width: 2rem;
                            height: 2rem;
                            border-radius: 0.5rem;
                            background: ${cor}20;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-shrink: 0;
                        ">
                            <i data-lucide="${icone}" style="width: 1rem; height: 1rem; color: ${cor};"></i>
                        </div>
                        
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); font-size: 0.875rem;">
                                ${item.acao}
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem;">
                                ${item.detalhes}
                            </div>
                        </div>
                        
                        <div style="text-align: right;">
                            <div style="color: var(--text-secondary); font-size: 0.75rem;">${hora}</div>
                            <div style="color: var(--text-secondary); font-size: 0.625rem; margin-top: 0.25rem;">
                                Nv. ${item.nivel}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // FUNÇÕES DE MANIPULAÇÃO DE PONTOS
        function adicionarPontoAvancado(atributo) {
            const novoStatus = StatusSystemAvancado.addPoint(atributo);
            if (novoStatus) {
                document.getElementById(`valor-${atributo}`).textContent = novoStatus.atributos[atributo];
                updateUI(novoStatus);
            }
        }

        function removerPontoAvancado(atributo) {
            const novoStatus = StatusSystemAvancado.removePoint(atributo);
            if (novoStatus) {
                document.getElementById(`valor-${atributo}`).textContent = novoStatus.atributos[atributo];
                updateUI(novoStatus);
            }
        }

        function atualizarSliderAvancado(atributo, valor) {
            const status = StatusSystemAvancado.load();
            const diferenca = valor - status.atributos[atributo];
            
            if (diferenca > 0) {
                for (let i = 0; i < diferenca; i++) {
                    if (!StatusSystemAvancado.addPoint(atributo)) break;
                }
            } else if (diferenca < 0) {
                for (let i = 0; i < Math.abs(diferenca); i++) {
                    if (!StatusSystemAvancado.removePoint(atributo)) break;
                }
            }
            
            loadStatusData();
        }

        // FUNÇÕES DE MODAL
        function abrirModal(id) {
            const modal = document.getElementById(id);
            modal.classList.add('active');
        }

        function fecharModal(id) {
            const modal = document.getElementById(id);
            modal.classList.remove('active');
        }

        // CONFIGURAR EVENTOS
        function setupEventListeners() {
            document.getElementById('btn-config').addEventListener('click', () => abrirModal('modal-config'));
            document.getElementById('btn-fechar-modal').addEventListener('click', () => fecharModal('modal-config'));
            
            document.getElementById('btn-chefe').addEventListener('click', function() {
                StatusSystemAvancado.toggleModoMestre();
                loadStatusData();
            });
            
            document.getElementById('btn-add-xp').addEventListener('click', () => abrirModal('modal-xp'));
            document.getElementById('btn-confirmar-xp').addEventListener('click', function() {
                const quantidade = document.getElementById('input-xp-quantidade').value;
                const resultado = StatusSystemAvancado.addExperiencia(quantidade);
                if (resultado) {
                    loadStatusData();
                    fecharModal('modal-xp');
                }
            });
            
            document.getElementById('btn-adicionar-pontos').addEventListener('click', () => abrirModal('modal-pontos'));
            document.getElementById('btn-confirmar-pontos').addEventListener('click', function() {
                const quantidade = document.getElementById('input-pontos-quantidade').value;
                const resultado = StatusSystemAvancado.addPontosDisponiveis(quantidade);
                if (resultado) {
                    loadStatusData();
                    fecharModal('modal-pontos');
                }
            });
            
            document.getElementById('btn-distribuir-aleatorio').addEventListener('click', function() {
                const data = StatusSystemAvancado.load();
                const totalAtual = Object.values(data.atributos).reduce((a, b) => a + b, 0);
                
                if (totalAtual >= data.minimoParaAleatorio) {
                    StatusSystemAvancado.showNotification('Distribuição automática já foi feita ou está pronta!', 'info');
                } else {
                    StatusSystemAvancado.showNotification(`Adicione mais ${data.minimoParaAleatorio - totalAtual} pontos para distribuição aleatória`, 'warning');
                }
            });
            
            document.getElementById('btn-distribuir-avancado').addEventListener('click', function() {
                const quantidade = document.getElementById('input-pontos-aleatorio').value;
                const metodo = document.getElementById('select-metodo-aleatorio').value;
                
                const resultado = StatusSystemAvancado.distribuirAleatorioAvancado(quantidade, metodo);
                if (resultado) {
                    loadStatusData();
                }
            });
            
            document.getElementById('btn-subir-nivel').addEventListener('click', function() {
                const resultado = StatusSystemAvancado.subirNivel();
                if (resultado) {
                    loadStatusData();
                }
            });
            
            document.getElementById('btn-reset-tudo').addEventListener('click', function() {
                const resultado = StatusSystemAvancado.reset();
                if (resultado) {
                    loadStatusData();
                }
            });
            
            document.getElementById('btn-aplicar-minimo').addEventListener('click', function() {
                const valor = document.getElementById('input-minimo-aleatorio').value;
                StatusSystemAvancado.updateConfig({ minimoParaAleatorio: parseInt(valor) });
                loadStatusData();
            });
            
            document.getElementById('btn-aplicar-pontos-nivel').addEventListener('click', function() {
                const valor = document.getElementById('input-pontos-nivel').value;
                StatusSystemAvancado.updateConfig({ pontosPorNivel: parseInt(valor) });
                loadStatusData();
            });
            
            document.getElementById('btn-aplicar-limite').addEventListener('click', function() {
                const valor = document.getElementById('input-limite-total').value;
                StatusSystemAvancado.updateConfig({ limiteTotalPontos: parseInt(valor) });
                loadStatusData();
            });
            
            document.getElementById('slider-limite-atributo').addEventListener('input', function() {
                document.getElementById('valor-limite-atributo').textContent = this.value;
            });
            
            document.getElementById('btn-salvar-config').addEventListener('click', function() {
                const config = {
                    limitePorAtributo: parseInt(document.getElementById('slider-limite-atributo').value),
                    limiteTotalPontos: parseInt(document.getElementById('input-config-limite-total').value),
                    pontosPorNivel: parseInt(document.getElementById('input-config-pontos-nivel').value),
                    experienciaProximoNivel: parseInt(document.getElementById('input-config-xp-proximo').value),
                    minimoParaAleatorio: parseInt(document.getElementById('input-config-minimo-aleatorio').value),
                    pontosDistribuicaoAleatoria: parseInt(document.getElementById('input-config-pontos-aleatorio').value)
                };
                
                StatusSystemAvancado.updateConfig(config);
                loadStatusData();
                fecharModal('modal-config');
            });
            
            document.getElementById('btn-restaurar-padrao').addEventListener('click', function() {
                if (confirm('Restaurar configurações padrão?')) {
                    StatusSystemAvancado.updateConfig({
                        limitePorAtributo: 100,
                        limiteTotalPontos: 100,
                        pontosPorNivel: 5,
                        experienciaProximoNivel: 1000,
                        minimoParaAleatorio: 18,
                        pontosDistribuicaoAleatoria: 10
                    });
                    loadStatusData();
                }
            });
            
            document.getElementById('btn-limpar-historico').addEventListener('click', function() {
                if (confirm('Limpar todo o histórico de ações?')) {
                    const data = StatusSystemAvancado.load();
                    data.historico = [];
                    StatusSystemAvancado.save(data);
                    renderHistorico([]);
                    StatusSystemAvancado.showNotification('Histórico limpo!', 'info');
                }
            });
            
            document.getElementById('btn-exportar-dados').addEventListener('click', function() {
                const data = StatusSystemAvancado.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `status_avancado_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                StatusSystemAvancado.showNotification('Dados exportados com sucesso!', 'success');
            });
            
            window.addEventListener('statusAvancadoUpdated', function() {
                loadStatusData();
                StatusSystemAvancado.showNotification('Dados atualizados de outra aba', 'info');
            });
        }

        // EXPOR FUNÇÕES GLOBAIS
        window.StatusSystemAvancado = StatusSystemAvancado;
        window.loadStatusData = loadStatusData;
        window.abrirModal = abrirModal;
        window.fecharModal = fecharModal;
        window.adicionarPontoAvancado = adicionarPontoAvancado;
        window.removerPontoAvancado = removerPontoAvancado;
        window.atualizarSliderAvancado = atualizarSliderAvancado;
        window.salvarSorteNoLocalStorage = salvarSorteNoLocalStorage;

        // EXPOR FUNÇÕES DO SISTEMA DE SORTE/DERIVADOS GLOBALMENTE
        window.rolarSorte = rolarSorte;
        window.fixarSorte = fixarSorte;
        window.calcularDerivado = calcularDerivado;
        window.calcularTodosDerivados = calcularTodosDerivados;
        window.ajustarDerivado = ajustarDerivado;
        window.ajustarRecurso = ajustarRecurso;
        window.toggleDerivado = toggleDerivado;
        window.atualizarAtributos = atualizarAtributos;
        window.atualizarNivel = atualizarNivel;
        window.inicializarSistemaSorte = inicializarSistemaSorte;
        // Adicione ao final do script, junto com as outras exportações
        window.resetarDerivadosAvancados = resetarDerivadosAvancados;
        window.resetarRecursos = resetarRecursos;
        window.resetarApenasDerivados = resetarApenasDerivados;
        // INICIALIZAÇÃO PRINCIPAL
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('DOM carregado - Inicializando sistemas...');
                
                // Inicializar ícones
                if (window.lucide) {
                    lucide.createIcons();
                }
                
                // Corrigir estilos Tailwind primeiro
                setTimeout(corrigirEstilosTailwind, 100);
                
                // Inicializar todos os sistemas
                inicializarTodosSistemas();
                
                console.log('Todos os sistemas carregados com sucesso');
            } catch (error) {
                console.error('Erro na inicialização:', error);
                StatusSystemAvancado.showNotification('Erro ao inicializar sistemas!', 'error');
            }
        });

        // Verificação de segurança para o sistema de sorte
        setTimeout(function() {
            if (typeof inicializarSistemaSorte === 'undefined') {
                console.warn('Sistema de sorte não inicializado automaticamente');
            }
        }, 2000);

        // Chame esta função após inicializarTodosSistemas
        setTimeout(verificarSistemaSorte, 1000);
    </script>
</body>
</html>