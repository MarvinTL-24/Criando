<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimório Digital - Sistema de Status</title>
    <script src="js/grimorio-core.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        :root {
            --bg-primary: #0a0a0c;
            --bg-panel: #0f0f12;
            --border-color: #2a2a2e;
            --text-primary: #e8e4dc;
            --text-secondary: #a0a0a0;
            --accent-blue: #4a9eff;
            --accent-red: #ff4757;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --accent-yellow: #f59e0b;
            --accent-pink: #ec4899;
            --destiny-gold: #d4a76a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .font-cinzel { 
            font-family: 'Cinzel', serif; 
            font-weight: 600;
        }
        
        /* NAVBAR CORRIGIDA */
        .navbar {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }
        
        .back-button {
            padding: 0.5rem 0.75rem;
            background: rgba(74, 158, 255, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(74, 158, 255, 0.3);
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .back-button:hover {
            background: rgba(74, 158, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-button {
            padding: 0.5rem 0.75rem;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .nav-button:hover {
            transform: translateY(-1px);
            filter: brightness(110%);
        }
        
        .nav-button-import {
            background: var(--accent-green);
        }
        
        .nav-button-export {
            background: var(--accent-blue);
        }
        
        .nav-button-config {
            background: var(--accent-purple);
        }
        
        /* LAYOUT PRINCIPAL */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            color: var(--accent-blue);
            font-family: 'Cinzel', serif;
            font-size: 1.25rem;
        }
        
        /* CARD SIMPLIFICADO */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.25rem;
            transition: border-color 0.3s;
        }
        
        .stat-card:hover {
            border-color: var(--accent-blue);
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .stat-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .stat-value {
            font-family: 'Inter', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin: 1rem 0;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* PROGRESS BAR COMO CONTROLE */
        .progress-control {
            margin: 1rem 0;
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
            position: relative;
        }
        
        .progress-handle {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            cursor: grab;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            border: 2px solid var(--bg-panel);
        }
        
        .progress-handle:active {
            cursor: grabbing;
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        /* SISTEMA DE DESTINO */
        .destiny-section {
            background: linear-gradient(135deg, rgba(26, 21, 16, 0.9), rgba(42, 35, 24, 0.9));
            border: 1px solid rgba(212, 167, 106, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dice-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .dice-box {
            text-align: center;
            padding: 1rem;
            background: rgba(26, 21, 16, 0.5);
            border-radius: 0.75rem;
            border: 1px solid rgba(212, 167, 106, 0.2);
        }
        
        .dice-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--destiny-gold);
            margin: 0.5rem 0;
        }
        
        .destiny-result {
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .destiny-percentage {
            font-size: 3rem;
            font-weight: 800;
            color: var(--destiny-gold);
            margin-bottom: 0.5rem;
        }
        
        /* ESTATÍSTICAS DERIVADAS (TEXTUAL) */
        .derived-stats {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        
        .derived-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .derived-item:last-child {
            border-bottom: none;
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-panel);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* UTILITIES */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; }
        
        /* BOTÕES */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }
        
        .btn-success {
            background: var(--accent-green);
            color: white;
        }
        
        .btn-danger {
            background: var(--accent-red);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            filter: brightness(110%);
        }
        
        /* CORES DOS ATRIBUTOS */
        .color-vida { color: var(--accent-red); }
        .color-mana { color: var(--accent-blue); }
        .color-estamina { color: var(--accent-green); }
        .color-forca { color: var(--accent-red); }
        .color-destreza { color: var(--accent-green); }
        .color-constituicao { color: var(--accent-yellow); }
        .color-inteligencia { color: var(--accent-blue); }
        .color-sabedoria { color: var(--accent-purple); }
        .color-carisma { color: var(--accent-pink); }
        
        .bg-vida { background: rgba(255, 71, 87, 0.2); }
        .bg-mana { background: rgba(74, 158, 255, 0.2); }
        .bg-estamina { background: rgba(34, 197, 94, 0.2); }
        .bg-forca { background: rgba(255, 71, 87, 0.2); }
        .bg-destreza { background: rgba(34, 197, 94, 0.2); }
        .bg-constituicao { background: rgba(245, 158, 11, 0.2); }
        .bg-inteligencia { background: rgba(74, 158, 255, 0.2); }
        .bg-sabedoria { background: rgba(139, 92, 246, 0.2); }
        .bg-carisma { background: rgba(236, 72, 153, 0.2); }
        
        /* RESPONSIVO */
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
            
            .dice-container {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                gap: 0.25rem;
            }
            
            .nav-button {
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .nav-button span {
                display: none;
            }
            
            .nav-button i {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <!-- NAVBAR CORRIGIDA -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="flex items-center gap-3">
                <a href="index.html" class="back-button">
                    <i data-lucide="arrow-left"></i>
                    <span class="font-cinzel">Voltar</span>
                </a>
                <h1 class="font-cinzel" style="color: var(--accent-blue);">Sistema de Status</h1>
            </div>
            
            <div class="nav-buttons">
                <button id="btn-importar" class="nav-button nav-button-import">
                    <i data-lucide="upload"></i>
                    <span>Importar</span>
                </button>
                <button id="btn-exportar" class="nav-button nav-button-export">
                    <i data-lucide="download"></i>
                    <span>Exportar</span>
                </button>
                <button id="btn-config" class="nav-button nav-button-config">
                    <i data-lucide="settings"></i>
                    <span>Configurar</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="container">
        <!-- RECURSOS VITAIS -->
        <section class="mb-6">
            <h2 class="section-title">
                <i data-lucide="heart"></i>
                Recursos Vitais
            </h2>
            
            <div class="card-grid">
                <!-- VIDA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-vida">
                            <i data-lucide="heart" class="color-vida"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-vida">Vida</div>
                            <div class="stat-description">Pontos de vida atuais</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-vida" id="vida-atual">100</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="vida-atual" data-max="200">
                            <div class="progress-fill bg-vida" style="width: 50%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span id="vida-maxima">100</span>
                        </div>
                    </div>
                </div>
                
                <!-- MANA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-mana">
                            <i data-lucide="flame" class="color-mana"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-mana">Mana</div>
                            <div class="stat-description">Pontos de mana atuais</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-mana" id="mana-atual">100</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="mana-atual" data-max="200">
                            <div class="progress-fill bg-mana" style="width: 50%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span id="mana-maxima">100</span>
                        </div>
                    </div>
                </div>
                
                <!-- ESTAMINA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-estamina">
                            <i data-lucide="zap" class="color-estamina"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-estamina">Estamina</div>
                            <div class="stat-description">Pontos de estamina atuais</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-estamina" id="estamina-atual">100</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="estamina-atual" data-max="200">
                            <div class="progress-fill bg-estamina" style="width: 50%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span id="estamina-maxima">100</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button onclick="restaurarRecursos()" class="btn btn-success">
                    <i data-lucide="refresh-cw"></i>
                    Restaurar Recursos
                </button>
            </div>
        </section>

        <!-- ATRIBUTOS -->
        <section class="mb-6">
            <h2 class="section-title">
                <i data-lucide="activity"></i>
                Atributos (0-100)
            </h2>
            
            <div class="card-grid">
                <!-- FORÇA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-forca">
                            <i data-lucide="sword" class="color-forca"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-forca">Força</div>
                            <div class="stat-description">Poder físico</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-forca" id="forca">0</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="forca" data-max="100">
                            <div class="progress-fill bg-forca" style="width: 0%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span>100</span>
                        </div>
                    </div>
                </div>
                
                <!-- DESTREZA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-destreza">
                            <i data-lucide="wind" class="color-destreza"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-destreza">Destreza</div>
                            <div class="stat-description">Agilidade</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-destreza" id="destreza">0</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="destreza" data-max="100">
                            <div class="progress-fill bg-destreza" style="width: 0%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span>100</span>
                        </div>
                    </div>
                </div>
                
                <!-- CONSTITUIÇÃO -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-constituicao">
                            <i data-lucide="shield" class="color-constituicao"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-constituicao">Constituição</div>
                            <div class="stat-description">Resistência</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-constituicao" id="constituicao">0</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="constituicao" data-max="100">
                            <div class="progress-fill bg-constituicao" style="width: 0%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span>100</span>
                        </div>
                    </div>
                </div>
                
                <!-- INTELIGÊNCIA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-inteligencia">
                            <i data-lucide="brain" class="color-inteligencia"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-inteligencia">Inteligência</div>
                            <div class="stat-description">Conhecimento</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-inteligencia" id="inteligencia">0</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="inteligencia" data-max="100">
                            <div class="progress-fill bg-inteligencia" style="width: 0%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span>100</span>
                        </div>
                    </div>
                </div>
                
                <!-- SABEDORIA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-sabedoria">
                            <i data-lucide="eye" class="color-sabedoria"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-sabedoria">Sabedoria</div>
                            <div class="stat-description">Percepção</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-sabedoria" id="sabedoria">0</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="sabedoria" data-max="100">
                            <div class="progress-fill bg-sabedoria" style="width: 0%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span>100</span>
                        </div>
                    </div>
                </div>
                
                <!-- CARISMA -->
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon bg-carisma">
                            <i data-lucide="sparkles" class="color-carisma"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-name color-carisma">Carisma</div>
                            <div class="stat-description">Persuasão</div>
                        </div>
                    </div>
                    
                    <div class="stat-value color-carisma" id="carisma">0</div>
                    
                    <div class="progress-control">
                        <div class="progress-bar" data-stat="carisma" data-max="100">
                            <div class="progress-fill bg-carisma" style="width: 0%">
                                <div class="progress-handle"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span>100</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center gap-3 mt-4">
                <button onclick="distribuirAleatorio()" class="btn btn-primary">
                    <i data-lucide="dice-5"></i>
                    Sorteio Aleatório
                </button>
                <button onclick="resetarAtributos()" class="btn btn-danger">
                    <i data-lucide="trash-2"></i>
                    Resetar
                </button>
            </div>
            <!-- APÓS os botões de Sorteio Aleatório e Resetar -->
            <div class="text-center mt-4">
                <div class="mb-2 text-sm" style="color: var(--text-secondary);">
                    Pontos disponíveis para sorteio: <span id="pontos-disponiveis">0</span>
                </div>
                <div class="flex gap-2 justify-center">
                    <button onclick="adicionarPontos(1)" class="btn" style="background: rgba(74, 158, 255, 0.2); color: var(--accent-blue);">
                        <i data-lucide="plus"></i> +1 Ponto
                    </button>
                    <button onclick="adicionarPontos(5)" class="btn" style="background: rgba(34, 197, 94, 0.2); color: var(--accent-green);">
                        <i data-lucide="plus"></i> +5 Pontos
                    </button>
                    <button onclick="adicionarPontos(10)" class="btn" style="background: rgba(139, 92, 246, 0.2); color: var(--accent-purple);">
                        <i data-lucide="plus"></i> +10 Pontos
                    </button>
                </div>
            </div>
        </section>

        <!-- SISTEMA DE DESTINO -->
        <section class="mb-6">
            <h2 class="section-title" style="color: var(--destiny-gold);">
                <i data-lucide="clover"></i>
                Sistema de Destino
            </h2>
            
            <div class="destiny-section">
                <div class="dice-container">
                    <div class="dice-box">
                        <div class="text-sm">Fé</div>
                        <div class="dice-value" id="dado-fe">0</div>
                    </div>
                    <div class="dice-box">
                        <div class="text-sm">Sorte</div>
                        <div class="dice-value" id="dado-sorte">0</div>
                    </div>
                    <div class="dice-box">
                        <div class="text-sm">Destino</div>
                        <div class="dice-value" id="dado-destino">0</div>
                    </div>
                </div>
                
                <div class="destiny-result">
                    <div class="destiny-percentage" id="indice-sorte">--</div>
                    <div class="text-sm" id="calculo-sorte">
                        ((Fé + Destino) × 2 - Sorte) ÷ 2
                    </div>
                </div>
                
                <div class="progress-control mb-4">
                    <div class="progress-bar" style="background: rgba(212, 167, 106, 0.1);">
                        <div class="progress-fill" style="background: var(--destiny-gold); width: 0%"></div>
                    </div>
                </div>
                
                <div class="text-center mb-4">
                    <div class="text-sm" style="color: var(--destiny-gold);" id="status-sorte">
                        Não definido
                    </div>
                    <div class="text-sm mt-1" id="rolls-info">
                        Rolagens restantes: ilimitadas
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button onclick="rolarSorte()" class="btn w-full" style="background: rgba(212, 167, 106, 0.2); color: var(--destiny-gold); border: 1px solid rgba(212, 167, 106, 0.3);">
                        <i data-lucide="dice-5"></i>
                        Rolar Destino
                    </button>
                    <button onclick="fixarSorte()" class="btn w-full" style="background: rgba(212, 167, 106, 0.2); color: var(--destiny-gold); border: 1px solid rgba(212, 167, 106, 0.3);">
                        <i data-lucide="lock"></i>
                        Fixar
                    </button>
                </div>
            </div>
        </section>

        <!-- ESTATÍSTICAS DERIVADAS -->
        <section class="mb-6">
            <h2 class="section-title">
                <i data-lucide="layers"></i>
                Estatísticas Avançadas
            </h2>
            
            <div class="derived-stats">
                <div class="derived-item">
                    <span>Blindagem:</span>
                    <span style="color: var(--accent-blue);" id="calc-blindagem">0</span>
                </div>
                <div class="derived-item">
                    <span>Velocidade:</span>
                    <span style="color: var(--accent-green);" id="calc-velocidade">0</span>
                </div>
                <div class="derived-item">
                    <span>Iniciativa:</span>
                    <span style="color: var(--accent-yellow);" id="calc-iniciativa">0</span>
                </div>
                <div class="derived-item">
                    <span>Percepção:</span>
                    <span style="color: var(--accent-purple);" id="calc-percepcao">0</span>
                </div>
                <div class="text-sm mt-4" style="color: var(--text-secondary);">
                    *Calculadas automaticamente com base nos atributos
                </div>
            </div>
        </section>
    </div>

    <!-- RODAPÉ -->
    <footer class="border-t border-border-color py-4 text-center text-sm" style="color: var(--text-secondary);">
        Sistema de Status - Grimório Digital v3.0 | Integrado com Core System
    </footer>

    <!-- MODAL DE CONFIGURAÇÕES -->
    <div id="modal-config" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-cinzel" style="color: var(--accent-blue);">
                    <i data-lucide="settings"></i>
                    Configurações
                </h3>
                <button onclick="fecharModal('modal-config')" class="btn" style="background: rgba(255,255,255,0.1);">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm mb-2">Limite por Atributo</label>
                    <input type="number" id="config-limite-atributo" class="w-full p-2 rounded" value="100" min="10" max="500">
                </div>
                
                <div>
                    <label class="block text-sm mb-2">Pontos por Nível</label>
                    <input type="number" id="config-pontos-nivel" class="w-full p-2 rounded" value="5" min="0" max="50">
                </div>
                
                <div>
                    <label class="block text-sm mb-2">Mínimo para Sorteio</label>
                    <input type="number" id="config-minimo-aleatorio" class="w-full p-2 rounded" value="18" min="0" max="200">
                </div>
                
                <div>
                    <label class="block text-sm mb-2">Rolagens de Destino</label>
                    <input type="number" id="config-rolagens-maximas" class="w-full p-2 rounded" value="3" min="1" max="10">
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="fecharModal('modal-config')" class="btn w-full" style="background: rgba(255,255,255,0.1);">
                    Cancelar
                </button>
                <button onclick="salvarConfiguracoes()" class="btn btn-success w-full">
                    <i data-lucide="save"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <script>
    // Inicializar ícones Lucide
    lucide.createIcons();
    
    // Sistema de notificações
    function mostrarNotificacao(mensagem, tipo = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background: ${tipo === 'success' ? 'rgba(34, 197, 94, 0.9)' : 
                         tipo === 'error' ? 'rgba(220, 38, 38, 0.9)' : 
                         tipo === 'warning' ? 'rgba(245, 158, 11, 0.9)' : 
                         'rgba(59, 130, 246, 0.9)'};
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        `;
        
        notification.innerHTML = `
            <i data-lucide="${tipo === 'success' ? 'check-circle' : 
                            tipo === 'error' ? 'x-circle' : 
                            tipo === 'warning' ? 'alert-triangle' : 'info'}"></i>
            <span>${mensagem}</span>
        `;
        
        document.body.appendChild(notification);
        lucide.createIcons();
        
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    // Dados do sistema
    let statusData = {
        recursos: {
            vida: { atual: 100, max: 100 },
            mana: { atual: 100, max: 100 },
            estamina: { atual: 100, max: 100 }
        },
        atributos: {
            forca: 0,
            destreza: 0,
            constituicao: 0,
            inteligencia: 0,
            sabedoria: 0,
            carisma: 0
        },
        sorte: {
            dado1: 0,
            dado2: 0,
            dado3: 0,
            indice: 0,
            status: 'Não definido',
            rolagens: 0,
            fixado: false
        },
        config: {
            limiteAtributo: 100,
            pontosPorNivel: 5,
            minimoAleatorio: 18,
            rolagensMaximas: 3
        }
    };
    
    // Array global para armazenar as progress bars
    let progressBars = [];
    
    // Sincronizar com Grimorio System
    function sincronizarComGrimorio() {
        if (window.GrimorioSystem) {
            try {
                const personagem = GrimorioSystem.carregarPersonagem();
                
                // Converter atributos de 0-30 para 0-100
                Object.keys(personagem.atributos).forEach(attr => {
                    if (statusData.atributos[attr] !== undefined) {
                        const valorConvertido = Math.round((personagem.atributos[attr] / 30) * 100);
                        statusData.atributos[attr] = Math.min(100, Math.max(0, valorConvertido));
                    }
                });
                
                // Sincronizar recursos
                statusData.recursos.vida.atual = personagem.recursos.vidaAtual || 100;
                statusData.recursos.vida.max = personagem.recursos.vidaMaxima || 100;
                statusData.recursos.mana.atual = personagem.recursos.manaAtual || 100;
                statusData.recursos.mana.max = personagem.recursos.manaMaxima || 100;
                statusData.recursos.estamina.atual = personagem.recursos.estaminaAtual || 100;
                statusData.recursos.estamina.max = personagem.recursos.estaminaMaxima || 100;
                
                console.log('[Status] Dados sincronizados com Grimorio System');
                return true;
            } catch (error) {
                console.error('[Status] Erro ao sincronizar com Grimorio:', error);
                return false;
            }
        }
        return false;
    }
    
    // Salvar no Grimorio System
    function salvarNoGrimorio() {
        if (window.GrimorioSystem) {
            try {
                const personagem = GrimorioSystem.carregarPersonagem();
                
                // Converter atributos de 0-100 para 0-30
                Object.keys(statusData.atributos).forEach(attr => {
                    if (personagem.atributos[attr] !== undefined) {
                        const valorConvertido = Math.round((statusData.atributos[attr] / 100) * 30);
                        personagem.atributos[attr] = Math.min(30, Math.max(0, valorConvertido));
                    }
                });
                
                // Sincronizar recursos
                personagem.recursos.vidaAtual = statusData.recursos.vida.atual;
                personagem.recursos.vidaMaxima = statusData.recursos.vida.max;
                personagem.recursos.manaAtual = statusData.recursos.mana.atual;
                personagem.recursos.manaMaxima = statusData.recursos.mana.max;
                personagem.recursos.estaminaAtual = statusData.recursos.estamina.atual;
                personagem.recursos.estaminaMaxima = statusData.recursos.estamina.max;
                
                // Calcular recursos automáticos
                GrimorioSystem.calcularRecursosAutomaticos(personagem);
                
                GrimorioSystem.salvarPersonagem(personagem);
                console.log('[Status] Dados salvos no Grimorio System');
                return true;
            } catch (error) {
                console.error('[Status] Erro ao salvar no Grimorio:', error);
                return false;
            }
        }
        return false;
    }
    
    // Controles de progress bar CORRIGIDO
    class ProgressBarControl {
        constructor(element) {
            this.bar = element;
            this.fill = element.querySelector('.progress-fill');
            this.handle = element.querySelector('.progress-handle');
            this.statId = element.dataset.stat;
            this.max = parseInt(element.dataset.max) || 100;
            this.isDragging = false;
            
            // Verificar se os elementos existem
            if (!this.bar || !this.fill || !this.handle) {
                console.warn('Elementos da progress bar não encontrados:', element);
                return;
            }
            
            this.init();
        }
        
        init() {
            try {
                this.bar.addEventListener('click', (e) => this.handleClick(e));
                this.handle.addEventListener('mousedown', (e) => this.startDrag(e));
                document.addEventListener('mousemove', (e) => this.drag(e));
                document.addEventListener('mouseup', () => this.stopDrag());
                
                // Touch events para mobile
                this.bar.addEventListener('touchstart', (e) => this.handleClick(e.touches[0]), { passive: false });
                this.handle.addEventListener('touchstart', (e) => this.startDrag(e.touches[0]), { passive: false });
                document.addEventListener('touchmove', (e) => this.drag(e.touches[0]), { passive: false });
                document.addEventListener('touchend', () => this.stopDrag());
            } catch (error) {
                console.error('Erro ao inicializar progress bar:', error);
            }
        }
        
        getCurrentValue() {
            const valueElement = document.getElementById(this.statId);
            return valueElement ? parseInt(valueElement.textContent) || 0 : 0;
        }
        
        setValue(value) {
            const clampedValue = Math.max(0, Math.min(this.max, value));
            const percentage = (clampedValue / this.max) * 100;
            
            this.fill.style.width = `${percentage}%`;
            
            const valueElement = document.getElementById(this.statId);
            if (valueElement) {
                valueElement.textContent = clampedValue;
            }
            
            // Atualizar dados
            this.updateData(clampedValue);
        }
        
        updateData(value) {
            // Recursos
            if (this.statId.includes('-atual')) {
                const resource = this.statId.split('-')[0];
                if (statusData.recursos[resource]) {
                    statusData.recursos[resource].atual = value;
                    
                    // Atualizar máximo se for vida
                    if (resource === 'vida') {
                        const maxElement = document.getElementById('vida-maxima');
                        if (maxElement) maxElement.textContent = statusData.recursos.vida.max;
                    } else if (resource === 'mana') {
                        const maxElement = document.getElementById('mana-maxima');
                        if (maxElement) maxElement.textContent = statusData.recursos.mana.max;
                    } else if (resource === 'estamina') {
                        const maxElement = document.getElementById('estamina-maxima');
                        if (maxElement) maxElement.textContent = statusData.recursos.estamina.max;
                    }
                }
            }
            // Atributos
            else if (statusData.atributos[this.statId] !== undefined) {
                statusData.atributos[this.statId] = value;
            }
            
            salvarDados();
            updateDerivedStats();
            salvarNoGrimorio();
        }
        
        handleClick(e) {
            if (this.isDragging || !this.bar) return;
            
            try {
                const rect = this.bar.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = (x / rect.width) * 100;
                const value = Math.round((percentage / 100) * this.max);
                
                this.setValue(value);
            } catch (error) {
                console.error('Erro no handleClick:', error);
            }
        }
        
        startDrag(e) {
            this.isDragging = true;
            if (e.preventDefault) e.preventDefault();
        }
        
        drag(e) {
            if (!this.isDragging || !this.bar) return;
            
            try {
                const rect = this.bar.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
                const value = Math.round((percentage / 100) * this.max);
                
                this.setValue(value);
            } catch (error) {
                console.error('Erro no drag:', error);
            }
        }
        
        stopDrag() {
            this.isDragging = false;
        }
    }
    
    // Inicializar todas as progress bars APÓS o DOM estar pronto
    function inicializarProgressBars() {
        progressBars = [];
        const bars = document.querySelectorAll('.progress-bar');
        console.log('Encontradas', bars.length, 'progress bars');
        
        bars.forEach(bar => {
            try {
                const pb = new ProgressBarControl(bar);
                if (pb.bar) { // Só adicionar se foi criado com sucesso
                    progressBars.push(pb);
                }
            } catch (error) {
                console.error('Erro ao criar progress bar:', error, bar);
            }
        });
        
        console.log('Progress bars inicializadas:', progressBars.length);
    }
    
    // SISTEMA DE DESTINO
    function rolarSorte() {
        if (statusData.sorte.fixado) {
            mostrarNotificacao('Destino já foi fixado!', 'warning');
            return;
        }
        
        if (statusData.sorte.rolagens >= statusData.config.rolagensMaximas) {
            mostrarNotificacao(`Máximo de ${statusData.config.rolagensMaximas} rolagens atingido!`, 'warning');
            return;
        }
        
        const dado1 = Math.floor(Math.random() * 100) + 1;
        const dado2 = Math.floor(Math.random() * 100) + 1;
        const dado3 = Math.floor(Math.random() * 100) + 1;
        
        const resultado = Math.max(1, Math.min(100, Math.round(((dado1 + dado3) * 2 - dado2) / 2)));
        
        statusData.sorte.dado1 = dado1;
        statusData.sorte.dado2 = dado2;
        statusData.sorte.dado3 = dado3;
        statusData.sorte.indice = resultado;
        statusData.sorte.rolagens++;
        
        // Atualizar display
        document.getElementById('dado-fe').textContent = dado1;
        document.getElementById('dado-sorte').textContent = dado2;
        document.getElementById('dado-destino').textContent = dado3;
        document.getElementById('indice-sorte').textContent = `${resultado}%`;
        
        // Barra de progresso
        const destinyFill = document.querySelector('.destiny-section .progress-fill');
        if (destinyFill) {
            destinyFill.style.width = `${resultado}%`;
        }
        
        // Status
        let status = 'Neutro';
        if (resultado > 70) status = 'Sorte Excelente';
        else if (resultado > 55) status = 'Sortudo';
        else if (resultado < 30) status = 'Azarado';
        else if (resultado < 45) status = 'Muito Azarado';
        
        statusData.sorte.status = status;
        document.getElementById('status-sorte').textContent = status;
        
        // Fórmula
        document.getElementById('calculo-sorte').textContent = 
            `((${dado1} + ${dado3}) × 2 - ${dado2}) ÷ 2 = ${resultado}`;
        
        // Rolagens restantes
        const restantes = statusData.config.rolagensMaximas - statusData.sorte.rolagens;
        document.getElementById('rolls-info').textContent = 
            `Rolagens restantes: ${restantes}`;
        
        mostrarNotificacao(`Destino: ${resultado}%`, 'success');
        salvarDados();
    }
    
    function fixarSorte() {
        if (statusData.sorte.indice === 0) {
            mostrarNotificacao('Role o destino primeiro!', 'warning');
            return;
        }
        
        statusData.sorte.fixado = true;
        mostrarNotificacao(`Destino fixado em ${statusData.sorte.indice}%!`, 'success');
        document.getElementById('rolls-info').textContent = 'Destino fixado';
        salvarDados();
    }
    
    // SORTEIO ALEATÓRIO
    function distribuirAleatorio() {
        const atributos = ['forca', 'destreza', 'constituicao', 'inteligencia', 'sabedoria', 'carisma'];
        const totalAtual = Object.values(statusData.atributos).reduce((a, b) => a + b, 0);
        
        if (totalAtual >= statusData.config.minimoAleatorio) {
            // Distribuir pontos baseados na configuração
            const pontos = Math.max(1, Math.floor(statusData.config.pontosPorNivel * 0.8));
            
            for (let i = 0; i < pontos; i++) {
                const randomAttr = atributos[Math.floor(Math.random() * atributos.length)];
                if (statusData.atributos[randomAttr] < statusData.config.limiteAtributo) {
                    statusData.atributos[randomAttr]++;
                    
                    // Atualizar visual
                    const progressBar = progressBars.find(pb => pb && pb.statId === randomAttr);
                    
                    if (progressBar) {
                        progressBar.setValue(statusData.atributos[randomAttr]);
                    } else {
                        // Fallback: atualizar diretamente
                        const element = document.getElementById(randomAttr);
                        if (element) {
                            element.textContent = statusData.atributos[randomAttr];
                        }
                        const barElement = document.querySelector(`[data-stat="${randomAttr}"] .progress-fill`);
                        if (barElement) {
                            const percentage = (statusData.atributos[randomAttr] / 100) * 100;
                            barElement.style.width = `${percentage}%`;
                        }
                    }
                }
            }
            
            mostrarNotificacao(`${pontos} pontos distribuídos!`, 'success');
            salvarDados();
            updateDerivedStats();
            salvarNoGrimorio();
        } else {
            mostrarNotificacao(`Mínimo de ${statusData.config.minimoAleatorio} pontos necessários`, 'warning');
        }
    }
    
    function resetarAtributos() {
        if (confirm('Resetar todos os atributos para 0?')) {
            const atributos = ['forca', 'destreza', 'constituicao', 'inteligencia', 'sabedoria', 'carisma'];
            atributos.forEach(attr => {
                statusData.atributos[attr] = 0;
                
                const progressBar = progressBars.find(pb => pb && pb.statId === attr);
                if (progressBar) {
                    progressBar.setValue(0);
                } else {
                    // Fallback
                    const element = document.getElementById(attr);
                    if (element) {
                        element.textContent = '0';
                    }
                    const barElement = document.querySelector(`[data-stat="${attr}"] .progress-fill`);
                    if (barElement) {
                        barElement.style.width = '0%';
                    }
                }
            });
            
            mostrarNotificacao('Atributos resetados!', 'info');
            salvarDados();
            updateDerivedStats();
            salvarNoGrimorio();
        }
    }
    
    function restaurarRecursos() {
        if (confirm('Restaurar todos os recursos?')) {
            ['vida', 'mana', 'estamina'].forEach(resource => {
                statusData.recursos[resource].atual = statusData.recursos[resource].max;
                
                const progressBar = progressBars.find(pb => pb && pb.statId === `${resource}-atual`);
                if (progressBar) {
                    progressBar.setValue(statusData.recursos[resource].atual);
                } else {
                    // Fallback
                    const element = document.getElementById(`${resource}-atual`);
                    if (element) {
                        element.textContent = statusData.recursos[resource].atual;
                    }
                    const barElement = document.querySelector(`[data-stat="${resource}-atual"] .progress-fill`);
                    if (barElement) {
                        const percentage = (statusData.recursos[resource].atual / statusData.recursos[resource].max) * 100;
                        barElement.style.width = `${percentage}%`;
                    }
                }
            });
            
            mostrarNotificacao('Recursos restaurados!', 'success');
            salvarDados();
            salvarNoGrimorio();
        }
    }
    
    // ESTATÍSTICAS DERIVADAS
    function updateDerivedStats() {
        const { forca, destreza, constituicao, inteligencia, sabedoria } = statusData.atributos;
        
        const blindagem = Math.floor((constituicao * 0.7) + (forca * 0.3));
        const velocidade = Math.floor((destreza * 0.6) + (constituicao * 0.4));
        const iniciativa = Math.floor((destreza * 0.5) + (sabedoria * 0.3) + (inteligencia * 0.2));
        const percepcao = Math.floor((sabedoria * 0.8) + (inteligencia * 0.2));
        
        const blindagemEl = document.getElementById('calc-blindagem');
        const velocidadeEl = document.getElementById('calc-velocidade');
        const iniciativaEl = document.getElementById('calc-iniciativa');
        const percepcaoEl = document.getElementById('calc-percepcao');
        
        if (blindagemEl) blindagemEl.textContent = blindagem;
        if (velocidadeEl) velocidadeEl.textContent = velocidade;
        if (iniciativaEl) iniciativaEl.textContent = iniciativa;
        if (percepcaoEl) percepcaoEl.textContent = percepcao;
    }
    
    // CONFIGURAÇÕES
    function abrirModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            modal.classList.add('active');
        }
        
        if (id === 'modal-config') {
            const limiteInput = document.getElementById('config-limite-atributo');
            const pontosInput = document.getElementById('config-pontos-nivel');
            const minimoInput = document.getElementById('config-minimo-aleatorio');
            const rolagensInput = document.getElementById('config-rolagens-maximas');
            
            if (limiteInput) limiteInput.value = statusData.config.limiteAtributo;
            if (pontosInput) pontosInput.value = statusData.config.pontosPorNivel;
            if (minimoInput) minimoInput.value = statusData.config.minimoAleatorio;
            if (rolagensInput) rolagensInput.value = statusData.config.rolagensMaximas;
        }
    }
    
    function fecharModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            modal.classList.remove('active');
        }
    }
    
    function salvarConfiguracoes() {
        const limiteInput = document.getElementById('config-limite-atributo');
        const pontosInput = document.getElementById('config-pontos-nivel');
        const minimoInput = document.getElementById('config-minimo-aleatorio');
        const rolagensInput = document.getElementById('config-rolagens-maximas');
        
        if (limiteInput) statusData.config.limiteAtributo = parseInt(limiteInput.value) || 100;
        if (pontosInput) statusData.config.pontosPorNivel = parseInt(pontosInput.value) || 5;
        if (minimoInput) statusData.config.minimoAleatorio = parseInt(minimoInput.value) || 18;
        if (rolagensInput) statusData.config.rolagensMaximas = parseInt(rolagensInput.value) || 3;
        
        mostrarNotificacao('Configurações salvas!', 'success');
        salvarDados();
        fecharModal('modal-config');
    }
    
    // EXPORTAÇÃO/IMPORTAÇÃO
    function exportarDados() {
        try {
            if (window.GrimorioSystem) {
                const dadosGrimorio = GrimorioSystem.exportarPersonagem();
                const dadosCompletos = {
                    statusData: statusData,
                    grimorioData: JSON.parse(dadosGrimorio),
                    exportadoEm: new Date().toISOString(),
                    versao: '3.0-integrada'
                };
                
                const blob = new Blob([JSON.stringify(dadosCompletos, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `grimorio_status_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                mostrarNotificacao('Dados exportados (integrado)!', 'success');
                return;
            }
            
            // Fallback para exportação local
            const dados = {
                ...statusData,
                exportadoEm: new Date().toISOString(),
                versao: '3.0'
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `status_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            mostrarNotificacao('Dados exportados!', 'success');
        } catch (error) {
            mostrarNotificacao('Erro ao exportar: ' + error.message, 'error');
        }
    }
    
    function importarDados() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    // Verificar se é arquivo integrado
                    if (dados.grimorioData && dados.statusData) {
                        // Importar dados do Grimorio System
                        if (window.GrimorioSystem && dados.grimorioData.personagem) {
                            GrimorioSystem.salvarPersonagem(dados.grimorioData.personagem);
                        }
                        
                        // Importar dados de status
                        if (dados.statusData) {
                            statusData = { ...statusData, ...dados.statusData };
                        }
                        
                        mostrarNotificacao('Dados integrados importados!', 'success');
                    }
                    // Verificar se é arquivo do Grimorio System
                    else if (dados.personagem && dados.sistema === 'Grimório Digital v2.0') {
                        if (window.GrimorioSystem) {
                            GrimorioSystem.salvarPersonagem(dados.personagem);
                            mostrarNotificacao('Personagem do Grimorio importado!', 'success');
                        }
                    }
                    // Verificar se é arquivo de status local
                    else if (dados.recursos || dados.atributos) {
                        // Mesclar dados
                        if (dados.recursos) {
                            statusData.recursos = { ...statusData.recursos, ...dados.recursos };
                        }
                        if (dados.atributos) {
                            statusData.atributos = { ...statusData.atributos, ...dados.atributos };
                        }
                        
                        if (dados.sorte) statusData.sorte = { ...statusData.sorte, ...dados.sorte };
                        if (dados.config) statusData.config = { ...statusData.config, ...dados.config };
                        
                        mostrarNotificacao('Dados de status importados!', 'success');
                    } else {
                        throw new Error('Formato de arquivo não reconhecido');
                    }
                    
                    carregarDadosNaInterface();
                    salvarDados();
                    
                } catch (error) {
                    mostrarNotificacao('Erro na importação: ' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        };
        
        input.click();
    }
    
    function carregarDadosNaInterface() {
        // Recursos
        ['vida', 'mana', 'estamina'].forEach(resource => {
            const value = statusData.recursos[resource]?.atual || 100;
            const max = statusData.recursos[resource]?.max || 100;
            
            const valueElement = document.getElementById(`${resource}-atual`);
            const maxElement = document.getElementById(`${resource}-maxima`);
            
            if (valueElement) valueElement.textContent = value;
            if (maxElement) maxElement.textContent = max;
            
            const progressBar = progressBars.find(pb => pb && pb.statId === `${resource}-atual`);
            if (progressBar) {
                progressBar.setValue(value);
            } else {
                // Fallback
                const barElement = document.querySelector(`[data-stat="${resource}-atual"] .progress-fill`);
                if (barElement) {
                    const percentage = (value / max) * 100;
                    barElement.style.width = `${percentage}%`;
                }
            }
        });
        
        // Atributos
        Object.keys(statusData.atributos).forEach(attr => {
            const value = statusData.atributos[attr] || 0;
            const element = document.getElementById(attr);
            if (element) {
                element.textContent = value;
            }
            
            const progressBar = progressBars.find(pb => pb && pb.statId === attr);
            if (progressBar) {
                progressBar.setValue(value);
            } else {
                // Fallback
                const barElement = document.querySelector(`[data-stat="${attr}"] .progress-fill`);
                if (barElement) {
                    const percentage = (value / 100) * 100;
                    barElement.style.width = `${percentage}%`;
                }
            }
        });
        // Função para adicionar pontos
        function adicionarPontos(quantidade) {
            statusData.config.pontosPorNivel += quantidade;
            
            // Atualizar display
            const pontosElement = document.getElementById('pontos-disponiveis');
            if (pontosElement) {
                pontosElement.textContent = statusData.config.pontosPorNivel;
            }
            
            mostrarNotificacao(`+${quantidade} pontos adicionados!`, 'success');
            salvarDados();
        }

        // Função para atualizar display dos pontos
        function atualizarDisplayPontos() {
            const pontosElement = document.getElementById('pontos-disponiveis');
            if (pontosElement) {
                pontosElement.textContent = statusData.config.pontosPorNivel;
            }
        }

        // Sorte
        if (statusData.sorte.indice > 0) {
            const dadoFe = document.getElementById('dado-fe');
            const dadoSorte = document.getElementById('dado-sorte');
            const dadoDestino = document.getElementById('dado-destino');
            const indiceSorte = document.getElementById('indice-sorte');
            const statusSorte = document.getElementById('status-sorte');
            const calculoSorte = document.getElementById('calculo-sorte');
            const rollsInfo = document.getElementById('rolls-info');
            const destinyFill = document.querySelector('.destiny-section .progress-fill');
            
            if (dadoFe) dadoFe.textContent = statusData.sorte.dado1;
            if (dadoSorte) dadoSorte.textContent = statusData.sorte.dado2;
            if (dadoDestino) dadoDestino.textContent = statusData.sorte.dado3;
            if (indiceSorte) indiceSorte.textContent = `${statusData.sorte.indice}%`;
            if (statusSorte) statusSorte.textContent = statusData.sorte.status;
            
            if (destinyFill) {
                destinyFill.style.width = `${statusData.sorte.indice}%`;
            }
            
            if (calculoSorte) {
                calculoSorte.textContent = 
                    `((${statusData.sorte.dado1} + ${statusData.sorte.dado3}) × 2 - ${statusData.sorte.dado2}) ÷ 2 = ${statusData.sorte.indice}`;
            }
            
            const restantes = statusData.config.rolagensMaximas - statusData.sorte.rolagens;
            if (rollsInfo) {
                rollsInfo.textContent = 
                    statusData.sorte.fixado ? 'Destino fixado' : `Rolagens restantes: ${restantes}`;
            }
        }
        
        updateDerivedStats();
    }
    
    // PERSISTÊNCIA
    function salvarDados() {
        try {
            localStorage.setItem('grimorio_status_simple', JSON.stringify(statusData));
        } catch (error) {
            console.error('Erro ao salvar:', error);
        }
    }
    
    function carregarDados() {
        try {
            const dados = localStorage.getItem('grimorio_status_simple');
            if (dados) {
                const parsed = JSON.parse(dados);
                statusData = { ...statusData, ...parsed };
                carregarDadosNaInterface();
            }
        } catch (error) {
            console.error('Erro ao carregar:', error);
        }
    }
    
    // INICIALIZAÇÃO
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar progress bars imediatamente após o DOM estar pronto
        setTimeout(() => {
            inicializarProgressBars();
            
            // Aguardar Grimorio System carregar
            setTimeout(() => {
                // Tentar sincronizar com Grimorio System
                sincronizarComGrimorio();
                carregarDados();
                
                // Configurar botões do navbar
                const btnExportar = document.getElementById('btn-exportar');
                const btnImportar = document.getElementById('btn-importar');
                const btnConfig = document.getElementById('btn-config');
                
                if (btnExportar) {
                    btnExportar.addEventListener('click', exportarDados);
                }
                if (btnImportar) {
                    btnImportar.addEventListener('click', importarDados);
                }
                if (btnConfig) {
                    btnConfig.addEventListener('click', () => abrirModal('modal-config'));
                }
                
                updateDerivedStats();
                
                // Adicionar CSS para animação se não existir
                if (!document.querySelector('#animations-css')) {
                    const style = document.createElement('style');
                    style.id = 'animations-css';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                console.log('[Status] Sistema inicializado com integração Grimorio');
                console.log('Progress bars ativas:', progressBars.length);
            }, 100);
        }, 100);
    });
    </script>
</body>
</html>