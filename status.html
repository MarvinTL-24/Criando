<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema RPG - Status</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        theme: {
                            bg: '#0a0a0c',
                            panel: '#0f0f12',
                            border: '#2a2a2e',
                            text: '#e8e4dc',
                            blue: '#4a9eff',
                            orange: '#ff6b35',
                            red: '#dc2626',
                            green: '#22c55e',
                            purple: '#8b5cf6',
                            yellow: '#f59e0b',
                            pink: '#ec4899'
                        }
                    }
                }
            }
        }
        // Verificar se h√° perfil ativo
        window.addEventListener('load', function() {
            if (window.hasActiveProfile && window.hasActiveProfile()) {
                const profileInfo = window.getActiveProfileInfo();
                console.log('Trabalhando no perfil:', profileInfo.name);
                
                // Carregar dados espec√≠ficos desta p√°gina
                const dados = window.loadFromProfile('status'); // 'status' muda por p√°gina
                if (dados) {
                    preencherCampos(dados);
                }
            }
        });

        // Ao salvar na p√°gina
        function salvarNaPagina() {
            const dados = coletarDadosDaPagina();
            
            // Salvar localmente (compatibilidade com vers√£o antiga)
            localStorage.setItem('grimorio_status_data', JSON.stringify(dados));
            
            // Salvar no perfil ativo (novo sistema)
            if (window.saveToProfile) {
                const success = window.saveToProfile('status', dados);
                if (success) {
                    alert('Salvo no perfil tamb√©m!');
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: #e8e4dc; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        .anim-entry { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-bar-fill { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Novas cores para o tema de sorte/destino */
        .bg-sorte-1 { background-color: #1a1510; }
        .bg-sorte-2 { background-color: #2a2318; }
        .border-sorte { border-color: #8b7355; }
        .text-sorte-gold { color: #d4a76a; }
        .text-sorte-light { color: #f4d29a; }
        .text-sorte-dark { color: #8b7355; }

        /* Anima√ß√µes para dados */
        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1.05); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .dice-rolling {
            animation: diceRoll 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Efeito de brilho para dados altos */
        .high-roll {
            box-shadow: 0 0 20px rgba(212, 167, 106, 0.3);
            border-color: #f4d29a;
        }
        
        /* Cores para se√ß√µes */
        .section-vital { border-left-color: #dc2626; }
        .section-vital h3 { color: #dc2626; }
        
        .section-attributes { border-left-color: #4a9eff; }
        .section-attributes h3 { color: #4a9eff; }
        
        .section-progression { border-left-color: #ff6b35; }
        .section-progression h3 { color: #ff6b35; }
        
        .section-balance { border-left-color: #f59e0b; }
        .section-balance h3 { color: #f59e0b; }
        
        .section-derived { border-left-color: #22c55e; }
        .section-derived h3 { color: #22c55e; }
        
        .section-destiny { border-left-color: #8b5cf6; }
        .section-destiny h3 { color: #8b5cf6; }

        /* Estilos para os bot√µes de navega√ß√£o */
        .nav-button {
            transition: all 0.3s ease;
        }
        
        .nav-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Anima√ß√£o para entrada dos bot√µes */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .nav-buttons-container {
            animation: slideInRight 0.5s ease-out;
        }
    </style>
</head>
<body class="min-h-screen font-sans pb-12">

    <div id="status-content">

        <nav class="w-full bg-[#0f0f12]/95 backdrop-blur-sm border-b border-theme-border sticky top-0 z-50 mb-8" data-html2pdf-ignore="true">
            <div class="max-w-7xl mx-auto px-4 flex items-center gap-4 py-4">
                <a href="index.html" class="text-theme-text hover:text-theme-blue transition-colors">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </a>
                <div class="h-6 w-[1px] bg-theme-border"></div>
                <span class="font-cinzel font-bold text-lg tracking-wide text-theme-orange">Grim√≥rio Digital</span>
            </div>
            <div class="h-[1px] bg-gradient-to-r from-transparent via-theme-orange to-transparent"></div>
        </nav>

        <div class="max-w-6xl mx-auto px-4 space-y-6">

            <!-- Cabe√ßalho -->
            <header class="flex items-center gap-4 mb-8 anim-entry">
                <div class="p-3 rounded-lg bg-theme-orange/10 border border-theme-orange/20">
                    <i data-lucide="zap" class="w-8 h-8 text-theme-orange"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-cinzel font-bold text-white">Status do Personagem</h1>
                    <p class="text-gray-400">Atributos, Progress√£o e Destino</p>
                </div>
            </header>

            <!-- Se√ß√£o 1: Nome do Personagem -->
            <section class="bg-theme-panel border border-theme-border p-4 rounded-lg anim-entry delay-0 mb-6">
                <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-cinzel">Nome do Personagem</label>
                <input type="text" id="input-nome" value="Her√≥i Desconhecido" placeholder="Nome do seu personagem" 
                    class="bg-[#0a0a0c] text-xl font-cinzel font-bold text-theme-text px-2 py-1 w-full outline-none focus:border-theme-orange border-b border-theme-border">
            </section>

            <!-- Se√ß√£o 2: Progress√£o (Laranja) -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-1 relative overflow-hidden group section-progression">
                <div class="absolute top-0 left-0 w-1 h-full bg-theme-orange"></div>
                
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold mb-6">
                    <i data-lucide="trending-up" class="w-4 h-4"></i> Progress√£o
                </h3>

                <div class="grid md:grid-cols-4 gap-6">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-cinzel">N√≠vel</label>
                        <div class="flex items-center bg-[#0a0a0c] border border-theme-border rounded px-3 py-2 focus-within:border-theme-orange transition-colors">
                            <i data-lucide="crown" class="w-4 h-4 text-theme-orange mr-2"></i>
                            <input type="number" id="input-nivel" value="0" min="0" 
                                class="bg-transparent w-full outline-none font-mono text-lg" oninput="recalc()">
                        </div>
                    </div>
                    
                    <div class="md:col-span-3">
                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-cinzel">XP Acumulado</label>
                        <div class="h-4 bg-[#0a0a0c] rounded-full overflow-hidden border border-theme-border mb-2">
                            <div id="bar-xp" class="h-full bg-theme-orange stat-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <input type="number" id="input-xp-acumulado" value="0" 
                                class="bg-transparent border-b border-theme-border w-20 outline-none focus:border-theme-orange text-right" 
                                oninput="recalc()">
                            <span class="text-gray-500">/ <span id="display-xp-necessario">1000</span> XP Pr√≥ximo N√≠vel</span>
                        </div>
                    </div>
                </div>
                
                <div class="h-px bg-theme-border my-6"></div> 
                
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold mb-4">
                    <i data-lucide="plus" class="w-4 h-4"></i> Adicionar XP
                </h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-cinzel">XP Ganhado</label>
                        <input type="number" id="input-xp-ganhado" value="0" min="0" 
                            class="bg-transparent w-full border border-theme-border rounded px-3 py-2 outline-none focus:border-theme-orange font-mono text-lg">
                    </div>
                    <button onclick="addXP()" 
                        class="flex items-center justify-center gap-2 px-6 py-2 bg-theme-green hover:bg-green-600 rounded text-white shadow-lg transition-all font-cinzel text-sm font-bold mt-5">
                        <i data-lucide="plus-square" class="w-4 h-4"></i>
                        <span>Somar XP</span>
                    </button>
                </div>
            </section>

            <!-- Se√ß√£o 3: Recursos Vitais (Vermelho) -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-2 relative overflow-hidden section-vital">
                <div class="absolute top-0 left-0 w-1 h-full bg-theme-red"></div>
                
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold mb-6">
                    <i data-lucide="heart" class="w-4 h-4"></i> Recursos Vitais
                </h3>

                <div class="grid md:grid-cols-3 gap-8">
                    <div class="resource-group">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-theme-red">Vida</span>
                            <i data-lucide="heart" class="w-4 h-4 text-theme-red"></i>
                        </div>
                        <div class="h-2 bg-[#0a0a0c] rounded-full overflow-hidden mb-2">
                            <div id="bar-vida" class="h-full bg-theme-red stat-bar-fill" style="width: 100%"></div>
                        </div>
                        <div class="flex justify-center gap-2 items-center">
                            <input type="number" id="input-vida-atual" value="100" 
                                class="w-16 bg-transparent text-center border-b border-theme-border focus:border-theme-red outline-none" 
                                oninput="recalc()">
                            <span class="text-gray-600">/</span>
                            <input type="number" id="input-vida-max" value="100" 
                                class="w-16 bg-transparent text-center border-b border-theme-border focus:border-theme-red outline-none" 
                                oninput="recalc()">
                        </div>
                    </div>

                    <div class="resource-group">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-theme-blue">Mana</span>
                            <i data-lucide="flame" class="w-4 h-4 text-theme-blue"></i>
                        </div>
                        <div class="h-2 bg-[#0a0a0c] rounded-full overflow-hidden mb-2">
                            <div id="bar-mana" class="h-full bg-theme-blue stat-bar-fill" style="width: 100%"></div>
                        </div>
                        <div class="flex justify-center gap-2 items-center">
                            <input type="number" id="input-mana-atual" value="50" 
                                class="w-16 bg-transparent text-center border-b border-theme-border focus:border-theme-blue outline-none" 
                                oninput="recalc()">
                            <span class="text-gray-600">/</span>
                            <input type="number" id="input-mana-max" value="50" 
                                class="w-16 bg-transparent text-center border-b border-theme-border focus:border-theme-blue outline-none" 
                                oninput="recalc()">
                        </div>
                    </div>

                    <div class="resource-group">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-theme-green">Estamina</span>
                            <i data-lucide="wind" class="w-4 h-4 text-theme-green"></i>
                        </div>
                        <div class="h-2 bg-[#0a0a0c] rounded-full overflow-hidden mb-2">
                            <div id="bar-estamina" class="h-full bg-theme-green stat-bar-fill" style="width: 100%"></div>
                        </div>
                        <div class="flex justify-center gap-2 items-center">
                            <input type="number" id="input-estamina-atual" value="80" 
                                class="w-16 bg-transparent text-center border-b border-theme-border focus:border-theme-green outline-none" 
                                oninput="recalc()">
                            <span class="text-gray-600">/</span>
                            <input type="number" id="input-estamina-max" value="80" 
                                class="w-16 bg-transparent text-center border-b border-theme-border focus:border-theme-green outline-none" 
                                oninput="recalc()">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 4: Atributos Base (Azul) -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-3 relative overflow-hidden section-attributes">
                <div class="absolute top-0 left-0 w-1 h-full bg-theme-blue"></div>
                
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold mb-6">
                    <i data-lucide="sword" class="w-4 h-4"></i> Atributos Base
                </h3>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <!-- For√ßa (Vermelho) -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-red/50 transition-colors group">
                        <div class="w-10 h-10 mx-auto mb-2 rounded bg-theme-red/10 flex items-center justify-center">
                            <i data-lucide="sword" class="w-5 h-5 text-theme-red"></i>
                        </div>
                        <label class="text-xs uppercase text-gray-500 font-cinzel">For√ßa</label>
                        <div class="flex justify-center items-center mt-2">
                            <button onclick="changeAttr('attr-forca', -1)" 
                                class="p-1 text-lg font-bold text-theme-red hover:bg-theme-border rounded-l border border-r-0 border-theme-border" 
                                id="btn-forca-minus" disabled>-</button>
                            <input type="number" id="attr-forca" value="0" 
                                class="w-12 bg-transparent border-b-2 border-theme-border text-2xl font-bold font-mono text-center focus:outline-none focus:border-theme-red py-2" 
                                oninput="recalc()" readonly>
                            <button onclick="changeAttr('attr-forca', 1)" 
                                class="p-1 text-lg font-bold text-theme-red hover:bg-theme-border rounded-r border border-l-0 border-theme-border" 
                                id="btn-forca-plus" disabled>+</button>
                        </div>
                    </div>

                    <!-- Destreza (Verde) -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-green/50 transition-colors">
                        <div class="w-10 h-10 mx-auto mb-2 rounded bg-theme-green/10 flex items-center justify-center">
                            <i data-lucide="wind" class="w-5 h-5 text-theme-green"></i>
                        </div>
                        <label class="text-xs uppercase text-gray-500 font-cinzel">Destreza</label>
                        <div class="flex justify-center items-center mt-2">
                            <button onclick="changeAttr('attr-destreza', -1)" 
                                class="p-1 text-lg font-bold text-theme-green hover:bg-theme-border rounded-l border border-r-0 border-theme-border" 
                                id="btn-destreza-minus" disabled>-</button>
                            <input type="number" id="attr-destreza" value="0" 
                                class="w-12 bg-transparent border-b-2 border-theme-border text-2xl font-bold font-mono text-center focus:outline-none focus:border-theme-green py-2" 
                                oninput="recalc()" readonly>
                            <button onclick="changeAttr('attr-destreza', 1)" 
                                class="p-1 text-lg font-bold text-theme-green hover:bg-theme-border rounded-r border border-l-0 border-theme-border" 
                                id="btn-destreza-plus" disabled>+</button>
                        </div>
                    </div>

                    <!-- Constitui√ß√£o (Amarelo) -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-yellow/50 transition-colors">
                        <div class="w-10 h-10 mx-auto mb-2 rounded bg-theme-yellow/10 flex items-center justify-center">
                            <i data-lucide="shield" class="w-5 h-5 text-theme-yellow"></i>
                        </div>
                        <label class="text-xs uppercase text-gray-500 font-cinzel">Constitui√ß√£o</label>
                        <div class="flex justify-center items-center mt-2">
                            <button onclick="changeAttr('attr-constituicao', -1)" 
                                class="p-1 text-lg font-bold text-theme-yellow hover:bg-theme-border rounded-l border border-r-0 border-theme-border" 
                                id="btn-constituicao-minus" disabled>-</button>
                            <input type="number" id="attr-constituicao" value="0" 
                                class="w-12 bg-transparent border-b-2 border-theme-border text-2xl font-bold font-mono text-center focus:outline-none focus:border-theme-yellow py-2" 
                                oninput="recalc()" readonly>
                            <button onclick="changeAttr('attr-constituicao', 1)" 
                                class="p-1 text-lg font-bold text-theme-yellow hover:bg-theme-border rounded-r border border-l-0 border-theme-border" 
                                id="btn-constituicao-plus" disabled>+</button>
                        </div>
                    </div>

                    <!-- Intelig√™ncia (Azul) -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-blue/50 transition-colors">
                        <div class="w-10 h-10 mx-auto mb-2 rounded bg-theme-blue/10 flex items-center justify-center">
                            <i data-lucide="brain" class="w-5 h-5 text-theme-blue"></i>
                        </div>
                        <label class="text-xs uppercase text-gray-500 font-cinzel">Intelig√™ncia</label>
                        <div class="flex justify-center items-center mt-2">
                            <button onclick="changeAttr('attr-inteligencia', -1)" 
                                class="p-1 text-lg font-bold text-theme-blue hover:bg-theme-border rounded-l border border-r-0 border-theme-border" 
                                id="btn-inteligencia-minus" disabled>-</button>
                            <input type="number" id="attr-inteligencia" value="0" 
                                class="w-12 bg-transparent border-b-2 border-theme-border text-2xl font-bold font-mono text-center focus:outline-none focus:border-theme-blue py-2" 
                                oninput="recalc()" readonly>
                            <button onclick="changeAttr('attr-inteligencia', 1)" 
                                class="p-1 text-lg font-bold text-theme-blue hover:bg-theme-border rounded-r border border-l-0 border-theme-border" 
                                id="btn-inteligencia-plus" disabled>+</button>
                        </div>
                    </div>

                    <!-- Sabedoria (Roxo) -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-purple/50 transition-colors">
                        <div class="w-10 h-10 mx-auto mb-2 rounded bg-theme-purple/10 flex items-center justify-center">
                            <i data-lucide="eye" class="w-5 h-5 text-theme-purple"></i>
                        </div>
                        <label class="text-xs uppercase text-gray-500 font-cinzel">Sabedoria</label>
                        <div class="flex justify-center items-center mt-2">
                            <button onclick="changeAttr('attr-sabedoria', -1)" 
                                class="p-1 text-lg font-bold text-theme-purple hover:bg-theme-border rounded-l border border-r-0 border-theme-border" 
                                id="btn-sabedoria-minus" disabled>-</button>
                            <input type="number" id="attr-sabedoria" value="0" 
                                class="w-12 bg-transparent border-b-2 border-theme-border text-2xl font-bold font-mono text-center focus:outline-none focus:border-theme-purple py-2" 
                                oninput="recalc()" readonly>
                            <button onclick="changeAttr('attr-sabedoria', 1)" 
                                class="p-1 text-lg font-bold text-theme-purple hover:bg-theme-border rounded-r border border-l-0 border-theme-border" 
                                id="btn-sabedoria-plus" disabled>+</button>
                        </div>
                    </div>

                    <!-- Carisma (Rosa) -->
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-pink/50 transition-colors">
                        <div class="w-10 h-10 mx-auto mb-2 rounded bg-theme-pink/10 flex items-center justify-center">
                            <i data-lucide="flame" class="w-5 h-5 text-theme-pink"></i>
                        </div>
                        <label class="text-xs uppercase text-gray-500 font-cinzel">Carisma</label>
                        <div class="flex justify-center items-center mt-2">
                            <button onclick="changeAttr('attr-carisma', -1)" 
                                class="p-1 text-lg font-bold text-theme-pink hover:bg-theme-border rounded-l border border-r-0 border-theme-border" 
                                id="btn-carisma-minus" disabled>-</button>
                            <input type="number" id="attr-carisma" value="0" 
                                class="w-12 bg-transparent border-b-2 border-theme-border text-2xl font-bold font-mono text-center focus:outline-none focus:border-theme-pink py-2" 
                                oninput="recalc()" readonly>
                            <button onclick="changeAttr('attr-carisma', 1)" 
                                class="p-1 text-lg font-bold text-theme-pink hover:bg-theme-border rounded-r border border-l-0 border-theme-border" 
                                id="btn-carisma-plus" disabled>+</button>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row gap-4 mt-6">
                    <div class="flex items-center bg-[#0a0a0c] border border-theme-border rounded px-3 py-2 focus-within:border-theme-red transition-colors w-full md:w-auto">
                        <span class="text-xs uppercase tracking-widest text-gray-500 mr-2 font-cinzel whitespace-nowrap">Total de Pontos:</span>
                        <input type="number" id="input-pool-pontos" value="0" min="6" max="100" 
                            class="bg-transparent w-full outline-none font-mono text-lg text-right text-theme-red">
                    </div>

                    <button onclick="rolarAtributos()" 
                        class="flex items-center justify-center gap-2 px-6 py-2 bg-theme-red hover:bg-red-600 rounded text-white shadow-lg hover:shadow-red-500/20 transition-all font-cinzel text-sm font-bold w-full md:w-auto">
                        <i data-lucide="dice-5" class="w-4 h-4"></i>
                        <span>Rolar Atributos</span>
                    </button>
                </div>
            </section>

            <!-- Se√ß√£o 5: Balanceamento Manual (Amarelo) -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-4 relative overflow-hidden section-balance">
                <div class="absolute top-0 left-0 w-1 h-full bg-theme-yellow"></div>

                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold mb-4">
                    <i data-lucide="sliders-horizontal" class="w-4 h-4"></i> Balanceamento Manual
                </h3>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-cinzel">Multiplicador Classe (0.00 a 2.00)</label>
                        <div class="flex items-center bg-[#0a0a0c] border border-theme-border rounded px-3 py-2 focus-within:border-theme-yellow transition-colors">
                            <i data-lucide="target" class="w-4 h-4 text-theme-yellow mr-2"></i>
                            <input type="number" 
                                id="input-classe" 
                                value="0" 
                                min="0.00" 
                                max="2.00" 
                                step="0.01" 
                                class="bg-transparent w-full outline-none font-mono text-lg" 
                                oninput="recalc()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2 font-cinzel">Multiplicador Dificuldade (0.00 a 1.00)</label>
                        <div class="flex items-center bg-[#0a0a0c] border border-theme-border rounded px-3 py-2 focus-within:border-theme-yellow transition-colors">
                            <i data-lucide="hand" class="w-4 h-4 text-theme-yellow mr-2"></i>
                            <input type="number" 
                                id="input-dificuldade" 
                                value="0" 
                                min="0.00" 
                                max="1.00" 
                                step="0.01" 
                                class="bg-transparent w-full outline-none font-mono text-lg" 
                                oninput="recalc()">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 6: Valores Derivados (Verde) -->
            <section class="bg-theme-panel border border-theme-border p-6 rounded-lg anim-entry delay-4 relative overflow-hidden section-derived">
                <div class="absolute top-0 left-0 w-1 h-full bg-theme-green"></div>
                
                <h3 class="flex items-center gap-2 font-cinzel text-lg font-semibold mb-6">
                    <i data-lucide="calculator" class="w-4 h-4"></i> Valores Derivados (Autom√°tico)
                </h3>

                <div class="grid grid-cols-2 md:grid-cols-5 gap-6">
                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-green/50 transition-colors">
                        <i data-lucide="shield" class="w-6 h-6 mx-auto mb-2 text-theme-green"></i>
                        <p class="text-xs uppercase tracking-widest text-gray-500 font-cinzel">Blindagem</p>
                        <p id="calc-blindagem" class="text-3xl font-bold text-theme-green font-mono mt-2">0</p>
                    </div>

                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-green/50 transition-colors">
                        <i data-lucide="wind" class="w-6 h-6 mx-auto mb-2 text-theme-green"></i>
                        <p class="text-xs uppercase tracking-widest text-gray-500 font-cinzel">Velocidade</p>
                        <p id="calc-velocidade" class="text-3xl font-bold text-theme-green font-mono mt-2">0</p>
                    </div>

                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-green/50 transition-colors">
                        <i data-lucide="zap" class="w-6 h-6 mx-auto mb-2 text-theme-green"></i>
                        <p class="text-xs uppercase tracking-widest text-gray-500 font-cinzel">Iniciativa</p>
                        <p id="calc-iniciativa" class="text-3xl font-bold text-theme-green font-mono mt-2">0</p>
                    </div>

                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-green/50 transition-colors">
                        <i data-lucide="radar" class="w-6 h-6 mx-auto mb-2 text-theme-green"></i>
                        <p class="text-xs uppercase tracking-widest text-gray-500 font-cinzel">Percep√ß√£o Espacial</p>
                        <p id="calc-percepcao" class="text-3xl font-bold text-theme-green font-mono mt-2">0</p>
                    </div>

                    <div class="bg-[#0a0a0c] border border-theme-border p-4 text-center rounded hover:border-theme-green/50 transition-colors">
                        <i data-lucide="eye-off" class="w-6 h-6 mx-auto mb-2 text-theme-green"></i>
                        <p class="text-xs uppercase tracking-widest text-gray-500 font-cinzel">Vis√£o Noturna</p>
                        <p id="calc-visao-noturna" class="text-3xl font-bold text-theme-green font-mono mt-2">0</p>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o 7: Destino (Card Principal - Tema Marrom/Cobre) -->
            <section class="bg-[#1a1510] border border-[#8b7355] p-4 text-center rounded anim-entry delay-4 group hover:border-[#d4a76a] transition-all duration-300">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full bg-gradient-to-br from-[#8b7355] to-[#d4a76a] flex items-center justify-center shadow-lg">
                    <i data-lucide="clover" class="w-6 h-6 text-white"></i>
                </div>
                <p class="text-xs uppercase tracking-widest text-[#d4a76a] font-cinzel mb-1">Destino</p>
                <p id="calc-sorte" class="text-3xl font-bold text-[#f4d29a] font-mono my-2">--</p>
                <div class="text-xs text-[#8b7355] mb-3">% de Fortuna</div>
                <button onclick="rolarSorte()" 
                    class="w-full px-4 py-2 bg-gradient-to-r from-[#8b7355]/20 to-[#d4a76a]/20 text-[#f4d29a] rounded border border-[#8b7355] hover:border-[#d4a76a] hover:from-[#8b7355]/30 hover:to-[#d4a76a]/30 transition-all duration-300 font-cinzel text-sm group-hover:shadow-lg group-hover:shadow-[#8b7355]/20">
                    <i data-lucide="dice-5" class="w-3 h-3 inline mr-1"></i>
                    Rolar Destino
                </button>
            </section>

            <!-- Se√ß√£o 8: Rolagem do Destino (Expandida - Tema Marrom/Cobre) -->
            <section id="secao-dados-sorte" class="bg-[#1a1510] border border-[#8b7355] p-6 rounded-lg hidden anim-entry delay-4 relative overflow-hidden group hover:border-[#d4a76a] transition-all duration-500">
                <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-[#8b7355] via-[#d4a76a] to-[#f4d29a]"></div>
                
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 rounded bg-[#8b7355]/20 border border-[#8b7355]/30">
                        <i data-lucide="dice-5" class="w-5 h-5 text-[#d4a76a]"></i>
                    </div>
                    <div>
                        <h3 class="font-cinzel text-lg font-semibold text-[#f4d29a]">Rolagem do Destino</h3>
                        <p class="text-[#8b7355] text-sm">Tr√™s dados definem sua fortuna</p>
                    </div>
                </div>
                
                <!-- DADOS VISUAIS -->
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="text-center transform hover:scale-105 transition-transform duration-300">
                        <div class="w-20 h-20 mx-auto mb-3 rounded-xl bg-gradient-to-br from-[#1a1510] to-[#2a2318] flex items-center justify-center border-2 border-[#8b7355] shadow-lg relative overflow-hidden group/dado">
                            <div class="absolute inset-0 bg-gradient-to-br from-transparent via-[#8b7355]/5 to-transparent"></div>
                            <span id="dado-sorte-1" class="text-3xl font-bold text-[#f4d29a] font-mono relative z-10">0</span>
                            <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#d4a76a] to-transparent opacity-0 group-hover/dado:opacity-100 transition-opacity"></div>
                        </div>
                        <p class="text-xs uppercase tracking-widest text-[#8b7355] font-cinzel">F√©</p>
                        <p class="text-xs text-[#8b7355] mt-1">Dado do Cora√ß√£o</p>
                    </div>
                    
                    <div class="text-center transform hover:scale-105 transition-transform duration-300">
                        <div class="w-20 h-20 mx-auto mb-3 rounded-xl bg-gradient-to-br from-[#1a1510] to-[#2a2318] flex items-center justify-center border-2 border-[#8b7355] shadow-lg relative overflow-hidden group/dado">
                            <div class="absolute inset-0 bg-gradient-to-br from-transparent via-[#8b7355]/5 to-transparent"></div>
                            <span id="dado-sorte-2" class="text-3xl font-bold text-[#f4d29a] font-mono relative z-10">0</span>
                            <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#d4a76a] to-transparent opacity-0 group-hover/dado:opacity-100 transition-opacity"></div>
                        </div>
                        <p class="text-xs uppercase tracking-widest text-[#8b7355] font-cinzel">Sorte</p>
                        <p class="text-xs text-[#8b7355] mt-1">Dado do Acaso</p>
                    </div>
                    
                    <div class="text-center transform hover:scale-105 transition-transform duration-300">
                        <div class="w-20 h-20 mx-auto mb-3 rounded-xl bg-gradient-to-br from-[#1a1510] to-[#2a2318] flex items-center justify-center border-2 border-[#8b7355] shadow-lg relative overflow-hidden group/dado">
                            <div class="absolute inset-0 bg-gradient-to-br from-transparent via-[#8b7355]/5 to-transparent"></div>
                            <span id="dado-sorte-3" class="text-3xl font-bold text-[#f4d29a] font-mono relative z-10">0</span>
                            <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#d4a76a] to-transparent opacity-0 group-hover/dado:opacity-100 transition-opacity"></div>
                        </div>
                        <p class="text-xs uppercase tracking-widest text-[#8b7355] font-cinzel">Destino</p>
                        <p class="text-xs text-[#8b7355] mt-1">Dado do Fado</p>
                    </div>
                </div>
                
                <!-- F√ìRMULA E C√ÅLCULO -->
                <div class="bg-gradient-to-r from-[#1a1510] to-[#2a2318] border border-[#8b7355]/30 p-5 rounded-xl mb-6">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="calculator" class="w-4 h-4 text-[#d4a76a]"></i>
                        <span class="font-cinzel text-sm font-semibold text-[#f4d29a]">F√≥rmula do Destino</span>
                    </div>
                    
                    <div class="text-center mb-4">
                        <p class="text-sm text-[#8b7355] mb-1">A magia da probabilidade:</p>
                        <div class="font-mono text-lg text-[#f4d29a] bg-[#1a1510] p-3 rounded border border-[#8b7355]/20">
                            <span class="text-[#d4a76a]">((</span><span class="text-white">F√â</span><span class="text-[#d4a76a]"> + </span><span class="text-white">DESTINO</span><span class="text-[#d4a76a]">) √ó 2 - </span><span class="text-white">SORTE</span><span class="text-[#d4a76a]">) √∑ 2</span>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <p class="text-xs text-[#8b7355] mb-1">C√°lculo atual:</p>
                        <p id="calculo-sorte" class="text-base font-mono text-[#f4d29a]">
                            ((<span class="text-white">0</span> + <span class="text-white">0</span>) √ó 2 - <span class="text-white">0</span>) √∑ 2 = <span class="text-[#d4a76a] font-bold">0</span>
                        </p>
                    </div>
                </div>
                
                <!-- BOT√ïES DE A√á√ÉO -->
                <div class="flex flex-col sm:flex-row justify-center gap-3">
                    <button onclick="rolarSorte()" 
                        class="flex-1 flex items-center justify-center gap-2 px-5 py-3 bg-gradient-to-r from-[#8b7355] to-[#d4a76a] text-white rounded-lg border border-[#8b7355] hover:from-[#9d8465] hover:to-[#e6b97a] hover:shadow-lg hover:shadow-[#8b7355]/30 transition-all duration-300 font-cinzel text-sm font-bold group/btn">
                        <i data-lucide="refresh-cw" class="w-4 h-4 group-hover/btn:rotate-180 transition-transform duration-500"></i>
                        <span>Rolar Novamente</span>
                    </button>
                    
                    <button onclick="fixarSorte()" id="btn-fixar-sorte" 
                        class="flex-1 flex items-center justify-center gap-2 px-5 py-3 bg-gradient-to-r from-[#1a1510] to-[#2a2318] text-[#f4d29a] rounded-lg border border-[#8b7355] hover:border-[#d4a76a] hover:bg-[#2a2318] hover:shadow-lg hover:shadow-[#8b7355]/20 transition-all duration-300 font-cinzel text-sm">
                        <i data-lucide="lock" class="w-4 h-4"></i>
                        <span>Fixar Destino</span>
                    </button>
                </div>
                
                <!-- LEGENDA -->
                <div class="mt-6 pt-4 border-t border-[#8b7355]/20">
                    <div class="flex items-center justify-center gap-4 text-xs text-[#8b7355]">
                        <div class="flex items-center gap-1">
                            <div class="w-2 h-2 rounded-full bg-[#8b7355]"></div>
                            <span>1-25%: Azar Persegue</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-2 h-2 rounded-full bg-[#d4a76a]"></div>
                            <span>26-74%: Destino Misto</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-2 h-2 rounded-full bg-[#f4d29a]"></div>
                            <span>75-100%: Fortuna Sorri</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Rodap√© com Bot√µes de A√ß√£o -->
    <div class="max-w-6xl mx-auto px-4 pb-12 pt-6 flex justify-end gap-4 border-t border-theme-border mt-6 anim-entry delay-4" data-html2pdf-ignore="true">
        <button onclick="resetStats()" 
            class="px-6 py-2 border border-theme-border rounded text-theme-text hover:bg-white/5 transition-colors font-cinzel text-sm">
            Resetar
        </button>
        
        <button onclick="acionarGerarCard()" 
            class="group flex items-center gap-2 px-6 py-2 bg-theme-pink hover:bg-pink-600 rounded text-white shadow-lg transition-all font-cinzel text-sm font-bold">
            <i data-lucide="sheet" class="w-4 h-4"></i>
            <span>Gerar Card Ficha</span>
        </button>
        
        <button onclick="exportDataTXT()" id="btn-txt" 
            class="group flex items-center gap-2 px-4 py-2 bg-theme-purple hover:bg-purple-600 rounded text-white shadow-lg transition-all font-cinzel text-sm font-bold">
            <i data-lucide="file-text" class="w-4 h-4"></i>
            <span>Exportar TXT</span>
        </button>

        <button onclick="saveStats()" id="btn-save" 
            class="group flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-theme-orange to-red-600 rounded text-white shadow-lg hover:shadow-orange-500/20 transition-all font-cinzel text-sm font-bold">
            <i data-lucide="save" class="w-4 h-4"></i>
            <span>Salvar</span>
        </button>
    </div>

    <!-- √Årea de Sa√≠da para Cards -->
    <div class="max-w-6xl mx-auto px-4">
        <section id="card-personagem-output" class="mt-6"></section>
    </div>

    <script>
        lucide.createIcons();

        // ====================================================================
        // 1. VARI√ÅVEIS GLOBAIS E CONSTANTES
        // ====================================================================
        let currentLevel = 1;
        let accumulatedXP = 0;
        let bonusPoints = 0;
        const XP_PER_LEVEL = 1000;
        const ATTRIBUTE_IDS = ['attr-forca', 'attr-destreza', 'attr-constituicao', 'attr-inteligencia', 'attr-sabedoria', 'attr-carisma'];
        
        // Vari√°veis para controle da sorte
        let sorteAtual = null;
        let dadosSorte = [0, 0, 0];
        let sorteFixada = false;

        // ====================================================================
        // 2. SISTEMA DE NAVEGA√á√ÉO ENTRE PERFIL E FICHA
        // ====================================================================
        
        // Fun√ß√£o para ir para a ficha
        function goToFicha() {
            window.location.href = 'ficha.html';
        }
        
        // Fun√ß√£o para voltar ao perfil
        function goToProfile() {
            window.location.href = 'index.html';
        }
        
        // Verificar se h√° perfil ativo ao carregar
        window.addEventListener('load', function() {
            // Adicionar bot√µes de navega√ß√£o na navbar
            const nav = document.querySelector('nav');
            if (nav) {
                const navContent = nav.querySelector('.max-w-7xl');
                if (navContent) {
                    // Adicionar bot√µes √† direita
                    const navButtons = document.createElement('div');
                    navButtons.className = 'ml-auto flex items-center gap-3';
                    navButtons.innerHTML = `
                        <button onclick="goToProfile()" class="flex items-center gap-2 px-3 py-2 text-sm bg-theme-panel hover:bg-theme-panel/80 border border-theme-border rounded transition-colors">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            <span class="hidden sm:inline">Perfil</span>
                        </button>
                        <button onclick="goToFicha()" class="flex items-center gap-2 px-3 py-2 text-sm bg-theme-orange/20 hover:bg-theme-orange/30 text-theme-orange border border-theme-orange/30 rounded transition-colors">
                            <i data-lucide="scroll-text" class="w-4 h-4"></i>
                            <span class="hidden sm:inline">Ficha</span>
                        </button>
                    `;
                    navContent.appendChild(navButtons);
                    lucide.createIcons();
                }
            }
            
            // Verificar se h√° sistema de perfis ativo
            if (typeof window.hasActiveProfile !== 'undefined' && window.hasActiveProfile()) {
                console.log('Sistema de perfis ativo - carregando dados do perfil');
                const dados = carregarDoPerfilAtivo();
                if (dados) {
                    preencherCampos(dados);
                }
            } else {
                console.log('Sistema de perfis n√£o dispon√≠vel - usando localStorage');
                carregarDoLocalStorage();
            }
            
            // Inicializar sistema
            inicializarSistemaClasseDificuldade();
            
            // Configurar listeners
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', recalc);
            });
            
            if (el('input-nome')) {
                el('input-nome').addEventListener('input', recalc);
            }
            
            // Executar c√°lculo inicial
            recalc();
            
            // Se n√£o h√° sorte definida, sugerir rolar
            if (sorteAtual === null) {
                setTimeout(() => {
                    mostrarFeedback("üé≤ Seu destino ainda n√£o foi definido. Clique em 'Rolar Destino' para definir sua fortuna!", 'info');
                }, 1000);
            }
        });

        // ====================================================================
        // 3. FUN√á√ïES UTILIT√ÅRIAS B√ÅSICAS
        // ====================================================================
        function el(id) { return document.getElementById(id); }
        function val(id) { return parseInt(el(id)?.value || 0); }
        function getInt() { return val('attr-inteligencia'); }
        function setTxt(id, value) { const e = el(id); if (e) e.textContent = value; }

        // ====================================================================
        // 4. SISTEMA DE PERFIS SIMPLIFICADO
        // ====================================================================
        
        // Fun√ß√£o para carregar dados do perfil ativo
        function carregarDoPerfilAtivo() {
            try {
                // Tentar usar o sistema de perfis do index.html
                if (typeof window.getActiveProfileData !== 'undefined') {
                    const perfilData = window.getActiveProfileData();
                    if (perfilData && perfilData.status) {
                        console.log('Dados do perfil carregados:', perfilData.status);
                        return perfilData.status;
                    }
                }
                
                // Se n√£o encontrar, tentar localStorage
                const dadosPerfil = localStorage.getItem('rpg_sistema_perfis');
                if (dadosPerfil) {
                    const perfis = JSON.parse(dadosPerfil);
                    const perfilAtivoId = localStorage.getItem('perfil_ativo');
                    if (perfilAtivoId && perfis[perfilAtivoId]) {
                        const perfil = perfis[perfilAtivoId];
                        if (perfil.dados && perfil.dados.status) {
                            return perfil.dados.status;
                        }
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar do perfil:', error);
            }
            return null;
        }
        
        // Fun√ß√£o para salvar dados no perfil ativo
        function salvarNoPerfilAtivo(dados) {
            try {
                // Verificar se existe sistema de perfis
                if (typeof window.getActiveProfile !== 'undefined') {
                    const perfil = window.getActiveProfile();
                    if (perfil) {
                        if (!perfil.dados) perfil.dados = {};
                        perfil.dados.status = dados;
                        window.saveProfiles();
                        return true;
                    }
                }
                
                // Sistema alternativo usando localStorage direto
                const dadosPerfil = localStorage.getItem('rpg_sistema_perfis');
                if (dadosPerfil) {
                    const perfis = JSON.parse(dadosPerfil);
                    const perfilAtivoId = localStorage.getItem('perfil_ativo');
                    
                    if (perfilAtivoId && perfis[perfilAtivoId]) {
                        if (!perfis[perfilAtivoId].dados) perfis[perfilAtivoId].dados = {};
                        perfis[perfilAtivoId].dados.status = dados;
                        localStorage.setItem('rpg_sistema_perfis', JSON.stringify(perfis));
                        return true;
                    }
                }
                
                // Se n√£o houver sistema de perfis, criar um b√°sico
                const perfilBasico = {
                    id: 'default',
                    nome: 'Personagem Principal',
                    data: { status: dados }
                };
                localStorage.setItem('perfil_principal', JSON.stringify(perfilBasico));
                return true;
                
            } catch (error) {
                console.error('Erro ao salvar no perfil:', error);
                return false;
            }
        }
        
        // Fun√ß√£o para carregar do localStorage (sistema antigo)
        function carregarDoLocalStorage() {
            // Carregar dados salvos da ficha
            const dadosFicha = localStorage.getItem('grimorio_ficha_personagem');
            const nome = localStorage.getItem('grimorio_nome_personagem');
            const classe = localStorage.getItem('grimorio_classe_personagem');
            const raca = localStorage.getItem('grimorio_raca_personagem');
            
            // 1. Preencher nome do personagem
            if (nome && nome !== 'null' && nome !== 'undefined') {
                el('input-nome').value = nome;
            }
            
            // 2. Carregar classe e aplicar b√¥nus
            if (classe && classe !== 'null' && classe !== 'undefined') {
                aplicarBonusDeClasse(classe);
            }
            
            // Carregar dados de status antigos
            const dadosAntigos = localStorage.getItem('grimorio_status_data');
            if (dadosAntigos) {
                try {
                    const dados = JSON.parse(dadosAntigos);
                    preencherCampos(dados);
                } catch (error) {
                    console.error('Erro ao carregar dados antigos:', error);
                }
            }
            
            // Carregar sorte do localStorage
            const sorteSalva = localStorage.getItem('grimorio_sorte');
            if (sorteSalva) {
                try {
                    const dados = JSON.parse(sorteSalva);
                    sorteAtual = dados.valor;
                    dadosSorte = dados.dados || [0, 0, 0];
                    sorteFixada = dados.fixada || false;
                    
                    if (sorteAtual !== null) {
                        atualizarDisplaySorte();
                        gerarRecomendacoesBaseadasNaSorte(sorteAtual);
                    }
                } catch (error) {
                    console.error('Erro ao carregar sorte:', error);
                }
            }
        }

        // ====================================================================
        // 5. FUN√á√ÉO PARA COLETAR DADOS DA P√ÅGINA
        // ====================================================================
        function coletarDadosDaPagina() {
            const dados = {};
            
            // Capturar todos os inputs
            document.querySelectorAll('#status-content input[type="number"], #status-content input[type="text"]').forEach(input => {
                dados[input.id] = input.value;
            });
            
            // Adicionar vari√°veis globais
            dados['GLOBAL_LEVEL'] = currentLevel;
            dados['GLOBAL_XP'] = accumulatedXP;
            dados['GLOBAL_BONUS_POINTS'] = bonusPoints;
            
            // Adicionar dados da sorte
            dados['SORTE'] = {
                valor: sorteAtual,
                dados: dadosSorte,
                fixada: sorteFixada,
                timestamp: new Date().toISOString()
            };
            
            return dados;
        }

        // ====================================================================
        // 6. FUN√á√ÉO PARA PREENCHER CAMPOS
        // ====================================================================
        function preencherCampos(dados) {
            if (!dados) return;
            
            // Restaurar inputs b√°sicos
            Object.keys(dados).forEach(key => {
                if (key.startsWith('input-') || key.startsWith('attr-') || key === 'GLOBAL_LEVEL' || key === 'GLOBAL_XP' || key === 'GLOBAL_BONUS_POINTS') {
                    const element = el(key);
                    if (element && dados[key] !== undefined && dados[key] !== null) {
                        element.value = dados[key];
                    }
                }
            });
            
            // Restaurar vari√°veis globais
            currentLevel = parseInt(dados['GLOBAL_LEVEL']) || 1;
            accumulatedXP = parseInt(dados['GLOBAL_XP']) || 0;
            bonusPoints = parseInt(dados['GLOBAL_BONUS_POINTS']) || 0;
            
            // Restaurar dados da sorte
            if (dados['SORTE']) {
                const sorteData = dados['SORTE'];
                sorteAtual = sorteData.valor;
                dadosSorte = sorteData.dados || [0, 0, 0];
                sorteFixada = sorteData.fixada || false;
                
                if (sorteAtual !== null) {
                    atualizarDisplaySorte();
                    
                    if (sorteFixada) {
                        el('secao-dados-sorte').classList.remove('hidden');
                        const botaoFixar = el('btn-fixar-sorte');
                        if (botaoFixar) {
                            botaoFixar.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Destino Selado!';
                            botaoFixar.disabled = true;
                            lucide.createIcons();
                        }
                    }
                    
                    gerarRecomendacoesBaseadasNaSorte(sorteAtual);
                }
            }
        }

        // ====================================================================
        // 7. SISTEMA DE SALVAMENTO UNIFICADO
        // ====================================================================
        function saveStats(showFeedback = true) {
            const dados = coletarDadosDaPagina();
            
            // 1. Salvar no perfil (sistema novo)
            const salvoNoPerfil = salvarNoPerfilAtivo(dados);
            
            // 2. Salvar localmente tamb√©m (backup e compatibilidade)
            localStorage.setItem('grimorio_status_data', JSON.stringify(dados));
            
            // 3. Salvar sorte separadamente (para persist√™ncia extra)
            if (sorteAtual !== null) {
                const dadosSorteSalvar = {
                    valor: sorteAtual,
                    dados: dadosSorte,
                    fixada: sorteFixada,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('grimorio_sorte', JSON.stringify(dadosSorteSalvar));
            }
            
            // Feedback visual
            if (showFeedback) {
                const btn = el('btn-save');
                const originalContent = btn.innerHTML;
                
                btn.disabled = true;
                btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Salvando...`;
                lucide.createIcons();
                
                setTimeout(() => {
                    let mensagem = 'Salvo localmente!';
                    if (salvoNoPerfil) {
                        mensagem = 'Salvo no perfil!';
                    }
                    
                    btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> ${mensagem}`;
                    lucide.createIcons();
                    
                    setTimeout(() => {
                        btn.disabled = false;
                        btn.innerHTML = originalContent;
                        lucide.createIcons();
                    }, 2000);
                    
                    mostrarFeedback(mensagem, 'success');
                }, 1000);
            }
        }

        // ====================================================================
        // 8. SISTEMA DE DESTINO/SORTE (PERSISTENTE)
        // ====================================================================
        function rolarSorte() {
            if (sorteFixada) {
                if (!confirm("O destino est√° fixado! Deseja rolar novamente e sobrescrever?")) {
                    return;
                }
                sorteFixada = false;
                
                // Reativar bot√£o de fixar
                const botaoFixar = el('btn-fixar-sorte');
                if (botaoFixar) {
                    botaoFixar.innerHTML = '<i data-lucide="lock" class="w-4 h-4"></i> Fixar Destino';
                    botaoFixar.disabled = false;
                    botaoFixar.classList.remove('bg-gradient-to-r', 'from-[#8b7355]/30', 'to-[#d4a76a]/30', 'border-[#d4a76a]');
                    botaoFixar.classList.add('bg-gradient-to-r', 'from-[#1a1510]', 'to-[#2a2318]');
                    lucide.createIcons();
                }
            }
            
            // Rolar 3 dados de 1 a 100
            const dado1 = Math.floor(Math.random() * 100) + 1;
            const dado2 = Math.floor(Math.random() * 100) + 1;
            const dado3 = Math.floor(Math.random() * 100) + 1;
            
            dadosSorte = [dado1, dado2, dado3];
            
            // Aplicar a f√≥rmula: ((dado1 + dado3) * 2 - dado2) / 2
            const resultadoBruto = ((dado1 + dado3) * 2 - dado2) / 2;
            
            // Garantir que o resultado esteja entre 1 e 100
            let resultadoFinal = Math.round(resultadoBruto);
            resultadoFinal = Math.max(1, Math.min(100, resultadoFinal));
            
            sorteAtual = resultadoFinal;
            
            // Atualizar a interface
            atualizarDisplaySorte();
            
            // Mostrar a se√ß√£o de dados
            el('secao-dados-sorte').classList.remove('hidden');
            
            // Gerar recomenda√ß√µes baseadas na nova sorte
            gerarRecomendacoesBaseadasNaSorte(sorteAtual);
            
            // Salvar automaticamente (sem feedback)
            saveStats(false);
            
            mostrarFeedback(`üé≤ Destino rolado: ${sorteAtual}%`, 'success');
        }

        function fixarSorte() {
            sorteFixada = true;
            
            // Atualizar bot√£o
            const botaoFixar = el('btn-fixar-sorte');
            if (botaoFixar) {
                botaoFixar.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Destino Selado!';
                botaoFixar.classList.remove('bg-gradient-to-r', 'from-[#1a1510]', 'to-[#2a2318]', 'hover:bg-[#2a2318]');
                botaoFixar.classList.add('bg-gradient-to-r', 'from-[#8b7355]/30', 'to-[#d4a76a]/30', 'border-[#d4a76a]');
                botaoFixar.disabled = true;
                lucide.createIcons();
            }
            
            // Salvar automaticamente
            saveStats(false);
            
            // Feedback
            let mensagem = '';
            if (sorteAtual >= 75) {
                mensagem = `‚ú® Destino glorioso fixado em ${sorteAtual}%!`;
            } else if (sorteAtual <= 25) {
                mensagem = `üåë Destino sombrio fixado em ${sorteAtual}%.`;
            } else {
                mensagem = `‚öñÔ∏è Destino fixado em ${sorteAtual}%.`;
            }
            
            mostrarFeedback(mensagem, 'success');
        }

        function atualizarDisplaySorte() {
            // Atualizar o card principal
            const cardSorte = el('calc-sorte');
            if (cardSorte) {
                cardSorte.textContent = sorteAtual !== null ? `${sorteAtual}%` : '--';
                
                // Cor din√¢mica baseada no valor
                const cardContainer = cardSorte.closest('.bg-\\[\\#1a1510\\]');
                if (cardContainer) {
                    cardContainer.classList.remove('border-[#f4d29a]', 'shadow-lg', 'shadow-[#f4d29a]/20', 'border-[#8b4513]');
                    
                    if (sorteAtual >= 75) {
                        cardContainer.classList.add('border-[#f4d29a]', 'shadow-lg', 'shadow-[#f4d29a]/20');
                    } else if (sorteAtual <= 25) {
                        cardContainer.classList.add('border-[#8b4513]');
                    } else {
                        cardContainer.classList.add('border-[#8b7355]');
                    }
                }
            }
            
            // Atualizar os dados visuais
            const dadosIds = ['dado-sorte-1', 'dado-sorte-2', 'dado-sorte-3'];
            dadosIds.forEach((id, index) => {
                const elemento = el(id);
                if (elemento) {
                    elemento.textContent = dadosSorte[index];
                }
            });
            
            // Atualizar o c√°lculo
            const calculo = `((<span class="text-white">${dadosSorte[0]}</span> + <span class="text-white">${dadosSorte[2]}</span>) √ó 2 - <span class="text-white">${dadosSorte[1]}</span>) √∑ 2 = <span class="${sorteAtual >= 75 ? 'text-[#f4d29a]' : sorteAtual <= 25 ? 'text-[#8b4513]' : 'text-[#d4a76a]'} font-bold">${sorteAtual}</span>`;
            const calculoElement = el('calculo-sorte');
            if (calculoElement) {
                calculoElement.innerHTML = calculo;
            }
        }

        // ====================================================================
        // 9. FUN√á√ÉO PARA B√îNUS DE CLASSE (SIMPLIFICADA)
        // ====================================================================
        function aplicarBonusDeClasse(classe) {
            const CLASS_BONUSES = {
                guerreiro: { for: 4, dex: 2, con: 4, int: 1, wis: 2, cha: 1 },
                mago: { for: 1, dex: 2, con: 2, int: 6, wis: 4, cha: 3 },
                arqueiro: { for: 2, dex: 6, con: 3, int: 3, wis: 3, cha: 1 },
                ladino: { for: 2, dex: 6, con: 2, int: 3, wis: 2, cha: 3 },
                paladino: { for: 5, dex: 1, con: 4, int: 2, wis: 3, cha: 4 },
                bardo: { for: 1, dex: 3, con: 2, int: 4, wis: 3, cha: 6 },
                cl√©rigo: { for: 2, dex: 1, con: 3, int: 3, wis: 6, cha: 4 },
                druida: { for: 2, dex: 2, con: 3, int: 4, wis: 5, cha: 2 },
                feiticeiro: { for: 1, dex: 2, con: 2, int: 5, wis: 3, cha: 5 },
                barbaro: { for: 6, dex: 3, con: 5, int: 1, wis: 2, cha: 1 }
            };
            
            const classeLower = classe.toLowerCase();
            const bonus = CLASS_BONUSES[classeLower];
            
            if (bonus) {
                el('attr-forca').value = (parseInt(el('attr-forca').value) || 0) + bonus.for;
                el('attr-destreza').value = (parseInt(el('attr-destreza').value) || 0) + bonus.dex;
                el('attr-constituicao').value = (parseInt(el('attr-constituicao').value) || 0) + bonus.con;
                el('attr-inteligencia').value = (parseInt(el('attr-inteligencia').value) || 0) + bonus.int;
                el('attr-sabedoria').value = (parseInt(el('attr-sabedoria').value) || 0) + bonus.wis;
                el('attr-carisma').value = (parseInt(el('attr-carisma').value) || 0) + bonus.cha;
            }
        }

        // ====================================================================
        // 10. FUN√á√ïES B√ÅSICAS DO SISTEMA (MANTIDAS)
        // ====================================================================
        function mostrarFeedback(mensagem, tipo = 'info') {
            console.log(`[${tipo.toUpperCase()}] ${mensagem}`);
            
            const feedback = document.createElement('div');
            feedback.className = `feedback-msg fixed top-4 right-4 z-50 px-4 py-3 rounded-lg border shadow-lg transition-all duration-500 animate-in slide-in-from-right-10 ${
                tipo === 'success' ? 'bg-green-900/30 border-green-700 text-green-300' :
                tipo === 'warning' ? 'bg-yellow-900/30 border-yellow-700 text-yellow-300' :
                tipo === 'error' ? 'bg-red-900/30 border-red-700 text-red-300' :
                'bg-blue-900/30 border-blue-700 text-blue-300'
            }`;
            
            feedback.innerHTML = `
                <div class="flex items-center gap-2">
                    <i data-lucide="${
                        tipo === 'success' ? 'check-circle' :
                        tipo === 'warning' ? 'alert-triangle' :
                        tipo === 'error' ? 'x-circle' : 'info'
                    }" class="w-4 h-4"></i>
                    <span class="font-medium">${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(feedback);
            lucide.createIcons();
            
            setTimeout(() => {
                feedback.style.opacity = '0';
                feedback.style.transform = 'translateX(20px)';
                setTimeout(() => feedback.remove(), 500);
            }, 5000);
        }

        function gerarRecomendacoesBaseadasNaSorte(sorte) {
            const container = el('card-personagem-output');
            if (!container) return;
            
            let recomendacao = '';
            let icone = 'üéØ';
            
            if (sorte >= 90) {
                recomendacao = 'SORTE LEND√ÅRIA! Voc√™ √© aben√ßoado pelos deuses.';
                icone = '‚ú®';
            } else if (sorte >= 75) {
                recomendacao = 'Sorte excelente! Foque em armas com alto dano cr√≠tico.';
                icone = 'üé≤';
            } else if (sorte >= 60) {
                recomendacao = 'Sorte acima da m√©dia. Armas balanceadas s√£o ideais.';
                icone = 'üçÄ';
            } else if (sorte >= 40) {
                recomendacao = 'Sorte mediana. Use armas confi√°veis com dano constante.';
                icone = '‚öñÔ∏è';
            } else if (sorte >= 25) {
                recomendacao = 'Sorte abaixo da m√©dia. Prefira armas defensivas.';
                icone = 'üõ°Ô∏è';
            } else {
                recomendacao = 'Sorte cr√≠tica baixa. Foque em sobreviv√™ncia.';
                icone = '‚ö†Ô∏è';
            }
            
            let cardSorte = el('card-recomendacao-sorte');
            if (!cardSorte) {
                cardSorte = document.createElement('div');
                cardSorte.id = 'card-recomendacao-sorte';
                cardSorte.className = `bg-[#1a1510] border border-[#8b7355] p-4 rounded-lg mb-4`;
                container.prepend(cardSorte);
            }
            
            cardSorte.innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">${icone}</span>
                    <span class="font-cinzel font-bold text-[#f4d29a]">DESTINO: ${sorte}%</span>
                </div>
                <p class="text-[#d4a76a]">${recomendacao}</p>
            `;
        }

        // ====================================================================
        // 11. FUN√á√ïES DO SISTEMA PRINCIPAL (MANTIDAS DO SEU C√ìDIGO ORIGINAL)
        // ====================================================================
        
        // ... (COLE AQUI TODAS AS OUTRAS FUN√á√ïES DO SEU C√ìDIGO ORIGINAL: 
        // recalc, checkLevelUp, addXP, updateBonusDisplay, changeAttr, 
        // rolarAtributos, updateBar, resetStats, exportDataTXT, 
        // acionarGerarCard, inicializarSistemaClasseDificuldade, etc.)
        
        // Mantenha todas as constantes e fun√ß√µes que j√° estavam funcionando

        // ====================================================================
        // 12. EXPORTA√á√ÉO TXT SIMPLIFICADA
        // ====================================================================
        function exportDataTXT() {
            const btn = el('btn-txt');
            const originalContent = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Exportando...`;
            lucide.createIcons();
            
            const dados = coletarDadosDaPagina();
            
            let outputText = "=== STATUS DO PERSONAGEM ===\n\n";
            outputText += `Nome: ${el('input-nome').value}\n`;
            outputText += `N√≠vel: ${currentLevel}\n`;
            outputText += `XP: ${accumulatedXP}/${XP_PER_LEVEL}\n\n`;
            
            outputText += "=== ATRIBUTOS ===\n";
            outputText += `For√ßa: ${val('attr-forca')}\n`;
            outputText += `Destreza: ${val('attr-destreza')}\n`;
            outputText += `Constitui√ß√£o: ${val('attr-constituicao')}\n`;
            outputText += `Intelig√™ncia: ${val('attr-inteligencia')}\n`;
            outputText += `Sabedoria: ${val('attr-sabedoria')}\n`;
            outputText += `Carisma: ${val('attr-carisma')}\n\n`;
            
            outputText += "=== RECURSOS ===\n";
            outputText += `Vida: ${val('input-vida-atual')}/${val('input-vida-max')}\n`;
            outputText += `Mana: ${val('input-mana-atual')}/${val('input-mana-max')}\n`;
            outputText += `Estamina: ${val('input-estamina-atual')}/${val('input-estamina-max')}\n\n`;
            
            if (sorteAtual !== null) {
                outputText += "=== DESTINO ===\n";
                outputText += `Sorte: ${sorteAtual}%\n`;
                outputText += `Status: ${sorteFixada ? 'Fixado' : 'N√£o fixado'}\n`;
            }
            
            outputText += `\nExportado em: ${new Date().toLocaleString('pt-BR')}`;
            
            const blob = new Blob([outputText], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Status_${el('input-nome').value || 'Personagem'}.txt`;
            
            setTimeout(() => {
                link.click();
                btn.disabled = false;
                btn.innerHTML = originalContent;
                lucide.createIcons();
                mostrarFeedback("Dados exportados com sucesso!", 'success');
            }, 500);
        }

    </script>
</body>
</html>